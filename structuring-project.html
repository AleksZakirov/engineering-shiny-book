<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Structuring Your Project | Engineering Production-Grade Shiny Apps</title>
  <meta name="description" content="A book about engineering shiny application that will later be sent to production. This book cover project management, structuring your project, building a solid testing suite, and optimizing your codebase. We describe in this book a specific workflow: design, prototype, build, strengthen and deploy." />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Structuring Your Project | Engineering Production-Grade Shiny Apps" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="https://raw.githubusercontent.com/ThinkR-open/engineering-shiny-book/master/img/engineering-shiny.jpg" />
  <meta property="og:description" content="A book about engineering shiny application that will later be sent to production. This book cover project management, structuring your project, building a solid testing suite, and optimizing your codebase. We describe in this book a specific workflow: design, prototype, build, strengthen and deploy." />
  <meta name="github-repo" content="ThinkR-open/building-shiny-apps-workflow" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Structuring Your Project | Engineering Production-Grade Shiny Apps" />
  
  <meta name="twitter:description" content="A book about engineering shiny application that will later be sent to production. This book cover project management, structuring your project, building a solid testing suite, and optimizing your codebase. We describe in this book a specific workflow: design, prototype, build, strengthen and deploy." />
  <meta name="twitter:image" content="https://raw.githubusercontent.com/ThinkR-open/engineering-shiny-book/master/img/engineering-shiny.jpg" />

<meta name="author" content="Colin Fay, Sébastien Rochette, Vincent Guyader, Cervan Girard" />


<meta name="date" content="2021-07-16" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon" />
<link rel="prev" href="planning-ahead.html"/>
<link rel="next" href="golem.html"/>
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block/empty-anchor.js"></script>
<link href="libs/anchor-sections/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections/anchor-sections.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-149994171-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-149994171-1');
</script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
<link rel="stylesheet" href="css/thinkr.css" type="text/css" />
<link rel="stylesheet" href="css/style_gitbook.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Engineering Production-Grade Shiny Apps</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#motivation"><i class="fa fa-check"></i>Motivation</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#audience-for-this-book"><i class="fa fa-check"></i>Audience for this book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-is-production"><i class="fa fa-check"></i>What is “production”?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#book-structure"><i class="fa fa-check"></i>Book structure</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-the-authors"><i class="fa fa-check"></i>About the authors</a><ul>
<li><a href="index.html#colin-fay"><a href="https://colinfay.me/">Colin Fay</a></a></li>
<li><a href="index.html#sébastien-rochette"><a href="https://statnmap.com/">Sébastien Rochette</a></a></li>
<li><a href="index.html#vincent-guyader"><a href="https://twitter.com/VincentGuyader">Vincent Guyader</a></a></li>
<li><a href="index.html#cervan-girard"><a href="https://twitter.com/CervanGirard">Cervan Girard</a></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#disclaimer"><i class="fa fa-check"></i>Disclaimer</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#software-information-and-conventions"><i class="fa fa-check"></i>Software information and conventions</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#want-to-help"><i class="fa fa-check"></i>Want to help?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#other-resources"><i class="fa fa-check"></i>Other resources</a><ul>
<li><a href="index.html#getting-started-with-shiny">Getting started with <code>{shiny}</code></a></li>
<li><a href="index.html#putting-shiny-into-production">Putting <code>{shiny}</code> into production</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgments"><i class="fa fa-check"></i>Acknowledgments</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#special-thanks"><i class="fa fa-check"></i>Special thanks</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#contributors-to-this-book"><i class="fa fa-check"></i>Contributors to this book</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="foreword.html"><a href="foreword.html"><i class="fa fa-check"></i>Foreword</a></li>
<li class="chapter" data-level="" data-path="application-presentation.html"><a href="application-presentation.html"><i class="fa fa-check"></i>Application presentation</a><ul>
<li><a href="application-presentation.html#hexmake"><code>{hexmake}</code></a></li>
<li><a href="application-presentation.html#tidytuesday201942"><code>{tidytuesday201942}</code></a></li>
<li><a href="application-presentation.html#minifying"><code>{minifying}</code></a></li>
<li class="chapter" data-level="" data-path="application-presentation.html"><a href="application-presentation.html#other-applications"><i class="fa fa-check"></i>Other applications</a></li>
</ul></li>
<li class="part"><span><b>I Building Successful {shiny} Apps</b></span></li>
<li class="chapter" data-level="1" data-path="successful-shiny-app.html"><a href="successful-shiny-app.html"><i class="fa fa-check"></i><b>1</b> About Successful <code>{shiny}</code> Apps</a><ul>
<li class="chapter" data-level="1.1" data-path="successful-shiny-app.html"><a href="successful-shiny-app.html#a-very-short-introduction-to-shiny"><i class="fa fa-check"></i><b>1.1</b> A (very) short introduction to <code>{shiny}</code></a></li>
<li class="chapter" data-level="1.2" data-path="successful-shiny-app.html"><a href="successful-shiny-app.html#complex-shiny"><i class="fa fa-check"></i><b>1.2</b> What is a complex <code>{shiny}</code> application?</a><ul>
<li class="chapter" data-level="1.2.1" data-path="successful-shiny-app.html"><a href="successful-shiny-app.html#reaching-the-cliff-of-complexity"><i class="fa fa-check"></i><b>1.2.1</b> Reaching the cliff of complexity</a></li>
<li class="chapter" data-level="1.2.2" data-path="successful-shiny-app.html"><a href="successful-shiny-app.html#balancing-complexities"><i class="fa fa-check"></i><b>1.2.2</b> Balancing complexities</a></li>
<li class="chapter" data-level="1.2.3" data-path="successful-shiny-app.html"><a href="successful-shiny-app.html#assessing-code-complexity"><i class="fa fa-check"></i><b>1.2.3</b> Assessing code complexity</a></li>
<li class="chapter" data-level="1.2.4" data-path="successful-shiny-app.html"><a href="successful-shiny-app.html#production-grade-software-engineering"><i class="fa fa-check"></i><b>1.2.4</b> Production-grade software engineering</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="successful-shiny-app.html"><a href="successful-shiny-app.html#what-is-a-successful-shiny-app"><i class="fa fa-check"></i><b>1.3</b> What is a successful <code>{shiny}</code> app?</a><ul>
<li class="chapter" data-level="1.3.1" data-path="successful-shiny-app.html"><a href="successful-shiny-app.html#it-exists"><i class="fa fa-check"></i><b>1.3.1</b> It exists</a></li>
<li class="chapter" data-level="1.3.2" data-path="successful-shiny-app.html"><a href="successful-shiny-app.html#it-is-accurate"><i class="fa fa-check"></i><b>1.3.2</b> It is accurate</a></li>
<li class="chapter" data-level="1.3.3" data-path="successful-shiny-app.html"><a href="successful-shiny-app.html#it-is-usable"><i class="fa fa-check"></i><b>1.3.3</b> It is usable</a></li>
<li class="chapter" data-level="1.3.4" data-path="successful-shiny-app.html"><a href="successful-shiny-app.html#it-is-immortal"><i class="fa fa-check"></i><b>1.3.4</b> It is immortal</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="planning-ahead.html"><a href="planning-ahead.html"><i class="fa fa-check"></i><b>2</b> Planning Ahead</a><ul>
<li class="chapter" data-level="2.1" data-path="planning-ahead.html"><a href="planning-ahead.html#working-with-a-long-term-mindset"><i class="fa fa-check"></i><b>2.1</b> Working with a “long-term” mindset</a><ul>
<li class="chapter" data-level="2.1.1" data-path="planning-ahead.html"><a href="planning-ahead.html#prepare-for-success"><i class="fa fa-check"></i><b>2.1.1</b> Prepare for success</a></li>
<li class="chapter" data-level="2.1.2" data-path="planning-ahead.html"><a href="planning-ahead.html#develop-with-the-kiss-principle"><i class="fa fa-check"></i><b>2.1.2</b> Develop with the KISS principle</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="planning-ahead.html"><a href="planning-ahead.html#working-as-a-team-tools-and-structure"><i class="fa fa-check"></i><b>2.2</b> Working as a team: Tools and structure</a><ul>
<li class="chapter" data-level="2.2.1" data-path="planning-ahead.html"><a href="planning-ahead.html#from-the-tools-point-of-view"><i class="fa fa-check"></i><b>2.2.1</b> From the tools point of view</a></li>
<li class="chapter" data-level="2.2.2" data-path="planning-ahead.html"><a href="planning-ahead.html#from-the-team-point-of-view"><i class="fa fa-check"></i><b>2.2.2</b> From the team point of view</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="structuring-project.html"><a href="structuring-project.html"><i class="fa fa-check"></i><b>3</b> Structuring Your Project</a><ul>
<li class="chapter" data-level="3.1" data-path="structuring-project.html"><a href="structuring-project.html#shiny-app-as-a-package"><i class="fa fa-check"></i><b>3.1</b> <code>{shiny}</code> app as a package</a><ul>
<li class="chapter" data-level="3.1.1" data-path="structuring-project.html"><a href="structuring-project.html#what-is-in-a-production-grade-shiny-app"><i class="fa fa-check"></i><b>3.1.1</b> What is in a production-grade <code>{shiny}</code> app?</a></li>
<li class="chapter" data-level="3.1.2" data-path="structuring-project.html"><a href="structuring-project.html#resources"><i class="fa fa-check"></i><b>3.1.2</b> Resources</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="structuring-project.html"><a href="structuring-project.html#using-shiny-modules"><i class="fa fa-check"></i><b>3.2</b> Using <code>{shiny}</code> modules</a><ul>
<li class="chapter" data-level="3.2.1" data-path="structuring-project.html"><a href="structuring-project.html#why-shiny-modules"><i class="fa fa-check"></i><b>3.2.1</b> Why <code>{shiny}</code> modules?</a></li>
<li class="chapter" data-level="3.2.2" data-path="structuring-project.html"><a href="structuring-project.html#when-to-use-shiny-modules"><i class="fa fa-check"></i><b>3.2.2</b> When to use <code>{shiny}</code> modules</a></li>
<li class="chapter" data-level="3.2.3" data-path="structuring-project.html"><a href="structuring-project.html#a-practical-walkthrough"><i class="fa fa-check"></i><b>3.2.3</b> A practical walkthrough</a></li>
<li class="chapter" data-level="3.2.4" data-path="structuring-project.html"><a href="structuring-project.html#communication-between-modules"><i class="fa fa-check"></i><b>3.2.4</b> Communication between modules</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="structuring-project.html"><a href="structuring-project.html#structuring-your-app"><i class="fa fa-check"></i><b>3.3</b> Structuring your app</a><ul>
<li class="chapter" data-level="3.3.1" data-path="structuring-project.html"><a href="structuring-project.html#business-logic-and-application-logic"><i class="fa fa-check"></i><b>3.3.1</b> Business logic and application logic</a></li>
<li class="chapter" data-level="3.3.2" data-path="structuring-project.html"><a href="structuring-project.html#small-is-beautiful-bis-repetita"><i class="fa fa-check"></i><b>3.3.2</b> Small is beautiful (bis repetita)</a></li>
<li class="chapter" data-level="3.3.3" data-path="structuring-project.html"><a href="structuring-project.html#conventions-matter"><i class="fa fa-check"></i><b>3.3.3</b> Conventions matter</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="golem.html"><a href="golem.html"><i class="fa fa-check"></i><b>4</b> Introduction to <code>{golem}</code></a><ul>
<li class="chapter" data-level="4.1" data-path="golem.html"><a href="golem.html#what-is-golem"><i class="fa fa-check"></i><b>4.1</b> What is <code>{golem}</code>?</a></li>
<li class="chapter" data-level="4.2" data-path="golem.html"><a href="golem.html#understanding-golem-app-structure"><i class="fa fa-check"></i><b>4.2</b> Understanding <code>{golem}</code> app structure</a><ul>
<li class="chapter" data-level="4.2.1" data-path="golem.html"><a href="golem.html#description-and-namespace"><i class="fa fa-check"></i><b>4.2.1</b> <code>DESCRIPTION</code> and <code>NAMESPACE</code></a></li>
<li class="chapter" data-level="4.2.2" data-path="golem.html"><a href="golem.html#r"><i class="fa fa-check"></i><b>4.2.2</b> R/</a></li>
<li class="chapter" data-level="4.2.3" data-path="golem.html"><a href="golem.html#golem-config"><i class="fa fa-check"></i><b>4.2.3</b> <code>golem-config</code></a></li>
<li class="chapter" data-level="4.2.4" data-path="golem.html"><a href="golem.html#instappwww"><i class="fa fa-check"></i><b>4.2.4</b> <code>inst/app/www/</code></a></li>
<li class="chapter" data-level="4.2.5" data-path="golem.html"><a href="golem.html#dev"><i class="fa fa-check"></i><b>4.2.5</b> <code>dev/</code></a></li>
<li class="chapter" data-level="4.2.6" data-path="golem.html"><a href="golem.html#man"><i class="fa fa-check"></i><b>4.2.6</b> <code>man/</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="workflow.html"><a href="workflow.html"><i class="fa fa-check"></i><b>5</b> The Workflow</a><ul>
<li class="chapter" data-level="5.1" data-path="workflow.html"><a href="workflow.html#step-1-design"><i class="fa fa-check"></i><b>5.1</b> Step 1: Design</a></li>
<li class="chapter" data-level="5.2" data-path="workflow.html"><a href="workflow.html#step-2-prototype"><i class="fa fa-check"></i><b>5.2</b> Step 2: Prototype</a></li>
<li class="chapter" data-level="5.3" data-path="workflow.html"><a href="workflow.html#step-3-build"><i class="fa fa-check"></i><b>5.3</b> Step 3: Build</a></li>
<li class="chapter" data-level="5.4" data-path="workflow.html"><a href="workflow.html#step-4-strengthen"><i class="fa fa-check"></i><b>5.4</b> Step 4: Strengthen</a></li>
<li class="chapter" data-level="5.5" data-path="workflow.html"><a href="workflow.html#step-5-deploy"><i class="fa fa-check"></i><b>5.5</b> Step 5: Deploy</a></li>
</ul></li>
<li class="part"><span><b>II Step 1: Design</b></span></li>
<li class="chapter" data-level="6" data-path="ux-matters.html"><a href="ux-matters.html"><i class="fa fa-check"></i><b>6</b> UX Matters</a><ul>
<li class="chapter" data-level="6.1" data-path="ux-matters.html"><a href="ux-matters.html#simplicity-is-gold"><i class="fa fa-check"></i><b>6.1</b> Simplicity is gold</a><ul>
<li class="chapter" data-level="6.1.1" data-path="ux-matters.html"><a href="ux-matters.html#how-we-read-the-web-scanning-content"><i class="fa fa-check"></i><b>6.1.1</b> How we read the web: Scanning content</a></li>
<li class="chapter" data-level="6.1.2" data-path="ux-matters.html"><a href="ux-matters.html#building-a-self-evident-app-or-at-least-self-explanatory"><i class="fa fa-check"></i><b>6.1.2</b> Building a self-evident app (or at least self-explanatory)</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="ux-matters.html"><a href="ux-matters.html#the-danger-of-feature-creep"><i class="fa fa-check"></i><b>6.2</b> The danger of feature-creep</a><ul>
<li class="chapter" data-level="6.2.1" data-path="ux-matters.html"><a href="ux-matters.html#what-is-feature-creep"><i class="fa fa-check"></i><b>6.2.1</b> What is feature-creep?</a></li>
<li class="chapter" data-level="6.2.2" data-path="ux-matters.html"><a href="ux-matters.html#too-much-reactivity"><i class="fa fa-check"></i><b>6.2.2</b> Too much reactivity</a></li>
<li class="chapter" data-level="6.2.3" data-path="ux-matters.html"><a href="ux-matters.html#too-much-interactivity"><i class="fa fa-check"></i><b>6.2.3</b> Too much interactivity</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="ux-matters.html"><a href="ux-matters.html#web-accessibility"><i class="fa fa-check"></i><b>6.3</b> Web accessibility</a><ul>
<li class="chapter" data-level="6.3.1" data-path="ux-matters.html"><a href="ux-matters.html#about-accessibility"><i class="fa fa-check"></i><b>6.3.1</b> About accessibility</a></li>
<li class="chapter" data-level="6.3.2" data-path="ux-matters.html"><a href="ux-matters.html#making-your-app-accessible"><i class="fa fa-check"></i><b>6.3.2</b> Making your app accessible</a></li>
<li class="chapter" data-level="6.3.3" data-path="ux-matters.html"><a href="ux-matters.html#evaluating-your-app-accessibility-and-further-reading"><i class="fa fa-check"></i><b>6.3.3</b> Evaluating your app accessibility and further reading</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="dont-rush-into-coding.html"><a href="dont-rush-into-coding.html"><i class="fa fa-check"></i><b>7</b> Don’t Rush into Coding</a><ul>
<li class="chapter" data-level="7.1" data-path="dont-rush-into-coding.html"><a href="dont-rush-into-coding.html#designing-before-coding"><i class="fa fa-check"></i><b>7.1</b> Designing before coding</a><ul>
<li class="chapter" data-level="7.1.1" data-path="dont-rush-into-coding.html"><a href="dont-rush-into-coding.html#the-urge-to-code"><i class="fa fa-check"></i><b>7.1.1</b> The urge to code</a></li>
<li class="chapter" data-level="7.1.2" data-path="dont-rush-into-coding.html"><a href="dont-rush-into-coding.html#knowing-where-to-search"><i class="fa fa-check"></i><b>7.1.2</b> Knowing where to search</a></li>
<li class="chapter" data-level="7.1.3" data-path="dont-rush-into-coding.html"><a href="dont-rush-into-coding.html#about-concept-map"><i class="fa fa-check"></i><b>7.1.3</b> About concept map</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="dont-rush-into-coding.html"><a href="dont-rush-into-coding.html#ask-questions"><i class="fa fa-check"></i><b>7.2</b> Ask questions</a><ul>
<li class="chapter" data-level="7.2.1" data-path="dont-rush-into-coding.html"><a href="dont-rush-into-coding.html#about-the-end-users"><i class="fa fa-check"></i><b>7.2.1</b> About the end users</a></li>
<li class="chapter" data-level="7.2.2" data-path="dont-rush-into-coding.html"><a href="dont-rush-into-coding.html#building-personas"><i class="fa fa-check"></i><b>7.2.2</b> Building personas</a></li>
<li class="chapter" data-level="7.2.3" data-path="dont-rush-into-coding.html"><a href="dont-rush-into-coding.html#pre-existing-code-base"><i class="fa fa-check"></i><b>7.2.3</b> Pre-existing code-base</a></li>
<li class="chapter" data-level="7.2.4" data-path="dont-rush-into-coding.html"><a href="dont-rush-into-coding.html#deployment"><i class="fa fa-check"></i><b>7.2.4</b> Deployment</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Step 2: Prototype</b></span></li>
<li class="chapter" data-level="8" data-path="setting-up-for-success.html"><a href="setting-up-for-success.html"><i class="fa fa-check"></i><b>8</b> Setting up for Success with <code>{golem}</code></a><ul>
<li class="chapter" data-level="8.1" data-path="setting-up-for-success.html"><a href="setting-up-for-success.html#create-a-golem"><i class="fa fa-check"></i><b>8.1</b> Create a <code>{golem}</code></a></li>
<li class="chapter" data-level="8.2" data-path="setting-up-for-success.html"><a href="setting-up-for-success.html#setting-things-up-with-dev01_start.r"><i class="fa fa-check"></i><b>8.2</b> Setting things up with <code>dev/01_start.R</code></a><ul>
<li class="chapter" data-level="8.2.1" data-path="setting-up-for-success.html"><a href="setting-up-for-success.html#fill-the-description-and-set-options"><i class="fa fa-check"></i><b>8.2.1</b> Fill the DESCRIPTION and set options</a></li>
<li class="chapter" data-level="8.2.2" data-path="setting-up-for-success.html"><a href="setting-up-for-success.html#set-common-files"><i class="fa fa-check"></i><b>8.2.2</b> Set common files</a></li>
<li class="chapter" data-level="8.2.3" data-path="setting-up-for-success.html"><a href="setting-up-for-success.html#use-recommended-elements"><i class="fa fa-check"></i><b>8.2.3</b> Use recommended elements</a></li>
<li class="chapter" data-level="8.2.4" data-path="setting-up-for-success.html"><a href="setting-up-for-success.html#add-utility-functions"><i class="fa fa-check"></i><b>8.2.4</b> Add utility functions</a></li>
<li class="chapter" data-level="8.2.5" data-path="setting-up-for-success.html"><a href="setting-up-for-success.html#changing-the-favicon"><i class="fa fa-check"></i><b>8.2.5</b> Changing the favicon</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="setting-up-for-success.html"><a href="setting-up-for-success.html#setting-infrastructure-for-prototyping"><i class="fa fa-check"></i><b>8.3</b> Setting infrastructure for prototyping</a><ul>
<li class="chapter" data-level="8.3.1" data-path="setting-up-for-success.html"><a href="setting-up-for-success.html#add-modules-in-dev02_dev.r"><i class="fa fa-check"></i><b>8.3.1</b> Add modules in <code>dev/02_dev.R</code></a></li>
<li class="chapter" data-level="8.3.2" data-path="setting-up-for-success.html"><a href="setting-up-for-success.html#add-css-and-js-files"><i class="fa fa-check"></i><b>8.3.2</b> Add CSS and JS files</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="building-ispum-app.html"><a href="building-ispum-app.html"><i class="fa fa-check"></i><b>9</b> Building an “ipsum-app”</a><ul>
<li class="chapter" data-level="9.1" data-path="building-ispum-app.html"><a href="building-ispum-app.html#prototyping-is-crucial"><i class="fa fa-check"></i><b>9.1</b> Prototyping is crucial</a><ul>
<li class="chapter" data-level="9.1.1" data-path="building-ispum-app.html"><a href="building-ispum-app.html#prototype-then-polish"><i class="fa fa-check"></i><b>9.1.1</b> Prototype, then polish</a></li>
<li class="chapter" data-level="9.1.2" data-path="building-ispum-app.html"><a href="building-ispum-app.html#the-ui-first-approach"><i class="fa fa-check"></i><b>9.1.2</b> The “UI first” approach</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="building-ispum-app.html"><a href="building-ispum-app.html#prototyping-shiny"><i class="fa fa-check"></i><b>9.2</b> Prototyping <code>{shiny}</code></a><ul>
<li class="chapter" data-level="9.2.1" data-path="building-ispum-app.html"><a href="building-ispum-app.html#fast-ui-prototyping-with-shinipsum"><i class="fa fa-check"></i><b>9.2.1</b> Fast UI prototyping with <code>{shinipsum}</code></a></li>
<li class="chapter" data-level="9.2.2" data-path="building-ispum-app.html"><a href="building-ispum-app.html#using-fakir-for-fake-data-generation"><i class="fa fa-check"></i><b>9.2.2</b> Using <code>{fakir}</code> for fake data generation</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="building-ispum-app.html"><a href="building-ispum-app.html#proto-rmdfirst"><i class="fa fa-check"></i><b>9.3</b> Building with RMarkdown</a><ul>
<li class="chapter" data-level="9.3.1" data-path="building-ispum-app.html"><a href="building-ispum-app.html#define-the-content-of-the-application"><i class="fa fa-check"></i><b>9.3.1</b> Define the content of the application</a></li>
<li class="chapter" data-level="9.3.2" data-path="building-ispum-app.html"><a href="building-ispum-app.html#using-the-rmd-files-as-a-laboratory-notebook"><i class="fa fa-check"></i><b>9.3.2</b> Using the Rmd files as a laboratory notebook</a></li>
<li class="chapter" data-level="9.3.3" data-path="building-ispum-app.html"><a href="building-ispum-app.html#rmd-vignettes-and-documentation-first"><i class="fa fa-check"></i><b>9.3.3</b> Rmd, Vignettes, and documentation first</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Step 3: Build</b></span></li>
<li class="chapter" data-level="10" data-path="build-app-golem.html"><a href="build-app-golem.html"><i class="fa fa-check"></i><b>10</b> Building the App with <code>{golem}</code></a><ul>
<li class="chapter" data-level="10.1" data-path="build-app-golem.html"><a href="build-app-golem.html#add-dependencies"><i class="fa fa-check"></i><b>10.1</b> Add dependencies</a><ul>
<li class="chapter" data-level="10.1.1" data-path="build-app-golem.html"><a href="build-app-golem.html#package-dependencies"><i class="fa fa-check"></i><b>10.1.1</b> Package dependencies</a></li>
<li class="chapter" data-level="10.1.2" data-path="build-app-golem.html"><a href="build-app-golem.html#importing-packages-and-functions"><i class="fa fa-check"></i><b>10.1.2</b> Importing packages and functions</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="build-app-golem.html"><a href="build-app-golem.html#submodules-and-utility-functions"><i class="fa fa-check"></i><b>10.2</b> Submodules and utility functions</a></li>
<li class="chapter" data-level="10.3" data-path="build-app-golem.html"><a href="build-app-golem.html#add-tests"><i class="fa fa-check"></i><b>10.3</b> Add tests</a></li>
<li class="chapter" data-level="10.4" data-path="build-app-golem.html"><a href="build-app-golem.html#documentation-and-code-coverage"><i class="fa fa-check"></i><b>10.4</b> Documentation and code coverage</a><ul>
<li class="chapter" data-level="10.4.1" data-path="build-app-golem.html"><a href="build-app-golem.html#vignette"><i class="fa fa-check"></i><b>10.4.1</b> Vignette</a></li>
<li class="chapter" data-level="10.4.2" data-path="build-app-golem.html"><a href="build-app-golem.html#code-coverage-and-continuous-integration"><i class="fa fa-check"></i><b>10.4.2</b> Code coverage and continuous integration</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="build-app-golem.html"><a href="build-app-golem.html#using-golem-dev-functions"><i class="fa fa-check"></i><b>10.5</b> Using <code>{golem}</code> dev functions</a></li>
</ul></li>
<li class="part"><span><b>V Step 4: Strengthen</b></span></li>
<li class="chapter" data-level="11" data-path="build-yourself-safety-net.html"><a href="build-yourself-safety-net.html"><i class="fa fa-check"></i><b>11</b> Build Yourself a Safety Net</a><ul>
<li class="chapter" data-level="11.1" data-path="build-yourself-safety-net.html"><a href="build-yourself-safety-net.html#testing-your-app"><i class="fa fa-check"></i><b>11.1</b> Testing your app</a><ul>
<li class="chapter" data-level="11.1.1" data-path="build-yourself-safety-net.html"><a href="build-yourself-safety-net.html#testing-the-business-logic"><i class="fa fa-check"></i><b>11.1.1</b> Testing the business logic</a></li>
<li class="chapter" data-level="11.1.2" data-path="build-yourself-safety-net.html"><a href="build-yourself-safety-net.html#shinytestserver"><i class="fa fa-check"></i><b>11.1.2</b> <code>shiny::testServer()</code></a></li>
<li class="chapter" data-level="11.1.3" data-path="build-yourself-safety-net.html"><a href="build-yourself-safety-net.html#testing-the-interactive-logic"><i class="fa fa-check"></i><b>11.1.3</b> Testing the interactive logic</a></li>
<li class="chapter" data-level="11.1.4" data-path="build-yourself-safety-net.html"><a href="build-yourself-safety-net.html#testing-the-app-load"><i class="fa fa-check"></i><b>11.1.4</b> Testing the app load</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="build-yourself-safety-net.html"><a href="build-yourself-safety-net.html#a-reproducible-environment"><i class="fa fa-check"></i><b>11.2</b> A reproducible environment</a><ul>
<li class="chapter" data-level="11.2.1" data-path="build-yourself-safety-net.html"><a href="build-yourself-safety-net.html#renv"><i class="fa fa-check"></i><b>11.2.1</b> <code>{renv}</code></a></li>
<li class="chapter" data-level="11.2.2" data-path="build-yourself-safety-net.html"><a href="build-yourself-safety-net.html#docker"><i class="fa fa-check"></i><b>11.2.2</b> Docker</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="version-control.html"><a href="version-control.html"><i class="fa fa-check"></i><b>12</b> Version Control</a><ul>
<li class="chapter" data-level="12.1" data-path="version-control.html"><a href="version-control.html#version-control-git"><i class="fa fa-check"></i><b>12.1</b> Using version control with <code>Git</code></a><ul>
<li class="chapter" data-level="12.1.1" data-path="version-control.html"><a href="version-control.html#why-version-control"><i class="fa fa-check"></i><b>12.1.1</b> Why version control?</a></li>
<li class="chapter" data-level="12.1.2" data-path="version-control.html"><a href="version-control.html#git-basics-add---commit---push---pull"><i class="fa fa-check"></i><b>12.1.2</b> <code>Git</code> basics: <code>add</code> - <code>commit</code> - <code>push</code> - <code>pull</code></a></li>
<li class="chapter" data-level="12.1.3" data-path="version-control.html"><a href="version-control.html#about-branches"><i class="fa fa-check"></i><b>12.1.3</b> About branches</a></li>
<li class="chapter" data-level="12.1.4" data-path="version-control.html"><a href="version-control.html#issues"><i class="fa fa-check"></i><b>12.1.4</b> Issues</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="version-control.html"><a href="version-control.html#git-integration"><i class="fa fa-check"></i><b>12.2</b> <code>Git</code> integration</a><ul>
<li class="chapter" data-level="12.2.1" data-path="version-control.html"><a href="version-control.html#with-rstudio"><i class="fa fa-check"></i><b>12.2.1</b> With RStudio</a></li>
<li class="chapter" data-level="12.2.2" data-path="version-control.html"><a href="version-control.html#as-part-of-a-larger-world"><i class="fa fa-check"></i><b>12.2.2</b> As part of a larger world</a></li>
<li class="chapter" data-level="12.2.3" data-path="version-control.html"><a href="version-control.html#about-git-flow"><i class="fa fa-check"></i><b>12.2.3</b> About <code>git-flow</code></a></li>
<li class="chapter" data-level="12.2.4" data-path="version-control.html"><a href="version-control.html#further-readings-on-git"><i class="fa fa-check"></i><b>12.2.4</b> Further readings on <code>Git</code></a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="version-control.html"><a href="version-control.html#automated-testing"><i class="fa fa-check"></i><b>12.3</b> Automated testing</a></li>
</ul></li>
<li class="part"><span><b>VI Step 5: Deploy</b></span></li>
<li class="chapter" data-level="13" data-path="deploy.html"><a href="deploy.html"><i class="fa fa-check"></i><b>13</b> Deploy Your Application</a><ul>
<li class="chapter" data-level="13.1" data-path="deploy.html"><a href="deploy.html#before-deployment-checklist"><i class="fa fa-check"></i><b>13.1</b> Before deployment checklist</a></li>
<li class="chapter" data-level="13.2" data-path="deploy.html"><a href="deploy.html#sharing-your-app-as-a-package"><i class="fa fa-check"></i><b>13.2</b> Sharing your app as a package</a><ul>
<li class="chapter" data-level="13.2.1" data-path="deploy.html"><a href="deploy.html#install-on-your-machine"><i class="fa fa-check"></i><b>13.2.1</b> Install on your machine</a></li>
<li class="chapter" data-level="13.2.2" data-path="deploy.html"><a href="deploy.html#share-as-a-built-package"><i class="fa fa-check"></i><b>13.2.2</b> Share as a built package</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="deploy.html"><a href="deploy.html#deploying-apps-with-golem"><i class="fa fa-check"></i><b>13.3</b> Deploying apps with <code>{golem}</code></a><ul>
<li class="chapter" data-level="13.3.1" data-path="deploy.html"><a href="deploy.html#rstudio-environments"><i class="fa fa-check"></i><b>13.3.1</b> RStudio environments</a></li>
<li class="chapter" data-level="13.3.2" data-path="deploy.html"><a href="deploy.html#docker-1"><i class="fa fa-check"></i><b>13.3.2</b> Docker</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>VII Optimizing</b></span></li>
<li class="chapter" data-level="14" data-path="need-for-optimization.html"><a href="need-for-optimization.html"><i class="fa fa-check"></i><b>14</b> The Need for Optimization</a><ul>
<li class="chapter" data-level="14.1" data-path="need-for-optimization.html"><a href="need-for-optimization.html#build-first-then-optimize"><i class="fa fa-check"></i><b>14.1</b> Build first, then optimize</a><ul>
<li class="chapter" data-level="14.1.1" data-path="need-for-optimization.html"><a href="need-for-optimization.html#identifying-bottlenecks"><i class="fa fa-check"></i><b>14.1.1</b> Identifying bottlenecks</a></li>
<li class="chapter" data-level="14.1.2" data-path="need-for-optimization.html"><a href="need-for-optimization.html#do-you-need-faster-functions"><i class="fa fa-check"></i><b>14.1.2</b> Do you need faster functions?</a></li>
<li class="chapter" data-level="14.1.3" data-path="need-for-optimization.html"><a href="need-for-optimization.html#dont-sacrifice-readability"><i class="fa fa-check"></i><b>14.1.3</b> Don’t sacrifice readability</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="need-for-optimization.html"><a href="need-for-optimization.html#tools-for-profiling"><i class="fa fa-check"></i><b>14.2</b> Tools for profiling</a><ul>
<li class="chapter" data-level="14.2.1" data-path="need-for-optimization.html"><a href="need-for-optimization.html#profiling-r-code"><i class="fa fa-check"></i><b>14.2.1</b> Profiling R code</a></li>
<li class="chapter" data-level="14.2.2" data-path="need-for-optimization.html"><a href="need-for-optimization.html#profiling-shiny"><i class="fa fa-check"></i><b>14.2.2</b> Profiling <code>{shiny}</code></a></li>
<li class="chapter" data-level="14.2.3" data-path="need-for-optimization.html"><a href="need-for-optimization.html#more-resources-about-web-page-performance"><i class="fa fa-check"></i><b>14.2.3</b> More resources about web-page performance</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="common-app-caveats.html"><a href="common-app-caveats.html"><i class="fa fa-check"></i><b>15</b> Common Application Caveats</a><ul>
<li class="chapter" data-level="15.1" data-path="common-app-caveats.html"><a href="common-app-caveats.html#reactivity-anti-patterns"><i class="fa fa-check"></i><b>15.1</b> Reactivity anti-patterns</a><ul>
<li class="chapter" data-level="15.1.1" data-path="common-app-caveats.html"><a href="common-app-caveats.html#reactivity-is-awesome-until-it-is-not"><i class="fa fa-check"></i><b>15.1.1</b> Reactivity is awesome… until it is not</a></li>
<li class="chapter" data-level="15.1.2" data-path="common-app-caveats.html"><a href="common-app-caveats.html#observe-vs-observeevent"><i class="fa fa-check"></i><b>15.1.2</b> <code>observe</code> vs <code>observeEvent</code></a></li>
<li class="chapter" data-level="15.1.3" data-path="common-app-caveats.html"><a href="common-app-caveats.html#building-triggers-and-watchers"><i class="fa fa-check"></i><b>15.1.3</b> Building triggers and watchers</a></li>
<li class="chapter" data-level="15.1.4" data-path="common-app-caveats.html"><a href="common-app-caveats.html#using-r6-as-data-storage"><i class="fa fa-check"></i><b>15.1.4</b> Using R6 as data storage</a></li>
<li class="chapter" data-level="15.1.5" data-path="common-app-caveats.html"><a href="common-app-caveats.html#logging-reactivity-with-whereami"><i class="fa fa-check"></i><b>15.1.5</b> Logging reactivity with <code>{whereami}</code></a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="common-app-caveats.html"><a href="common-app-caveats.html#r-does-too-much"><i class="fa fa-check"></i><b>15.2</b> R does too much</a><ul>
<li class="chapter" data-level="15.2.1" data-path="common-app-caveats.html"><a href="common-app-caveats.html#rendering-the-ui-from-the-server-side"><i class="fa fa-check"></i><b>15.2.1</b> Rendering the UI from the server side</a></li>
<li class="chapter" data-level="15.2.2" data-path="common-app-caveats.html"><a href="common-app-caveats.html#too-much-data-in-memory"><i class="fa fa-check"></i><b>15.2.2</b> Too much data in memory</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="common-app-caveats.html"><a href="common-app-caveats.html#reading-data"><i class="fa fa-check"></i><b>15.3</b> Reading data</a><ul>
<li class="chapter" data-level="15.3.1" data-path="common-app-caveats.html"><a href="common-app-caveats.html#including-data-in-your-application"><i class="fa fa-check"></i><b>15.3.1</b> Including data in your application</a></li>
<li class="chapter" data-level="15.3.2" data-path="common-app-caveats.html"><a href="common-app-caveats.html#reading-external-datasets"><i class="fa fa-check"></i><b>15.3.2</b> Reading external datasets</a></li>
<li class="chapter" data-level="15.3.3" data-path="common-app-caveats.html"><a href="common-app-caveats.html#using-external-databases"><i class="fa fa-check"></i><b>15.3.3</b> Using external databases</a></li>
<li class="chapter" data-level="15.3.4" data-path="common-app-caveats.html"><a href="common-app-caveats.html#data-source-checklist"><i class="fa fa-check"></i><b>15.3.4</b> Data-source checklist</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="optimizing-shiny-code.html"><a href="optimizing-shiny-code.html"><i class="fa fa-check"></i><b>16</b> Optimizing <code>{shiny}</code> Code</a><ul>
<li class="chapter" data-level="16.1" data-path="optimizing-shiny-code.html"><a href="optimizing-shiny-code.html#optimizing-r-code"><i class="fa fa-check"></i><b>16.1</b> Optimizing R code</a></li>
<li class="chapter" data-level="16.2" data-path="optimizing-shiny-code.html"><a href="optimizing-shiny-code.html#caching-elements"><i class="fa fa-check"></i><b>16.2</b> Caching elements</a><ul>
<li class="chapter" data-level="16.2.1" data-path="optimizing-shiny-code.html"><a href="optimizing-shiny-code.html#what-is-caching"><i class="fa fa-check"></i><b>16.2.1</b> What is caching?</a></li>
<li class="chapter" data-level="16.2.2" data-path="optimizing-shiny-code.html"><a href="optimizing-shiny-code.html#native-caching-in-r"><i class="fa fa-check"></i><b>16.2.2</b> Native caching in R</a></li>
<li class="chapter" data-level="16.2.3" data-path="optimizing-shiny-code.html"><a href="optimizing-shiny-code.html#caching-in-shiny"><i class="fa fa-check"></i><b>16.2.3</b> Caching in <code>{shiny}</code></a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="optimizing-shiny-code.html"><a href="optimizing-shiny-code.html#asynchronous-in-shiny"><i class="fa fa-check"></i><b>16.3</b> Asynchronous in <code>{shiny}</code></a><ul>
<li class="chapter" data-level="16.3.1" data-path="optimizing-shiny-code.html"><a href="optimizing-shiny-code.html#how-to"><i class="fa fa-check"></i><b>16.3.1</b> How to</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="using-javascript.html"><a href="using-javascript.html"><i class="fa fa-check"></i><b>17</b> Using JavaScript</a><ul>
<li class="chapter" data-level="17.1" data-path="using-javascript.html"><a href="using-javascript.html#introduction-1"><i class="fa fa-check"></i><b>17.1</b> Introduction</a></li>
<li class="chapter" data-level="17.2" data-path="using-javascript.html"><a href="using-javascript.html#a-quick-introduction-to-javascript"><i class="fa fa-check"></i><b>17.2</b> A quick introduction to JavaScript</a><ul>
<li class="chapter" data-level="17.2.1" data-path="using-javascript.html"><a href="using-javascript.html#about-javascript"><i class="fa fa-check"></i><b>17.2.1</b> About JavaScript</a></li>
<li class="chapter" data-level="17.2.2" data-path="using-javascript.html"><a href="using-javascript.html#including-javascript-code-in-your-app"><i class="fa fa-check"></i><b>17.2.2</b> Including JavaScript code in your app</a></li>
<li class="chapter" data-level="17.2.3" data-path="using-javascript.html"><a href="using-javascript.html#understanding-html-class-and-id"><i class="fa fa-check"></i><b>17.2.3</b> Understanding HTML, class, and id</a></li>
<li class="chapter" data-level="17.2.4" data-path="using-javascript.html"><a href="using-javascript.html#querying-in-vanilla-javascript"><i class="fa fa-check"></i><b>17.2.4</b> Querying in Vanilla JavaScript</a></li>
<li class="chapter" data-level="17.2.5" data-path="using-javascript.html"><a href="using-javascript.html#about-dom-events"><i class="fa fa-check"></i><b>17.2.5</b> About DOM events</a></li>
<li class="chapter" data-level="17.2.6" data-path="using-javascript.html"><a href="using-javascript.html#about-jquery-and-jquery-selectors"><i class="fa fa-check"></i><b>17.2.6</b> About <code>jQuery</code> and <code>jQuery</code> selectors</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="using-javascript.html"><a href="using-javascript.html#client-side-javascript"><i class="fa fa-check"></i><b>17.3</b> Client-side JavaScript</a><ul>
<li class="chapter" data-level="17.3.1" data-path="using-javascript.html"><a href="using-javascript.html#common-patterns"><i class="fa fa-check"></i><b>17.3.1</b> Common patterns</a></li>
<li class="chapter" data-level="17.3.2" data-path="using-javascript.html"><a href="using-javascript.html#where-to-put-them-back-to-javascript-events"><i class="fa fa-check"></i><b>17.3.2</b> Where to put them: Back to JavaScript Events</a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="using-javascript.html"><a href="using-javascript.html#javascript---shiny-communication"><i class="fa fa-check"></i><b>17.4</b> JavaScript &lt;-&gt; <code>{shiny}</code> communication</a><ul>
<li class="chapter" data-level="17.4.1" data-path="using-javascript.html"><a href="using-javascript.html#from-r-to-javascript"><i class="fa fa-check"></i><b>17.4.1</b> From R to JavaScript</a></li>
<li class="chapter" data-level="17.4.2" data-path="using-javascript.html"><a href="using-javascript.html#from-javascript-to-r"><i class="fa fa-check"></i><b>17.4.2</b> From JavaScript to R</a></li>
</ul></li>
<li class="chapter" data-level="17.5" data-path="using-javascript.html"><a href="using-javascript.html#about-shinyjs-js-functions"><i class="fa fa-check"></i><b>17.5</b> About <code>{shinyjs}</code> JS functions</a></li>
<li class="chapter" data-level="17.6" data-path="using-javascript.html"><a href="using-javascript.html#one-last-thing-api-calls"><i class="fa fa-check"></i><b>17.6</b> One last thing: API calls</a></li>
<li class="chapter" data-level="17.7" data-path="using-javascript.html"><a href="using-javascript.html#learn-more-about-javascript"><i class="fa fa-check"></i><b>17.7</b> Learn more about JavaScript</a><ul>
<li class="chapter" data-level="17.7.1" data-path="using-javascript.html"><a href="using-javascript.html#shiny-and-javascript"><i class="fa fa-check"></i><b>17.7.1</b> <code>{shiny}</code> and JavaScript</a></li>
<li class="chapter" data-level="17.7.2" data-path="using-javascript.html"><a href="using-javascript.html#javascript-basics"><i class="fa fa-check"></i><b>17.7.2</b> JavaScript basics</a></li>
<li class="chapter" data-level="17.7.3" data-path="using-javascript.html"><a href="using-javascript.html#jquery"><i class="fa fa-check"></i><b>17.7.3</b> jQuery</a></li>
<li class="chapter" data-level="17.7.4" data-path="using-javascript.html"><a href="using-javascript.html#intermediateadvanced-javascript"><i class="fa fa-check"></i><b>17.7.4</b> Intermediate/advanced JavaScript</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18" data-path="css.html"><a href="css.html"><i class="fa fa-check"></i><b>18</b> A Gentle Introduction to CSS</a><ul>
<li class="chapter" data-level="18.1" data-path="css.html"><a href="css.html#what-is-css"><i class="fa fa-check"></i><b>18.1</b> What is CSS?</a><ul>
<li class="chapter" data-level="18.1.1" data-path="css.html"><a href="css.html#about-css"><i class="fa fa-check"></i><b>18.1.1</b> About CSS</a></li>
<li class="chapter" data-level="18.1.2" data-path="css.html"><a href="css.html#shinys-default-fluidpage"><i class="fa fa-check"></i><b>18.1.2</b> <code>{shiny}</code>’s default: <code>fluidPage()</code></a></li>
</ul></li>
<li class="chapter" data-level="18.2" data-path="css.html"><a href="css.html#getting-started-with-css"><i class="fa fa-check"></i><b>18.2</b> Getting started with CSS</a><ul>
<li class="chapter" data-level="18.2.1" data-path="css.html"><a href="css.html#about-css-syntax"><i class="fa fa-check"></i><b>18.2.1</b> About CSS syntax</a></li>
<li class="chapter" data-level="18.2.2" data-path="css.html"><a href="css.html#css-selectors"><i class="fa fa-check"></i><b>18.2.2</b> CSS selectors</a></li>
<li class="chapter" data-level="18.2.3" data-path="css.html"><a href="css.html#css-properties"><i class="fa fa-check"></i><b>18.2.3</b> CSS properties</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="css.html"><a href="css.html#integrate-css-files-in-your-shiny-app"><i class="fa fa-check"></i><b>18.3</b> Integrate CSS files in your <code>{shiny}</code> app</a><ul>
<li class="chapter" data-level="18.3.1" data-path="css.html"><a href="css.html#inline-css"><i class="fa fa-check"></i><b>18.3.1</b> Inline CSS</a></li>
<li class="chapter" data-level="18.3.2" data-path="css.html"><a href="css.html#writing-in-a-tagsstyle"><i class="fa fa-check"></i><b>18.3.2</b> Writing in a <code>tags$style()</code></a></li>
<li class="chapter" data-level="18.3.3" data-path="css.html"><a href="css.html#including-external-files"><i class="fa fa-check"></i><b>18.3.3</b> Including external files</a></li>
<li class="chapter" data-level="18.3.4" data-path="css.html"><a href="css.html#using-r-packages"><i class="fa fa-check"></i><b>18.3.4</b> Using R packages</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="css.html"><a href="css.html#external-resources"><i class="fa fa-check"></i><b>18.4</b> External resources</a></li>
</ul></li>
<li class="part"><span><b>VIII Appendix</b></span></li>
<li class="chapter" data-level="" data-path="appendix-a-use-case-building-an-app-from-start-to-finish.html"><a href="appendix-a-use-case-building-an-app-from-start-to-finish.html"><i class="fa fa-check"></i>Appendix A - Use Case: Building an App from Start to Finish</a><ul>
<li class="chapter" data-level="" data-path="appendix-a-use-case-building-an-app-from-start-to-finish.html"><a href="appendix-a-use-case-building-an-app-from-start-to-finish.html#about-the-application"><i class="fa fa-check"></i>About the application</a></li>
<li class="chapter" data-level="" data-path="appendix-a-use-case-building-an-app-from-start-to-finish.html"><a href="appendix-a-use-case-building-an-app-from-start-to-finish.html#step-1-design-1"><i class="fa fa-check"></i>Step 1: Design</a><ul>
<li class="chapter" data-level="" data-path="appendix-a-use-case-building-an-app-from-start-to-finish.html"><a href="appendix-a-use-case-building-an-app-from-start-to-finish.html#deciphering-the-specifications"><i class="fa fa-check"></i>Deciphering the specifications</a></li>
<li class="chapter" data-level="" data-path="appendix-a-use-case-building-an-app-from-start-to-finish.html"><a href="appendix-a-use-case-building-an-app-from-start-to-finish.html#building-a-concept-map"><i class="fa fa-check"></i>Building a concept map</a></li>
<li class="chapter" data-level="" data-path="appendix-a-use-case-building-an-app-from-start-to-finish.html"><a href="appendix-a-use-case-building-an-app-from-start-to-finish.html#asking-questions"><i class="fa fa-check"></i>Asking questions</a></li>
<li class="chapter" data-level="" data-path="appendix-a-use-case-building-an-app-from-start-to-finish.html"><a href="appendix-a-use-case-building-an-app-from-start-to-finish.html#building-personas-1"><i class="fa fa-check"></i>Building personas</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendix-a-use-case-building-an-app-from-start-to-finish.html"><a href="appendix-a-use-case-building-an-app-from-start-to-finish.html#step-2-prototyping"><i class="fa fa-check"></i>Step 2: Prototyping</a><ul>
<li class="chapter" data-level="" data-path="appendix-a-use-case-building-an-app-from-start-to-finish.html"><a href="appendix-a-use-case-building-an-app-from-start-to-finish.html#back-end-in-rmd"><i class="fa fa-check"></i>Back-end in Rmd</a></li>
<li class="chapter" data-level="" data-path="appendix-a-use-case-building-an-app-from-start-to-finish.html"><a href="appendix-a-use-case-building-an-app-from-start-to-finish.html#ui-prototyping"><i class="fa fa-check"></i>UI prototyping</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendix-a-use-case-building-an-app-from-start-to-finish.html"><a href="appendix-a-use-case-building-an-app-from-start-to-finish.html#step-3-build-1"><i class="fa fa-check"></i>Step 3: Build</a></li>
<li class="chapter" data-level="" data-path="appendix-a-use-case-building-an-app-from-start-to-finish.html"><a href="appendix-a-use-case-building-an-app-from-start-to-finish.html#step-4-strengthen-1"><i class="fa fa-check"></i>Step 4: Strengthen</a></li>
<li class="chapter" data-level="" data-path="appendix-a-use-case-building-an-app-from-start-to-finish.html"><a href="appendix-a-use-case-building-an-app-from-start-to-finish.html#step-5-deploy-1"><i class="fa fa-check"></i>Step 5: Deploy</a><ul>
<li class="chapter" data-level="" data-path="appendix-a-use-case-building-an-app-from-start-to-finish.html"><a href="appendix-a-use-case-building-an-app-from-start-to-finish.html#before-deployment-checklist-1"><i class="fa fa-check"></i>Before deployment checklist</a></li>
<li class="chapter" data-level="" data-path="appendix-a-use-case-building-an-app-from-start-to-finish.html"><a href="appendix-a-use-case-building-an-app-from-start-to-finish.html#deploy-as-a-tar.gz"><i class="fa fa-check"></i>Deploy as a tar.gz</a></li>
<li class="chapter" data-level="" data-path="appendix-a-use-case-building-an-app-from-start-to-finish.html"><a href="appendix-a-use-case-building-an-app-from-start-to-finish.html#deploy-on-rstudio-connect"><i class="fa fa-check"></i>Deploy on RStudio Connect</a></li>
<li class="chapter" data-level="" data-path="appendix-a-use-case-building-an-app-from-start-to-finish.html"><a href="appendix-a-use-case-building-an-app-from-start-to-finish.html#deploy-with-docker"><i class="fa fa-check"></i>Deploy with Docker</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendix-b-session-info.html"><a href="appendix-b-session-info.html"><i class="fa fa-check"></i>Appendix B - Session Info</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://rtask.thinkr.fr">A book by the ThinkR team</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Engineering Production-Grade Shiny Apps</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="structuring-project" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Structuring Your Project</h1>
<div id="shiny-app-as-a-package" class="section level2">
<h2><span class="header-section-number">3.1</span> <code>{shiny}</code> app as a package</h2>
<p>In the next chapter you will be introduced to the <code>{golem}</code> <span class="citation">(Fay et al. <a href="#ref-R-golem" role="doc-biblioref">2020</a>)</span> package, <strong>an opinionated framework for building production-ready <code>{shiny}</code> applications</strong>.
This framework will be used a lot throughout this book, and it relies on the idea that every <code>{shiny}</code> application should be built as an R package.</p>
<p>But in a world where <code>{shiny}</code> applications are mostly created as a series of files, why bother with a package?</p>
<div id="what-is-in-a-production-grade-shiny-app" class="section level3">
<h3><span class="header-section-number">3.1.1</span> What is in a production-grade <code>{shiny}</code> app?</h3>
<p>You probably haven’t realized it yet, but if you have built a significant (in terms of size or complexity of the codebase) <code>{shiny}</code> application, chances are you have been using a package-like structure without knowing it.</p>
<p>Think about your last <code>{shiny}</code> application, which was created as a single-file (<code>app.R</code>) or two-file app (<code>ui.R</code> and <code>server.R</code>).
On top of these files, what do you needed to make it <strong>a production-ready application</strong>, and why is a package the perfect infrastructure?</p>
<div id="a.-it-has-metadata" class="section level4 unnumbered">
<h4>A. It has metadata</h4>
<p>First of all, <strong>metadata</strong>.
In other words, all the necessary information for something that runs in production: the name of the app, the version number (which is crucial to any serious, production-level project), what the application does, who to contact if something goes wrong, etc.</p>
<p>This is what you will get when using a package <code>DESCRIPTION</code> file.</p>
</div>
<div id="b.-it-handles-dependencies" class="section level4 unnumbered">
<h4>B. It handles dependencies</h4>
<p>Second, you need to find a way to <strong>handle the dependencies</strong>.
When you want to push your app into production, you do not want to have this conversation with the IT team:</p>
<ul>
<li><p><em>IT: Hey, I tried to <code>source("app.R")</code> as you said, but I got an error.</em></p></li>
<li><p><em>R-dev: What is the error?</em></p></li>
<li><p><em>IT: It says “could not find package ‘shiny’”.</em></p></li>
<li><p><em>R-dev: Ah yes, you need to install {shiny}. Try to run <code>install.packages("shiny")</code>.</em></p></li>
<li><p><em>IT: OK nice. What else?</em></p></li>
<li><p><em>R-dev: Let me think, try also <code>install.packages("DT")</code>… good? Now try <code>install.packages("ggplot2")</code>, and …</em></p></li>
<li><p><em>[…]</em></p></li>
<li><p><em>IT: Ok, now I source the ‘app.R’, right?</em></p></li>
<li><p><em>R-dev: Sure!</em></p></li>
<li><p><em>IT: Ok so it says “could not find function <code>runApp()</code>”</em></p></li>
<li><p><em>R-dev: Ah, you got to do <code>library(shiny)</code> at the beginning of your script. And <code>library(purrr)</code>, and <code>library(jsonlite)</code>, and…</em></p></li>
</ul>
<p>For example here, the <code>library(purrr)</code> and <code>library(jsonlite)</code> will lead to a NAMESPACE conflict on the <code>flatten()</code> function that can cause you some debugging headaches (trust us, we have been there before).
It would be cool if we could have a <code>{shiny}</code> app that only imports specific functions from a package, right?</p>
<p>We cannot stress enough that <strong>dependencies matter</strong>.
You need to handle them, and handle them correctly if you want to ensure a smooth deployment to production.
This dependency management is native when you use a package structure: the packages your application depends on are listed in the <code>DESCRIPTION</code>, and the functions/packages you need to import are listed in the <code>NAMESPACE</code> file.</p>
</div>
<div id="c.-its-split-into-functions" class="section level4 unnumbered">
<h4>C. It’s split into functions</h4>
<p>Third, let’s say you are building a big application.
Something with thousands of lines of code.
You cannot build this large application by writing one or two files, as it is simply impossible to maintain in the long run or use on a daily basis.
If we are developing a large application, we should split everything into smaller files.
And maybe we can store those files in a specific directory.</p>
<p>This is what is done with a package, with the <code>R/</code> folder.</p>
</div>
<div id="d.-it-has-documentation" class="section level4 unnumbered">
<h4>D. It has documentation</h4>
<p>Last but not least, we want our app to live long and prosper, which means we need to document it.</p>
<p>Documenting your <code>{shiny}</code> app involves explaining features to the end users and also to the future developers (chances are this future developer will be you).
The good news is that using the R package structure helps you leverage the common tools for documentation in R:</p>
<ul>
<li><p>A <code>README</code> file that you will put at the root of your package, which will document how to install the package, and some information about how to use the package. Note that in many cases developers go for a <code>.md</code> file (short for markdown) because this format is automatically rendered on services like GitHub, GitLab, or any other main version control system.</p></li>
<li><p><code>Vignettes</code> are longer-form documentation that explains in more depth how to use your app. They are also useful if you need to detail the core functions of the application using a static document, notably for prototyping and/or for exchanging with the client. We will get back to <code>Vignettes</code> in Chapter <a href="building-ispum-app.html#building-ispum-app">9</a> when we will talk about prototyping.</p></li>
<li><p>Function documentation. Every function in your package should come with its own documentation, even if it is just for your future self. “Exported” functions, the one which are available once you run <code>library(myapp)</code>, should be fully documented and will be listed in the package help page. Internal functions need less documentation, but documenting them is the best way to be sure you can come back to the app in a few months and still know why things are the way they are, what the pieces of the apps are used for, and how to use these functions.<a href="#fn18" class="footnote-ref" id="fnref18"><sup>18</sup></a></p></li>
<li><p>If needed, you can build a <code>{pkgdown}</code> website, that can either be deployed on the web or kept internally. It can contain installation steps for I.T., internal features use for developers, a user guide, etc.</p></li>
</ul>
</div>
<div id="e.-its-tested" class="section level4 unnumbered">
<h4>E. It’s tested</h4>
<p>The other thing we need for our application to be successful in the long run is a testing infrastructure, so that we are sure we are not introducing any regression during development.</p>
<p><strong>Nothing should go to production without being tested. Nothing.</strong></p>
<p>Testing production apps is a broad question that we will come back to in another chapter, but let’s talk briefly about why using a package structure helps with testing.</p>
<p>Frameworks for package testing are robust and widely documented in the R world, and if you choose to embrace the “<code>{shiny}</code> app as a package” structure, you do not have to put in any extra-effort for testing your application back-end: use a canonical testing framework like <code>{testthat}</code> <span class="citation">(Wickham <a href="#ref-R-testthat" role="doc-biblioref">2020</a>)</span>.
Learning how to use it is not the subject of this chapter, so feel free to refer to the documentation, and see also Chapter 5 of the <a href="https://speakerdeck.com/colinfay/building-a-package-that-lasts-erum-2018-workshop?slide=107">workshop: “Building a Package that Lasts”</a>.</p>
<p>We will come back to testing in Chapter 11: “Build Yourself a Safety Net”.</p>
</div>
<div id="f.-there-is-a-native-way-to-build-and-deploy-it" class="section level4 unnumbered">
<h4>F. There is a native way to build and deploy it</h4>
<p>Oh, and it would also be nice if people could get a <code>tar.gz</code> and install it on their computer and have access to a local copy of the app!
Or if we could install that on the server without any headache!</p>
<p>When adopting the package structure, you can use classical tools to locally install your <code>{shiny}</code> application, i.e. as any other R package, built as a <code>tar.gz</code>.
On a server, be it RStudio products or as Docker containers, the package infrastructure will also allow you to leverage the native R tools to build, install and launch R code.</p>
<p>More about this in Chapter <a href="deploy.html#deploy">13</a>.</p>
</div>
<div id="shiny-app-as-a-package-a-checklist" class="section level4 unnumbered">
<h4><code>{shiny}</code> app as a package, a checklist</h4>
<p>Let’s sum up what we need for our application:</p>
<ul>
<li><p><input type="checkbox" disabled="" />
<strong>Metadata</strong> and <strong>dependencies</strong>, which is what you get from the <code>DESCRIPTION</code> + <code>NAMESPACE</code> files of a package.
Even more useful is the fact that you can do “selective namespace extraction” inside a package, <em>i.e.</em> you can say “I want this function from this package”.</p></li>
<li><p><input type="checkbox" disabled="" />
A <strong>bite-size code-base, aka functions</strong>.
This is done through <code>.R</code> files, stored in the <code>R/</code> directory, which is the way a package is organized.</p></li>
<li><p><input type="checkbox" disabled="" />
<strong>Documentation</strong> can be done using Vignettes, Readme, and native R package documentation.</p></li>
<li><p><input type="checkbox" disabled="" />
<strong>Testing toolkit</strong>, done using the native <code>R CMD Check</code> and other packages like <code>{testthat}</code> <span class="citation">(Wickham <a href="#ref-R-testthat" role="doc-biblioref">2020</a>)</span>.</p></li>
<li><p><input type="checkbox" disabled="" />
<strong>Installation process</strong>, which is possible using the package infrastructure.</p></li>
</ul>
</div>
</div>
<div id="resources" class="section level3">
<h3><span class="header-section-number">3.1.2</span> Resources</h3>
<p>In the rest of this book, we will assume you are comfortable with building an R package.
If you need to read some resources before continuing, feel free to have a look at these links:</p>
<ul>
<li><p><a href="http://r-pkgs.had.co.nz/">R packages</a></p></li>
<li><p><a href="https://speakerdeck.com/colinfay/building-a-package-that-lasts-erum-2018-workshop">Building a Package that Lasts</a></p></li>
<li><p><a href="https://cran.r-project.org/doc/manuals/r-release/R-exts.html#Creating-R-packages">Writing R Extensions</a></p></li>
<li><p><a href="https://kbroman.org/pkg_primer/">R Package Primer - a Minimal Tutorial</a></p></li>
</ul>
</div>
</div>
<div id="using-shiny-modules" class="section level2">
<h2><span class="header-section-number">3.2</span> Using <code>{shiny}</code> modules</h2>
<p>Modules are one of the most powerful tools for building <code>{shiny}</code> applications in a maintainable and sustainable manner.</p>
<div id="why-shiny-modules" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Why <code>{shiny}</code> modules?</h3>
<p>Small is beautiful.
Being able to properly cut a codebase into small modules will help developers build a mental model of the application (Remember <a href="successful-shiny-app.html#complex-shiny">“What is a complex <code>{shiny}</code> application?”</a>).
But what are <code>{shiny}</code> modules?</p>
<blockquote>
<p><code>{shiny}</code> modules address the namespacing problem in <code>{shiny}</code> UI (User Interface) and server logic, adding a level of abstraction beyond functions.<br />
</p>
<p><em>Modularizing Shiny app code</em> (<a href="https://shiny.rstudio.com/articles/modules.html" class="uri">https://shiny.rstudio.com/articles/modules.html</a>)</p>
</blockquote>
<p>Let us first untangle this quote with an example about the <code>{shiny}</code> namespace problem.</p>
<div id="a.-the-one-million-validate-buttons-problem" class="section level4 unnumbered">
<h4>A. The one million “Validate” buttons problem</h4>
<p>A big <code>{shiny}</code> application usually requires reusing pieces of the UI/server, which makes it hard to name and identify similar inputs and outputs.</p>
<p><code>{shiny}</code> requires its outputs and inputs to have a <strong>unique id</strong>.
And, unfortunately, we cannot bypass that: when you send a plot <strong>from R to the browser</strong>, i.e. from the <code>server</code> to the <code>ui</code>, the browser needs to know exactly where to put this element.
This “exactly where” is handled through the use of an <code>id</code>.
Ids are not <code>{shiny}</code> specific: they are at the very root of the way web pages work.
Understanding all of this is not the purpose of this chapter: just remember that <code>{shiny}</code> input and output ids <strong>have</strong> to be unique, just as any id on a web page, so that the browser knows where to put what it receives from R, and R knows what to listen to from the browser.
The need to be unique is made a little bit complex by the way <code>{shiny}</code> handles the names, as it shares a global pool for all the id names, with no native way to use namespaces.
Wait, namespaces?</p>
<p>Namespaces are a computer science concept created to handle a common issue: how to share the same name for a variable in various places of your program without them conflicting.
In other words, how to use an object called <code>my_dataset</code> several times in the program, and still be sure that it is correctly used depending on the context.</p>
<p>R itself has a system for namespaces; this is what packages do and why you can have <code>purrr::flatten</code> and <code>jsonlite::flatten</code> on the same computer and inside the same script: the function names are the same, but the two exist in different namespaces, and the behavior of both functions can be totally different as the symbol is evaluated inside two different namespaces.
If you want to learn more about namespaces, please refer to the <a href="https://adv-r.hadley.nz/environments.html#special-environments">7.4 Special environments</a> chapter from <em>Advanced R</em>, or turn to any computer science book: namespaces are pretty common in any programming language.</p>
<p>That is what modules are made for: <strong>creating small namespaces where you can safely define <code>ids</code> without conflicting with other <code>ids</code> in the app.</strong> Why do we need to do that?
Think about the number of times you have created an “OK” or “validate” button.
How have you been handling that so far?
By creating <code>validate1</code>, <code>validate2</code>, and so on and so forth.
But if you think about it, you are mimicking a namespacing process: a <code>validate</code> in namespace <code>1</code>, another in namespace <code>2</code>.</p>
<p>Consider the following <code>{shiny}</code> application:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="structuring-project.html#cb31-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb31-2"><a href="structuring-project.html#cb31-2"></a>ui &lt;-<span class="st"> </span><span class="cf">function</span>() {</span>
<span id="cb31-3"><a href="structuring-project.html#cb31-3"></a>  <span class="kw">fluidPage</span>(</span>
<span id="cb31-4"><a href="structuring-project.html#cb31-4"></a>    <span class="co"># Define a first sliderInput(), </span></span>
<span id="cb31-5"><a href="structuring-project.html#cb31-5"></a>    <span class="co"># with an id that we will postfix with `1`</span></span>
<span id="cb31-6"><a href="structuring-project.html#cb31-6"></a>    <span class="co"># in order to make it unique</span></span>
<span id="cb31-7"><a href="structuring-project.html#cb31-7"></a>    <span class="kw">sliderInput</span>(</span>
<span id="cb31-8"><a href="structuring-project.html#cb31-8"></a>      <span class="dt">inputId =</span> <span class="st">&quot;choice1&quot;</span>, </span>
<span id="cb31-9"><a href="structuring-project.html#cb31-9"></a>      <span class="dt">label =</span> <span class="st">&quot;choice 1&quot;</span>, </span>
<span id="cb31-10"><a href="structuring-project.html#cb31-10"></a>      <span class="dt">min =</span> <span class="dv">1</span>, <span class="dt">max =</span> <span class="dv">10</span>, <span class="dt">value =</span> <span class="dv">5</span></span>
<span id="cb31-11"><a href="structuring-project.html#cb31-11"></a>    ),</span>
<span id="cb31-12"><a href="structuring-project.html#cb31-12"></a>    <span class="co"># Define a first actionButton(), </span></span>
<span id="cb31-13"><a href="structuring-project.html#cb31-13"></a>    <span class="co"># with an id that we will postfix with `1`</span></span>
<span id="cb31-14"><a href="structuring-project.html#cb31-14"></a>    <span class="co"># in order to make it unique</span></span>
<span id="cb31-15"><a href="structuring-project.html#cb31-15"></a>    <span class="kw">actionButton</span>(</span>
<span id="cb31-16"><a href="structuring-project.html#cb31-16"></a>      <span class="dt">inputId =</span> <span class="st">&quot;validate1&quot;</span>,</span>
<span id="cb31-17"><a href="structuring-project.html#cb31-17"></a>      <span class="dt">label =</span> <span class="st">&quot;Validate choice 1&quot;</span></span>
<span id="cb31-18"><a href="structuring-project.html#cb31-18"></a>    ),</span>
<span id="cb31-19"><a href="structuring-project.html#cb31-19"></a>    <span class="co"># We define here a second sliderInput, </span></span>
<span id="cb31-20"><a href="structuring-project.html#cb31-20"></a>    <span class="co"># and need its id to be unique, so we </span></span>
<span id="cb31-21"><a href="structuring-project.html#cb31-21"></a>    <span class="co"># postfix it with 2</span></span>
<span id="cb31-22"><a href="structuring-project.html#cb31-22"></a>    <span class="kw">sliderInput</span>(</span>
<span id="cb31-23"><a href="structuring-project.html#cb31-23"></a>      <span class="dt">inputId =</span> <span class="st">&quot;choice2&quot;</span>,</span>
<span id="cb31-24"><a href="structuring-project.html#cb31-24"></a>      <span class="dt">label =</span> <span class="st">&quot;choice 2&quot;</span>, </span>
<span id="cb31-25"><a href="structuring-project.html#cb31-25"></a>      <span class="dt">min =</span> <span class="dv">1</span>, <span class="dt">max =</span> <span class="dv">10</span>, <span class="dt">value =</span> <span class="dv">5</span></span>
<span id="cb31-26"><a href="structuring-project.html#cb31-26"></a>    ),</span>
<span id="cb31-27"><a href="structuring-project.html#cb31-27"></a>    <span class="co"># We define here a second actionButton, </span></span>
<span id="cb31-28"><a href="structuring-project.html#cb31-28"></a>    <span class="co"># and need its id to be unique, so we </span></span>
<span id="cb31-29"><a href="structuring-project.html#cb31-29"></a>    <span class="co"># postfix it with 2</span></span>
<span id="cb31-30"><a href="structuring-project.html#cb31-30"></a>    <span class="kw">actionButton</span>(</span>
<span id="cb31-31"><a href="structuring-project.html#cb31-31"></a>      <span class="dt">inputId =</span> <span class="st">&quot;validate2&quot;</span>, </span>
<span id="cb31-32"><a href="structuring-project.html#cb31-32"></a>      <span class="dt">label =</span> <span class="st">&quot;Validate choice 2&quot;</span></span>
<span id="cb31-33"><a href="structuring-project.html#cb31-33"></a>    )</span>
<span id="cb31-34"><a href="structuring-project.html#cb31-34"></a>  )</span>
<span id="cb31-35"><a href="structuring-project.html#cb31-35"></a>}</span>
<span id="cb31-36"><a href="structuring-project.html#cb31-36"></a></span>
<span id="cb31-37"><a href="structuring-project.html#cb31-37"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {</span>
<span id="cb31-38"><a href="structuring-project.html#cb31-38"></a>  </span>
<span id="cb31-39"><a href="structuring-project.html#cb31-39"></a>  <span class="co"># Observing the first series of inputs</span></span>
<span id="cb31-40"><a href="structuring-project.html#cb31-40"></a>  <span class="co"># Whenever the user clicks on the first validate button, </span></span>
<span id="cb31-41"><a href="structuring-project.html#cb31-41"></a>  <span class="co"># the value of choice1 will be printed to the console</span></span>
<span id="cb31-42"><a href="structuring-project.html#cb31-42"></a>  <span class="kw">observeEvent</span>( input<span class="op">$</span>validate1 , {</span>
<span id="cb31-43"><a href="structuring-project.html#cb31-43"></a>    <span class="kw">print</span>(input<span class="op">$</span>choice1)</span>
<span id="cb31-44"><a href="structuring-project.html#cb31-44"></a>  })</span>
<span id="cb31-45"><a href="structuring-project.html#cb31-45"></a>  </span>
<span id="cb31-46"><a href="structuring-project.html#cb31-46"></a>  <span class="co"># Same as the first observeEvent, except that we are </span></span>
<span id="cb31-47"><a href="structuring-project.html#cb31-47"></a>  <span class="co"># observing the second series</span></span>
<span id="cb31-48"><a href="structuring-project.html#cb31-48"></a>  <span class="kw">observeEvent</span>( input<span class="op">$</span>validate2 , {</span>
<span id="cb31-49"><a href="structuring-project.html#cb31-49"></a>    <span class="kw">print</span>(input<span class="op">$</span>choice2)</span>
<span id="cb31-50"><a href="structuring-project.html#cb31-50"></a>  })</span>
<span id="cb31-51"><a href="structuring-project.html#cb31-51"></a>}</span>
<span id="cb31-52"><a href="structuring-project.html#cb31-52"></a></span>
<span id="cb31-53"><a href="structuring-project.html#cb31-53"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<p>This, of course, is an approach that works.
Well, it works as long as your codebase is small.
But how can you be sure that you are not creating <code>validate6</code> on line 55 and another on line 837?
How can you be sure that you are deleting the correct combination of UI/server components if they are named that way?
Also, how do you work smoothly in a context where you have to scroll from <code>sliderInput("choice1")</code> to <code>observeEvent( input$choice1 , {})</code> which might be separated by thousands of lines?</p>
</div>
<div id="b.-working-with-a-bite-sized-codebase" class="section level4 unnumbered">
<h4>B. Working with a bite-sized codebase</h4>
<p>Build your application through multiple smaller applications that are easier to understand, develop and maintain, using <code>{shiny}</code> <span class="citation">(Chang et al. <a href="#ref-R-shiny" role="doc-biblioref">2020</a>)</span> modules.</p>
<p>We assume that you know the saying that “if you copy and paste something more than twice, you should make a function”.
In a <code>{shiny}</code> application, how can we refactor a partially repetitive piece of code so that it is reusable?</p>
<p>Yes, you guessed right: using shiny modules.
<strong><code>{shiny}</code> modules aim at three things: simplify “id” namespacing, split the codebase into a series of functions, and allow UI/Server parts of your app to be reused. Most of the time, modules are used to do the two first. In our case, we could say that 90% of the modules we write are never reused;<a href="#fn19" class="footnote-ref" id="fnref19"><sup>19</sup></a> they are here to allow us to split the codebase into smaller, more manageable pieces</strong>.</p>
<p>With <code>{shiny}</code> modules, you will be writing a combination of UI and server functions.
Think of them as small, standalone <code>{shiny}</code> apps, which handle a fraction of your global application.
If you develop R packages, chances are you have split your functions into series of smaller functions.
With <code>{shiny}</code> modules, you are doing the exact same thing: with just a little bit of tweaking, you can split your application into a series of smaller applications.</p>
</div>
</div>
<div id="when-to-use-shiny-modules" class="section level3">
<h3><span class="header-section-number">3.2.2</span> When to use <code>{shiny}</code> modules</h3>
<p>No matter how big your application is, it is always safe to start modularizing from the very beginning.
The sooner you use modules, the easier downstream development will be.
It is even easier if you are working with <code>{golem}</code>, which promotes the use of modules from the very beginning of your application.</p>
<p>“<em>Yes, but I just want to write a small app, nothing fancy.</em>”</p>
<p>A production app almost always started as a small proof of concept.
Then, the small PoC becomes an interesting idea.
Then, this idea becomes a strategic asset.
And before you know it, your not-that-fancy app needs to become larger and larger.
So, you will be better off starting on solid foundations from the very beginning.</p>
</div>
<div id="a-practical-walkthrough" class="section level3">
<h3><span class="header-section-number">3.2.3</span> A practical walkthrough</h3>
<p>An example is worth a thousand words, so let’s explore the code of a very small <code>{shiny}</code> application that is split into modules.</p>
<div id="a.-your-first-shiny-module" class="section level4 unnumbered">
<h4>A. Your first <code>{shiny}</code> module</h4>
<p>Let’s try to transform the above example (the one with two sliders and two action buttons) into an application with a module.
Note that the following code will work only for <code>{shiny}</code> version 1.5.0 and after.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="structuring-project.html#cb32-1"></a><span class="co"># Re-usable module</span></span>
<span id="cb32-2"><a href="structuring-project.html#cb32-2"></a>choice_ui &lt;-<span class="st"> </span><span class="cf">function</span>(id) {</span>
<span id="cb32-3"><a href="structuring-project.html#cb32-3"></a>  <span class="co"># This ns &lt;- NS structure creates a </span></span>
<span id="cb32-4"><a href="structuring-project.html#cb32-4"></a>  <span class="co"># &quot;namespacing&quot; function, that will </span></span>
<span id="cb32-5"><a href="structuring-project.html#cb32-5"></a>  <span class="co"># prefix all ids with a string</span></span>
<span id="cb32-6"><a href="structuring-project.html#cb32-6"></a>  ns &lt;-<span class="st"> </span><span class="kw">NS</span>(id)</span>
<span id="cb32-7"><a href="structuring-project.html#cb32-7"></a>  <span class="kw">tagList</span>(</span>
<span id="cb32-8"><a href="structuring-project.html#cb32-8"></a>    <span class="kw">sliderInput</span>(</span>
<span id="cb32-9"><a href="structuring-project.html#cb32-9"></a>      <span class="co"># This looks the same as your usual piece of code, </span></span>
<span id="cb32-10"><a href="structuring-project.html#cb32-10"></a>      <span class="co"># except that the id is wrapped into </span></span>
<span id="cb32-11"><a href="structuring-project.html#cb32-11"></a>      <span class="co"># the ns() function we defined before</span></span>
<span id="cb32-12"><a href="structuring-project.html#cb32-12"></a>      <span class="dt">inputId =</span> <span class="kw">ns</span>(<span class="st">&quot;choice&quot;</span>), </span>
<span id="cb32-13"><a href="structuring-project.html#cb32-13"></a>      <span class="dt">label =</span> <span class="st">&quot;Choice&quot;</span>,</span>
<span id="cb32-14"><a href="structuring-project.html#cb32-14"></a>      <span class="dt">min =</span> <span class="dv">1</span>, <span class="dt">max =</span> <span class="dv">10</span>, <span class="dt">value =</span> <span class="dv">5</span></span>
<span id="cb32-15"><a href="structuring-project.html#cb32-15"></a>    ),</span>
<span id="cb32-16"><a href="structuring-project.html#cb32-16"></a>    <span class="kw">actionButton</span>(</span>
<span id="cb32-17"><a href="structuring-project.html#cb32-17"></a>      <span class="co"># We need to ns() all ids</span></span>
<span id="cb32-18"><a href="structuring-project.html#cb32-18"></a>      <span class="dt">inputId =</span> <span class="kw">ns</span>(<span class="st">&quot;validate&quot;</span>),</span>
<span id="cb32-19"><a href="structuring-project.html#cb32-19"></a>      <span class="dt">label =</span> <span class="st">&quot;Validate Choice&quot;</span></span>
<span id="cb32-20"><a href="structuring-project.html#cb32-20"></a>    )</span>
<span id="cb32-21"><a href="structuring-project.html#cb32-21"></a>  )</span>
<span id="cb32-22"><a href="structuring-project.html#cb32-22"></a>}</span>
<span id="cb32-23"><a href="structuring-project.html#cb32-23"></a></span>
<span id="cb32-24"><a href="structuring-project.html#cb32-24"></a>choice_server &lt;-<span class="st"> </span><span class="cf">function</span>(id) {</span>
<span id="cb32-25"><a href="structuring-project.html#cb32-25"></a>  <span class="co"># Calling the moduleServer function</span></span>
<span id="cb32-26"><a href="structuring-project.html#cb32-26"></a>  <span class="kw">moduleServer</span>(</span>
<span id="cb32-27"><a href="structuring-project.html#cb32-27"></a>    <span class="co"># Setting the id</span></span>
<span id="cb32-28"><a href="structuring-project.html#cb32-28"></a>    id,</span>
<span id="cb32-29"><a href="structuring-project.html#cb32-29"></a>    <span class="co"># Defining the module core mechanism</span></span>
<span id="cb32-30"><a href="structuring-project.html#cb32-30"></a>    <span class="cf">function</span>(input, output, session) {</span>
<span id="cb32-31"><a href="structuring-project.html#cb32-31"></a>      <span class="co"># This part is the same as the code you would put </span></span>
<span id="cb32-32"><a href="structuring-project.html#cb32-32"></a>      <span class="co"># inside a standard server</span></span>
<span id="cb32-33"><a href="structuring-project.html#cb32-33"></a>      <span class="kw">observeEvent</span>( input<span class="op">$</span>validate , {</span>
<span id="cb32-34"><a href="structuring-project.html#cb32-34"></a>        <span class="kw">print</span>(input<span class="op">$</span>choice)</span>
<span id="cb32-35"><a href="structuring-project.html#cb32-35"></a>      })</span>
<span id="cb32-36"><a href="structuring-project.html#cb32-36"></a>    }</span>
<span id="cb32-37"><a href="structuring-project.html#cb32-37"></a>  )</span>
<span id="cb32-38"><a href="structuring-project.html#cb32-38"></a>}</span>
<span id="cb32-39"><a href="structuring-project.html#cb32-39"></a></span>
<span id="cb32-40"><a href="structuring-project.html#cb32-40"></a></span>
<span id="cb32-41"><a href="structuring-project.html#cb32-41"></a><span class="co"># Main application</span></span>
<span id="cb32-42"><a href="structuring-project.html#cb32-42"></a><span class="kw">library</span>(shiny)</span>
<span id="cb32-43"><a href="structuring-project.html#cb32-43"></a>app_ui &lt;-<span class="st"> </span><span class="cf">function</span>() {</span>
<span id="cb32-44"><a href="structuring-project.html#cb32-44"></a>  <span class="kw">fluidPage</span>(</span>
<span id="cb32-45"><a href="structuring-project.html#cb32-45"></a>    <span class="co"># Call the UI  function, this is the only place </span></span>
<span id="cb32-46"><a href="structuring-project.html#cb32-46"></a>    <span class="co"># your ids will need to be unique</span></span>
<span id="cb32-47"><a href="structuring-project.html#cb32-47"></a>    <span class="kw">choice_ui</span>(<span class="dt">id =</span> <span class="st">&quot;choice_ui1&quot;</span>),</span>
<span id="cb32-48"><a href="structuring-project.html#cb32-48"></a>    <span class="kw">choice_ui</span>(<span class="dt">id =</span> <span class="st">&quot;choice_ui2&quot;</span>)</span>
<span id="cb32-49"><a href="structuring-project.html#cb32-49"></a>  )</span>
<span id="cb32-50"><a href="structuring-project.html#cb32-50"></a>}</span>
<span id="cb32-51"><a href="structuring-project.html#cb32-51"></a></span>
<span id="cb32-52"><a href="structuring-project.html#cb32-52"></a>app_server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {</span>
<span id="cb32-53"><a href="structuring-project.html#cb32-53"></a>  <span class="co"># We are now calling the module server functions </span></span>
<span id="cb32-54"><a href="structuring-project.html#cb32-54"></a>  <span class="co"># on a given id that matches the one from the UI</span></span>
<span id="cb32-55"><a href="structuring-project.html#cb32-55"></a>  <span class="kw">choice_server</span>(<span class="dt">id =</span> <span class="st">&quot;choice_ui1&quot;</span>)</span>
<span id="cb32-56"><a href="structuring-project.html#cb32-56"></a>  <span class="kw">choice_server</span>(<span class="dt">id =</span> <span class="st">&quot;choice_ui2&quot;</span>)</span>
<span id="cb32-57"><a href="structuring-project.html#cb32-57"></a>}</span>
<span id="cb32-58"><a href="structuring-project.html#cb32-58"></a></span>
<span id="cb32-59"><a href="structuring-project.html#cb32-59"></a><span class="kw">shinyApp</span>(app_ui, app_server)</span></code></pre></div>
<p>Let’s stop for a minute and decompose what we have here.</p>
<p>The <strong>server</strong> function of the module (<code>mod_server()</code>) is pretty much the same as before: you use the same code as the one you would use in any server part of a <code>{shiny}</code> application.</p>
<p>The <strong>ui</strong> function of the module (<code>mod_ui()</code>) requires specific things.
There are two new things: <code>ns &lt;- NS(id)</code> and <code>ns(inputId)</code>.
That is where the namespacing happens.
Remember the previous version where we identified our two “validate” buttons with slightly different namespaces: <code>validate1</code> and <code>validate2</code>?
Here, we create namespaces with the <code>ns()</code> function, built with <code>ns &lt;- NS(id)</code>.
This line, <code>ns &lt;- NS(id)</code>, is added on top of all module UI functions and will allow building namespaces with the module id.</p>
<p>To understand what it does, let us try and run it outside <code>{shiny}</code>:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="structuring-project.html#cb33-1"></a><span class="co"># Defining the id</span></span>
<span id="cb33-2"><a href="structuring-project.html#cb33-2"></a>id &lt;-<span class="st"> &quot;mod_ui_1&quot;</span></span>
<span id="cb33-3"><a href="structuring-project.html#cb33-3"></a><span class="co"># Creating the internal &quot;namespacing&quot; function</span></span>
<span id="cb33-4"><a href="structuring-project.html#cb33-4"></a>ns &lt;-<span class="st"> </span><span class="kw">NS</span>(id)</span>
<span id="cb33-5"><a href="structuring-project.html#cb33-5"></a><span class="co"># &quot;namespace&quot; the id</span></span>
<span id="cb33-6"><a href="structuring-project.html#cb33-6"></a><span class="kw">ns</span>(<span class="st">&quot;choice&quot;</span>)</span></code></pre></div>
<pre><code>[1] &quot;mod_ui_1-choice&quot;</code></pre>
<p>And here it is, our namespaced <code>id</code>!</p>
<p>Each call to a module with <code>choice_server()</code> requires a different <code>id</code> argument that will allow creating various internal namespaces to prevent from id conflicts.<a href="#fn20" class="footnote-ref" id="fnref20"><sup>20</sup></a>
Then you can have as many <code>validate</code> ids as you want in your whole app, as long as this input has a unique id inside your module.</p>
<div id="note-for-shiny-1.5.0" class="section level5 unnumbered">
<h5>Note for <code>{shiny}</code> &lt; 1.5.0</h5>
<p>Released on 2020-06-23, the version 1.5.0 of <code>{shiny}</code> introduced a new way to write shiny modules, using a new function called <code>moduleServer()</code>.
This new function was introduced to make the couple <code>ui_function</code> / <code>server_function</code> more obvious, where the old version used to require a <code>callModule(server_function, id)</code> call.
This <code>callModule</code> notation is still valid (at least at the time of writing these lines), but we chose to go for the <code>moduleServer()</code> notation in this book.
Most of the applications that are used as examples in this book have been built before this new function though, so when you will read their code, you will find the <code>callModule</code> implementation.</p>
</div>
</div>
<div id="b.-passing-arguments-to-your-modules" class="section level4 unnumbered">
<h4>B. Passing arguments to your modules</h4>
<p><code>{shiny}</code> modules will potentially be reused and may need a specific user interface and inputs.
This requires using extra arguments to generate the UI and server.
As the UI and server are functions, you can set parameters that will be used to configure the internals of the result.</p>
<p>As you can see, the <strong>app_ui</strong> contains a series of calls to the
<code>mod_ui(unique_id, ...)</code> function, allowing additional arguments like any other function:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="structuring-project.html#cb35-1"></a>mod_ui &lt;-<span class="st"> </span><span class="cf">function</span>(id, button_label) {</span>
<span id="cb35-2"><a href="structuring-project.html#cb35-2"></a>  ns &lt;-<span class="st"> </span><span class="kw">NS</span>(id)</span>
<span id="cb35-3"><a href="structuring-project.html#cb35-3"></a>  <span class="kw">tagList</span>(</span>
<span id="cb35-4"><a href="structuring-project.html#cb35-4"></a>    <span class="kw">actionButton</span>(<span class="kw">ns</span>(<span class="st">&quot;validate&quot;</span>), button_label)</span>
<span id="cb35-5"><a href="structuring-project.html#cb35-5"></a>  )</span>
<span id="cb35-6"><a href="structuring-project.html#cb35-6"></a>}</span>
<span id="cb35-7"><a href="structuring-project.html#cb35-7"></a></span>
<span id="cb35-8"><a href="structuring-project.html#cb35-8"></a><span class="co"># Printing the HTML for this piece of UI</span></span>
<span id="cb35-9"><a href="structuring-project.html#cb35-9"></a><span class="kw">mod_ui</span>(<span class="st">&quot;mod_ui_1&quot;</span>, <span class="dt">button_label =</span> <span class="st">&quot;Validate &quot;</span>)</span>
<span id="cb35-10"><a href="structuring-project.html#cb35-10"></a><span class="kw">mod_ui</span>(<span class="st">&quot;mod_ui_2&quot;</span>, <span class="dt">button_label =</span> <span class="st">&quot;Validate, again&quot;</span>)</span></code></pre></div>
<pre><code>&lt;!-- The ids are &quot;namespaced&quot; with mod_ui_*--&gt;
&lt;button id=&quot;mod_ui_1-validate&quot; type=&quot;button&quot; 
class=&quot;btn btn-default action-button&quot;&gt;Validate&lt;/button&gt;

&lt;!-- The ids are &quot;namespaced&quot; with mod_ui_*--&gt;
&lt;button id=&quot;mod_ui_2-validate&quot; type=&quot;button&quot; 
class=&quot;btn btn-default action-button&quot;&gt;Validate, again&lt;/button&gt;</code></pre>
<p>The <strong>app_server</strong> side contains a series of <code>mod_server(unique_id, ...)</code>, also allowing additional parameters, just like any other function.</p>
<p>As a live example, we can have a look at <a href="https://github.com/ColinFay/tidytuesday201942/blob/master/R/mod_dataviz.R#L17">mod_dataviz.R</a> from the <code>{tidytuesday201942}</code> <span class="citation">(Fay <a href="#ref-R-tidytuesday201942" role="doc-biblioref">2020</a><a href="#ref-R-tidytuesday201942" role="doc-biblioref">l</a>)</span> <code>{shiny}</code> application, available at <a href="https://connect.thinkr.fr/tidytuesday201942/" class="uri">https://connect.thinkr.fr/tidytuesday201942/</a>.
Figure <a href="structuring-project.html#fig:03-structure-6">3.1</a> is a screenshot of this application.</p>
<p>This application contains 6 tabs, 4 of them being pretty much alike: a side bar with inputs, a main panel with a button, and the plot.
This plot can be, depending on the tab, a scatterplot, a histogram, a boxplot, or a barplot.</p>
<p>This is a typical case where you should reuse modules: if several parts are relatively similar, it is easier to bundle it inside a reusable module, and condition the UI/server with function arguments.</p>

<div class="figure" style="text-align: center"><span id="fig:03-structure-6"></span>
<img src="img/tidytuesdayapp.png" alt="Snapshot of the {tidytuesday201942} {shiny} application." width="100%" />
<p class="caption">
FIGURE 3.1: Snapshot of the <code>{tidytuesday201942}</code> <code>{shiny}</code> application.
</p>
</div>
<p>Let’s extract some pieces of this application to show how (and why) you would parametrize your module.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="structuring-project.html#cb37-1"></a>mod_dataviz_ui &lt;-<span class="st"> </span><span class="cf">function</span>(</span>
<span id="cb37-2"><a href="structuring-project.html#cb37-2"></a>  id, </span>
<span id="cb37-3"><a href="structuring-project.html#cb37-3"></a>  <span class="dt">type =</span> <span class="kw">c</span>(<span class="st">&quot;point&quot;</span>, <span class="st">&quot;hist&quot;</span>, <span class="st">&quot;boxplot&quot;</span>, <span class="st">&quot;bar&quot;</span>)</span>
<span id="cb37-4"><a href="structuring-project.html#cb37-4"></a>) {</span>
<span id="cb37-5"><a href="structuring-project.html#cb37-5"></a>  <span class="co"># Setting a header with the specified type of graph</span></span>
<span id="cb37-6"><a href="structuring-project.html#cb37-6"></a>  <span class="kw">h4</span>(</span>
<span id="cb37-7"><a href="structuring-project.html#cb37-7"></a>    <span class="kw">sprintf</span>( <span class="st">&quot;Create a geom_%s&quot;</span>, type )</span>
<span id="cb37-8"><a href="structuring-project.html#cb37-8"></a>  ),</span>
<span id="cb37-9"><a href="structuring-project.html#cb37-9"></a>  <span class="co"># [ ... ]</span></span>
<span id="cb37-10"><a href="structuring-project.html#cb37-10"></a>  <span class="co"># We want to allow a coord_flip only with barplots</span></span>
<span id="cb37-11"><a href="structuring-project.html#cb37-11"></a>  <span class="cf">if</span> (type <span class="op">==</span><span class="st"> &quot;bar&quot;</span>){</span>
<span id="cb37-12"><a href="structuring-project.html#cb37-12"></a>    <span class="kw">checkboxInput</span>(</span>
<span id="cb37-13"><a href="structuring-project.html#cb37-13"></a>      <span class="kw">ns</span>(<span class="st">&quot;coord_flip&quot;</span>),</span>
<span id="cb37-14"><a href="structuring-project.html#cb37-14"></a>      <span class="st">&quot;coord_flip&quot;</span></span>
<span id="cb37-15"><a href="structuring-project.html#cb37-15"></a>    )</span>
<span id="cb37-16"><a href="structuring-project.html#cb37-16"></a>  }, </span>
<span id="cb37-17"><a href="structuring-project.html#cb37-17"></a>  <span class="co"># [ ... ]</span></span>
<span id="cb37-18"><a href="structuring-project.html#cb37-18"></a>  <span class="co"># We want to display the bins input only </span></span>
<span id="cb37-19"><a href="structuring-project.html#cb37-19"></a>  <span class="co"># when the type is histogram</span></span>
<span id="cb37-20"><a href="structuring-project.html#cb37-20"></a>  <span class="cf">if</span> (type <span class="op">==</span><span class="st"> &quot;hist&quot;</span>) {</span>
<span id="cb37-21"><a href="structuring-project.html#cb37-21"></a>    <span class="kw">numericInput</span>(</span>
<span id="cb37-22"><a href="structuring-project.html#cb37-22"></a>      <span class="kw">ns</span>(<span class="st">&quot;bins&quot;</span>), </span>
<span id="cb37-23"><a href="structuring-project.html#cb37-23"></a>      <span class="st">&quot;bins&quot;</span>, </span>
<span id="cb37-24"><a href="structuring-project.html#cb37-24"></a>      <span class="dv">30</span>, </span>
<span id="cb37-25"><a href="structuring-project.html#cb37-25"></a>      <span class="dv">1</span>, </span>
<span id="cb37-26"><a href="structuring-project.html#cb37-26"></a>      <span class="dv">150</span>,</span>
<span id="cb37-27"><a href="structuring-project.html#cb37-27"></a>      <span class="dv">1</span></span>
<span id="cb37-28"><a href="structuring-project.html#cb37-28"></a>    )</span>
<span id="cb37-29"><a href="structuring-project.html#cb37-29"></a>  },</span>
<span id="cb37-30"><a href="structuring-project.html#cb37-30"></a>  <span class="co"># [ ... ]</span></span>
<span id="cb37-31"><a href="structuring-project.html#cb37-31"></a>  <span class="co"># The title input will be added to the graph </span></span>
<span id="cb37-32"><a href="structuring-project.html#cb37-32"></a>  <span class="co"># for every type of graph</span></span>
<span id="cb37-33"><a href="structuring-project.html#cb37-33"></a>  <span class="kw">textInput</span>(</span>
<span id="cb37-34"><a href="structuring-project.html#cb37-34"></a>    <span class="kw">ns</span>(<span class="st">&quot;title&quot;</span>),</span>
<span id="cb37-35"><a href="structuring-project.html#cb37-35"></a>    <span class="st">&quot;Title&quot;</span>,</span>
<span id="cb37-36"><a href="structuring-project.html#cb37-36"></a>    <span class="dt">value =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb37-37"><a href="structuring-project.html#cb37-37"></a>  )</span>
<span id="cb37-38"><a href="structuring-project.html#cb37-38"></a>}</span></code></pre></div>
<p>And in the module server:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="structuring-project.html#cb38-1"></a>mod_dataviz_server &lt;-<span class="st"> </span><span class="cf">function</span>(</span>
<span id="cb38-2"><a href="structuring-project.html#cb38-2"></a>  input, </span>
<span id="cb38-3"><a href="structuring-project.html#cb38-3"></a>  output, </span>
<span id="cb38-4"><a href="structuring-project.html#cb38-4"></a>  session, </span>
<span id="cb38-5"><a href="structuring-project.html#cb38-5"></a>  type</span>
<span id="cb38-6"><a href="structuring-project.html#cb38-6"></a>) {</span>
<span id="cb38-7"><a href="structuring-project.html#cb38-7"></a>  <span class="co"># [ ... ]</span></span>
<span id="cb38-8"><a href="structuring-project.html#cb38-8"></a>  <span class="cf">if</span> (type <span class="op">==</span><span class="st"> &quot;point&quot;</span>) {</span>
<span id="cb38-9"><a href="structuring-project.html#cb38-9"></a>    <span class="co"># Defining the server logic when the type is point</span></span>
<span id="cb38-10"><a href="structuring-project.html#cb38-10"></a>    <span class="co"># When the type is point, we have access to input$x, </span></span>
<span id="cb38-11"><a href="structuring-project.html#cb38-11"></a>    <span class="co"># input$y, input$color, and input$palette, </span></span>
<span id="cb38-12"><a href="structuring-project.html#cb38-12"></a>    <span class="co"># so we reuse them here</span></span>
<span id="cb38-13"><a href="structuring-project.html#cb38-13"></a>    <span class="kw">ggplot</span>(</span>
<span id="cb38-14"><a href="structuring-project.html#cb38-14"></a>      big_epa_cars, </span>
<span id="cb38-15"><a href="structuring-project.html#cb38-15"></a>      <span class="kw">aes</span>(</span>
<span id="cb38-16"><a href="structuring-project.html#cb38-16"></a>        .data[[input<span class="op">$</span>x]], </span>
<span id="cb38-17"><a href="structuring-project.html#cb38-17"></a>        .data[[input<span class="op">$</span>y]], </span>
<span id="cb38-18"><a href="structuring-project.html#cb38-18"></a>        <span class="dt">color =</span> .data[[input<span class="op">$</span>color]])</span>
<span id="cb38-19"><a href="structuring-project.html#cb38-19"></a>    )  <span class="op">+</span></span>
<span id="cb38-20"><a href="structuring-project.html#cb38-20"></a><span class="st">      </span><span class="kw">geom_point</span>()<span class="op">+</span><span class="st"> </span></span>
<span id="cb38-21"><a href="structuring-project.html#cb38-21"></a><span class="st">      </span><span class="kw">scale_color_manual</span>(</span>
<span id="cb38-22"><a href="structuring-project.html#cb38-22"></a>        <span class="dt">values =</span> <span class="kw">color_values</span>(</span>
<span id="cb38-23"><a href="structuring-project.html#cb38-23"></a>          <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(</span>
<span id="cb38-24"><a href="structuring-project.html#cb38-24"></a>            <span class="kw">unique</span>(</span>
<span id="cb38-25"><a href="structuring-project.html#cb38-25"></a>              <span class="kw">pull</span>(</span>
<span id="cb38-26"><a href="structuring-project.html#cb38-26"></a>                big_epa_cars, </span>
<span id="cb38-27"><a href="structuring-project.html#cb38-27"></a>                .data[[input<span class="op">$</span>color]])</span>
<span id="cb38-28"><a href="structuring-project.html#cb38-28"></a>            )</span>
<span id="cb38-29"><a href="structuring-project.html#cb38-29"></a>          ), </span>
<span id="cb38-30"><a href="structuring-project.html#cb38-30"></a>          <span class="dt">palette =</span> input<span class="op">$</span>palette</span>
<span id="cb38-31"><a href="structuring-project.html#cb38-31"></a>        )</span>
<span id="cb38-32"><a href="structuring-project.html#cb38-32"></a>      )</span>
<span id="cb38-33"><a href="structuring-project.html#cb38-33"></a>  } </span>
<span id="cb38-34"><a href="structuring-project.html#cb38-34"></a>  <span class="co"># [ ... ]</span></span>
<span id="cb38-35"><a href="structuring-project.html#cb38-35"></a>  <span class="cf">if</span> (type <span class="op">==</span><span class="st"> &quot;hist&quot;</span>) {</span>
<span id="cb38-36"><a href="structuring-project.html#cb38-36"></a>    <span class="co"># Defining the server logic when the type is hist</span></span>
<span id="cb38-37"><a href="structuring-project.html#cb38-37"></a>    <span class="co"># When the type is point, we have access to input$x, </span></span>
<span id="cb38-38"><a href="structuring-project.html#cb38-38"></a>    <span class="co"># input$color, input$bins, and input$palette</span></span>
<span id="cb38-39"><a href="structuring-project.html#cb38-39"></a>    <span class="co"># so we reuse them here</span></span>
<span id="cb38-40"><a href="structuring-project.html#cb38-40"></a>    <span class="kw">ggplot</span>(</span>
<span id="cb38-41"><a href="structuring-project.html#cb38-41"></a>      big_epa_cars, </span>
<span id="cb38-42"><a href="structuring-project.html#cb38-42"></a>      <span class="kw">aes</span>(</span>
<span id="cb38-43"><a href="structuring-project.html#cb38-43"></a>        .data[[input<span class="op">$</span>x]], </span>
<span id="cb38-44"><a href="structuring-project.html#cb38-44"></a>        <span class="dt">fill =</span> .data[[input<span class="op">$</span>color]]</span>
<span id="cb38-45"><a href="structuring-project.html#cb38-45"></a>      )</span>
<span id="cb38-46"><a href="structuring-project.html#cb38-46"></a>    ) <span class="op">+</span></span>
<span id="cb38-47"><a href="structuring-project.html#cb38-47"></a><span class="st">      </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> input<span class="op">$</span>bins)<span class="op">+</span><span class="st"> </span></span>
<span id="cb38-48"><a href="structuring-project.html#cb38-48"></a><span class="st">      </span><span class="kw">scale_fill_manual</span>(</span>
<span id="cb38-49"><a href="structuring-project.html#cb38-49"></a>        <span class="dt">values =</span> <span class="kw">color_values</span>(</span>
<span id="cb38-50"><a href="structuring-project.html#cb38-50"></a>          <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(</span>
<span id="cb38-51"><a href="structuring-project.html#cb38-51"></a>            <span class="kw">unique</span>(</span>
<span id="cb38-52"><a href="structuring-project.html#cb38-52"></a>              <span class="kw">pull</span>(</span>
<span id="cb38-53"><a href="structuring-project.html#cb38-53"></a>                big_epa_cars, </span>
<span id="cb38-54"><a href="structuring-project.html#cb38-54"></a>                .data[[input<span class="op">$</span>color]]</span>
<span id="cb38-55"><a href="structuring-project.html#cb38-55"></a>              )</span>
<span id="cb38-56"><a href="structuring-project.html#cb38-56"></a>            )</span>
<span id="cb38-57"><a href="structuring-project.html#cb38-57"></a>          ), </span>
<span id="cb38-58"><a href="structuring-project.html#cb38-58"></a>          <span class="dt">palette =</span> input<span class="op">$</span>palette</span>
<span id="cb38-59"><a href="structuring-project.html#cb38-59"></a>        )</span>
<span id="cb38-60"><a href="structuring-project.html#cb38-60"></a>      )</span>
<span id="cb38-61"><a href="structuring-project.html#cb38-61"></a>  } </span>
<span id="cb38-62"><a href="structuring-project.html#cb38-62"></a>}</span></code></pre></div>
<p>Then, the UI of the entire application is:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="structuring-project.html#cb39-1"></a>app_ui &lt;-<span class="st"> </span><span class="cf">function</span>() {</span>
<span id="cb39-2"><a href="structuring-project.html#cb39-2"></a>  <span class="co"># [...]</span></span>
<span id="cb39-3"><a href="structuring-project.html#cb39-3"></a>  <span class="kw">tagList</span>(</span>
<span id="cb39-4"><a href="structuring-project.html#cb39-4"></a>    <span class="kw">fluidRow</span>(</span>
<span id="cb39-5"><a href="structuring-project.html#cb39-5"></a>      <span class="co"># Setting the first tab to be of type point</span></span>
<span id="cb39-6"><a href="structuring-project.html#cb39-6"></a>      <span class="dt">id =</span> <span class="st">&quot;geom_point&quot;</span>, </span>
<span id="cb39-7"><a href="structuring-project.html#cb39-7"></a>      <span class="kw">mod_dataviz_ui</span>(</span>
<span id="cb39-8"><a href="structuring-project.html#cb39-8"></a>        <span class="st">&quot;dataviz_ui_1&quot;</span>, </span>
<span id="cb39-9"><a href="structuring-project.html#cb39-9"></a>        <span class="dt">type =</span> <span class="st">&quot;point&quot;</span></span>
<span id="cb39-10"><a href="structuring-project.html#cb39-10"></a>      )</span>
<span id="cb39-11"><a href="structuring-project.html#cb39-11"></a>    ), </span>
<span id="cb39-12"><a href="structuring-project.html#cb39-12"></a>    <span class="kw">fluidRow</span>(</span>
<span id="cb39-13"><a href="structuring-project.html#cb39-13"></a>      <span class="co"># Setting the second tab to be of type point</span></span>
<span id="cb39-14"><a href="structuring-project.html#cb39-14"></a>      <span class="dt">id =</span> <span class="st">&quot;geom_hist&quot;</span>, </span>
<span id="cb39-15"><a href="structuring-project.html#cb39-15"></a>      <span class="kw">mod_dataviz_ui</span>(</span>
<span id="cb39-16"><a href="structuring-project.html#cb39-16"></a>        <span class="st">&quot;dataviz_ui_2&quot;</span>, </span>
<span id="cb39-17"><a href="structuring-project.html#cb39-17"></a>        <span class="dt">type =</span> <span class="st">&quot;hist&quot;</span></span>
<span id="cb39-18"><a href="structuring-project.html#cb39-18"></a>      )</span>
<span id="cb39-19"><a href="structuring-project.html#cb39-19"></a>    )</span>
<span id="cb39-20"><a href="structuring-project.html#cb39-20"></a>  )</span>
<span id="cb39-21"><a href="structuring-project.html#cb39-21"></a>}</span></code></pre></div>
<p>And the <code>app_server()</code> of the application:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="structuring-project.html#cb40-1"></a>app_server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {</span>
<span id="cb40-2"><a href="structuring-project.html#cb40-2"></a>  <span class="co"># This app has been built before shiny 1.5.0, </span></span>
<span id="cb40-3"><a href="structuring-project.html#cb40-3"></a>  <span class="co"># so we use the callModule structure</span></span>
<span id="cb40-4"><a href="structuring-project.html#cb40-4"></a>  <span class="co"># </span></span>
<span id="cb40-5"><a href="structuring-project.html#cb40-5"></a>  <span class="co"># We here call the server module on their </span></span>
<span id="cb40-6"><a href="structuring-project.html#cb40-6"></a>  <span class="co"># corresponding id in the UI, and set the </span></span>
<span id="cb40-7"><a href="structuring-project.html#cb40-7"></a>  <span class="co"># parameter of the server function to </span></span>
<span id="cb40-8"><a href="structuring-project.html#cb40-8"></a>  <span class="co"># match the correct type of input</span></span>
<span id="cb40-9"><a href="structuring-project.html#cb40-9"></a>  <span class="kw">callModule</span>(mod_dataviz_server, <span class="st">&quot;dataviz_ui_1&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;point&quot;</span>)</span>
<span id="cb40-10"><a href="structuring-project.html#cb40-10"></a>  <span class="kw">callModule</span>(mod_dataviz_server, <span class="st">&quot;dataviz_ui_2&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;hist&quot;</span>)</span>
<span id="cb40-11"><a href="structuring-project.html#cb40-11"></a>}</span></code></pre></div>
</div>
</div>
<div id="communication-between-modules" class="section level3">
<h3><span class="header-section-number">3.2.4</span> Communication between modules</h3>
<p>One of the hardest part of using modules is sharing data across them.
There are at least three approaches:</p>
<ul>
<li>Returning a <code>reactive</code> function</li>
<li>The “stratégie du petit r” (to be pronounced with a French accent of course)</li>
<li>The “stratégie du grand R6”</li>
</ul>
<div id="a.-returning-values-from-the-module" class="section level4 unnumbered">
<h4>A. Returning values from the module</h4>
<p>One common approach is to return a <code>reactive</code> function from one module<strong>, and pass it to another</strong> in the general <code>app_server()</code> function.</p>
<p>Here is an example that illustrates this pattern.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="structuring-project.html#cb41-1"></a><span class="co"># Module 1, which will allow to select a number</span></span>
<span id="cb41-2"><a href="structuring-project.html#cb41-2"></a>choice_ui &lt;-<span class="st"> </span><span class="cf">function</span>(id) {</span>
<span id="cb41-3"><a href="structuring-project.html#cb41-3"></a>  ns &lt;-<span class="st"> </span><span class="kw">NS</span>(id)</span>
<span id="cb41-4"><a href="structuring-project.html#cb41-4"></a>  <span class="kw">tagList</span>(</span>
<span id="cb41-5"><a href="structuring-project.html#cb41-5"></a>    <span class="co"># Add a slider to select a number</span></span>
<span id="cb41-6"><a href="structuring-project.html#cb41-6"></a>    <span class="kw">sliderInput</span>(<span class="kw">ns</span>(<span class="st">&quot;choice&quot;</span>), <span class="st">&quot;Choice&quot;</span>, <span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">5</span>)</span>
<span id="cb41-7"><a href="structuring-project.html#cb41-7"></a>  )</span>
<span id="cb41-8"><a href="structuring-project.html#cb41-8"></a>}</span>
<span id="cb41-9"><a href="structuring-project.html#cb41-9"></a></span>
<span id="cb41-10"><a href="structuring-project.html#cb41-10"></a></span>
<span id="cb41-11"><a href="structuring-project.html#cb41-11"></a>choice_server &lt;-<span class="st"> </span><span class="cf">function</span>(id) {</span>
<span id="cb41-12"><a href="structuring-project.html#cb41-12"></a>  <span class="kw">moduleServer</span>( id, <span class="cf">function</span>(input, output, session) {</span>
<span id="cb41-13"><a href="structuring-project.html#cb41-13"></a>    <span class="co"># We return a reactive function from this server, </span></span>
<span id="cb41-14"><a href="structuring-project.html#cb41-14"></a>    <span class="co"># that can be passed along to other modules</span></span>
<span id="cb41-15"><a href="structuring-project.html#cb41-15"></a>    <span class="kw">return</span>(</span>
<span id="cb41-16"><a href="structuring-project.html#cb41-16"></a>      <span class="kw">reactive</span>({</span>
<span id="cb41-17"><a href="structuring-project.html#cb41-17"></a>        input<span class="op">$</span>choice</span>
<span id="cb41-18"><a href="structuring-project.html#cb41-18"></a>      })</span>
<span id="cb41-19"><a href="structuring-project.html#cb41-19"></a>    )</span>
<span id="cb41-20"><a href="structuring-project.html#cb41-20"></a>  }</span>
<span id="cb41-21"><a href="structuring-project.html#cb41-21"></a>  )</span>
<span id="cb41-22"><a href="structuring-project.html#cb41-22"></a>}</span>
<span id="cb41-23"><a href="structuring-project.html#cb41-23"></a></span>
<span id="cb41-24"><a href="structuring-project.html#cb41-24"></a><span class="co"># Module 2, which will display the number</span></span>
<span id="cb41-25"><a href="structuring-project.html#cb41-25"></a>printing_ui &lt;-<span class="st"> </span><span class="cf">function</span>(id) {</span>
<span id="cb41-26"><a href="structuring-project.html#cb41-26"></a>  ns &lt;-<span class="st"> </span><span class="kw">NS</span>(id)</span>
<span id="cb41-27"><a href="structuring-project.html#cb41-27"></a>  <span class="kw">tagList</span>(</span>
<span id="cb41-28"><a href="structuring-project.html#cb41-28"></a>    <span class="co"># Insert the number modified in the first module</span></span>
<span id="cb41-29"><a href="structuring-project.html#cb41-29"></a>    <span class="kw">verbatimTextOutput</span>(<span class="kw">ns</span>(<span class="st">&quot;print&quot;</span>))</span>
<span id="cb41-30"><a href="structuring-project.html#cb41-30"></a>  )</span>
<span id="cb41-31"><a href="structuring-project.html#cb41-31"></a>}</span>
<span id="cb41-32"><a href="structuring-project.html#cb41-32"></a></span>
<span id="cb41-33"><a href="structuring-project.html#cb41-33"></a>printing_server &lt;-<span class="st"> </span><span class="cf">function</span>(id, number) {</span>
<span id="cb41-34"><a href="structuring-project.html#cb41-34"></a>  <span class="kw">moduleServer</span>(id, <span class="cf">function</span>(input, output, session) {</span>
<span id="cb41-35"><a href="structuring-project.html#cb41-35"></a>    <span class="co"># We evaluate the reactive function </span></span>
<span id="cb41-36"><a href="structuring-project.html#cb41-36"></a>    <span class="co"># returned from the other module</span></span>
<span id="cb41-37"><a href="structuring-project.html#cb41-37"></a>    output<span class="op">$</span>print &lt;-<span class="st"> </span><span class="kw">renderPrint</span>({</span>
<span id="cb41-38"><a href="structuring-project.html#cb41-38"></a>      <span class="kw">number</span>()</span>
<span id="cb41-39"><a href="structuring-project.html#cb41-39"></a>    })</span>
<span id="cb41-40"><a href="structuring-project.html#cb41-40"></a>  }</span>
<span id="cb41-41"><a href="structuring-project.html#cb41-41"></a>  )</span>
<span id="cb41-42"><a href="structuring-project.html#cb41-42"></a>}</span>
<span id="cb41-43"><a href="structuring-project.html#cb41-43"></a></span>
<span id="cb41-44"><a href="structuring-project.html#cb41-44"></a><span class="co"># Application</span></span>
<span id="cb41-45"><a href="structuring-project.html#cb41-45"></a><span class="kw">library</span>(shiny)</span>
<span id="cb41-46"><a href="structuring-project.html#cb41-46"></a>app_ui &lt;-<span class="st"> </span><span class="cf">function</span>() {</span>
<span id="cb41-47"><a href="structuring-project.html#cb41-47"></a>  <span class="kw">fluidPage</span>(</span>
<span id="cb41-48"><a href="structuring-project.html#cb41-48"></a>    <span class="kw">choice_ui</span>(<span class="st">&quot;choice_ui_1&quot;</span>),</span>
<span id="cb41-49"><a href="structuring-project.html#cb41-49"></a>    <span class="kw">printing_ui</span>(<span class="st">&quot;printing_ui_2&quot;</span>)</span>
<span id="cb41-50"><a href="structuring-project.html#cb41-50"></a>  )</span>
<span id="cb41-51"><a href="structuring-project.html#cb41-51"></a>}</span>
<span id="cb41-52"><a href="structuring-project.html#cb41-52"></a></span>
<span id="cb41-53"><a href="structuring-project.html#cb41-53"></a>app_server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {</span>
<span id="cb41-54"><a href="structuring-project.html#cb41-54"></a>  <span class="co"># choice_server() returns a value that is then passed to </span></span>
<span id="cb41-55"><a href="structuring-project.html#cb41-55"></a>  <span class="co"># printing_server()</span></span>
<span id="cb41-56"><a href="structuring-project.html#cb41-56"></a>  number_from_first_mod &lt;-<span class="st"> </span><span class="kw">choice_server</span>(<span class="st">&quot;choice_ui_1&quot;</span>)</span>
<span id="cb41-57"><a href="structuring-project.html#cb41-57"></a>  <span class="kw">printing_server</span>(</span>
<span id="cb41-58"><a href="structuring-project.html#cb41-58"></a>    <span class="st">&quot;printing_ui_2&quot;</span>, </span>
<span id="cb41-59"><a href="structuring-project.html#cb41-59"></a>    <span class="dt">number =</span> number_from_first_mod</span>
<span id="cb41-60"><a href="structuring-project.html#cb41-60"></a>  )</span>
<span id="cb41-61"><a href="structuring-project.html#cb41-61"></a>}</span>
<span id="cb41-62"><a href="structuring-project.html#cb41-62"></a></span>
<span id="cb41-63"><a href="structuring-project.html#cb41-63"></a><span class="kw">shinyApp</span>(app_ui, app_server)</span></code></pre></div>
<p>This strategy works well, but for large <code>{shiny}</code> apps it might be hard to handle large lists of reactive outputs / inputs and to keep track of how things are organized.
It might also create some reactivity issues, as a lot of <code>reactive</code> function calls is harder to control, or lead to too much computation from the server.</p>
</div>
<div id="b.-the-stratégie-du-petit-r" class="section level4 unnumbered">
<h4>B. The “stratégie du petit r”</h4>
<p>In this strategy, we <strong>create a global <code>reactiveValues</code> list that is passed along through other modules</strong>.
The idea is that it allows you to be less preoccupied about what your module takes as input and what it outputs.
You can think of this approach as creating a small, internal database that is passed along through all the modules of your application.</p>
<p>Below, we create a “global” (in the sense that it is initiated at the top of the module hierarchy) <code>reactiveValues()</code> object in the <code>app_server()</code> function.
It will then go through all modules, passed as a function argument.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="structuring-project.html#cb42-1"></a><span class="co"># Module 1, which will allow to select a number</span></span>
<span id="cb42-2"><a href="structuring-project.html#cb42-2"></a>choice_ui &lt;-<span class="st"> </span><span class="cf">function</span>(id) {</span>
<span id="cb42-3"><a href="structuring-project.html#cb42-3"></a>  ns &lt;-<span class="st"> </span><span class="kw">NS</span>(id)</span>
<span id="cb42-4"><a href="structuring-project.html#cb42-4"></a>  <span class="kw">tagList</span>(</span>
<span id="cb42-5"><a href="structuring-project.html#cb42-5"></a>    <span class="co"># Add a slider to select a number</span></span>
<span id="cb42-6"><a href="structuring-project.html#cb42-6"></a>    <span class="kw">sliderInput</span>(<span class="kw">ns</span>(<span class="st">&quot;choice&quot;</span>), <span class="st">&quot;Choice&quot;</span>, <span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">5</span>)</span>
<span id="cb42-7"><a href="structuring-project.html#cb42-7"></a>  )</span>
<span id="cb42-8"><a href="structuring-project.html#cb42-8"></a>}</span>
<span id="cb42-9"><a href="structuring-project.html#cb42-9"></a></span>
<span id="cb42-10"><a href="structuring-project.html#cb42-10"></a>choice_server &lt;-<span class="st"> </span><span class="cf">function</span>(id, r) {</span>
<span id="cb42-11"><a href="structuring-project.html#cb42-11"></a>  <span class="kw">moduleServer</span>(</span>
<span id="cb42-12"><a href="structuring-project.html#cb42-12"></a>    id,</span>
<span id="cb42-13"><a href="structuring-project.html#cb42-13"></a>    <span class="cf">function</span>(input, output, session) {</span>
<span id="cb42-14"><a href="structuring-project.html#cb42-14"></a>      <span class="co"># Whenever the choice changes, the value inside r is set</span></span>
<span id="cb42-15"><a href="structuring-project.html#cb42-15"></a>      <span class="kw">observeEvent</span>( input<span class="op">$</span>choice , {</span>
<span id="cb42-16"><a href="structuring-project.html#cb42-16"></a>        r<span class="op">$</span>number_from_first_mod &lt;-<span class="st"> </span>input<span class="op">$</span>choice</span>
<span id="cb42-17"><a href="structuring-project.html#cb42-17"></a>      })</span>
<span id="cb42-18"><a href="structuring-project.html#cb42-18"></a>      </span>
<span id="cb42-19"><a href="structuring-project.html#cb42-19"></a>    }</span>
<span id="cb42-20"><a href="structuring-project.html#cb42-20"></a>  )</span>
<span id="cb42-21"><a href="structuring-project.html#cb42-21"></a>}</span>
<span id="cb42-22"><a href="structuring-project.html#cb42-22"></a></span>
<span id="cb42-23"><a href="structuring-project.html#cb42-23"></a><span class="co"># Module 2, which will display the number</span></span>
<span id="cb42-24"><a href="structuring-project.html#cb42-24"></a>printing_ui &lt;-<span class="st"> </span><span class="cf">function</span>(id) {</span>
<span id="cb42-25"><a href="structuring-project.html#cb42-25"></a>  ns &lt;-<span class="st"> </span><span class="kw">NS</span>(id)</span>
<span id="cb42-26"><a href="structuring-project.html#cb42-26"></a>  <span class="kw">tagList</span>(</span>
<span id="cb42-27"><a href="structuring-project.html#cb42-27"></a>    <span class="co"># Insert the number modified in the first module</span></span>
<span id="cb42-28"><a href="structuring-project.html#cb42-28"></a>    <span class="kw">verbatimTextOutput</span>(<span class="kw">ns</span>(<span class="st">&quot;print&quot;</span>))</span>
<span id="cb42-29"><a href="structuring-project.html#cb42-29"></a>  )</span>
<span id="cb42-30"><a href="structuring-project.html#cb42-30"></a>}</span>
<span id="cb42-31"><a href="structuring-project.html#cb42-31"></a></span>
<span id="cb42-32"><a href="structuring-project.html#cb42-32"></a>printing_server &lt;-<span class="st"> </span><span class="cf">function</span>(id, r) {</span>
<span id="cb42-33"><a href="structuring-project.html#cb42-33"></a>  <span class="kw">moduleServer</span>(</span>
<span id="cb42-34"><a href="structuring-project.html#cb42-34"></a>    id,</span>
<span id="cb42-35"><a href="structuring-project.html#cb42-35"></a>    <span class="cf">function</span>(input, output, session) {</span>
<span id="cb42-36"><a href="structuring-project.html#cb42-36"></a>      <span class="co"># We evaluate the reactiveValue element modified in the </span></span>
<span id="cb42-37"><a href="structuring-project.html#cb42-37"></a>      <span class="co"># first module</span></span>
<span id="cb42-38"><a href="structuring-project.html#cb42-38"></a>      output<span class="op">$</span>print &lt;-<span class="st"> </span><span class="kw">renderPrint</span>({</span>
<span id="cb42-39"><a href="structuring-project.html#cb42-39"></a>        r<span class="op">$</span>number_from_first_mod</span>
<span id="cb42-40"><a href="structuring-project.html#cb42-40"></a>      })</span>
<span id="cb42-41"><a href="structuring-project.html#cb42-41"></a>    }</span>
<span id="cb42-42"><a href="structuring-project.html#cb42-42"></a>  )</span>
<span id="cb42-43"><a href="structuring-project.html#cb42-43"></a>}</span>
<span id="cb42-44"><a href="structuring-project.html#cb42-44"></a></span>
<span id="cb42-45"><a href="structuring-project.html#cb42-45"></a><span class="co"># Application</span></span>
<span id="cb42-46"><a href="structuring-project.html#cb42-46"></a><span class="kw">library</span>(shiny)</span>
<span id="cb42-47"><a href="structuring-project.html#cb42-47"></a>app_ui &lt;-<span class="st"> </span><span class="cf">function</span>() {</span>
<span id="cb42-48"><a href="structuring-project.html#cb42-48"></a>  <span class="kw">fluidPage</span>(</span>
<span id="cb42-49"><a href="structuring-project.html#cb42-49"></a>    <span class="kw">choice_ui</span>(<span class="st">&quot;choice_ui_1&quot;</span>),</span>
<span id="cb42-50"><a href="structuring-project.html#cb42-50"></a>    <span class="kw">printing_ui</span>(<span class="st">&quot;printing_ui_2&quot;</span>)</span>
<span id="cb42-51"><a href="structuring-project.html#cb42-51"></a>  )</span>
<span id="cb42-52"><a href="structuring-project.html#cb42-52"></a>}</span>
<span id="cb42-53"><a href="structuring-project.html#cb42-53"></a></span>
<span id="cb42-54"><a href="structuring-project.html#cb42-54"></a>app_server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {</span>
<span id="cb42-55"><a href="structuring-project.html#cb42-55"></a>  <span class="co"># both servers take a reactiveValue,</span></span>
<span id="cb42-56"><a href="structuring-project.html#cb42-56"></a>  <span class="co">#  which is set in the first module</span></span>
<span id="cb42-57"><a href="structuring-project.html#cb42-57"></a>  <span class="co"># and printed in the second one.</span></span>
<span id="cb42-58"><a href="structuring-project.html#cb42-58"></a>  <span class="co"># The server functions don&#39;t return any value per se</span></span>
<span id="cb42-59"><a href="structuring-project.html#cb42-59"></a>  r &lt;-<span class="st"> </span><span class="kw">reactiveValues</span>()</span>
<span id="cb42-60"><a href="structuring-project.html#cb42-60"></a>  <span class="kw">choice_server</span>(<span class="st">&quot;choice_ui_1&quot;</span>, <span class="dt">r =</span> r)</span>
<span id="cb42-61"><a href="structuring-project.html#cb42-61"></a>  <span class="kw">printing_server</span>(<span class="st">&quot;printing_ui_2&quot;</span>, <span class="dt">r =</span> r)</span>
<span id="cb42-62"><a href="structuring-project.html#cb42-62"></a>}</span>
<span id="cb42-63"><a href="structuring-project.html#cb42-63"></a></span>
<span id="cb42-64"><a href="structuring-project.html#cb42-64"></a><span class="kw">shinyApp</span>(app_ui, app_server)</span></code></pre></div>
<p>The good thing about this method is that whenever you add something in one module, it is immediately available in all other modules where <code>r</code> is present.
The downside is that it can make it harder to reason about the app, as the input/content of the <code>r</code> is not specified anywhere unless you explicitly document it: the parameter to your server function being “r” only, you need to be a little bit more zealous when it comes to documenting it.</p>
<p>Note that if you want to share your module, for example in a package, you should document the structure of the <code>r</code>.
For example:</p>
<pre><code>#&#39; @param r a `reactiveValues()` list with a 
    `number_from_first_mod` element in it. 
#&#39; This `r$number_from_first_mod` will be 
    printed to the `print` output.</code></pre>
</div>
<div id="c.-the-stratégie-du-grand-r6" class="section level4 unnumbered">
<h4>C. The “stratégie du grand R6”</h4>
<p>Similar to the “stratégie du petit r”, we can create an R6 object, which is passed along inside the modules.</p>
<p>R6 objects, created using the package of the same name, are “traditional” object-oriented programming implementations in R.
An R6 object is a data structure that can hold in itself data and functions.
Its particularity is that if <strong>it’s modified inside a function, this modified value is kept outside the function in which it’s called, making it a powerful tool to manage data across the application</strong>.</p>
<p>As this R6 object is not a reactive object and is not meant to be used as such, uncontrolled reactivity of the application is reduced, thus reduces the complexity of handling chain reactions across modules.
Of course, you need to have another special tool in your app to trigger elements.
All this will be explained in detail in Chapter <a href="common-app-caveats.html#common-app-caveats">15</a> of this book, and you can find an example of this pattern inside the <a href="https://github.com/ColinFay/hexmake/blob/master/R/R6.R"><code>{hexmake}</code></a> <span class="citation">(Fay <a href="#ref-R-hexmake" role="doc-biblioref">2020</a><a href="#ref-R-hexmake" role="doc-biblioref">g</a>)</span> application.</p>
<p>If you are eager to know more about what <code>{R6}</code> is and how it works, we suggest the chapter on this subject in <em>Advanced R</em> <span class="citation">(Wickham <a href="#ref-hadleywickham2019" role="doc-biblioref">2019</a><a href="#ref-hadleywickham2019" role="doc-biblioref">b</a>)</span>, <a href="https://adv-r.hadley.nz/r6.html">R6</a>.</p>
</div>
<div id="d.-other-approaches-about-tidymodules" class="section level4 unnumbered">
<h4>D. Other approaches: About <code>{tidymodules}</code></h4>
<p><code>{tidymodules}</code> <span class="citation">(Larbaoui <a href="#ref-R-tidymodules" role="doc-biblioref">2020</a>)</span> is a package that helps in building shiny modules using an object-oriented paradigm, based on <code>{R6}</code>.
It allows you to automatically take care of namespaces, and makes sharing data across modules easier.
With this approach, as modules are objects, you can also define inheritance between modules.</p>
<p>The <a href="https://opensource.nibr.com/tidymodules/articles/tidymodules.html">“Getting Started”</a> page for <code>{tidymodules}</code> offers a presentation of how you can build modules using this approach, so feel free to refer to it if you want to know more, and to dive into the article for the advanced features offered by this package.</p>
</div>
</div>
</div>
<div id="structuring-your-app" class="section level2">
<h2><span class="header-section-number">3.3</span> Structuring your app</h2>
<div id="business-logic-and-application-logic" class="section level3">
<h3><span class="header-section-number">3.3.1</span> Business logic and application logic</h3>
<p>A shiny application has two main components: the application logic and the business logic.</p>
<ul>
<li><p><strong>Application logic is what makes your <code>{shiny}</code> app interactive</strong>: structure, buttons, tables, interactivity, etc.
These components are not specific to your core business.
You could use them for any other line of work or professional context.
This has no other use case than your interactive application.
It is not meant to be used outside your app, and you would not use them in a markdown report for instance.</p></li>
<li><p><strong>Business logic includes the components with the core algorithms and functions that make your application specific to your area of work</strong>.
You can recognize these elements as the ones that can be run outside any interactive context.
This is the case for specific computations and algorithms, custom plots or <code>geom</code> for <code>{ggplot2}</code> <span class="citation">(Wickham, Chang, et al. <a href="#ref-R-ggplot2" role="doc-biblioref">2021</a>)</span>, specific calls to a database, etc.</p></li>
</ul>
<p>These two components do not have to live together.
And in reality, they should not live together if you want to keep your sanity when you are building an app.
If you keep all components together in the same file, you will end up having to rerun the app from scratch and spend five minutes clicking everywhere just to be sure you have correctly set the color palette for the graph on the last <code>tabPanel()</code>.</p>
<p>Trust us, we have been there, and it is not pretty.</p>
<p>What is the way to go?
Extract the business function from the reactive functions.
Literally.
Compare this pattern:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="structuring-project.html#cb44-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb44-2"><a href="structuring-project.html#cb44-2"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb44-3"><a href="structuring-project.html#cb44-3"></a><span class="co"># A simple app that returns a table</span></span>
<span id="cb44-4"><a href="structuring-project.html#cb44-4"></a>ui &lt;-<span class="st"> </span><span class="cf">function</span>() {</span>
<span id="cb44-5"><a href="structuring-project.html#cb44-5"></a>  <span class="kw">tagList</span>(</span>
<span id="cb44-6"><a href="structuring-project.html#cb44-6"></a>    <span class="kw">tableOutput</span>(<span class="st">&quot;tbl&quot;</span>), </span>
<span id="cb44-7"><a href="structuring-project.html#cb44-7"></a>    <span class="kw">sliderInput</span>(<span class="st">&quot;n&quot;</span>, <span class="st">&quot;Number of rows&quot;</span>, <span class="dv">1</span>, <span class="dv">50</span>, <span class="dv">25</span>)</span>
<span id="cb44-8"><a href="structuring-project.html#cb44-8"></a>  )</span>
<span id="cb44-9"><a href="structuring-project.html#cb44-9"></a>}</span>
<span id="cb44-10"><a href="structuring-project.html#cb44-10"></a></span>
<span id="cb44-11"><a href="structuring-project.html#cb44-11"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {</span>
<span id="cb44-12"><a href="structuring-project.html#cb44-12"></a>  output<span class="op">$</span>tbl &lt;-<span class="st"> </span><span class="kw">renderTable</span>({</span>
<span id="cb44-13"><a href="structuring-project.html#cb44-13"></a>    <span class="co"># Writing all the business logic for the table manipulation </span></span>
<span id="cb44-14"><a href="structuring-project.html#cb44-14"></a>    <span class="co"># inside the server</span></span>
<span id="cb44-15"><a href="structuring-project.html#cb44-15"></a>    mtcars <span class="op">%&gt;%</span></span>
<span id="cb44-16"><a href="structuring-project.html#cb44-16"></a><span class="st">      </span><span class="co"># [...] %&gt;% </span></span>
<span id="cb44-17"><a href="structuring-project.html#cb44-17"></a><span class="st">      </span><span class="co"># [...] %&gt;% </span></span>
<span id="cb44-18"><a href="structuring-project.html#cb44-18"></a><span class="st">      </span><span class="co"># [...] %&gt;% </span></span>
<span id="cb44-19"><a href="structuring-project.html#cb44-19"></a><span class="st">      </span><span class="co"># [...] %&gt;% </span></span>
<span id="cb44-20"><a href="structuring-project.html#cb44-20"></a><span class="st">      </span><span class="co"># [...] %&gt;% </span></span>
<span id="cb44-21"><a href="structuring-project.html#cb44-21"></a><span class="st">      </span><span class="kw">top_n</span>(input<span class="op">$</span>n)</span>
<span id="cb44-22"><a href="structuring-project.html#cb44-22"></a>  })</span>
<span id="cb44-23"><a href="structuring-project.html#cb44-23"></a>}</span>
<span id="cb44-24"><a href="structuring-project.html#cb44-24"></a></span>
<span id="cb44-25"><a href="structuring-project.html#cb44-25"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<p>To this one:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="structuring-project.html#cb45-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb45-2"><a href="structuring-project.html#cb45-2"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb45-3"><a href="structuring-project.html#cb45-3"></a></span>
<span id="cb45-4"><a href="structuring-project.html#cb45-4"></a><span class="co"># Writing all the business logic for the table manipulation </span></span>
<span id="cb45-5"><a href="structuring-project.html#cb45-5"></a><span class="co"># inside an external function</span></span>
<span id="cb45-6"><a href="structuring-project.html#cb45-6"></a>top_this &lt;-<span class="st"> </span><span class="cf">function</span>(tbl, n) {</span>
<span id="cb45-7"><a href="structuring-project.html#cb45-7"></a>  tbl <span class="op">%&gt;%</span></span>
<span id="cb45-8"><a href="structuring-project.html#cb45-8"></a><span class="st">    </span><span class="co"># [...] %&gt;% </span></span>
<span id="cb45-9"><a href="structuring-project.html#cb45-9"></a><span class="st">    </span><span class="co"># [...] %&gt;% </span></span>
<span id="cb45-10"><a href="structuring-project.html#cb45-10"></a><span class="st">    </span><span class="co"># [...] %&gt;% </span></span>
<span id="cb45-11"><a href="structuring-project.html#cb45-11"></a><span class="st">    </span><span class="co"># [...] %&gt;% </span></span>
<span id="cb45-12"><a href="structuring-project.html#cb45-12"></a><span class="st">    </span><span class="kw">top_n</span>(n)</span>
<span id="cb45-13"><a href="structuring-project.html#cb45-13"></a>}</span>
<span id="cb45-14"><a href="structuring-project.html#cb45-14"></a></span>
<span id="cb45-15"><a href="structuring-project.html#cb45-15"></a><span class="co"># A simple app that returns a table</span></span>
<span id="cb45-16"><a href="structuring-project.html#cb45-16"></a>ui &lt;-<span class="st"> </span><span class="cf">function</span>() {</span>
<span id="cb45-17"><a href="structuring-project.html#cb45-17"></a>  <span class="kw">tagList</span>(</span>
<span id="cb45-18"><a href="structuring-project.html#cb45-18"></a>    <span class="kw">tableOutput</span>(<span class="st">&quot;tbl&quot;</span>), </span>
<span id="cb45-19"><a href="structuring-project.html#cb45-19"></a>    <span class="kw">sliderInput</span>(<span class="st">&quot;n&quot;</span>, <span class="st">&quot;Number of rows&quot;</span>, <span class="dv">1</span>, <span class="dv">50</span>, <span class="dv">25</span>)</span>
<span id="cb45-20"><a href="structuring-project.html#cb45-20"></a>  )</span>
<span id="cb45-21"><a href="structuring-project.html#cb45-21"></a>}</span>
<span id="cb45-22"><a href="structuring-project.html#cb45-22"></a></span>
<span id="cb45-23"><a href="structuring-project.html#cb45-23"></a></span>
<span id="cb45-24"><a href="structuring-project.html#cb45-24"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {</span>
<span id="cb45-25"><a href="structuring-project.html#cb45-25"></a>  output<span class="op">$</span>tbl &lt;-<span class="st"> </span><span class="kw">renderTable</span>({</span>
<span id="cb45-26"><a href="structuring-project.html#cb45-26"></a>    <span class="co"># We call the previously declared function inside the server</span></span>
<span id="cb45-27"><a href="structuring-project.html#cb45-27"></a>    <span class="co"># The business logic is thus defined outside the application</span></span>
<span id="cb45-28"><a href="structuring-project.html#cb45-28"></a>    <span class="kw">top_this</span>(mtcars, input<span class="op">$</span>n)</span>
<span id="cb45-29"><a href="structuring-project.html#cb45-29"></a>  })</span>
<span id="cb45-30"><a href="structuring-project.html#cb45-30"></a>}</span>
<span id="cb45-31"><a href="structuring-project.html#cb45-31"></a></span>
<span id="cb45-32"><a href="structuring-project.html#cb45-32"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<p>Both scripts do the exact same thing.
The difference is that the second code can be easily explored without having to relaunch the app.
You will be able to build a reproducible example to explore, illustrate, and improve <code>top_this()</code>.
This function can be tested, documented, and reused outside the application.
Moreover, this approach lowers the cognitive load when debugging: you either debug an application issue, or a business logic issue.
You never debug both at the same time.</p>
<p>Even more, think about the future: how likely are the colors or the UI subject to change, compared to how likely the core algorithms are to change?
As said in <em>The Art of Unix Programming</em>, “<em>Fashions in the look and feel of GUI toolkits may come and go, but raster operations and compositing are forever</em>” <span class="citation">(Raymond <a href="#ref-ericraymond2003" role="doc-biblioref">2003</a>)</span>.
In other words, the core back-end, once consolidated, will potentially stay unchanged forever.
On the other hand, the front-end might change: new colors, new graphic designs, new interactions, new visualization libraries, etc.
Whenever this happens, you will be happy you have separated the business logic from the application logic, as you will have to change less code.</p>
<p>How to do that?
Add your application logic in a file (typically, a module), and the business logic in another R script (typically starting with <code>fct_</code> or <code>utils_</code>).
You can even write the business logic inside another package, making these functions really reusable outside your application.</p>
</div>
<div id="small-is-beautiful-bis-repetita" class="section level3">
<h3><span class="header-section-number">3.3.2</span> Small is beautiful (bis repetita)</h3>
<p>There are a lot of reasons for splitting your application into smaller pieces, including the fact that it is easier to maintain, easier to decipher, and it facilitates collaboration.</p>
<p>There is nothing harder to maintain than a <code>{shiny}</code> app only made of a unique 1000-line long <code>app.R</code> file.
Well, there still is the 10000-line long <code>app.R</code> file, but you get the idea.
<strong>Long scripts are almost always synonymous with complexity when it comes to building software</strong>.
Of course, small and numerous scripts do not systematically prevent codebase complexity, but they do simplify collaboration and maintenance, and divide the application logic into smaller, easier-to-understand bits of code.</p>
<p>In practice, big files are complex to handle and make development harder.
Here is what happens when you work on an application for production:</p>
<ul>
<li><p>You will work during a long period of time (either in one run or split across several months) on your codebase.
Hence, you will have to get back to pieces of code you wrote a long time ago.</p></li>
<li><p>You will possibly develop with other developers.
Maintaining a codebase when several people work on the same directory is already a complex thing: from time to time you might work on the same file separately, a situation where you will have to be careful about what and how to merge things when changes are implemented.
It is almost impossible to work together on the same file throughout the project without losing your mind: even more if this file is thousands of lines long.</p></li>
<li><p>You will implement numerous features.
Numerous features imply a lot of UI and server interactions.
In an <code>app.R</code> file containing thousands of lines, it is very hard to match the UI element with its server counterpart.
When the UI is on line 50 and the server on line 570, you will be scrolling a lot when working on these elements.</p></li>
</ul>
</div>
<div id="conventions-matter" class="section level3">
<h3><span class="header-section-number">3.3.3</span> Conventions matter</h3>
<p>In this section you will find a suggestion for a naming convention for your app files that will help you and your team be organized.</p>
<p>Splitting files is good.
Splitting files using a defined convention is better.
Why?
Because using a common convention for your files helps the other developers (and potentially you) to know exactly what is contained in a specific file, making it easier to navigate through the codebase, be it for newcomers or for developers already familiar with the software.</p>
<p>As developed in <em>Refactoring at Scale</em> <span class="citation">(Lemaire <a href="#ref-lemaire2020" role="doc-biblioref">2020</a>)</span>, lacking a defined file structure when it comes to the codebase leads to slower productivity in the long run, notably when new engineers join the team: engineers with a knowledge of the file structure have learned how to navigate through the codebase, but new comers will find it hard to understand how everything is organized.
And of course, in the long run, even developers with a knowledge of the structure can get lost, even more if they haven’t worked on the project for months.</p>
<blockquote>
<p>Because it’s easier to maintain the status quo, instead of proactively beginning to organize related files […], engineers instead learn to navigate the increasingly sprawling code.
New engineers introduced to the growing chaos raise a warning flag and encourage the team to begin splitting up the code, but these concerns fall to deaf ears […].
Eventually, the codebase reaches a critical mass where the persistent lack of organization has dramatically slowed productivity across the engineering team.
Only then does the team take the time to draft a plan for grooming the codebase, at which point the number of variables to consider is far greater than had they made a concerted effort to tackle the problem months (or even years) earlier.<br />
</p>
<p><em>Refactoring at Scale</em> <span class="citation">(Lemaire <a href="#ref-lemaire2020" role="doc-biblioref">2020</a>)</span></p>
</blockquote>
<p>Using a convention allows everyone to know where to look when debugging, refactoring, or implementing new features.
For example, if you follow <code>{golem}</code>’s convention (which is the one developed in this section), you will know immediately that a file starting with <code>mod_</code> contains a module.
If you take over a project, look in the <code>R/</code> folder, and see files starting with these three letters, you will know immediately that these files contain modules.</p>
<p>Here is our proposition for a convention defining how to split your application into smaller pieces.</p>
<p>First of all, put everything into an <code>R/</code> folder.
If you build your app using the <code>{golem}</code> framework, this is already the case.
We use the package convention to hold the functions of our application.</p>
<p>The naming convention in <code>{golem}</code> is the following:</p>
<ul>
<li><p><code>app_*.R</code> (typically <code>app_ui.R</code> and <code>app_server.R</code>) contain the top-level functions defining your user interface and your server function.</p></li>
<li><p><code>fct_*</code> files contain the business logic, which are potentially large functions.
They are the backbone of the application and may not be specific to a given module.
They can be added using <code>{golem}</code> with the <code>add_fct("name")</code> function.</p></li>
<li><p><code>mod_*</code> files contain a unique module.
Many <code>{shiny}</code> apps contain a series of tabs, or at least a tab-like pattern, so we suggest that you number them according to their step in the application.
Tabs are almost always named in the user interface, so that you can use this tab name as the file name.
For example, if you build a dashboard where the first tab is called “Import”, you should name your file <code>mod_01_import.R</code>.
You can create this file with a module skeleton using <code>golem::add_module("01_import")</code>.</p></li>
<li><p><code>utils_*</code> are files that contain utilities, which are small helper functions.
For example, you might want to have a <code>not_na</code>, which is <code>not_na &lt;- Negate(is.na)</code>, a <code>not_null</code>, or small tools that you will be using application-wide.
Note that you can also create <code>utils</code> for a specific module.</p></li>
<li><p><code>*_ui_*</code>, for example <code>utils_ui.R</code>, relates to the user interface.</p></li>
<li><p><code>*_server_*</code> are files that contain anything related to the application’s back-end.
For example, <code>fct_connection_server.R</code> will contain functions that are related to the connection to a database, and are specifically used from the server side.</p></li>
</ul>
<p>Note that when building a module file with <code>{golem}</code>, you can also create <code>fct_</code> and <code>utils_</code> files that will hold functions and utilities for this specific module.
For example, <code>golem::add_module("01_import", fct = "readr", utils = "ui")</code> will create <code>R/mod_01_import.R</code>, <code>R/mod_01_import_fct_readr.R</code> and <code>R/mod_01_import_utils_ui.R</code>.</p>
<p>Of course, as with any convention, you might occasionally feel like deviating from the general pattern.
Your app may not have that many functions, or maybe the functions can all fit into one <code>utils_</code> file.
But whether you have one or thousands of files, it is always a good practice to stick to a formalized pattern as much as possible.</p>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-R-shiny">
<p>Chang, Winston, Joe Cheng, JJ Allaire, Yihui Xie, and Jonathan McPherson. 2020. <em>Shiny: Web Application Framework for R</em>. <a href="http://shiny.rstudio.com">http://shiny.rstudio.com</a>.</p>
</div>
<div id="ref-R-hexmake">
<p>Fay, Colin. 2020g. <em>Hexmake: Hex Stickers Maker</em>. <a href="https://github.com/colinfay/hexmake">https://github.com/colinfay/hexmake</a>.</p>
</div>
<div id="ref-R-tidytuesday201942">
<p>Fay, Colin. 2020l. <em>Tidytuesday201942: A Golem App for Tidy Tuesday</em>. <a href="http://www.github.com/ColinFay/tidytuesday201942">http://www.github.com/ColinFay/tidytuesday201942</a>.</p>
</div>
<div id="ref-R-golem">
<p>Fay, Colin, Vincent Guyader, Sébastien Rochette, and Cervan Girard. 2020. <em>Golem: A Framework for Robust Shiny Applications</em>. <a href="https://github.com/ThinkR-open/golem">https://github.com/ThinkR-open/golem</a>.</p>
</div>
<div id="ref-R-tidymodules">
<p>Larbaoui, Mustapha. 2020. <em>Tidymodules: A Robust Framework for Developing Shiny Modules</em>. <a href="https://github.com/Novartis/tidymodules">https://github.com/Novartis/tidymodules</a>.</p>
</div>
<div id="ref-lemaire2020">
<p>Lemaire, Maude. 2020. <em>Refactoring at Scale</em>. Henry Holt. <a href="https://learning.oreilly.com/library/view/refactoring-at-scale/9781492075523/">https://learning.oreilly.com/library/view/refactoring-at-scale/9781492075523/</a>.</p>
</div>
<div id="ref-ericraymond2003">
<p>Raymond, Eric S. 2003. <em>The Art of Unix Programming (the Addison-Wesley Professional Computng Series)</em>. Addison-Wesley.</p>
</div>
<div id="ref-R-testthat">
<p>Wickham, Hadley. 2020. <em>Testthat: Unit Testing for R</em>.</p>
</div>
<div id="ref-hadleywickham2019">
<p>Wickham, Hadley. 2019b. <em>Advanced R, Second Edition</em>. Chapman; Hall/CRC.</p>
</div>
<div id="ref-R-ggplot2">
<p>Wickham, Hadley, Winston Chang, Lionel Henry, Thomas Lin Pedersen, Kohske Takahashi, Claus Wilke, Kara Woo, Hiroaki Yutani, and Dewey Dunnington. 2021. <em>Ggplot2: Create Elegant Data Visualisations Using the Grammar of Graphics</em>.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="19">
<li id="fn19"><p>Most of the time, pieces / panels of the app are too unique to be reused elsewhere.<a href="structuring-project.html#fnref19" class="footnote-back">↩︎</a></p></li>
<li id="fn20"><p>Well, of course you can still have inner module id conflicts, but they are easier to avoid, detect, and fix.<a href="structuring-project.html#fnref20" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
<hr/>
<footer>
<a href="rtask.thinkr.fr"><img src="img/logo400_129.png" alt="ThinkR Website"/></a>
<!--https://yihui.org/en/2018/09/target-blank/-->
<script>
  (function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>
</footer>
            </section>

          </div>
        </div>
      </div>
<a href="planning-ahead.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="golem.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/ThinkR-open/building-shiny-apps-workflow/edit/master/03-structure.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>

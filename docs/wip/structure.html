<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Structuring your Project | Engineering Production-Grade Shiny Apps</title>
  <meta name="description" content="Chapter 3 Structuring your Project | Engineering Production-Grade Shiny Apps" />
  <meta name="generator" content="bookdown 0.11 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Structuring your Project | Engineering Production-Grade Shiny Apps" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Chapter 3 Structuring your Project | Engineering Production-Grade Shiny Apps" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Structuring your Project | Engineering Production-Grade Shiny Apps" />
  
  <meta name="twitter:description" content="Chapter 3 Structuring your Project | Engineering Production-Grade Shiny Apps" />
  

<meta name="author" content="Colin Fay, Vincent Guyader, Cervan Girard, SÃ©bastien Rochette" />


<meta name="date" content="2020-02-09" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon" />
<link rel="prev" href="planning.html">
<link rel="next" href="golem.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-149994171-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-149994171-1');
</script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
<link rel="stylesheet" href="css/thinkr.css" type="text/css" />
<link rel="stylesheet" href="css/style_gitbook.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Building Big Shiny Apps - A Workflow</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#motivation"><i class="fa fa-check"></i>Motivation</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#book-structure"><i class="fa fa-check"></i>Book structure</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-the-authors"><i class="fa fa-check"></i>About the authors</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#want-to-help"><i class="fa fa-check"></i>Want to help?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#other-resources"><i class="fa fa-check"></i>Other resources</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#getting-started-with-shiny"><i class="fa fa-check"></i>Getting started with Shiny</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#shiny-into-production"><i class="fa fa-check"></i>Shiny into production</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgments"><i class="fa fa-check"></i>Acknowledgments</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#contributors-to-this-book"><i class="fa fa-check"></i>Contributors to this book</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>I Building Successful Shiny Apps</b></span></li>
<li class="chapter" data-level="1" data-path="successfulshinyapp.html"><a href="successfulshinyapp.html"><i class="fa fa-check"></i><b>1</b> About Successful Shiny Apps</a><ul>
<li class="chapter" data-level="1.1" data-path="successfulshinyapp.html"><a href="successfulshinyapp.html#a-very-short-introduction-to-shiny"><i class="fa fa-check"></i><b>1.1</b> A (very) short introduction to Shiny</a></li>
<li class="chapter" data-level="1.2" data-path="successfulshinyapp.html"><a href="successfulshinyapp.html#what-is-a-complex-shiny-application"><i class="fa fa-check"></i><b>1.2</b> What is a complex Shiny Application?</a><ul>
<li class="chapter" data-level="1.2.1" data-path="successfulshinyapp.html"><a href="successfulshinyapp.html#reaching-the-cliff-of-complexity"><i class="fa fa-check"></i><b>1.2.1</b> Reaching the cliff of complexity</a></li>
<li class="chapter" data-level="1.2.2" data-path="successfulshinyapp.html"><a href="successfulshinyapp.html#balancing-complexities"><i class="fa fa-check"></i><b>1.2.2</b> Balancing complexities</a></li>
<li class="chapter" data-level="1.2.3" data-path="successfulshinyapp.html"><a href="successfulshinyapp.html#assessing-code-complexity"><i class="fa fa-check"></i><b>1.2.3</b> Assessing code complexity</a></li>
<li class="chapter" data-level="1.2.4" data-path="successfulshinyapp.html"><a href="successfulshinyapp.html#production-grade-software-engineering"><i class="fa fa-check"></i><b>1.2.4</b> Production Grade Software Engineering</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="successfulshinyapp.html"><a href="successfulshinyapp.html#what-is-a-successful-shiny-app"><i class="fa fa-check"></i><b>1.3</b> What is a successful Shiny App?</a><ul>
<li class="chapter" data-level="1.3.1" data-path="successfulshinyapp.html"><a href="successfulshinyapp.html#it-exists"><i class="fa fa-check"></i><b>1.3.1</b> It exists</a></li>
<li class="chapter" data-level="1.3.2" data-path="successfulshinyapp.html"><a href="successfulshinyapp.html#it-is-accurate"><i class="fa fa-check"></i><b>1.3.2</b> It is accurate</a></li>
<li class="chapter" data-level="1.3.3" data-path="successfulshinyapp.html"><a href="successfulshinyapp.html#it-is-usable"><i class="fa fa-check"></i><b>1.3.3</b> It is usable</a></li>
<li class="chapter" data-level="1.3.4" data-path="successfulshinyapp.html"><a href="successfulshinyapp.html#it-is-immortal"><i class="fa fa-check"></i><b>1.3.4</b> It is immortal</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="planning.html"><a href="planning.html"><i class="fa fa-check"></i><b>2</b> Planning Ahead</a><ul>
<li class="chapter" data-level="2.1" data-path="planning.html"><a href="planning.html#working-with-a-long-term-mindset"><i class="fa fa-check"></i><b>2.1</b> Working with a âlong-termâ mindset</a><ul>
<li class="chapter" data-level="2.1.1" data-path="planning.html"><a href="planning.html#prepare-for-success"><i class="fa fa-check"></i><b>2.1.1</b> Prepare for success</a></li>
<li class="chapter" data-level="2.1.2" data-path="planning.html"><a href="planning.html#develop-with-the-kiss-principle"><i class="fa fa-check"></i><b>2.1.2</b> Develop with the KISS principle</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="planning.html"><a href="planning.html#working-as-a-team-tools-organisation"><i class="fa fa-check"></i><b>2.2</b> Working as a team: tools &amp; organisation</a><ul>
<li class="chapter" data-level="2.2.1" data-path="planning.html"><a href="planning.html#from-the-tools-point-of-view"><i class="fa fa-check"></i><b>2.2.1</b> From the tools point of view</a></li>
<li class="chapter" data-level="2.2.2" data-path="planning.html"><a href="planning.html#from-the-organisational-point-of-view"><i class="fa fa-check"></i><b>2.2.2</b> From the organisational point of view</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="structure.html"><a href="structure.html"><i class="fa fa-check"></i><b>3</b> Structuring your Project</a><ul>
<li class="chapter" data-level="3.1" data-path="structure.html"><a href="structure.html#shiny-app-as-a-package"><i class="fa fa-check"></i><b>3.1</b> Shiny App as a Package</a><ul>
<li class="chapter" data-level="3.1.1" data-path="structure.html"><a href="structure.html#whats-in-a-shiny-app"><i class="fa fa-check"></i><b>3.1.1</b> Whatâs in a Shiny App?</a></li>
<li class="chapter" data-level="3.1.2" data-path="structure.html"><a href="structure.html#the-other-plus-side-of-shiny-as-a-package"><i class="fa fa-check"></i><b>3.1.2</b> The other plus side of Shiny as a Package</a></li>
<li class="chapter" data-level="3.1.3" data-path="structure.html"><a href="structure.html#deploy"><i class="fa fa-check"></i><b>3.1.3</b> Deploy</a></li>
<li class="chapter" data-level="3.1.4" data-path="structure.html"><a href="structure.html#resources"><i class="fa fa-check"></i><b>3.1.4</b> Resources</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="structure.html"><a href="structure.html#using-shiny-modules"><i class="fa fa-check"></i><b>3.2</b> Using Shiny Modules</a><ul>
<li class="chapter" data-level="3.2.1" data-path="structure.html"><a href="structure.html#small-is-beautiful-1"><i class="fa fa-check"></i><b>3.2.1</b> Small is beautiful</a></li>
<li class="chapter" data-level="3.2.2" data-path="structure.html"><a href="structure.html#a-practical-walk-through"><i class="fa fa-check"></i><b>3.2.2</b> A practical walk through</a></li>
<li class="chapter" data-level="3.2.3" data-path="structure.html"><a href="structure.html#communication-between-modules"><i class="fa fa-check"></i><b>3.2.3</b> Communication between modules</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="structure.html"><a href="structure.html#structuring-your-app"><i class="fa fa-check"></i><b>3.3</b> Structuring your app</a><ul>
<li class="chapter" data-level="3.3.1" data-path="structure.html"><a href="structure.html#business-logic-application-logic"><i class="fa fa-check"></i><b>3.3.1</b> Business logic &amp; application logic</a></li>
<li class="chapter" data-level="3.3.2" data-path="structure.html"><a href="structure.html#small-is-beautiful-bis-repetita"><i class="fa fa-check"></i><b>3.3.2</b> Small is beautiful (bis repetita)</a></li>
<li class="chapter" data-level="3.3.3" data-path="structure.html"><a href="structure.html#conventions-matter"><i class="fa fa-check"></i><b>3.3.3</b> Conventions matter</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="golem.html"><a href="golem.html"><i class="fa fa-check"></i><b>4</b> Introduction to <code>{golem}</code></a><ul>
<li class="chapter" data-level="4.1" data-path="golem.html"><a href="golem.html#getting-started-with-golem"><i class="fa fa-check"></i><b>4.1</b> Getting started with <code>{golem}</code></a></li>
<li class="chapter" data-level="4.2" data-path="golem.html"><a href="golem.html#understanding-golem-app-structure"><i class="fa fa-check"></i><b>4.2</b> Understanding <code>{golem}</code> app structure</a><ul>
<li class="chapter" data-level="4.2.1" data-path="golem.html"><a href="golem.html#description-namespace"><i class="fa fa-check"></i><b>4.2.1</b> <code>DESCRIPTION</code> &amp; <code>NAMESPACE</code></a></li>
<li class="chapter" data-level="4.2.2" data-path="golem.html"><a href="golem.html#r"><i class="fa fa-check"></i><b>4.2.2</b> R/</a></li>
<li class="chapter" data-level="4.2.3" data-path="golem.html"><a href="golem.html#instappwww"><i class="fa fa-check"></i><b>4.2.3</b> <code>inst/app/www/</code></a></li>
<li class="chapter" data-level="4.2.4" data-path="golem.html"><a href="golem.html#man"><i class="fa fa-check"></i><b>4.2.4</b> <code>man/</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="workflow.html"><a href="workflow.html"><i class="fa fa-check"></i><b>5</b> The workflow</a><ul>
<li class="chapter" data-level="5.1" data-path="workflow.html"><a href="workflow.html#part-1-design"><i class="fa fa-check"></i><b>5.1</b> Part 1: Design</a></li>
<li class="chapter" data-level="5.2" data-path="workflow.html"><a href="workflow.html#part-2-prototype"><i class="fa fa-check"></i><b>5.2</b> Part 2: Prototype</a></li>
<li class="chapter" data-level="5.3" data-path="workflow.html"><a href="workflow.html#part-3-build"><i class="fa fa-check"></i><b>5.3</b> Part 3: Build</a></li>
<li class="chapter" data-level="5.4" data-path="workflow.html"><a href="workflow.html#part-4-secure"><i class="fa fa-check"></i><b>5.4</b> Part 4: Secure</a></li>
<li class="chapter" data-level="5.5" data-path="workflow.html"><a href="workflow.html#part-5-deploy"><i class="fa fa-check"></i><b>5.5</b> Part 5: Deploy</a></li>
</ul></li>
<li class="part"><span><b>II Step 1: Design</b></span></li>
<li class="chapter" data-level="6" data-path="matters.html"><a href="matters.html"><i class="fa fa-check"></i><b>6</b> UX Matters</a><ul>
<li class="chapter" data-level="6.1" data-path="matters.html"><a href="matters.html#simplicity-is-gold"><i class="fa fa-check"></i><b>6.1</b> Simplicity is Gold</a><ul>
<li class="chapter" data-level="6.1.1" data-path="matters.html"><a href="matters.html#how-we-read-the-web-scanning-content"><i class="fa fa-check"></i><b>6.1.1</b> How we read the web: scanning content</a></li>
<li class="chapter" data-level="6.1.2" data-path="matters.html"><a href="matters.html#a-self-evident-app-or-at-least-self-explanatory"><i class="fa fa-check"></i><b>6.1.2</b> A self-evident app (or at least self-explanatory)</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="matters.html"><a href="matters.html#the-danger-of-feature-creep"><i class="fa fa-check"></i><b>6.2</b> The danger of feature-creep</a><ul>
<li class="chapter" data-level="6.2.1" data-path="matters.html"><a href="matters.html#whats-feature-creep"><i class="fa fa-check"></i><b>6.2.1</b> Whatâs feature-creep?</a></li>
<li class="chapter" data-level="6.2.2" data-path="matters.html"><a href="matters.html#restrain-reactivity"><i class="fa fa-check"></i><b>6.2.2</b> Restrain reactivity</a></li>
<li class="chapter" data-level="6.2.3" data-path="matters.html"><a href="matters.html#too-much-interactivity"><i class="fa fa-check"></i><b>6.2.3</b> Too much interactivity</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="matters.html"><a href="matters.html#web-accessibility"><i class="fa fa-check"></i><b>6.3</b> Web Accessibility</a><ul>
<li class="chapter" data-level="6.3.1" data-path="matters.html"><a href="matters.html#about-accessibility"><i class="fa fa-check"></i><b>6.3.1</b> About Accessibility</a></li>
<li class="chapter" data-level="6.3.2" data-path="matters.html"><a href="matters.html#making-your-app-accessible"><i class="fa fa-check"></i><b>6.3.2</b> Making your App Accessible</a></li>
<li class="chapter" data-level="6.3.3" data-path="matters.html"><a href="matters.html#evaluating-your-app-accessibility-further-reading"><i class="fa fa-check"></i><b>6.3.3</b> Evaluating your App Accessibility &amp; Further reading</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="step-design.html"><a href="step-design.html"><i class="fa fa-check"></i><b>7</b> Donât rush into coding</a><ul>
<li class="chapter" data-level="7.1" data-path="step-design.html"><a href="step-design.html#designing-before-coding"><i class="fa fa-check"></i><b>7.1</b> Designing before coding</a><ul>
<li class="chapter" data-level="7.1.1" data-path="step-design.html"><a href="step-design.html#the-urge-to-code"><i class="fa fa-check"></i><b>7.1.1</b> The Urge to Code</a></li>
<li class="chapter" data-level="7.1.2" data-path="step-design.html"><a href="step-design.html#about-concept-map"><i class="fa fa-check"></i><b>7.1.2</b> About Concept Map</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="step-design.html"><a href="step-design.html#ask-questions"><i class="fa fa-check"></i><b>7.2</b> Ask questions</a><ul>
<li class="chapter" data-level="7.2.1" data-path="step-design.html"><a href="step-design.html#about-the-end-users"><i class="fa fa-check"></i><b>7.2.1</b> About the end users</a></li>
<li class="chapter" data-level="7.2.2" data-path="step-design.html"><a href="step-design.html#pre-existing-code-base"><i class="fa fa-check"></i><b>7.2.2</b> Pre-existing code-base</a></li>
<li class="chapter" data-level="7.2.3" data-path="step-design.html"><a href="step-design.html#deployment"><i class="fa fa-check"></i><b>7.2.3</b> Deployment</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="css.html"><a href="css.html"><i class="fa fa-check"></i><b>8</b> A Gentle Introduction to CSS</a><ul>
<li class="chapter" data-level="8.1" data-path="css.html"><a href="css.html#what-is-css"><i class="fa fa-check"></i><b>8.1</b> What is CSS</a><ul>
<li class="chapter" data-level="8.1.1" data-path="css.html"><a href="css.html#about-css"><i class="fa fa-check"></i><b>8.1.1</b> About CSS</a></li>
<li class="chapter" data-level="8.1.2" data-path="css.html"><a href="css.html#shinys-default-fluidpage"><i class="fa fa-check"></i><b>8.1.2</b> Shinyâs default: <code>fluidPage()</code></a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="css.html"><a href="css.html#getting-started-with-css"><i class="fa fa-check"></i><b>8.2</b> Getting started with CSS</a><ul>
<li class="chapter" data-level="8.2.1" data-path="css.html"><a href="css.html#about-css-syntax"><i class="fa fa-check"></i><b>8.2.1</b> About CSS syntax</a></li>
<li class="chapter" data-level="8.2.2" data-path="css.html"><a href="css.html#css-selectors"><i class="fa fa-check"></i><b>8.2.2</b> CSS selectors</a></li>
<li class="chapter" data-level="8.2.3" data-path="css.html"><a href="css.html#css-properties"><i class="fa fa-check"></i><b>8.2.3</b> CSS properties</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="css.html"><a href="css.html#integrate-css-files-to-your-shiny-app"><i class="fa fa-check"></i><b>8.3</b> Integrate CSS files to your Shiny App</a><ul>
<li class="chapter" data-level="8.3.1" data-path="css.html"><a href="css.html#inline-css"><i class="fa fa-check"></i><b>8.3.1</b> Inline CSS</a></li>
<li class="chapter" data-level="8.3.2" data-path="css.html"><a href="css.html#writing-in-a-tagsstyle"><i class="fa fa-check"></i><b>8.3.2</b> Writing in a <code>tags$style()</code></a></li>
<li class="chapter" data-level="8.3.3" data-path="css.html"><a href="css.html#including-external-files"><i class="fa fa-check"></i><b>8.3.3</b> Including External Files</a></li>
<li class="chapter" data-level="8.3.4" data-path="css.html"><a href="css.html#using-r-packages"><i class="fa fa-check"></i><b>8.3.4</b> Using R packages</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="css.html"><a href="css.html#external-resources"><i class="fa fa-check"></i><b>8.4</b> External resources</a></li>
</ul></li>
<li class="part"><span><b>III Step 2: Prototype</b></span></li>
<li class="chapter" data-level="9" data-path="stepprotopype.html"><a href="stepprotopype.html"><i class="fa fa-check"></i><b>9</b> Building an âipsum-appâ</a><ul>
<li class="chapter" data-level="9.1" data-path="stepprotopype.html"><a href="stepprotopype.html#prototyping-is-crucial"><i class="fa fa-check"></i><b>9.1</b> Prototyping is crucial</a><ul>
<li class="chapter" data-level="9.1.1" data-path="stepprotopype.html"><a href="stepprotopype.html#the-ui-first-approach"><i class="fa fa-check"></i><b>9.1.1</b> The âUI firstâ approach</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="stepprotopype.html"><a href="stepprotopype.html#prototyping-shiny"><i class="fa fa-check"></i><b>9.2</b> Prototyping Shiny</a><ul>
<li class="chapter" data-level="9.2.1" data-path="stepprotopype.html"><a href="stepprotopype.html#fast-prototyping-with-shinipsum"><i class="fa fa-check"></i><b>9.2.1</b> Fast prototyping with <code>{shinipsum}</code></a></li>
<li class="chapter" data-level="9.2.2" data-path="stepprotopype.html"><a href="stepprotopype.html#using-fakir-for-fake-data-generation"><i class="fa fa-check"></i><b>9.2.2</b> Using <code>{fakir}</code> for fake data generation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="proto-rmdfirst.html"><a href="proto-rmdfirst.html"><i class="fa fa-check"></i><b>10</b> Building with RMarkdown</a><ul>
<li class="chapter" data-level="10.1" data-path="proto-rmdfirst.html"><a href="proto-rmdfirst.html#define-the-content-of-the-application"><i class="fa fa-check"></i><b>10.1</b> Define the content of the application</a></li>
<li class="chapter" data-level="10.2" data-path="proto-rmdfirst.html"><a href="proto-rmdfirst.html#fill-the-rmd-files"><i class="fa fa-check"></i><b>10.2</b> Fill the Rmd files</a></li>
<li class="chapter" data-level="10.3" data-path="proto-rmdfirst.html"><a href="proto-rmdfirst.html#use-the-rmd-first-method-to-document-further"><i class="fa fa-check"></i><b>10.3</b> Use the âRmd firstâ method to document further</a></li>
</ul></li>
<li class="part"><span><b>IV Step 3: Build</b></span></li>
<li class="chapter" data-level="11" data-path="stepbuild.html"><a href="stepbuild.html"><i class="fa fa-check"></i><b>11</b> Building app with <code>{golem}</code></a><ul>
<li class="chapter" data-level="11.1" data-path="stepbuild.html"><a href="stepbuild.html#using-golem"><i class="fa fa-check"></i><b>11.1</b> Using <code>{golem}</code></a><ul>
<li class="chapter" data-level="11.1.1" data-path="stepbuild.html"><a href="stepbuild.html#create-a-package"><i class="fa fa-check"></i><b>11.1.1</b> Create a package</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="stepbuild.html"><a href="stepbuild.html#dev01_start.r"><i class="fa fa-check"></i><b>11.2</b> <code>dev/01_start.R</code></a><ul>
<li class="chapter" data-level="11.2.1" data-path="stepbuild.html"><a href="stepbuild.html#fill-the-desc"><i class="fa fa-check"></i><b>11.2.1</b> Fill the DESC</a></li>
<li class="chapter" data-level="11.2.2" data-path="stepbuild.html"><a href="stepbuild.html#set-common-files"><i class="fa fa-check"></i><b>11.2.2</b> Set common Files</a></li>
<li class="chapter" data-level="11.2.3" data-path="stepbuild.html"><a href="stepbuild.html#add-a-data-raw-folder"><i class="fa fa-check"></i><b>11.2.3</b> Add a data-raw folder</a></li>
<li class="chapter" data-level="11.2.4" data-path="stepbuild.html"><a href="stepbuild.html#init-tests"><i class="fa fa-check"></i><b>11.2.4</b> Init Tests</a></li>
<li class="chapter" data-level="11.2.5" data-path="stepbuild.html"><a href="stepbuild.html#use-recommended-package"><i class="fa fa-check"></i><b>11.2.5</b> Use Recommended Package</a></li>
<li class="chapter" data-level="11.2.6" data-path="stepbuild.html"><a href="stepbuild.html#add-various-tools"><i class="fa fa-check"></i><b>11.2.6</b> Add various tools</a></li>
<li class="chapter" data-level="11.2.7" data-path="stepbuild.html"><a href="stepbuild.html#if-you-want-to-change-the-default-favicon"><i class="fa fa-check"></i><b>11.2.7</b> If you want to change the default favicon</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="stepbuild.html"><a href="stepbuild.html#day-to-day-dev-with-golem"><i class="fa fa-check"></i><b>11.3</b> Day to Day Dev with <code>{golem}</code></a></li>
<li class="chapter" data-level="11.4" data-path="stepbuild.html"><a href="stepbuild.html#launching-the-app"><i class="fa fa-check"></i><b>11.4</b> Launching the app</a></li>
<li class="chapter" data-level="11.5" data-path="stepbuild.html"><a href="stepbuild.html#dev02_dev.r"><i class="fa fa-check"></i><b>11.5</b> <code>dev/02_dev.R</code></a><ul>
<li class="chapter" data-level="11.5.1" data-path="stepbuild.html"><a href="stepbuild.html#add-modules"><i class="fa fa-check"></i><b>11.5.1</b> Add modules</a></li>
<li class="chapter" data-level="11.5.2" data-path="stepbuild.html"><a href="stepbuild.html#add-dependencies"><i class="fa fa-check"></i><b>11.5.2</b> Add dependencies</a></li>
<li class="chapter" data-level="11.5.3" data-path="stepbuild.html"><a href="stepbuild.html#add-tests"><i class="fa fa-check"></i><b>11.5.3</b> Add tests</a></li>
<li class="chapter" data-level="11.5.4" data-path="stepbuild.html"><a href="stepbuild.html#add-a-browser-button"><i class="fa fa-check"></i><b>11.5.4</b> Add a browser button</a></li>
<li class="chapter" data-level="11.5.5" data-path="stepbuild.html"><a href="stepbuild.html#add-external-files"><i class="fa fa-check"></i><b>11.5.5</b> Add external files</a></li>
</ul></li>
<li class="chapter" data-level="11.6" data-path="stepbuild.html"><a href="stepbuild.html#adding-these-external-resources-to-your-app"><i class="fa fa-check"></i><b>11.6</b> Adding these external resources to your app</a></li>
<li class="chapter" data-level="11.7" data-path="stepbuild.html"><a href="stepbuild.html#documentation"><i class="fa fa-check"></i><b>11.7</b> Documentation</a><ul>
<li class="chapter" data-level="11.7.1" data-path="stepbuild.html"><a href="stepbuild.html#vignette"><i class="fa fa-check"></i><b>11.7.1</b> Vignette</a></li>
<li class="chapter" data-level="11.7.2" data-path="stepbuild.html"><a href="stepbuild.html#code-coverage"><i class="fa fa-check"></i><b>11.7.2</b> Code coverage</a></li>
</ul></li>
<li class="chapter" data-level="11.8" data-path="stepbuild.html"><a href="stepbuild.html#using-golem-dev-functions"><i class="fa fa-check"></i><b>11.8</b> Using <code>{golem}</code> dev functions</a></li>
</ul></li>
<li class="part"><span><b>V Step 4: Strengthen</b></span></li>
<li class="chapter" data-level="12" data-path="step-secure.html"><a href="step-secure.html"><i class="fa fa-check"></i><b>12</b> Build yourself a safety net</a><ul>
<li class="chapter" data-level="12.1" data-path="step-secure.html"><a href="step-secure.html#testing-your-app"><i class="fa fa-check"></i><b>12.1</b> Testing your app</a><ul>
<li class="chapter" data-level="12.1.1" data-path="step-secure.html"><a href="step-secure.html#testing-the-business-logic"><i class="fa fa-check"></i><b>12.1.1</b> Testing the business logic</a></li>
<li class="chapter" data-level="12.1.2" data-path="step-secure.html"><a href="step-secure.html#testing-the-interactive-logic"><i class="fa fa-check"></i><b>12.1.2</b> Testing the interactive logic</a></li>
<li class="chapter" data-level="12.1.3" data-path="step-secure.html"><a href="step-secure.html#testing-the-app-load"><i class="fa fa-check"></i><b>12.1.3</b> Testing the app load</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="step-secure.html"><a href="step-secure.html#a-reproducible-environment"><i class="fa fa-check"></i><b>12.2</b> A reproducible environment</a><ul>
<li class="chapter" data-level="12.2.1" data-path="step-secure.html"><a href="step-secure.html#renv"><i class="fa fa-check"></i><b>12.2.1</b> {renv}</a></li>
<li class="chapter" data-level="12.2.2" data-path="step-secure.html"><a href="step-secure.html#docker-rstudio-connect"><i class="fa fa-check"></i><b>12.2.2</b> Docker &amp; RStudio Connect</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="secure.html"><a href="secure.html"><i class="fa fa-check"></i><b>13</b> Version Control</a><ul>
<li class="chapter" data-level="13.1" data-path="secure.html"><a href="secure.html#using-version-control-with-git"><i class="fa fa-check"></i><b>13.1</b> Using Version Control with <code>git</code></a><ul>
<li class="chapter" data-level="13.1.1" data-path="secure.html"><a href="secure.html#why-version-control"><i class="fa fa-check"></i><b>13.1.1</b> Why Version Control?</a></li>
<li class="chapter" data-level="13.1.2" data-path="secure.html"><a href="secure.html#git-basics-commit---push---pull"><i class="fa fa-check"></i><b>13.1.2</b> <code>Git</code> basics: <code>commit</code> - <code>push</code> - <code>pull</code></a></li>
<li class="chapter" data-level="13.1.3" data-path="secure.html"><a href="secure.html#about-branches"><i class="fa fa-check"></i><b>13.1.3</b> About branches</a></li>
<li class="chapter" data-level="13.1.4" data-path="secure.html"><a href="secure.html#issues"><i class="fa fa-check"></i><b>13.1.4</b> Issues</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="secure.html"><a href="secure.html#git-integration"><i class="fa fa-check"></i><b>13.2</b> Git integration</a><ul>
<li class="chapter" data-level="13.2.1" data-path="secure.html"><a href="secure.html#with-rstudio"><i class="fa fa-check"></i><b>13.2.1</b> With RStudio</a></li>
<li class="chapter" data-level="13.2.2" data-path="secure.html"><a href="secure.html#as-part-of-a-larger-world"><i class="fa fa-check"></i><b>13.2.2</b> As part of a larger world</a></li>
<li class="chapter" data-level="13.2.3" data-path="secure.html"><a href="secure.html#about-git-flow"><i class="fa fa-check"></i><b>13.2.3</b> About <code>git-flow</code></a></li>
<li class="chapter" data-level="13.2.4" data-path="secure.html"><a href="secure.html#further-readings-on-git"><i class="fa fa-check"></i><b>13.2.4</b> Further readings on <code>git</code></a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="secure.html"><a href="secure.html#ci-and-testing"><i class="fa fa-check"></i><b>13.3</b> CI and testing</a></li>
</ul></li>
<li class="part"><span><b>VI Step 5: Deploy</b></span></li>
<li class="chapter" data-level="14" data-path="stepdeploy.html"><a href="stepdeploy.html"><i class="fa fa-check"></i><b>14</b> Send your app to production</a><ul>
<li class="chapter" data-level="14.1" data-path="stepdeploy.html"><a href="stepdeploy.html#where-to-deploy-your-app"><i class="fa fa-check"></i><b>14.1</b> Where to deploy your app</a></li>
<li class="chapter" data-level="14.2" data-path="stepdeploy.html"><a href="stepdeploy.html#before-deployment-check-list"><i class="fa fa-check"></i><b>14.2</b> Before deployment Check-list</a><ul>
<li class="chapter" data-level="14.2.1" data-path="stepdeploy.html"><a href="stepdeploy.html#what-to-check-on-the-app"><i class="fa fa-check"></i><b>14.2.1</b> What to check on the app</a></li>
<li class="chapter" data-level="14.2.2" data-path="stepdeploy.html"><a href="stepdeploy.html#what-to-check-in-the-production-envionment"><i class="fa fa-check"></i><b>14.2.2</b> What to check in the production envionment</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="deploy-golem.html"><a href="deploy-golem.html"><i class="fa fa-check"></i><b>15</b> Deploy with <code>{golem}</code></a><ul>
<li class="chapter" data-level="15.1" data-path="deploy-golem.html"><a href="deploy-golem.html#local-deployment-1"><i class="fa fa-check"></i><b>15.1</b> Local deployment</a></li>
<li class="chapter" data-level="15.2" data-path="deploy-golem.html"><a href="deploy-golem.html#deploying-apps-with-golem"><i class="fa fa-check"></i><b>15.2</b> Deploying Apps with <code>{golem}</code></a></li>
<li class="chapter" data-level="15.3" data-path="deploy-golem.html"><a href="deploy-golem.html#rstudio-environments"><i class="fa fa-check"></i><b>15.3</b> RStudio Environments</a></li>
<li class="chapter" data-level="15.4" data-path="deploy-golem.html"><a href="deploy-golem.html#docker"><i class="fa fa-check"></i><b>15.4</b> Docker</a></li>
</ul></li>
<li class="part"><span><b>VII Optimizing</b></span></li>
<li class="chapter" data-level="16" data-path="when-optimize.html"><a href="when-optimize.html"><i class="fa fa-check"></i><b>16</b> The Need for Optimization</a><ul>
<li class="chapter" data-level="16.1" data-path="when-optimize.html"><a href="when-optimize.html#build-first-then-optimize"><i class="fa fa-check"></i><b>16.1</b> Build first, then optimize</a><ul>
<li class="chapter" data-level="16.1.1" data-path="when-optimize.html"><a href="when-optimize.html#identifying-bottlenecks"><i class="fa fa-check"></i><b>16.1.1</b> Identifying bottlenecks</a></li>
<li class="chapter" data-level="16.1.2" data-path="when-optimize.html"><a href="when-optimize.html#do-you-need-faster-functions"><i class="fa fa-check"></i><b>16.1.2</b> Do you need faster functions?</a></li>
<li class="chapter" data-level="16.1.3" data-path="when-optimize.html"><a href="when-optimize.html#dont-sacrifice-readability"><i class="fa fa-check"></i><b>16.1.3</b> Donât sacrifice readability</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="when-optimize.html"><a href="when-optimize.html#tools-for-profiling"><i class="fa fa-check"></i><b>16.2</b> Tools for profiling</a><ul>
<li class="chapter" data-level="16.2.1" data-path="when-optimize.html"><a href="when-optimize.html#profiling-r-code"><i class="fa fa-check"></i><b>16.2.1</b> Profiling R code</a></li>
<li class="chapter" data-level="16.2.2" data-path="when-optimize.html"><a href="when-optimize.html#profiling-shiny"><i class="fa fa-check"></i><b>16.2.2</b> Profiling Shiny</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="optim-caveat.html"><a href="optim-caveat.html"><i class="fa fa-check"></i><b>17</b> Common Application Caveats</a><ul>
<li class="chapter" data-level="17.1" data-path="optim-caveat.html"><a href="optim-caveat.html#reactivity-anti-patterns"><i class="fa fa-check"></i><b>17.1</b> Reactivity anti-patterns</a><ul>
<li class="chapter" data-level="17.1.1" data-path="optim-caveat.html"><a href="optim-caveat.html#reactivity-is-awesome-until-its-not"><i class="fa fa-check"></i><b>17.1.1</b> Reactivity is awesomeâ¦ until itâs not</a></li>
<li class="chapter" data-level="17.1.2" data-path="optim-caveat.html"><a href="optim-caveat.html#observe-vs-observeevent"><i class="fa fa-check"></i><b>17.1.2</b> <code>observe</code> vs <code>observeEvent</code></a></li>
<li class="chapter" data-level="17.1.3" data-path="optim-caveat.html"><a href="optim-caveat.html#building-triggers-and-watchers"><i class="fa fa-check"></i><b>17.1.3</b> Building triggers and watchers</a></li>
<li class="chapter" data-level="17.1.4" data-path="optim-caveat.html"><a href="optim-caveat.html#using-r6-as-a-data-storage"><i class="fa fa-check"></i><b>17.1.4</b> Using R6 as a data storage</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="optim-caveat.html"><a href="optim-caveat.html#r-does-too-much"><i class="fa fa-check"></i><b>17.2</b> R does too much</a></li>
<li class="chapter" data-level="17.3" data-path="optim-caveat.html"><a href="optim-caveat.html#reading-data"><i class="fa fa-check"></i><b>17.3</b> Reading data</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="optimizing-shiny-code.html"><a href="optimizing-shiny-code.html"><i class="fa fa-check"></i><b>18</b> Optimizing Shiny Code</a><ul>
<li class="chapter" data-level="18.1" data-path="optimizing-shiny-code.html"><a href="optimizing-shiny-code.html#optimizing-r-code"><i class="fa fa-check"></i><b>18.1</b> Optimizing R code</a></li>
<li class="chapter" data-level="18.2" data-path="optimizing-shiny-code.html"><a href="optimizing-shiny-code.html#caching-elements"><i class="fa fa-check"></i><b>18.2</b> Caching elements</a><ul>
<li class="chapter" data-level="18.2.1" data-path="optimizing-shiny-code.html"><a href="optimizing-shiny-code.html#whats-caching"><i class="fa fa-check"></i><b>18.2.1</b> Whatâs caching?</a></li>
<li class="chapter" data-level="18.2.2" data-path="optimizing-shiny-code.html"><a href="optimizing-shiny-code.html#using-caching-in-r"><i class="fa fa-check"></i><b>18.2.2</b> Using caching in R</a></li>
<li class="chapter" data-level="18.2.3" data-path="optimizing-shiny-code.html"><a href="optimizing-shiny-code.html#caching-shiny"><i class="fa fa-check"></i><b>18.2.3</b> Caching Shiny</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="optimizing-shiny-code.html"><a href="optimizing-shiny-code.html#paralellizing-shiny"><i class="fa fa-check"></i><b>18.3</b> Paralellizing Shiny</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="optimjs.html"><a href="optimjs.html"><i class="fa fa-check"></i><b>19</b> Using JavaScript</a><ul>
<li class="chapter" data-level="19.1" data-path="optimjs.html"><a href="optimjs.html#a-quick-introduction-to-javascript"><i class="fa fa-check"></i><b>19.1</b> A quick introduction to JavaScript</a><ul>
<li class="chapter" data-level="19.1.1" data-path="optimjs.html"><a href="optimjs.html#understanding-html-class-and-id"><i class="fa fa-check"></i><b>19.1.1</b> Understanding html, class, and id</a></li>
<li class="chapter" data-level="19.1.2" data-path="optimjs.html"><a href="optimjs.html#about-jquery-jquery-selectors"><i class="fa fa-check"></i><b>19.1.2</b> About jQuery &amp; jQuery selectors</a></li>
</ul></li>
<li class="chapter" data-level="19.2" data-path="optimjs.html"><a href="optimjs.html#client-side-javascript"><i class="fa fa-check"></i><b>19.2</b> Client-side JavaScript</a><ul>
<li class="chapter" data-level="19.2.1" data-path="optimjs.html"><a href="optimjs.html#common-patterns"><i class="fa fa-check"></i><b>19.2.1</b> Common patterns</a></li>
<li class="chapter" data-level="19.2.2" data-path="optimjs.html"><a href="optimjs.html#where-to-put-them---introduction-to-javascript-events"><i class="fa fa-check"></i><b>19.2.2</b> Where to put them - introduction to JavaScript events</a></li>
</ul></li>
<li class="chapter" data-level="19.3" data-path="optimjs.html"><a href="optimjs.html#javascript---shiny-communication"><i class="fa fa-check"></i><b>19.3</b> JavaScript &lt;-&gt; Shiny communication</a><ul>
<li class="chapter" data-level="19.3.1" data-path="optimjs.html"><a href="optimjs.html#from-r-to-javascript"><i class="fa fa-check"></i><b>19.3.1</b> From R to JavaScript</a></li>
<li class="chapter" data-level="19.3.2" data-path="optimjs.html"><a href="optimjs.html#from-javascript-to-r"><i class="fa fa-check"></i><b>19.3.2</b> From JavaScript to R</a></li>
</ul></li>
<li class="chapter" data-level="19.4" data-path="optimjs.html"><a href="optimjs.html#about-golem-js-functions"><i class="fa fa-check"></i><b>19.4</b> About <code>{golem}</code> js functions</a><ul>
<li class="chapter" data-level="19.4.1" data-path="optimjs.html"><a href="optimjs.html#goleminvoke_js"><i class="fa fa-check"></i><b>19.4.1</b> <code>golem::invoke_js()</code></a></li>
</ul></li>
<li class="chapter" data-level="19.5" data-path="optimjs.html"><a href="optimjs.html#learn-more-about-javascript"><i class="fa fa-check"></i><b>19.5</b> Learn more about JavaScript</a><ul>
<li class="chapter" data-level="19.5.1" data-path="optimjs.html"><a href="optimjs.html#javascript-basics"><i class="fa fa-check"></i><b>19.5.1</b> JavaScript basics</a></li>
<li class="chapter" data-level="19.5.2" data-path="optimjs.html"><a href="optimjs.html#jquery"><i class="fa fa-check"></i><b>19.5.2</b> jQuery</a></li>
<li class="chapter" data-level="19.5.3" data-path="optimjs.html"><a href="optimjs.html#intermediate-advanced-javascript"><i class="fa fa-check"></i><b>19.5.3</b> Intermediate / advanced JavaScript</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://rtask.thinkr.fr">A book by the ThinkR team</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Engineering Production-Grade Shiny Apps</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="structure" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Structuring your Project</h1>
<div id="shiny-app-as-a-package" class="section level2">
<h2><span class="header-section-number">3.1</span> Shiny App as a Package</h2>
<p>In the next chapter youâll be introduced to the <code>{golem}</code> package, which is <strong>an opinionated framework for building production-ready Shiny Applications</strong>.
This framework starts by creating a package skeleton waiting to be filled.</p>
<p>But, in a world where Shiny Applications are mostly created as a series of files, why bother with a package?</p>
<div id="whats-in-a-shiny-app" class="section level3">
<h3><span class="header-section-number">3.1.1</span> Whatâs in a Shiny App?</h3>
<p>OK, so letâs ask the question the other way round.
Think about your last Shiny which was created as a single-file (<code>app.R</code>) or two files app (<code>ui.R</code> and <code>server.R</code>).
Youâve got these two, and you put them into a folder.</p>
<p>So, letâs have a review of <strong>what youâll need next for a robust application</strong>.</p>
<p>First, <strong>metadata.</strong>
In other words, the name of the app, the version number (which is crucial to any serious, production-level project), what the application does, who to contact if something goes wrong.</p>
<p>Then, you need to find a way to <strong>handle the dependencies</strong>.
Because you know, when you want to push your app into production, you canât have this conversation with IT:</p>
<blockquote>
<p>IT: Hey, I tried to âsource(âapp.Râ)â but Iâve got an error.</p>
<p>R-dev: Whatâs the error?</p>
<p>IT: It says âcould not find package âshinyââ.</p>
<p>R-dev: Ah yes, you need to install {shiny}. Try to run âinstall.packages(âshinyâ)â.</p>
<p>IT: OK nice. What else?</p>
<p>R-dev: Let me think, try also âinstall.packages(âDTâ)ââ¦ good? Now try âinstall.packages(âggplot2â)â, and â¦</p>
<p>[â¦]</p>
<p>IT: Ok, now I source the âapp.Râ, right?</p>
<p>R-dev: Sure!</p>
<p>IT: Ok so it says âcould not find function runApp()â</p>
<p>R-dev: Ah, youâve got to do library(shiny) at the beginning of your script. And library(purrr), and library(jsonlite)*.</p>
</blockquote>
<p><code>*</code> Which will lead to a Namespace conflict on the <code>flatten()</code> function that can cause you some debugging headache.
So, hey, it would be cool if we could have a Shiny app that only imports specific functions from a package, right?</p>
<p><strong>So yes, dependencies matter. You need to handle them, and handle them correctly. </strong></p>
<p>Now, letâs say youâre building a big app.
Something with thousands of lines of code.
Handling a one-file or two-file shiny app with that much lines is just a nightmare.
So, what to do?
Letâs split everything into smaller files that we can call!</p>
<p>And finally, we want our app to live long and prosper, which means we need to document it: <strong>each small pieces of code should have a piece of comment</strong> to explain what these specific lines do.
The other thing we need for our application to be successful on the long term is tests, so that we are sure weâre not introducing any regression.</p>
<p>Oh, and that would be nice if people can get a <code>tar.gz</code> and install it on their computer and have access to a local copy of the app!</p>
<p>OK, so letâs sum up: we want to build an app.
This app needs to have <strong>metadata</strong> and to handle <strong>dependencies</strong> correctly, which is what you get from the <code>DESCRIPTION</code> + <code>NAMESPACE</code> files of the package.
Even more practical is the fact that you can do âselective namespace extractionâ inside a package, i.e you can say âI want this function from this packageâ.
Also, <strong>this app needs to be split up in smaller <code>.R</code> files</strong>, which is the way a package is organized.
And I donât need to emphasize how <strong>documentation</strong> is a vital part of any package, so we solved this question too here. So is the <strong>testing toolkit</strong>.
And of course, the âinstall everywhereâ wish comes to life when a Shiny App is in a package.</p>
</div>
<div id="the-other-plus-side-of-shiny-as-a-package" class="section level3">
<h3><span class="header-section-number">3.1.2</span> The other plus side of Shiny as a Package</h3>
<div id="testing" class="section level4">
<h4><span class="header-section-number">3.1.2.1</span> Testing</h4>
<p><strong>Nothing should go to production without being tested. Nothing.</strong>
Testing production apps is a wide question, and Iâll just stick to tests inside a Package here.</p>
<p>Frameworks for package testing are robust and widely documented.
So you donât have to put any extra-effort here: just use a canonical testing framework like <a href="https://testthat.r-lib.org/"><code>{testthat}</code></a>.
Learning how to use it is not the subject of this chapter, so feel free to refer to the documentation.
See also Chapter 5 of <a href="https://speakerdeck.com/colinfay/building-a-package-that-lasts-erum-2018-workshop?slide=107">âBuilding a package that lastsâ</a>.</p>
<p>What should you test?</p>
<ul>
<li><p>First of all, as weâve said before, the app should be split between the UI part and the back-end (or âbusiness logicâ) part.
These back-end functions are supposed to run without any interactive context, just as plain old functions. So for these ones, <strong>you can do classical tests</strong>.
As they are back-end functions (so specific to a project), <code>{golem}</code> canât provide any helpers for that.</p></li>
<li><p>For the UI part, <strong>remember that any UI function is designed to render an HTML element</strong>.
So you can save a file as HTML, and then compare it to a UI object with the <code>golem::expect_html_equal()</code>.</p></li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="structure.html#cb26-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb26-2"><a href="structure.html#cb26-2"></a>ui &lt;-<span class="st"> </span><span class="kw">tagList</span>(<span class="kw">h1</span>(<span class="st">&quot;Hello world!&quot;</span>))</span>
<span id="cb26-3"><a href="structure.html#cb26-3"></a>htmltools<span class="op">::</span><span class="kw">save_html</span>(ui, <span class="st">&quot;ui.html&quot;</span>)</span>
<span id="cb26-4"><a href="structure.html#cb26-4"></a>golem<span class="op">::</span><span class="kw">expect_html_equal</span>(ui, <span class="st">&quot;ui.html&quot;</span>)</span>
<span id="cb26-5"><a href="structure.html#cb26-5"></a><span class="co"># Changes </span></span>
<span id="cb26-6"><a href="structure.html#cb26-6"></a>ui &lt;-<span class="st"> </span><span class="kw">tagList</span>(<span class="kw">h2</span>(<span class="st">&quot;Hello world!&quot;</span>))</span>
<span id="cb26-7"><a href="structure.html#cb26-7"></a>golem<span class="op">::</span><span class="kw">expect_html_equal</span>(ui, <span class="st">&quot;ui.html&quot;</span>)</span></code></pre></div>
<p>This can for example be useful if you need to test a module.
A UI module function returns an HTML tag list, so once your modules are set you can save them and use them inside tests.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="structure.html#cb27-1"></a>my_mod_ui &lt;-<span class="st"> </span><span class="cf">function</span>(id){</span>
<span id="cb27-2"><a href="structure.html#cb27-2"></a>  ns &lt;-<span class="st"> </span><span class="kw">NS</span>(<span class="st">&quot;id&quot;</span>)</span>
<span id="cb27-3"><a href="structure.html#cb27-3"></a>  <span class="kw">tagList</span>(</span>
<span id="cb27-4"><a href="structure.html#cb27-4"></a>    <span class="kw">selectInput</span>(<span class="kw">ns</span>(<span class="st">&quot;this&quot;</span>), <span class="st">&quot;that&quot;</span>, <span class="dt">choices =</span> LETTERS[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>])</span>
<span id="cb27-5"><a href="structure.html#cb27-5"></a>  )</span>
<span id="cb27-6"><a href="structure.html#cb27-6"></a>}</span>
<span id="cb27-7"><a href="structure.html#cb27-7"></a>my_mod_ui_test &lt;-<span class="st"> </span><span class="kw">tempfile</span>(<span class="dt">fileext =</span> <span class="st">&quot;html&quot;</span>)</span>
<span id="cb27-8"><a href="structure.html#cb27-8"></a>htmltools<span class="op">::</span><span class="kw">save_html</span>(<span class="kw">my_mod_ui</span>(<span class="st">&quot;test&quot;</span>), my_mod_ui_test)</span>
<span id="cb27-9"><a href="structure.html#cb27-9"></a><span class="co"># Some time later, and of course saved in the test folder, </span></span>
<span id="cb27-10"><a href="structure.html#cb27-10"></a><span class="co"># not as a temp file</span></span>
<span id="cb27-11"><a href="structure.html#cb27-11"></a>golem<span class="op">::</span><span class="kw">expect_html_equal</span>(<span class="kw">my_mod_ui</span>(<span class="st">&quot;test&quot;</span>), my_mod_ui_test)</span></code></pre></div>
<p><code>{golem}</code> also provides two functions, <code>expect_shinytag()</code> and <code>expect_shinytaglist()</code>, that test if an object is of class <code>"shiny.tag"</code> or <code>"shiny.tag.list"</code>.</p>
<ul>
<li>Testing package launch: when launching <code>golem::use_recommended_tests()</code>, youâll find a test built on top of <code>{processx}</code> that allows to check if the application is launch-able. Hereâs a short description of what happens:</li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="structure.html#cb28-1"></a><span class="co"># Standard testthat things</span></span>
<span id="cb28-2"><a href="structure.html#cb28-2"></a><span class="kw">context</span>(<span class="st">&quot;launch&quot;</span>)</span>
<span id="cb28-3"><a href="structure.html#cb28-3"></a></span>
<span id="cb28-4"><a href="structure.html#cb28-4"></a><span class="kw">library</span>(processx)</span>
<span id="cb28-5"><a href="structure.html#cb28-5"></a></span>
<span id="cb28-6"><a href="structure.html#cb28-6"></a>testthat<span class="op">::</span><span class="kw">test_that</span>(</span>
<span id="cb28-7"><a href="structure.html#cb28-7"></a>  <span class="st">&quot;app launches&quot;</span>,{</span>
<span id="cb28-8"><a href="structure.html#cb28-8"></a>    <span class="co"># We&#39;re creating a new process that runs the app</span></span>
<span id="cb28-9"><a href="structure.html#cb28-9"></a>    x &lt;-<span class="st"> </span>process<span class="op">$</span><span class="kw">new</span>(</span>
<span id="cb28-10"><a href="structure.html#cb28-10"></a>      <span class="st">&quot;R&quot;</span>, </span>
<span id="cb28-11"><a href="structure.html#cb28-11"></a>      <span class="kw">c</span>(</span>
<span id="cb28-12"><a href="structure.html#cb28-12"></a>        <span class="st">&quot;-e&quot;</span>, </span>
<span id="cb28-13"><a href="structure.html#cb28-13"></a>        <span class="co"># As we are in the tests/testthat dir, we&#39;re moving </span></span>
<span id="cb28-14"><a href="structure.html#cb28-14"></a>        <span class="co"># two steps back before launching the whole package</span></span>
<span id="cb28-15"><a href="structure.html#cb28-15"></a>        <span class="co"># and we try to launch the app</span></span>
<span id="cb28-16"><a href="structure.html#cb28-16"></a>        <span class="st">&quot;setwd(&#39;../../&#39;); pkgload::load_all();run_app()&quot;</span></span>
<span id="cb28-17"><a href="structure.html#cb28-17"></a>      )</span>
<span id="cb28-18"><a href="structure.html#cb28-18"></a>    )</span>
<span id="cb28-19"><a href="structure.html#cb28-19"></a>    <span class="co"># We leave some time for the app to launch</span></span>
<span id="cb28-20"><a href="structure.html#cb28-20"></a>    <span class="co"># Configure this according to your need</span></span>
<span id="cb28-21"><a href="structure.html#cb28-21"></a>    <span class="kw">Sys.sleep</span>(<span class="dv">5</span>)</span>
<span id="cb28-22"><a href="structure.html#cb28-22"></a>    <span class="co"># We check that the app is alive</span></span>
<span id="cb28-23"><a href="structure.html#cb28-23"></a>    <span class="kw">expect_true</span>(x<span class="op">$</span><span class="kw">is_alive</span>())</span>
<span id="cb28-24"><a href="structure.html#cb28-24"></a>    <span class="co"># We kill it</span></span>
<span id="cb28-25"><a href="structure.html#cb28-25"></a>    x<span class="op">$</span><span class="kw">kill</span>()</span>
<span id="cb28-26"><a href="structure.html#cb28-26"></a>  }</span>
<span id="cb28-27"><a href="structure.html#cb28-27"></a>)</span></code></pre></div>
<p><em>Note</em>: this specific configuration will possibly fail on Continuous integration platform as Gitlab CI or Travis. A workaround is to, inside your CI yml, first install the package with <code>remotes::install_local()</code>, and then replace the <code>setwd (...) run_app()</code> command with <code>myuberapp::run_app()</code>.</p>
<p>For example:</p>
<ul>
<li>in <code>.gitlab-ci.yml</code>:</li>
</ul>
<pre><code>test:
stage: test
script: 
- echo &quot;Running tests&quot;
- R -e &#39;remotes::install_local()&#39;
- R -e &#39;devtools::check()&#39;</code></pre>
<ul>
<li>in <code>test-golem.R</code>:</li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="structure.html#cb30-1"></a>testthat<span class="op">::</span><span class="kw">test_that</span>(</span>
<span id="cb30-2"><a href="structure.html#cb30-2"></a>  <span class="st">&quot;app launches&quot;</span>,{</span>
<span id="cb30-3"><a href="structure.html#cb30-3"></a>    x &lt;-<span class="st"> </span>process<span class="op">$</span><span class="kw">new</span>( </span>
<span id="cb30-4"><a href="structure.html#cb30-4"></a>      <span class="st">&quot;R&quot;</span>, </span>
<span id="cb30-5"><a href="structure.html#cb30-5"></a>      <span class="kw">c</span>(</span>
<span id="cb30-6"><a href="structure.html#cb30-6"></a>        <span class="st">&quot;-e&quot;</span>, </span>
<span id="cb30-7"><a href="structure.html#cb30-7"></a>        <span class="st">&quot;datuberapp::run_app()&quot;</span></span>
<span id="cb30-8"><a href="structure.html#cb30-8"></a>      )</span>
<span id="cb30-9"><a href="structure.html#cb30-9"></a>    )</span>
<span id="cb30-10"><a href="structure.html#cb30-10"></a>    <span class="kw">Sys.sleep</span>(<span class="dv">5</span>)</span>
<span id="cb30-11"><a href="structure.html#cb30-11"></a>    <span class="kw">expect_true</span>(x<span class="op">$</span><span class="kw">is_alive</span>())</span>
<span id="cb30-12"><a href="structure.html#cb30-12"></a>    x<span class="op">$</span><span class="kw">kill</span>()</span>
<span id="cb30-13"><a href="structure.html#cb30-13"></a>  }</span>
<span id="cb30-14"><a href="structure.html#cb30-14"></a>)</span></code></pre></div>
</div>
<div id="documenting" class="section level4">
<h4><span class="header-section-number">3.1.2.2</span> Documenting</h4>
<p>Documenting packages is a natural thing for any R developer.
Any exported function should have its own documentation, hence you are âforcedâ to document any user facing-function.</p>
<p>Also, building a Shiny App as a package allows you to write standard R documentation:</p>
<ul>
<li>A <code>README</code> at the root of your package</li>
<li><code>Vignettes</code> that explain how to use your app</li>
<li>A <code>{pkgdown}</code> that can be used as an external link for your application.</li>
</ul>
</div>
</div>
<div id="deploy" class="section level3">
<h3><span class="header-section-number">3.1.3</span> Deploy</h3>
<div id="local-deployment" class="section level4">
<h4><span class="header-section-number">3.1.3.1</span> Local deployment</h4>
<p>As your Shiny App is a standard package, it can be built as a <code>tar.gz</code>, sent to your colleagues, friends, and family, and even to the CRAN.
It can also be installed in any R-package repository. Then, if youâve built your app with <code>{golem}</code>, youâll just have to do:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="structure.html#cb31-1"></a><span class="kw">library</span>(myuberapp)</span>
<span id="cb31-2"><a href="structure.html#cb31-2"></a><span class="kw">run_app</span>()</span></code></pre></div>
<p>to launch your app.</p>
</div>
<div id="rstudio-connect-shiny-server" class="section level4">
<h4><span class="header-section-number">3.1.3.2</span> RStudio Connect &amp; Shiny Server</h4>
<p>Both these platforms expect a file app configuration, i.e an <code>app.R</code> file or <code>ui.R</code> / <code>server.R</code> files.
So how can we integrate this âShiny App as Packageâ into Connect or Shiny Server?</p>
<ul>
<li><p>Using an internal package manager like <a href="https://www.rstudio.com/products/package-manager/">RStudio Package Manager</a>, where the package app is installed, and then you simply have to create an <code>app.R</code> with the small piece of code from the section just before.</p></li>
<li><p>Uploading the package folder to the server. In that scenario, you use the package folder as the app package, and upload the whole thing. Then, write an <code>app.R</code> that does:</p></li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="structure.html#cb32-1"></a>pkgload<span class="op">::</span><span class="kw">load_all</span>()</span>
<span id="cb32-2"><a href="structure.html#cb32-2"></a>shiny<span class="op">::</span><span class="kw">shinyApp</span>(<span class="dt">ui =</span> <span class="kw">app_ui</span>(), <span class="dt">server =</span> app_server)</span></code></pre></div>
<p>And of course, donât forget to add this file in the <code>.Rbuildignore</code>!</p>
<p>This is the file youâll get if you run <code>golem::add_rconnect_file()</code>.</p>
</div>
<div id="docker-containers" class="section level4">
<h4><span class="header-section-number">3.1.3.3</span> Docker containers</h4>
<p>In order to dockerize your app, simply install the package as any other package, and use as a <code>CMD</code> <code>R -e 'options("shiny.port"=80,shiny.host="0.0.0.0");myuberapp::run_app()'</code>.
Of course changing the port to the one you need.</p>
<p>Youâll get the Dockerfile you need with <code>golem::add_dockerfile()</code>.</p>
</div>
</div>
<div id="resources" class="section level3">
<h3><span class="header-section-number">3.1.4</span> Resources</h3>
<ul>
<li><p><a href="http://r-pkgs.had.co.nz/">R packages</a></p></li>
<li><p><a href="https://speakerdeck.com/colinfay/building-a-package-that-lasts-erum-2018-workshop">âBuilding a package that lastsâ</a></p></li>
<li><p><a href="https://cran.r-project.org/doc/manuals/r-release/R-exts.html#Creating-R-packages">Writing R Extensions</a></p></li>
<li><p><a href="https://kbroman.org/pkg_primer/">R package primer - a minimal tutorial</a></p></li>
</ul>
</div>
</div>
<div id="using-shiny-modules" class="section level2">
<h2><span class="header-section-number">3.2</span> Using Shiny Modules</h2>
<div id="small-is-beautiful-1" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Small is beautiful</h3>
<p>Modules are one of the most powerful tool for building Shiny Application.
But what are they?</p>
<blockquote>
<p>Shiny modules address the namespacing problem in Shiny UI and server logic, adding a level of abstraction beyond functions</p>
</blockquote>
<!--SHINY.SINGLETON[1efbbb1390b1f2da3adcc5776ac72d01ac3af14a]-->
<style>.right{ text-align: right;}</style>
<!--/SHINY.SINGLETON[1efbbb1390b1f2da3adcc5776ac72d01ac3af14a]-->
<div class="right">
<a href="https://shiny.rstudio.com/articles/modules.html">Modularizing Shiny app code</a>
</div>
<p>Letâs first untangle this quote with a simple example about what is shiny namespace problem.</p>
<div id="one-million-validate-buttons" class="section level4">
<h4><span class="header-section-number">3.2.1.1</span> One million âValidateâ buttons</h4>
<p>Shiny needs its outputs and inputs to have a <strong>unique id</strong>.
And unfortunately, we canât bypass that: when you send a plot <strong>from R to the browser</strong>, i.e from the <code>server</code> to the <code>ui</code>, the browser needs to know exactly where to put this element.
This âexactly whereâ is handled through the use of an <code>id</code>.
Ids are not a Shiny specific concept: they are at the very root of the way web pages work.
Understanding all of this is not the purpose of this chapter: just remember that Shiny inputs and outputs ids <strong>have</strong> to be unique, so that the browser knows where to put what it receives from R, and R knows what to listen to from the browser.
The need to be unique is made a little bit complex by the way Shiny handles the names, as it share a global pool for all the id names, with no native way to use namespaces.</p>
<p>Namespaces are a computer science concept which has been designed to handle a common issue: how to share the same name for a variable in various place of your program without them conflicting.
In other words, how to use an object called <code>foo</code> several times in the program, and still be sure that itâs correctly used depending on the context.
R itself has a system for namespaces ; thatâs what packages do and why you can have <code>purrr::flatten</code> and <code>jsonlite::flatten</code>: the function name is the same, but the two live in different namespaces, and they can mean two different things, as the symbol is evaluated inside two different namespaces.
If you want to learn more about namespaces, please refer to the <a href="https://adv-r.hadley.nz/environments.html#special-environments">7.4 Special environments</a> chapter from <em>Advanced R</em>.</p>
<p>So, thatâs what modules are made for: creating small namespaces where you can safely define <code>ids</code> without conflicting with other ids in the app.
Why do we need to do that?
Think about the number of times youâve created a âOKâ or âvalidateâ button.
How do you handle that?
By creating <code>validate1</code>, <code>validate2</code>, and so on and so forth.
And if you think about it, youâre mimicking a namespacing process: a <code>validate</code> in namespace <code>1</code>, another in namespace <code>2</code>.</p>
<p>Consider this piece of code:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="structure.html#cb33-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb33-2"><a href="structure.html#cb33-2"></a>ui &lt;-<span class="st"> </span><span class="cf">function</span>(request){</span>
<span id="cb33-3"><a href="structure.html#cb33-3"></a>  <span class="kw">fluidPage</span>(</span>
<span id="cb33-4"><a href="structure.html#cb33-4"></a>    <span class="kw">sliderInput</span>(<span class="st">&quot;choice1&quot;</span>, <span class="st">&quot;choice 1&quot;</span>, <span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">5</span>),</span>
<span id="cb33-5"><a href="structure.html#cb33-5"></a>    <span class="kw">actionButton</span>(<span class="st">&quot;validate1&quot;</span>, <span class="st">&quot;Validate choice 1&quot;</span>),</span>
<span id="cb33-6"><a href="structure.html#cb33-6"></a>    <span class="kw">sliderInput</span>(<span class="st">&quot;choice2&quot;</span>, <span class="st">&quot;choice 2&quot;</span>, <span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">5</span>),</span>
<span id="cb33-7"><a href="structure.html#cb33-7"></a>    <span class="kw">actionButton</span>(<span class="st">&quot;validate2&quot;</span>, <span class="st">&quot;Validate choice 2&quot;</span>)</span>
<span id="cb33-8"><a href="structure.html#cb33-8"></a>  )</span>
<span id="cb33-9"><a href="structure.html#cb33-9"></a>}</span>
<span id="cb33-10"><a href="structure.html#cb33-10"></a></span>
<span id="cb33-11"><a href="structure.html#cb33-11"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(</span>
<span id="cb33-12"><a href="structure.html#cb33-12"></a>  input, </span>
<span id="cb33-13"><a href="structure.html#cb33-13"></a>  output, </span>
<span id="cb33-14"><a href="structure.html#cb33-14"></a>  session</span>
<span id="cb33-15"><a href="structure.html#cb33-15"></a>){</span>
<span id="cb33-16"><a href="structure.html#cb33-16"></a>  <span class="kw">observeEvent</span>( input<span class="op">$</span>validate1 , {</span>
<span id="cb33-17"><a href="structure.html#cb33-17"></a>    <span class="kw">print</span>(input<span class="op">$</span>choice1)</span>
<span id="cb33-18"><a href="structure.html#cb33-18"></a>  })</span>
<span id="cb33-19"><a href="structure.html#cb33-19"></a>  <span class="kw">observeEvent</span>( input<span class="op">$</span>validate2 , {</span>
<span id="cb33-20"><a href="structure.html#cb33-20"></a>    <span class="kw">print</span>(input<span class="op">$</span>choice2)</span>
<span id="cb33-21"><a href="structure.html#cb33-21"></a>  })</span>
<span id="cb33-22"><a href="structure.html#cb33-22"></a>  </span>
<span id="cb33-23"><a href="structure.html#cb33-23"></a>}</span>
<span id="cb33-24"><a href="structure.html#cb33-24"></a></span>
<span id="cb33-25"><a href="structure.html#cb33-25"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<p>This, of course, is an approach that works.
Well, it works as long as your code base is small.
But how can you be sure that youâre not creating <code>validate6</code> on line 55 and another on line 837?
How can you be make sure that youâre deleting the correct combination of UI/server components if they are named that way?
Also, how do you work smoothly in a context where you have to scroll from <code>sliderInput("choice1"</code> to <code>observeEvent( input$choice1 , {</code> which might be separated by thousands of lines?</p>
</div>
<div id="a-bite-sized-code-base" class="section level4">
<h4><span class="header-section-number">3.2.1.2</span> A bite-sized code base</h4>
<p>And of course, you know the saying that <em>âif you copy and paste something more than twice, you should make a functionâ</em>, so how do we refactor this piece of code so that itâs reusable?</p>
<p>Yes, you guessed right: using shiny modules.
Shiny modules aim at three things: simplifying id namespacing, split the code base into a series of functions, and allow UI/Server parts of your app to be reused.
Most of the time, modules are used to do the two first: Iâd say that 90% of the module I write are never reused<a href="optimjs.html#fn13" class="footnote-ref" id="fnref13"><sup>13</sup></a> ; they are here to allow me to split the code base into smaller, more manageable pieces.</p>
<p>With Shiny modules, youâll be writing a combination of UI and server functions.
Think of them as small, standalone Shiny apps, which output and handle a fraction of your global application.
If youâve been developing R packages, youâd probably trying to split your functions into series of smaller functions, thatâs the exact same thing: you are, with just a little bit of tweaking, doing the same thing.
That is to say creating smaller functions that are easier to understand, develop and maintain.</p>
</div>
</div>
<div id="a-practical-walk-through" class="section level3">
<h3><span class="header-section-number">3.2.2</span> A practical walk through</h3>
<div id="your-first-shiny-module" class="section level4">
<h4><span class="header-section-number">3.2.2.1</span> Your first Shiny Module</h4>
<p>So, here is how youâd refactor the example from before with modules:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="structure.html#cb34-1"></a>name_ui &lt;-<span class="st"> </span><span class="cf">function</span>(id){</span>
<span id="cb34-2"><a href="structure.html#cb34-2"></a>  ns &lt;-<span class="st"> </span><span class="kw">NS</span>(id)</span>
<span id="cb34-3"><a href="structure.html#cb34-3"></a>  <span class="kw">tagList</span>(</span>
<span id="cb34-4"><a href="structure.html#cb34-4"></a>    <span class="kw">sliderInput</span>(<span class="kw">ns</span>(<span class="st">&quot;choice&quot;</span>), <span class="st">&quot;Choice&quot;</span>, <span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">5</span>),</span>
<span id="cb34-5"><a href="structure.html#cb34-5"></a>    <span class="kw">actionButton</span>(<span class="kw">ns</span>(<span class="st">&quot;validate&quot;</span>), <span class="st">&quot;Validate Choice&quot;</span>)</span>
<span id="cb34-6"><a href="structure.html#cb34-6"></a>  )</span>
<span id="cb34-7"><a href="structure.html#cb34-7"></a>}</span>
<span id="cb34-8"><a href="structure.html#cb34-8"></a></span>
<span id="cb34-9"><a href="structure.html#cb34-9"></a>name_server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session){</span>
<span id="cb34-10"><a href="structure.html#cb34-10"></a>  ns &lt;-<span class="st"> </span>session<span class="op">$</span>ns</span>
<span id="cb34-11"><a href="structure.html#cb34-11"></a>  </span>
<span id="cb34-12"><a href="structure.html#cb34-12"></a>  <span class="kw">observeEvent</span>( input<span class="op">$</span>validate , {</span>
<span id="cb34-13"><a href="structure.html#cb34-13"></a>    <span class="kw">print</span>(input<span class="op">$</span>choice)</span>
<span id="cb34-14"><a href="structure.html#cb34-14"></a>  })</span>
<span id="cb34-15"><a href="structure.html#cb34-15"></a>  </span>
<span id="cb34-16"><a href="structure.html#cb34-16"></a>}</span>
<span id="cb34-17"><a href="structure.html#cb34-17"></a></span>
<span id="cb34-18"><a href="structure.html#cb34-18"></a><span class="kw">library</span>(shiny)</span>
<span id="cb34-19"><a href="structure.html#cb34-19"></a>ui &lt;-<span class="st"> </span><span class="cf">function</span>(request){</span>
<span id="cb34-20"><a href="structure.html#cb34-20"></a>  <span class="kw">fluidPage</span>(</span>
<span id="cb34-21"><a href="structure.html#cb34-21"></a>    <span class="kw">name_ui</span>(<span class="st">&quot;name_ui_1&quot;</span>),</span>
<span id="cb34-22"><a href="structure.html#cb34-22"></a>    <span class="kw">name_ui</span>(<span class="st">&quot;name_ui_2&quot;</span>)</span>
<span id="cb34-23"><a href="structure.html#cb34-23"></a>  )</span>
<span id="cb34-24"><a href="structure.html#cb34-24"></a>}</span>
<span id="cb34-25"><a href="structure.html#cb34-25"></a></span>
<span id="cb34-26"><a href="structure.html#cb34-26"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(</span>
<span id="cb34-27"><a href="structure.html#cb34-27"></a>  input, </span>
<span id="cb34-28"><a href="structure.html#cb34-28"></a>  output, </span>
<span id="cb34-29"><a href="structure.html#cb34-29"></a>  session</span>
<span id="cb34-30"><a href="structure.html#cb34-30"></a>){</span>
<span id="cb34-31"><a href="structure.html#cb34-31"></a>  <span class="kw">callModule</span>(name_server, <span class="st">&quot;name_ui_1&quot;</span>)</span>
<span id="cb34-32"><a href="structure.html#cb34-32"></a>  <span class="kw">callModule</span>(name_server, <span class="st">&quot;name_ui_2&quot;</span>)</span>
<span id="cb34-33"><a href="structure.html#cb34-33"></a>}</span>
<span id="cb34-34"><a href="structure.html#cb34-34"></a></span>
<span id="cb34-35"><a href="structure.html#cb34-35"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<p>Letâs stop for a minute and decompose what weâve got here.</p>
<p>The <strong>server</strong> function is pretty much the same as before: youâll just be using the same code as the one youâve been using so far.</p>
<p>The <strong>ui</strong> function has some new things in it. Well, two new things, which are <code>ns &lt;- NS(id)</code> and <code>ns(inputId)</code>.
Thatâs where the namespacing happens.
You can think about this function as a way to add a namespace to your id: youâve been doing <code>validate1</code> and <code>validate2</code> before, now youâre doing this with the function created by <code>ns &lt;- NS(id)</code>.</p>
<p>Youâll find this little piece of code on top of all the module ui functions.
To understand what it does, letâs try and run it outside of Shiny:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="structure.html#cb35-1"></a>id &lt;-<span class="st"> &quot;name_ui_1&quot;</span></span>
<span id="cb35-2"><a href="structure.html#cb35-2"></a>ns &lt;-<span class="st"> </span><span class="kw">NS</span>(id)</span>
<span id="cb35-3"><a href="structure.html#cb35-3"></a><span class="kw">ns</span>(<span class="st">&quot;choice&quot;</span>)</span></code></pre></div>
<pre><code>[1] &quot;name_ui_1-choice&quot;</code></pre>
<p>And here it is, our namespaced id!</p>
<p>And of course, calling it with various id will create various namespaces for the id, preventing you from id conflicts<a href="optimjs.html#fn14" class="footnote-ref" id="fnref14"><sup>14</sup></a>.
All you have to do now is to make sure that ids are unique at the âupperâ levels.
Then you can have as many <code>validate</code> input as you want in your app: as long as this <code>validate</code> is unique inside your module youâre good to go.</p>
<p>The <code>app_ui</code> contains a series of call to <code>module_ui_function(unique_id, ...)</code> with potential parameters:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="structure.html#cb37-1"></a>name_ui &lt;-<span class="st"> </span><span class="cf">function</span>(id, butname){</span>
<span id="cb37-2"><a href="structure.html#cb37-2"></a>  ns &lt;-<span class="st"> </span><span class="kw">NS</span>(id)</span>
<span id="cb37-3"><a href="structure.html#cb37-3"></a>  <span class="kw">tagList</span>(</span>
<span id="cb37-4"><a href="structure.html#cb37-4"></a>    <span class="kw">actionButton</span>(<span class="kw">ns</span>(<span class="st">&quot;validate&quot;</span>), butname)</span>
<span id="cb37-5"><a href="structure.html#cb37-5"></a>  )</span>
<span id="cb37-6"><a href="structure.html#cb37-6"></a>}</span>
<span id="cb37-7"><a href="structure.html#cb37-7"></a></span>
<span id="cb37-8"><a href="structure.html#cb37-8"></a><span class="kw">name_ui</span>(<span class="st">&quot;name_ui_1&quot;</span>, <span class="st">&quot;Validate Choice&quot;</span>)</span>
<span id="cb37-9"><a href="structure.html#cb37-9"></a><span class="kw">name_ui</span>(<span class="st">&quot;name_ui_2&quot;</span>, <span class="st">&quot;Validate Choice, again&quot;</span>)</span></code></pre></div>
<pre><code>&lt;button id=&quot;name_ui_1-validate&quot; type=&quot;button&quot; class=&quot;btn btn-default action-button&quot;&gt;Validate Choice&lt;/button&gt;

&lt;button id=&quot;name_ui_2-validate&quot; type=&quot;button&quot; class=&quot;btn btn-default action-button&quot;&gt;Validate Choice, again&lt;/button&gt;</code></pre>
<p>The <code>app_server</code> side contains a series of <code>callModule(module_server_function, unique_id, ...)</code>, with potential parameters.</p>
</div>
<div id="passing-args-to-your-modules" class="section level4">
<h4><span class="header-section-number">3.2.2.2</span> Passing args to your modules</h4>
<p>Shiny modules will potentially be reused.
Itâs not the general pattern, but they can.</p>
<p>In that case, youâll potentially be using extra arguments to generate the UI and server conditionally.
Letâs for example have a look at <a href="https://github.com/ColinFay/tidytuesday201942/blob/master/R/mod_dataviz.R#L17">mod_dataviz.R</a> from the <code>{tidytuesday201942}</code> Shiny application.</p>
<p>This application contains 6 tabs, 4 of them being pretty much alike: a side bar with inputs, an a main panel with a button and the plot.
This is a typical case where you should reuse modules: if two or more parts are relatively similar, itâs easier to bundle it inside a reusable module, and condition the ui/server with function arguments.</p>
<p><img src="img/tidytuesdayapp.png" /></p>
<p>Here, are some examples of how it works in the UI:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="structure.html#cb39-1"></a>mod_dataviz_ui &lt;-<span class="st"> </span><span class="cf">function</span>(id, <span class="dt">type =</span> <span class="kw">c</span>(<span class="st">&quot;point&quot;</span>, <span class="st">&quot;hist&quot;</span>, <span class="st">&quot;boxplot&quot;</span>, <span class="st">&quot;bar&quot;</span>)){</span>
<span id="cb39-2"><a href="structure.html#cb39-2"></a>  <span class="kw">h4</span>(</span>
<span id="cb39-3"><a href="structure.html#cb39-3"></a>    <span class="kw">sprintf</span>( <span class="st">&quot;Create a geom_%s&quot;</span>, type )</span>
<span id="cb39-4"><a href="structure.html#cb39-4"></a>  ),</span>
<span id="cb39-5"><a href="structure.html#cb39-5"></a>  <span class="cf">if</span> (type <span class="op">==</span><span class="st"> &quot;boxplot&quot;</span> <span class="op">|</span><span class="st"> </span>type <span class="op">==</span><span class="st">&quot;bar&quot;</span>) {</span>
<span id="cb39-6"><a href="structure.html#cb39-6"></a>    <span class="kw">selectInput</span>(</span>
<span id="cb39-7"><a href="structure.html#cb39-7"></a>      <span class="kw">ns</span>(<span class="st">&quot;x&quot;</span>),</span>
<span id="cb39-8"><a href="structure.html#cb39-8"></a>      <span class="st">&quot;x&quot;</span>, </span>
<span id="cb39-9"><a href="structure.html#cb39-9"></a>      <span class="dt">choices =</span> <span class="kw">names_that_are</span>(<span class="kw">c</span>(<span class="st">&quot;logical&quot;</span>, <span class="st">&quot;character&quot;</span>))</span>
<span id="cb39-10"><a href="structure.html#cb39-10"></a>    )</span>
<span id="cb39-11"><a href="structure.html#cb39-11"></a>  } <span class="cf">else</span> {</span>
<span id="cb39-12"><a href="structure.html#cb39-12"></a>    <span class="kw">selectInput</span>(</span>
<span id="cb39-13"><a href="structure.html#cb39-13"></a>      <span class="kw">ns</span>(<span class="st">&quot;x&quot;</span>),</span>
<span id="cb39-14"><a href="structure.html#cb39-14"></a>      <span class="st">&quot;x&quot;</span>, </span>
<span id="cb39-15"><a href="structure.html#cb39-15"></a>      <span class="dt">choices =</span> <span class="kw">names_that_are</span>(<span class="st">&quot;numeric&quot;</span>)</span>
<span id="cb39-16"><a href="structure.html#cb39-16"></a>    )</span>
<span id="cb39-17"><a href="structure.html#cb39-17"></a>  }</span>
<span id="cb39-18"><a href="structure.html#cb39-18"></a>}</span></code></pre></div>
<p>And in the server:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="structure.html#cb40-1"></a>mod_dataviz_server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session, type){</span>
<span id="cb40-2"><a href="structure.html#cb40-2"></a>  <span class="cf">if</span> (type <span class="op">==</span><span class="st"> &quot;point&quot;</span>){</span>
<span id="cb40-3"><a href="structure.html#cb40-3"></a>    x &lt;-<span class="st"> </span>rlang<span class="op">::</span><span class="kw">sym</span>(input<span class="op">$</span>x)</span>
<span id="cb40-4"><a href="structure.html#cb40-4"></a>    y &lt;-<span class="st"> </span>rlang<span class="op">::</span><span class="kw">sym</span>(input<span class="op">$</span>y)</span>
<span id="cb40-5"><a href="structure.html#cb40-5"></a>    color &lt;-<span class="st"> </span>rlang<span class="op">::</span><span class="kw">sym</span>(input<span class="op">$</span>color)</span>
<span id="cb40-6"><a href="structure.html#cb40-6"></a>    r<span class="op">$</span>plot &lt;-<span class="st"> </span><span class="kw">ggplot</span>(</span>
<span id="cb40-7"><a href="structure.html#cb40-7"></a>      big_epa_cars, </span>
<span id="cb40-8"><a href="structure.html#cb40-8"></a>      <span class="kw">aes</span>(<span class="op">!!</span>x, <span class="op">!!</span>y, <span class="dt">color =</span> <span class="op">!!</span>color)</span>
<span id="cb40-9"><a href="structure.html#cb40-9"></a>    )  <span class="op">+</span></span>
<span id="cb40-10"><a href="structure.html#cb40-10"></a><span class="st">      </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb40-11"><a href="structure.html#cb40-11"></a><span class="st">      </span><span class="kw">scale_color_manual</span>(</span>
<span id="cb40-12"><a href="structure.html#cb40-12"></a>        <span class="dt">values =</span> <span class="kw">color_values</span>(</span>
<span id="cb40-13"><a href="structure.html#cb40-13"></a>          <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(<span class="kw">unique</span>(<span class="kw">pull</span>(big_epa_cars, <span class="op">!!</span>color))), </span>
<span id="cb40-14"><a href="structure.html#cb40-14"></a>          <span class="dt">palette =</span> input<span class="op">$</span>palette</span>
<span id="cb40-15"><a href="structure.html#cb40-15"></a>        )</span>
<span id="cb40-16"><a href="structure.html#cb40-16"></a>      )</span>
<span id="cb40-17"><a href="structure.html#cb40-17"></a>  } </span>
<span id="cb40-18"><a href="structure.html#cb40-18"></a>}</span></code></pre></div>
<p>Then, the app server is:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="structure.html#cb41-1"></a>app_server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output,session) {</span>
<span id="cb41-2"><a href="structure.html#cb41-2"></a>  <span class="co">#callModule(mod_raw_server, &quot;raw_ui_1&quot;)</span></span>
<span id="cb41-3"><a href="structure.html#cb41-3"></a>  <span class="kw">callModule</span>(mod_dataviz_server, <span class="st">&quot;dataviz_ui_1&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;point&quot;</span>)</span>
<span id="cb41-4"><a href="structure.html#cb41-4"></a>  <span class="kw">callModule</span>(mod_dataviz_server, <span class="st">&quot;dataviz_ui_2&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;hist&quot;</span>)</span>
<span id="cb41-5"><a href="structure.html#cb41-5"></a>  <span class="kw">callModule</span>(mod_dataviz_server, <span class="st">&quot;dataviz_ui_3&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;boxplot&quot;</span>)</span>
<span id="cb41-6"><a href="structure.html#cb41-6"></a>  <span class="kw">callModule</span>(mod_dataviz_server, <span class="st">&quot;dataviz_ui_4&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;bar&quot;</span>)</span>
<span id="cb41-7"><a href="structure.html#cb41-7"></a>}</span></code></pre></div>
<p>And the UI:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="structure.html#cb42-1"></a>app_ui &lt;-<span class="st"> </span><span class="cf">function</span>() {</span>
<span id="cb42-2"><a href="structure.html#cb42-2"></a>  <span class="co"># [...]</span></span>
<span id="cb42-3"><a href="structure.html#cb42-3"></a>  <span class="kw">tagList</span>(</span>
<span id="cb42-4"><a href="structure.html#cb42-4"></a>    <span class="kw">fluidRow</span>(</span>
<span id="cb42-5"><a href="structure.html#cb42-5"></a>      <span class="dt">id =</span> <span class="st">&quot;geom_point&quot;</span>, <span class="kw">mod_dataviz_ui</span>(<span class="st">&quot;dataviz_ui_1&quot;</span>, <span class="st">&quot;point&quot;</span>)</span>
<span id="cb42-6"><a href="structure.html#cb42-6"></a>    ), </span>
<span id="cb42-7"><a href="structure.html#cb42-7"></a>    <span class="kw">fluidRow</span>(</span>
<span id="cb42-8"><a href="structure.html#cb42-8"></a>      <span class="dt">id =</span> <span class="st">&quot;geom_hist&quot;</span>, <span class="kw">mod_dataviz_ui</span>(<span class="st">&quot;dataviz_ui_2&quot;</span>, <span class="st">&quot;hist&quot;</span>)</span>
<span id="cb42-9"><a href="structure.html#cb42-9"></a>    )</span>
<span id="cb42-10"><a href="structure.html#cb42-10"></a>  )</span>
<span id="cb42-11"><a href="structure.html#cb42-11"></a>}</span></code></pre></div>
</div>
</div>
<div id="communication-between-modules" class="section level3">
<h3><span class="header-section-number">3.2.3</span> Communication between modules</h3>
<p>One of the hardest part about modules is sharing data across them.
There are at least two approaches: returning reactive, or the âstratÃ©gie du petit râ (to be pronounced with a french accent).</p>
<div id="returning-values-from-the-module" class="section level4">
<h4><span class="header-section-number">3.2.3.1</span> Returning values from the module</h4>
<p>One common approach is return a reactive from one module, and to pass it to another.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="structure.html#cb43-1"></a>name_ui &lt;-<span class="st"> </span><span class="cf">function</span>(id){</span>
<span id="cb43-2"><a href="structure.html#cb43-2"></a>  ns &lt;-<span class="st"> </span><span class="kw">NS</span>(id)</span>
<span id="cb43-3"><a href="structure.html#cb43-3"></a>  <span class="kw">tagList</span>(</span>
<span id="cb43-4"><a href="structure.html#cb43-4"></a>    <span class="kw">sliderInput</span>(<span class="kw">ns</span>(<span class="st">&quot;choice&quot;</span>), <span class="st">&quot;Choice&quot;</span>, <span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">5</span>)</span>
<span id="cb43-5"><a href="structure.html#cb43-5"></a>  )</span>
<span id="cb43-6"><a href="structure.html#cb43-6"></a>}</span>
<span id="cb43-7"><a href="structure.html#cb43-7"></a></span>
<span id="cb43-8"><a href="structure.html#cb43-8"></a>name_server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session){</span>
<span id="cb43-9"><a href="structure.html#cb43-9"></a>  ns &lt;-<span class="st"> </span>session<span class="op">$</span>ns</span>
<span id="cb43-10"><a href="structure.html#cb43-10"></a>  </span>
<span id="cb43-11"><a href="structure.html#cb43-11"></a>  <span class="kw">return</span>(</span>
<span id="cb43-12"><a href="structure.html#cb43-12"></a>    <span class="kw">reactive</span>({</span>
<span id="cb43-13"><a href="structure.html#cb43-13"></a>      input<span class="op">$</span>choice</span>
<span id="cb43-14"><a href="structure.html#cb43-14"></a>    })</span>
<span id="cb43-15"><a href="structure.html#cb43-15"></a>  )</span>
<span id="cb43-16"><a href="structure.html#cb43-16"></a>}</span>
<span id="cb43-17"><a href="structure.html#cb43-17"></a></span>
<span id="cb43-18"><a href="structure.html#cb43-18"></a>name_b_ui &lt;-<span class="st"> </span><span class="cf">function</span>(id){</span>
<span id="cb43-19"><a href="structure.html#cb43-19"></a>  ns &lt;-<span class="st"> </span><span class="kw">NS</span>(id)</span>
<span id="cb43-20"><a href="structure.html#cb43-20"></a>  <span class="kw">tagList</span>(</span>
<span id="cb43-21"><a href="structure.html#cb43-21"></a>    <span class="kw">actionButton</span>(<span class="kw">ns</span>(<span class="st">&quot;validate&quot;</span>), <span class="st">&quot;Print&quot;</span>)</span>
<span id="cb43-22"><a href="structure.html#cb43-22"></a>  )</span>
<span id="cb43-23"><a href="structure.html#cb43-23"></a>}</span>
<span id="cb43-24"><a href="structure.html#cb43-24"></a></span>
<span id="cb43-25"><a href="structure.html#cb43-25"></a>name_b_server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session, react){</span>
<span id="cb43-26"><a href="structure.html#cb43-26"></a>  ns &lt;-<span class="st"> </span>session<span class="op">$</span>ns</span>
<span id="cb43-27"><a href="structure.html#cb43-27"></a>  <span class="kw">observeEvent</span>( input<span class="op">$</span>validate , {</span>
<span id="cb43-28"><a href="structure.html#cb43-28"></a>    <span class="kw">print</span>(<span class="kw">react</span>())</span>
<span id="cb43-29"><a href="structure.html#cb43-29"></a>  })</span>
<span id="cb43-30"><a href="structure.html#cb43-30"></a>  </span>
<span id="cb43-31"><a href="structure.html#cb43-31"></a>}</span>
<span id="cb43-32"><a href="structure.html#cb43-32"></a></span>
<span id="cb43-33"><a href="structure.html#cb43-33"></a><span class="kw">library</span>(shiny)</span>
<span id="cb43-34"><a href="structure.html#cb43-34"></a>ui &lt;-<span class="st"> </span><span class="cf">function</span>(request){</span>
<span id="cb43-35"><a href="structure.html#cb43-35"></a>  <span class="kw">fluidPage</span>(</span>
<span id="cb43-36"><a href="structure.html#cb43-36"></a>    <span class="kw">name_ui</span>(<span class="st">&quot;name_ui_1&quot;</span>),</span>
<span id="cb43-37"><a href="structure.html#cb43-37"></a>    <span class="kw">name_b_ui</span>(<span class="st">&quot;name_ui_2&quot;</span>)</span>
<span id="cb43-38"><a href="structure.html#cb43-38"></a>  )</span>
<span id="cb43-39"><a href="structure.html#cb43-39"></a>}</span>
<span id="cb43-40"><a href="structure.html#cb43-40"></a></span>
<span id="cb43-41"><a href="structure.html#cb43-41"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(</span>
<span id="cb43-42"><a href="structure.html#cb43-42"></a>  input, </span>
<span id="cb43-43"><a href="structure.html#cb43-43"></a>  output, </span>
<span id="cb43-44"><a href="structure.html#cb43-44"></a>  session</span>
<span id="cb43-45"><a href="structure.html#cb43-45"></a>){</span>
<span id="cb43-46"><a href="structure.html#cb43-46"></a>  res &lt;-<span class="st"> </span><span class="kw">callModule</span>(name_server, <span class="st">&quot;name_ui_1&quot;</span>)</span>
<span id="cb43-47"><a href="structure.html#cb43-47"></a>  <span class="kw">callModule</span>(name_b_server, <span class="st">&quot;name_ui_2&quot;</span>, <span class="dt">react =</span> res)</span>
<span id="cb43-48"><a href="structure.html#cb43-48"></a>}</span>
<span id="cb43-49"><a href="structure.html#cb43-49"></a></span>
<span id="cb43-50"><a href="structure.html#cb43-50"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<p>That works well, but for large Shiny Apps it might be hard to handle large list of reactive outputs / inputs.
It might also create some reactivity issues, as they are harder to control.</p>
</div>
<div id="the-stratÃ©gie-du-petit-r" class="section level4">
<h4><span class="header-section-number">3.2.3.2</span> The âstratÃ©gie du petit râ</h4>
<p>With this strategy, instead of passing reactives as function input, weâll be creating a global reactive list which is passed along other modules.
The idea is that it allows us to be less preoccupied about what your module takes as input.
Here, we will be creating a âglobalâ <code>reactiveValues()</code> that we will pass downstream.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="structure.html#cb44-1"></a>name_ui &lt;-<span class="st"> </span><span class="cf">function</span>(id){</span>
<span id="cb44-2"><a href="structure.html#cb44-2"></a>  ns &lt;-<span class="st"> </span><span class="kw">NS</span>(id)</span>
<span id="cb44-3"><a href="structure.html#cb44-3"></a>  <span class="kw">tagList</span>(</span>
<span id="cb44-4"><a href="structure.html#cb44-4"></a>    <span class="kw">sliderInput</span>(<span class="kw">ns</span>(<span class="st">&quot;choice&quot;</span>), <span class="st">&quot;Choice&quot;</span>, <span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">5</span>)</span>
<span id="cb44-5"><a href="structure.html#cb44-5"></a>  )</span>
<span id="cb44-6"><a href="structure.html#cb44-6"></a>}</span>
<span id="cb44-7"><a href="structure.html#cb44-7"></a></span>
<span id="cb44-8"><a href="structure.html#cb44-8"></a>name_server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session, r){</span>
<span id="cb44-9"><a href="structure.html#cb44-9"></a>  ns &lt;-<span class="st"> </span>session<span class="op">$</span>ns</span>
<span id="cb44-10"><a href="structure.html#cb44-10"></a>  <span class="kw">observeEvent</span>( input<span class="op">$</span>choice , {</span>
<span id="cb44-11"><a href="structure.html#cb44-11"></a>    r<span class="op">$</span>choice &lt;-<span class="st"> </span>input<span class="op">$</span>choice</span>
<span id="cb44-12"><a href="structure.html#cb44-12"></a>  })</span>
<span id="cb44-13"><a href="structure.html#cb44-13"></a>  </span>
<span id="cb44-14"><a href="structure.html#cb44-14"></a>}</span>
<span id="cb44-15"><a href="structure.html#cb44-15"></a></span>
<span id="cb44-16"><a href="structure.html#cb44-16"></a>name_b_ui &lt;-<span class="st"> </span><span class="cf">function</span>(id){</span>
<span id="cb44-17"><a href="structure.html#cb44-17"></a>  ns &lt;-<span class="st"> </span><span class="kw">NS</span>(id)</span>
<span id="cb44-18"><a href="structure.html#cb44-18"></a>  <span class="kw">tagList</span>(</span>
<span id="cb44-19"><a href="structure.html#cb44-19"></a>    <span class="kw">actionButton</span>(<span class="kw">ns</span>(<span class="st">&quot;validate&quot;</span>), <span class="st">&quot;Print&quot;</span>)</span>
<span id="cb44-20"><a href="structure.html#cb44-20"></a>  )</span>
<span id="cb44-21"><a href="structure.html#cb44-21"></a>}</span>
<span id="cb44-22"><a href="structure.html#cb44-22"></a></span>
<span id="cb44-23"><a href="structure.html#cb44-23"></a>name_b_server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session, r){</span>
<span id="cb44-24"><a href="structure.html#cb44-24"></a>  ns &lt;-<span class="st"> </span>session<span class="op">$</span>ns</span>
<span id="cb44-25"><a href="structure.html#cb44-25"></a>  <span class="kw">observeEvent</span>( input<span class="op">$</span>validate , {</span>
<span id="cb44-26"><a href="structure.html#cb44-26"></a>    <span class="kw">print</span>(r<span class="op">$</span>choice)</span>
<span id="cb44-27"><a href="structure.html#cb44-27"></a>  })</span>
<span id="cb44-28"><a href="structure.html#cb44-28"></a>  </span>
<span id="cb44-29"><a href="structure.html#cb44-29"></a>}</span>
<span id="cb44-30"><a href="structure.html#cb44-30"></a></span>
<span id="cb44-31"><a href="structure.html#cb44-31"></a><span class="kw">library</span>(shiny)</span>
<span id="cb44-32"><a href="structure.html#cb44-32"></a>ui &lt;-<span class="st"> </span><span class="cf">function</span>(request){</span>
<span id="cb44-33"><a href="structure.html#cb44-33"></a>  <span class="kw">fluidPage</span>(</span>
<span id="cb44-34"><a href="structure.html#cb44-34"></a>    <span class="kw">name_ui</span>(<span class="st">&quot;name_ui_1&quot;</span>),</span>
<span id="cb44-35"><a href="structure.html#cb44-35"></a>    <span class="kw">name_b_ui</span>(<span class="st">&quot;name_ui_2&quot;</span>)</span>
<span id="cb44-36"><a href="structure.html#cb44-36"></a>  )</span>
<span id="cb44-37"><a href="structure.html#cb44-37"></a>}</span>
<span id="cb44-38"><a href="structure.html#cb44-38"></a></span>
<span id="cb44-39"><a href="structure.html#cb44-39"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(</span>
<span id="cb44-40"><a href="structure.html#cb44-40"></a>  input, </span>
<span id="cb44-41"><a href="structure.html#cb44-41"></a>  output, </span>
<span id="cb44-42"><a href="structure.html#cb44-42"></a>  session</span>
<span id="cb44-43"><a href="structure.html#cb44-43"></a>){</span>
<span id="cb44-44"><a href="structure.html#cb44-44"></a>  r &lt;-<span class="st"> </span><span class="kw">reactiveValues</span>()</span>
<span id="cb44-45"><a href="structure.html#cb44-45"></a>  <span class="kw">callModule</span>(name_server, <span class="st">&quot;name_ui_1&quot;</span>, r)</span>
<span id="cb44-46"><a href="structure.html#cb44-46"></a>  <span class="kw">callModule</span>(name_b_server, <span class="st">&quot;name_ui_2&quot;</span>, r)</span>
<span id="cb44-47"><a href="structure.html#cb44-47"></a>}</span>
<span id="cb44-48"><a href="structure.html#cb44-48"></a></span>
<span id="cb44-49"><a href="structure.html#cb44-49"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<p>The plus side of this method is that whenever youâre add something in one module, itâs immediately available in the other modules.
The down side is that it can be harder to reason about the app, as the input / content of the <code>r</code> is not specified anywhere: as you donât pass any arguments to your function other than <code>r</code>, you donât really know whatâs inside.</p>
<p>Also, not that if you want to share your module, for example in a package, you should document the structure of the <code>r</code>.
For example:</p>
<pre><code>#&#39; @param r a `reactiveValues()` with a `choice` element in it. This `r$choice` will be printed to the R console.</code></pre>
</div>
<div id="a-third-way" class="section level4">
<h4><span class="header-section-number">3.2.3.3</span> A third way</h4>
<p>There is another way to share data across modules, which is creating an R6 object which is then pass along the modules.
In the spirit, itâs more or less the same as passing the <code>r</code> list, except that it is not a reactive object, making it more robust to the complexity of handling reactivity invalidation across modules.</p>
<p>This methods is explain in the chapter <a href="optim-caveat.html#optim-caveat">Reactivity anti-patterns</a> of this book.</p>
</div>
<div id="when-should-you-modularize" class="section level4">
<h4><span class="header-section-number">3.2.3.4</span> When should you modularize?</h4>
<p>From the very beginning.
The overhead of writing a module compared to putting everything inside the app function is relatively low: itâs even simpler if you are working in a framework like <code>{golem}</code>, which promotes the use of modules from the very beginning of your application.</p>
<blockquote>
<p>"Yes but I just want to write a small app, nothing fancy</p>
</blockquote>
<p>Production apps almost always started as a small POC.
Then the small POC becomes an interesting idea.
Then this idea becomes a strategical asset.
And before you know it your ânot-that-fancyâ app needs to become larger</p>
</div>
</div>
</div>
<div id="structuring-your-app" class="section level2">
<h2><span class="header-section-number">3.3</span> Structuring your app</h2>
<div id="business-logic-application-logic" class="section level3">
<h3><span class="header-section-number">3.3.1</span> Business logic &amp; application logic</h3>
<p>If you think of the how your application is composed, there are two main things that make it run:</p>
<ul>
<li><p>Application logic, which are the things that make your Shiny app interactive: structure, buttons, table, interactivity, etc.
These application logic is not specific to your core business: you could use it for any other line of work.
Most of the time, these functions have no other use case than your interactive application: they are not meant to be used outside your app, and could work in a lot of other professional context.</p></li>
<li><p>Business logic, which are the core algorithms and functions that make your application specific to your area of work.
You can recognize these as they can be run outside any interactive context.
For example, if youâve been making specific computation and algorithm, if you have a custom plot or <code>geom</code> for <code>{ggplot2}</code>, if your doing specific calls to a database, etc.</p></li>
</ul>
<p>These two families of functions do not have to live together, and they shouldnât if you want to keep your sanity when youâll be building an appâyouâll end up having to rerun the app from scratch and spend 3 minutes clicking everywhere just to be sure youâve correctly set the color palette for the graph on the last <code>tabPanel()</code>.
Trust us, weâve been there, and itâs not pretty.</p>
<p>So whatâs the way to go?
Extract the business function from the reactive functions.
Literally.
Compare this pattern:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="structure.html#cb46-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb46-2"><a href="structure.html#cb46-2"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb46-3"><a href="structure.html#cb46-3"></a>ui &lt;-<span class="st"> </span><span class="cf">function</span>(request){</span>
<span id="cb46-4"><a href="structure.html#cb46-4"></a>  <span class="kw">tagList</span>(</span>
<span id="cb46-5"><a href="structure.html#cb46-5"></a>    <span class="kw">tableOutput</span>(<span class="st">&quot;tbl&quot;</span>)</span>
<span id="cb46-6"><a href="structure.html#cb46-6"></a>  )</span>
<span id="cb46-7"><a href="structure.html#cb46-7"></a>}</span>
<span id="cb46-8"><a href="structure.html#cb46-8"></a></span>
<span id="cb46-9"><a href="structure.html#cb46-9"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(</span>
<span id="cb46-10"><a href="structure.html#cb46-10"></a>  input, </span>
<span id="cb46-11"><a href="structure.html#cb46-11"></a>  output, </span>
<span id="cb46-12"><a href="structure.html#cb46-12"></a>  session</span>
<span id="cb46-13"><a href="structure.html#cb46-13"></a>){</span>
<span id="cb46-14"><a href="structure.html#cb46-14"></a>  output<span class="op">$</span>tbl &lt;-<span class="st"> </span><span class="kw">renderTable</span>({</span>
<span id="cb46-15"><a href="structure.html#cb46-15"></a>    mtcars <span class="op">%&gt;%</span></span>
<span id="cb46-16"><a href="structure.html#cb46-16"></a><span class="st">      </span><span class="co"># [...] %&gt;% </span></span>
<span id="cb46-17"><a href="structure.html#cb46-17"></a><span class="st">      </span><span class="co"># [...] %&gt;% </span></span>
<span id="cb46-18"><a href="structure.html#cb46-18"></a><span class="st">      </span><span class="co"># [...] %&gt;% </span></span>
<span id="cb46-19"><a href="structure.html#cb46-19"></a><span class="st">      </span><span class="co"># [...] %&gt;% </span></span>
<span id="cb46-20"><a href="structure.html#cb46-20"></a><span class="st">      </span><span class="co"># [...] %&gt;% </span></span>
<span id="cb46-21"><a href="structure.html#cb46-21"></a><span class="st">      </span><span class="kw">top_n</span>(<span class="dv">10</span>)</span>
<span id="cb46-22"><a href="structure.html#cb46-22"></a>  })</span>
<span id="cb46-23"><a href="structure.html#cb46-23"></a>}</span>
<span id="cb46-24"><a href="structure.html#cb46-24"></a></span>
<span id="cb46-25"><a href="structure.html#cb46-25"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<p>To this one:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="structure.html#cb47-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb47-2"><a href="structure.html#cb47-2"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb47-3"><a href="structure.html#cb47-3"></a>top_this &lt;-<span class="st"> </span><span class="cf">function</span>(tbl){</span>
<span id="cb47-4"><a href="structure.html#cb47-4"></a>  tbl <span class="op">%&gt;%</span></span>
<span id="cb47-5"><a href="structure.html#cb47-5"></a><span class="st">    </span><span class="co"># [...] %&gt;% </span></span>
<span id="cb47-6"><a href="structure.html#cb47-6"></a><span class="st">    </span><span class="co"># [...] %&gt;% </span></span>
<span id="cb47-7"><a href="structure.html#cb47-7"></a><span class="st">    </span><span class="co"># [...] %&gt;% </span></span>
<span id="cb47-8"><a href="structure.html#cb47-8"></a><span class="st">    </span><span class="co"># [...] %&gt;% </span></span>
<span id="cb47-9"><a href="structure.html#cb47-9"></a><span class="st">    </span><span class="kw">top_n</span>(<span class="dv">10</span>)</span>
<span id="cb47-10"><a href="structure.html#cb47-10"></a>}</span>
<span id="cb47-11"><a href="structure.html#cb47-11"></a></span>
<span id="cb47-12"><a href="structure.html#cb47-12"></a>ui &lt;-<span class="st"> </span><span class="cf">function</span>(request){</span>
<span id="cb47-13"><a href="structure.html#cb47-13"></a>  <span class="kw">tagList</span>(</span>
<span id="cb47-14"><a href="structure.html#cb47-14"></a>    <span class="kw">tableOutput</span>(<span class="st">&quot;tbl&quot;</span>)</span>
<span id="cb47-15"><a href="structure.html#cb47-15"></a>  )</span>
<span id="cb47-16"><a href="structure.html#cb47-16"></a>}</span>
<span id="cb47-17"><a href="structure.html#cb47-17"></a></span>
<span id="cb47-18"><a href="structure.html#cb47-18"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(</span>
<span id="cb47-19"><a href="structure.html#cb47-19"></a>  input, </span>
<span id="cb47-20"><a href="structure.html#cb47-20"></a>  output, </span>
<span id="cb47-21"><a href="structure.html#cb47-21"></a>  session</span>
<span id="cb47-22"><a href="structure.html#cb47-22"></a>){</span>
<span id="cb47-23"><a href="structure.html#cb47-23"></a>  output<span class="op">$</span>tbl &lt;-<span class="st"> </span><span class="kw">renderTable</span>({</span>
<span id="cb47-24"><a href="structure.html#cb47-24"></a>    <span class="kw">top_this</span>(mtcars)</span>
<span id="cb47-25"><a href="structure.html#cb47-25"></a>  })</span>
<span id="cb47-26"><a href="structure.html#cb47-26"></a>}</span>
<span id="cb47-27"><a href="structure.html#cb47-27"></a></span>
<span id="cb47-28"><a href="structure.html#cb47-28"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<p>They both do the exact same thing.
The difference being that the first can be easily explored without having to relaunch the app.
It also can be tested, documented, and reused outside the app.
And the other benefit youâll get from that approach is that it lower the cognitive load when debugging: you are either debugging an application issue, or a business logic issue, but never debugging both of them at the same time.
So put them in a separate file, so that youâll be able to work and test them without having to relaunch your whole app for the 300th time of the day.
And if you want to be even more strict about this, you can write a package for these functions, so that they are neatly separated from the package containing the Shiny application.</p>
</div>
<div id="small-is-beautiful-bis-repetita" class="section level3">
<h3><span class="header-section-number">3.3.2</span> Small is beautiful (bis repetita)</h3>
<p>There is nothing harder to maintain than a Shiny app which is only made of one 1000 lines long <code>app.R</code>.
Well, there still is the 10 000 lines long <code>app.R</code>, but youâve got the idea.
Long scripts are almost always synonym of complexity when it comes to building an application.
Of course, small and numerous scripts donât systematically prevent from codebase complexity but they simplify collaboration and maintenance, and of course divide the application logic into smaller, easier to understand bits of code.</p>
<p>So yes, big files are complex to handle and make development harder.
Indeed, here is what happens when youâre working on a production application:</p>
<ul>
<li><p>Youâll be working during a long period of time (either in one run or split across several months) on your codebase, meaning that youâll have to get back to pieces of code you have written a long time ago.</p></li>
<li><p>Youâll possibly be developing with others.
Maintaining a code base when several persons are working on the files is already a complex thing: from time to time you might be working on the same file separately, a situation where youâll have to be careful about what and how you merge things when changes are implemented.
Of course, itâs almost impossible to work on one same file all along the project without losing your mind: even more if this file is thousands of lines long.</p></li>
<li><p>Youâll be implementing numerous features.
Numerous features imply a lot of UI &amp; server interaction.
And in an <code>app.R</code> file of thousands of line, itâs very hard to match the UI element with its server counterpart: when the UI is on line 50 and the server on line 570, youâll be scrolling a lot when working on that element.</p></li>
</ul>
<p>So yes, there are a lot of reasons for splitting your application into smaller pieces: itâs easier to maintain, easier to decipher, and of course it facilitates collaboration.</p>
</div>
<div id="conventions-matter" class="section level3">
<h3><span class="header-section-number">3.3.3</span> Conventions matter</h3>
<p>So, now that weâve talk about the benefits of splitting files, letâs think about how to do that.
Splitting files is good, splitting files using a defined convention is better.
Why?
Because using a common convention for your files helps the other developers (and potentially you) to know exactly what is contained in a specific file, and that way it helps everybody know where to look for debugging / implementing new features.
For example, if you follow <code>{golem}</code>âs convention, youâll know that a file starting with <code>mod_</code> contains a module, so if I take over a project, look in the <code>R/</code> folder and see files starting with these three letters, Iâll know immediately what these files contain.</p>
<p>Thatâs what weâll see in this part: a proposition for a convention on how to split your application into smaller pieces.</p>
<p>First of all, put everything into an <code>R/</code> folder.
If youâre building your app using the <code>{golem}</code> framework, this is already what youâre doing: using this package convention to hold the functions for your application.</p>
<p>Once youâve got this, here is the <code>{golem}</code>-specific convention for organizing your files:</p>
<ul>
<li><p><code>app_*.R</code> (typically <code>app_ui.R</code> and <code>app_server.R</code>) should contain the top level functions which are used to defined your user interface and your server function.</p></li>
<li><p><code>fct_*</code> are files that contains business logic, potentially large functions.
They are the backbone of the app but are potentially not specific to a given module.
They can be added in <code>{golem}</code> with the <code>add_fct("name")</code> function.</p></li>
<li><p><code>mod_*</code> are files that contain ONE module.
As many shiny apps contains a series of tabs, or at least a tab-like pattern, we suggest that you number then according to their step in the application.
And as tabs are almost always named, you can use the tab-name as the file name.
For example, if youâre building a dashboard and the first tab is called âImportâ, your should name your file <code>mod_01_import.R</code>, which you can create with <code>golem::add_module("01_import")</code>.
Note that when building a module file with <code>{golem}</code>, you can add a <code>fct_</code> and <code>utils_</code> specific file, that will hold functions and utilities for this specific modules.
For example, <code>golem::add_module("01_import", fct = "readr", utils = "ui")</code> will create <code>R/mod_01_import.R</code>, <code>R/mod_01_import_fct_readr.R</code> and <code>R/mod_01_import_utils_ui.R</code>.</p></li>
<li><p><code>utils_*</code> are files that contain utilities, which are small helper functions.
For example, you might want to have a <code>not_na</code>, which is <code>not_na &lt;- Negate(is.na)</code>, a <code>not_null</code>, or small tools that youâll be using application-wide.
Note that you can also create <code>utils</code> for a specific module.</p></li>
<li><p><code>*_ui_*</code>, for example <code>utils_ui.R</code>, relates to the user interface. Anything back-end can be noted using <code>*_server_*</code>, for example <code>fct_connection_server.R</code> will contain functions that are related to the connection to a database, and which are specifically used from the server side.</p></li>
</ul>
<p>Of course, as with any convention, you might be deviating from time to time from this pattern.
Your app may not have that many functions, or maybe the functions can all fit into one <code>utils_</code> file.
But be it one or thousands of file, itâs always a good practice to stick to a formalized pattern.</p>

</div>
</div>
</div>
<hr/>
<footer>
<a href="rtask.thinkr.fr"><img src="img/logo400_129.png" alt="ThinkR Website"/></a>
</footer>
            </section>

          </div>
        </div>
      </div>
<a href="planning.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="golem.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/ThinkR-open/building-shiny-apps-workflow/edit/master/structure.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>

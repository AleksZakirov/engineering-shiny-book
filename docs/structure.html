<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Chapter 9 Structuring your App Project | Building Big Shiny Apps - A Workflow</title>
  <meta name="description" content="Chapter 9 Structuring your App Project | Building Big Shiny Apps - A Workflow">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="Chapter 9 Structuring your App Project | Building Big Shiny Apps - A Workflow" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Chapter 9 Structuring your App Project | Building Big Shiny Apps - A Workflow" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 9 Structuring your App Project | Building Big Shiny Apps - A Workflow" />
  
  <meta name="twitter:description" content="Chapter 9 Structuring your App Project | Building Big Shiny Apps - A Workflow" />
  

<meta name="author" content="Colin Fay">


<meta name="date" content="2019-05-21">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="step-deploy.html">
<link rel="next" href="golem.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Building Big Shiny Apps - A Workflow</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Disclaimer</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#motivation"><i class="fa fa-check"></i><b>1.1</b> Motivation</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#book-structure"><i class="fa fa-check"></i><b>1.2</b> Book structure</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#wanna-help"><i class="fa fa-check"></i><b>1.3</b> Wanna help?</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#other-resources"><i class="fa fa-check"></i><b>1.4</b> Other resources</a><ul>
<li class="chapter" data-level="1.4.1" data-path="index.html"><a href="index.html#getting-started-with-shiny"><i class="fa fa-check"></i><b>1.4.1</b> Getting started with Shiny</a></li>
<li class="chapter" data-level="1.4.2" data-path="index.html"><a href="index.html#shiny-into-production"><i class="fa fa-check"></i><b>1.4.2</b> Shiny into production</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>I Building Shiny Apps</b></span></li>
<li class="chapter" data-level="2" data-path="bigshinyapp.html"><a href="bigshinyapp.html"><i class="fa fa-check"></i><b>2</b> About Big Shiny Apps</a><ul>
<li class="chapter" data-level="2.1" data-path="bigshinyapp.html"><a href="bigshinyapp.html#whats-a-big-shiny-app"><i class="fa fa-check"></i><b>2.1</b> What’s a big Shiny App?</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="challenges.html"><a href="challenges.html"><i class="fa fa-check"></i><b>3</b> Challenges</a><ul>
<li class="chapter" data-level="3.1" data-path="challenges.html"><a href="challenges.html#designing-the-ui"><i class="fa fa-check"></i><b>3.1</b> Designing the UI</a></li>
<li class="chapter" data-level="3.2" data-path="challenges.html"><a href="challenges.html#working-as-a-team"><i class="fa fa-check"></i><b>3.2</b> Working as a team</a><ul>
<li class="chapter" data-level="3.2.1" data-path="challenges.html"><a href="challenges.html#from-the-tools-point-of-view"><i class="fa fa-check"></i><b>3.2.1</b> From the tools point of view:</a></li>
<li class="chapter" data-level="3.2.2" data-path="challenges.html"><a href="challenges.html#from-the-organisational-point-of-view"><i class="fa fa-check"></i><b>3.2.2</b> From the organisational point of view</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="challenges.html"><a href="challenges.html#making-the-app-production-ready"><i class="fa fa-check"></i><b>3.3</b> Making the app production ready</a><ul>
<li class="chapter" data-level="3.3.1" data-path="challenges.html"><a href="challenges.html#scaling"><i class="fa fa-check"></i><b>3.3.1</b> Scaling</a></li>
<li class="chapter" data-level="3.3.2" data-path="challenges.html"><a href="challenges.html#maintaining"><i class="fa fa-check"></i><b>3.3.2</b> Maintaining</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Step by Step</b></span></li>
<li class="chapter" data-level="4" data-path="step-design.html"><a href="step-design.html"><i class="fa fa-check"></i><b>4</b> Step 1: Designing</a></li>
<li class="chapter" data-level="5" data-path="step-protopype.html"><a href="step-protopype.html"><i class="fa fa-check"></i><b>5</b> Step 2: Prototype</a></li>
<li class="chapter" data-level="6" data-path="step-build.html"><a href="step-build.html"><i class="fa fa-check"></i><b>6</b> Step 3: Build</a></li>
<li class="chapter" data-level="7" data-path="step-secure.html"><a href="step-secure.html"><i class="fa fa-check"></i><b>7</b> Step 4: Secure</a></li>
<li class="chapter" data-level="8" data-path="step-deploy.html"><a href="step-deploy.html"><i class="fa fa-check"></i><b>8</b> Step 5: Deploy</a></li>
<li class="part"><span><b>III Tools</b></span></li>
<li class="chapter" data-level="9" data-path="structure.html"><a href="structure.html"><i class="fa fa-check"></i><b>9</b> Structuring your App Project</a><ul>
<li class="chapter" data-level="9.1" data-path="structure.html"><a href="structure.html#shiny-app-as-a-package"><i class="fa fa-check"></i><b>9.1</b> Shiny App as a Package</a><ul>
<li class="chapter" data-level="9.1.1" data-path="structure.html"><a href="structure.html#whats-in-a-shiny-app"><i class="fa fa-check"></i><b>9.1.1</b> What’s in a Shiny App?</a></li>
<li class="chapter" data-level="9.1.2" data-path="structure.html"><a href="structure.html#the-other-plus-side-of-shiny-as-a-package"><i class="fa fa-check"></i><b>9.1.2</b> The other plus side of Shiny as a Package</a></li>
<li class="chapter" data-level="9.1.3" data-path="structure.html"><a href="structure.html#deploy"><i class="fa fa-check"></i><b>9.1.3</b> Deploy</a></li>
<li class="chapter" data-level="9.1.4" data-path="structure.html"><a href="structure.html#resources"><i class="fa fa-check"></i><b>9.1.4</b> Resources</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="structure.html"><a href="structure.html#understanding-golem-package-structure"><i class="fa fa-check"></i><b>9.2</b> Understanding <code>{golem}</code> package structure</a></li>
<li class="chapter" data-level="9.3" data-path="structure.html"><a href="structure.html#using-shiny-modules"><i class="fa fa-check"></i><b>9.3</b> Using Shiny Modules</a></li>
<li class="chapter" data-level="9.4" data-path="structure.html"><a href="structure.html#splitting-your-app-into-files"><i class="fa fa-check"></i><b>9.4</b> Splitting your app into files</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="golem.html"><a href="golem.html"><i class="fa fa-check"></i><b>10</b> Using Golem</a><ul>
<li class="chapter" data-level="10.1" data-path="golem.html"><a href="golem.html#getting-started-with-golem"><i class="fa fa-check"></i><b>10.1</b> Getting started with <code>{golem}</code></a><ul>
<li class="chapter" data-level="10.1.1" data-path="golem.html"><a href="golem.html#create-a-package"><i class="fa fa-check"></i><b>10.1.1</b> Create a package</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="golem.html"><a href="golem.html#dev01_start.r"><i class="fa fa-check"></i><b>10.2</b> <code>dev/01_start.R</code></a><ul>
<li class="chapter" data-level="10.2.1" data-path="golem.html"><a href="golem.html#fill-the-desc"><i class="fa fa-check"></i><b>10.2.1</b> Fill the DESC</a></li>
<li class="chapter" data-level="10.2.2" data-path="golem.html"><a href="golem.html#set-common-files"><i class="fa fa-check"></i><b>10.2.2</b> Set common Files</a></li>
<li class="chapter" data-level="10.2.3" data-path="golem.html"><a href="golem.html#add-a-data-raw-folder"><i class="fa fa-check"></i><b>10.2.3</b> Add a data-raw folder</a></li>
<li class="chapter" data-level="10.2.4" data-path="golem.html"><a href="golem.html#init-tests"><i class="fa fa-check"></i><b>10.2.4</b> Init Tests</a></li>
<li class="chapter" data-level="10.2.5" data-path="golem.html"><a href="golem.html#use-recommended-package"><i class="fa fa-check"></i><b>10.2.5</b> Use Recommended Package</a></li>
<li class="chapter" data-level="10.2.6" data-path="golem.html"><a href="golem.html#add-various-tools"><i class="fa fa-check"></i><b>10.2.6</b> Add various tools</a></li>
<li class="chapter" data-level="10.2.7" data-path="golem.html"><a href="golem.html#if-you-want-to-change-the-default-favicon"><i class="fa fa-check"></i><b>10.2.7</b> If you want to change the default favicon</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="golem.html"><a href="golem.html#day-to-day-dev-with-golem"><i class="fa fa-check"></i><b>10.3</b> Day to Day Dev with <code>{golem}</code></a></li>
<li class="chapter" data-level="10.4" data-path="golem.html"><a href="golem.html#launching-the-app"><i class="fa fa-check"></i><b>10.4</b> Launching the app</a></li>
<li class="chapter" data-level="10.5" data-path="golem.html"><a href="golem.html#dev02_dev.r"><i class="fa fa-check"></i><b>10.5</b> <code>dev/02_dev.R</code></a><ul>
<li class="chapter" data-level="10.5.1" data-path="golem.html"><a href="golem.html#add-modules"><i class="fa fa-check"></i><b>10.5.1</b> Add modules</a></li>
<li class="chapter" data-level="10.5.2" data-path="golem.html"><a href="golem.html#add-dependencies"><i class="fa fa-check"></i><b>10.5.2</b> Add dependencies</a></li>
<li class="chapter" data-level="10.5.3" data-path="golem.html"><a href="golem.html#add-tests"><i class="fa fa-check"></i><b>10.5.3</b> Add tests</a></li>
<li class="chapter" data-level="10.5.4" data-path="golem.html"><a href="golem.html#add-a-browser-button"><i class="fa fa-check"></i><b>10.5.4</b> Add a browser button</a></li>
<li class="chapter" data-level="10.5.5" data-path="golem.html"><a href="golem.html#add-external-files"><i class="fa fa-check"></i><b>10.5.5</b> Add external files</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="golem.html"><a href="golem.html#adding-these-external-resources-to-your-app"><i class="fa fa-check"></i><b>10.6</b> Adding these external resources to your app</a></li>
<li class="chapter" data-level="10.7" data-path="golem.html"><a href="golem.html#documentation"><i class="fa fa-check"></i><b>10.7</b> Documentation</a><ul>
<li class="chapter" data-level="10.7.1" data-path="golem.html"><a href="golem.html#vignette"><i class="fa fa-check"></i><b>10.7.1</b> Vignette</a></li>
<li class="chapter" data-level="10.7.2" data-path="golem.html"><a href="golem.html#code-coverage"><i class="fa fa-check"></i><b>10.7.2</b> Code coverage</a></li>
</ul></li>
<li class="chapter" data-level="10.8" data-path="golem.html"><a href="golem.html#using-golem-dev-functions"><i class="fa fa-check"></i><b>10.8</b> Using <code>{golem}</code> dev functions</a></li>
<li class="chapter" data-level="10.9" data-path="golem.html"><a href="golem.html#deploying-apps-with-golem"><i class="fa fa-check"></i><b>10.9</b> Deploying Apps with <code>{golem}</code></a><ul>
<li class="chapter" data-level="10.9.1" data-path="golem.html"><a href="golem.html#rstudio-connect"><i class="fa fa-check"></i><b>10.9.1</b> RStudio Connect</a></li>
<li class="chapter" data-level="10.9.2" data-path="golem.html"><a href="golem.html#docker"><i class="fa fa-check"></i><b>10.9.2</b> Docker</a></li>
</ul></li>
<li class="chapter" data-level="10.10" data-path="golem.html"><a href="golem.html#using-golem-js-functions"><i class="fa fa-check"></i><b>10.10</b> Using <code>{golem}</code> js functions</a><ul>
<li class="chapter" data-level="10.10.1" data-path="golem.html"><a href="golem.html#golemjs"><i class="fa fa-check"></i><b>10.10.1</b> <code>golem::js()</code></a></li>
<li class="chapter" data-level="10.10.2" data-path="golem.html"><a href="golem.html#about-jquery-selectors"><i class="fa fa-check"></i><b>10.10.2</b> About jQuery selectors</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="proto.html"><a href="proto.html"><i class="fa fa-check"></i><b>11</b> Prototyping</a><ul>
<li class="chapter" data-level="11.1" data-path="proto.html"><a href="proto.html#shinipsum"><i class="fa fa-check"></i><b>11.1</b> {shinipsum}</a></li>
<li class="chapter" data-level="11.2" data-path="proto.html"><a href="proto.html#fakir"><i class="fa fa-check"></i><b>11.2</b> {fakir}</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="tooling.html"><a href="tooling.html"><i class="fa fa-check"></i><b>12</b> Other tools</a><ul>
<li class="chapter" data-level="12.1" data-path="tooling.html"><a href="tooling.html#package"><i class="fa fa-check"></i><b>12.1</b> Package</a></li>
<li class="chapter" data-level="12.2" data-path="tooling.html"><a href="tooling.html#git"><i class="fa fa-check"></i><b>12.2</b> Git</a></li>
<li class="chapter" data-level="12.3" data-path="tooling.html"><a href="tooling.html#shiny-modules"><i class="fa fa-check"></i><b>12.3</b> Shiny modules</a></li>
<li class="chapter" data-level="12.4" data-path="tooling.html"><a href="tooling.html#ci-and-testing"><i class="fa fa-check"></i><b>12.4</b> CI and testing</a></li>
</ul></li>
<li class="part"><span><b>IV Optimizing</b></span></li>
<li class="chapter" data-level="13" data-path="optim-caveat.html"><a href="optim-caveat.html"><i class="fa fa-check"></i><b>13</b> Common Application Caveats</a></li>
<li class="chapter" data-level="14" data-path="optim-r.html"><a href="optim-r.html"><i class="fa fa-check"></i><b>14</b> Optimizing Shiny Code</a></li>
<li class="chapter" data-level="15" data-path="optim-js.html"><a href="optim-js.html"><i class="fa fa-check"></i><b>15</b> Using JavaSript</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Building Big Shiny Apps - A Workflow</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="structure" class="section level1">
<h1><span class="header-section-number">Chapter 9</span> Structuring your App Project</h1>
<div id="shiny-app-as-a-package" class="section level2">
<h2><span class="header-section-number">9.1</span> Shiny App as a Package</h2>
<p>In the next chapter you’ll be introduced to the <code>{golem}</code> package, which is <strong>an opinionated framework for building production-ready Shiny Applications</strong>. This framework starts by creating a package skeleton waiting to be filled.</p>
<p>But, in a world where Shiny Applications are mostly created as a series of files, why bother with a package?</p>
<div id="whats-in-a-shiny-app" class="section level3">
<h3><span class="header-section-number">9.1.1</span> What’s in a Shiny App?</h3>
<p>OK, so let’s ask the question the other way round. Think about your last Shiny which was created as a single-file (<code>app.R</code>) or two files app (<code>ui.R</code> and <code>server.R</code>). You’ve got these two, and you put them into a folder.</p>
<p>So, let’s have a review of <strong>what you’ll need next for a robust application</strong>.</p>
<p>First, <strong>metadata.</strong> In other words, the name of the app, the version number (which is crucial to any serious, production-level project), what the application does, who to contact if something goes wrong.</p>
<p>Then, you need to find a way to <strong>handle the dependencies</strong>. Because you know, when you want to push your app into production, you can’t have this conversation with IT:</p>
<blockquote>
<p>IT: Hey, I tried to ‘source(“app.R”)’ but I’ve got an error.</p>
<p>R-dev: What’s the error?</p>
<p>IT: It says “could not find package ‘shiny’”.</p>
<p>R-dev: Ah yes, you need to install {shiny}. Try to run ‘install.packages(“shiny”)’.</p>
<p>IT: Ok nice. What else?</p>
<p>R-dev: Let me think, try also ‘install.packages(“DT”)’… good? Now try ‘install.packages(“ggplot2”)’, and …</p>
<p>[…]</p>
<p>IT: Ok, now I source the ‘app.R’, right?</p>
<p>R-dev: Sure!</p>
<p>IT: Ok so it says ‘could not find function runApp()’</p>
<p>R-dev: Ah, you’ve got to do library(shiny) at the beginning of your script. And library(purrr), and library(jsonlite)*.</p>
</blockquote>
<p><code>*</code> Which will lead to a Namespace conflict on the <code>flatten()</code> function that can cause you some debugging headache. So, hey, it would be cool if we could have a Shiny app that only imports specific functions from a package, right?</p>
<p><strong>So yes, dependencies matter. You need to handle them, and handle them correctly. </strong></p>
<p>Now, let’s say you’re building a big app. Something with thousands of lines of code. Handling a one-file or two-file shiny app with that much lines is just a nightmare. So, what to do? Let’s split everything into smaller files that we can call!</p>
<p>And finally, we want our app to live long and prosper, which means we need to document it: <strong>each small pieces of code should have a piece of comment</strong> to explain what these specific lines do. The other thing we need for our application to be successful on the long term is tests, so that we are sure we’re not introducing any regression.</p>
<p>Oh, and that would be nice if people can get a <code>tar.gz</code> and install it on their computer and have access to a local copy of the app!</p>
<p>OK, so let’s sum up: we want to build an app. This app needs to have <strong>metadata</strong> and to handle <strong>dependencies</strong> corrrecly, which is what you get from the <code>DESCRIPTION</code> + <code>NAMESPACE</code> files of the package. Even more practical is the fact that you can do “selective namespace extraction” inside a package, i.e you can say “I want this function from this package”. Also, <strong>this app needs to be split up in smaller <code>.R</code> files</strong>, which is the way a package is organized. And I don’t need to emphasize how <strong>documentation</strong> is a vital part of any package, so we solved this question too here. So is the <strong>testing toolkit</strong>. And of course, the “install everywhere” wish comes to life when a Shiny App is in a package.</p>
</div>
<div id="the-other-plus-side-of-shiny-as-a-package" class="section level3">
<h3><span class="header-section-number">9.1.2</span> The other plus side of Shiny as a Package</h3>
<div id="testing" class="section level4">
<h4><span class="header-section-number">9.1.2.1</span> Testing</h4>
<p><strong>Nothing should go to production without being tested. Nothing.</strong> Testing production apps is a wide question, and I’ll just stick to tests inside a Package here.</p>
<p>Frameworks for package testing are robust and widely documented. So you don’t have to put any extra-effort here: just use a canonical testing framework like <a href="https://testthat.r-lib.org/"><code>{testthat}</code></a>. Learning how to use it is not the subject of this chapter, so feel free to refer to the documentation. See also Chapter 5 of <a href="https://speakerdeck.com/colinfay/building-a-package-that-lasts-erum-2018-workshop?slide=107">“Building a package that lasts”</a>.</p>
<p>What should you test?</p>
<ul>
<li><p>First of all, as we’ve said before, the app should be split between the UI part and the backend (or ‘business logic’) part. These backend functions are supposed to run without any interactive context, just as plain old functions. So for these ones, <strong>you can do classical tests</strong>. As they are backend functions (so specific to a project), <code>{golem}</code> can’t provide any helpers for that.</p></li>
<li><p>For the UI part, <strong>remember that any UI function is designed to render an HTML element</strong>. So you can save a file as HTML, and then compare it to a UI object with the <code>golem::expect_html_equal()</code>.</p></li>
</ul>
<pre><code>library(shiny)
ui &lt;- tagList(h1(&quot;Hello world!&quot;))
htmltools::save_html(ui, &quot;ui.html&quot;)
golem::expect_html_equal(ui, &quot;ui.html&quot;)
# Changes 
ui &lt;- tagList(h2(&quot;Hello world!&quot;))
golem::expect_html_equal(ui, &quot;ui.html&quot;)</code></pre>
<p>This can for example be useful if you need to test a module. A UI module function returns an HTML tag list, so once your modules are set you can save them and use them inside tests.</p>
<pre><code>my_mod_ui &lt;- function(id){
  ns &lt;- NS(&quot;id&quot;)
  tagList(
    selectInput(ns(&quot;this&quot;), &quot;that&quot;, choices = LETTERS[1:4])
  )
}
my_mod_ui_test &lt;- tempfile(fileext = &quot;html&quot;)
htmltools::save_html(my_mod_ui(&quot;test&quot;), my_mod_ui_test)
# Some time later, and of course saved in the test folder, 
# not as a temp file
golem::expect_html_equal(my_mod_ui(&quot;test&quot;), my_mod_ui_test)</code></pre>
<p><code>{golem}</code> also provides two functions, <code>expect_shinytag()</code> and <code>expect_shinytaglist()</code>, that test if an objet is of class <code>&quot;shiny.tag&quot;</code> or <code>&quot;shiny.tag.list&quot;</code>.</p>
<ul>
<li>Testing package launch: when launching <code>golem::use_recommended_tests()</code>, you’ll find a test built on top of <code>{processx}</code> that allows to check if the application is launch-able. Here’s a short description of what happens:</li>
</ul>
<pre><code># Standard testthat things
context(&quot;launch&quot;)

library(processx)

testthat::test_that(
  &quot;app launches&quot;,{
    # We&#39;re creating a new process that runs the app
    x &lt;- process$new(
      &quot;R&quot;, 
      c(
        &quot;-e&quot;, 
        # As we are in the tests/testthat dir, we&#39;re moving 
        # two steps back before launching the whole package
        # and we try to launch the app
        &quot;setwd(&#39;../../&#39;); pkgload::load_all();run_app()&quot;
      )
    )
    # We leave some time for the app to launch
    # Configure this according to your need
    Sys.sleep(5)
    # We check that the app is alive
    expect_true(x$is_alive())
    # We kill it
    x$kill()
  }
)</code></pre>
<p><em>Note</em>: this specific configuration will possibly fail on Continuous integration platform as Gitlab CI or Travis. A workaround is to, inside your CI yml, first install the package with <code>remotes::install_local()</code>, and then replace the <code>setwd (...) run_app()</code> command with <code>myuberapp::run_app()</code>.</p>
<p>For example:</p>
<ul>
<li>in <code>.gitlab-ci.yml</code>:</li>
</ul>
<pre><code>test:
  stage: test
  script: 
  - echo &quot;Running tests&quot;
  - R -e &#39;remotes::install_local()&#39;
  - R -e &#39;devtools::check()&#39;</code></pre>
<ul>
<li>in <code>test-golem.R</code>:</li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r">testthat<span class="op">::</span><span class="kw">test_that</span>(
  <span class="st">&quot;app launches&quot;</span>,{
    x &lt;-<span class="st"> </span>process<span class="op">$</span><span class="kw">new</span>( 
      <span class="st">&quot;R&quot;</span>, 
      <span class="kw">c</span>(
        <span class="st">&quot;-e&quot;</span>, 
        <span class="st">&quot;datuberapp::run_app()&quot;</span>
      )
    )
    <span class="kw">Sys.sleep</span>(<span class="dv">5</span>)
    <span class="kw">expect_true</span>(x<span class="op">$</span><span class="kw">is_alive</span>())
    x<span class="op">$</span><span class="kw">kill</span>()
  }
)</code></pre>
</div>
<div id="documenting" class="section level4">
<h4><span class="header-section-number">9.1.2.2</span> Documenting</h4>
<p>Documenting packages is a natural thing for any R developer. Any exported function should have its own documentation, hence you are “forced” to document any user facing-function.</p>
<p>Also, building a Shiny App as a package allows you to write standard R documentation:</p>
<ul>
<li>A <code>README</code> at the root of your package</li>
<li><code>Vignettes</code> that explain how to use your app</li>
<li>A <code>{pkgdown}</code> that can be used as an external link for your application.</li>
</ul>
</div>
</div>
<div id="deploy" class="section level3">
<h3><span class="header-section-number">9.1.3</span> Deploy</h3>
<div id="local-deployment" class="section level4">
<h4><span class="header-section-number">9.1.3.1</span> Local deployment</h4>
<p>As your Shiny App is a standard package, it can be built as a <code>tar.gz</code>, sent to your colleagues, friends, and family, and even to the CRAN. It can also be installed in any R-package repository. Then, if you’ve built your app with <code>{golem}</code>, you’ll just have to do:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(myuberapp)
<span class="kw">run_app</span>()</code></pre>
<p>to launch your app.</p>
</div>
<div id="rstudio-connect-shiny-server" class="section level4">
<h4><span class="header-section-number">9.1.3.2</span> RStudio Connect &amp; Shiny Server</h4>
<p>Both these platforms expect a file app configuration, i.e an <code>app.R</code> file or <code>ui.R</code> / <code>server.R</code> files. So how can we integrate this “Shiny App as Package” into Connect or Shiny Server?</p>
<ul>
<li><p>Using an internal package manager like <a href="https://www.rstudio.com/products/package-manager/">RStudio Package Manager</a>, where the package app is installed, and then you simply have to create an <code>app.R</code> with the small piece of code from the section just before.</p></li>
<li><p>Uploading the package package folder to the server. In that scenario, you use the package folder as the app package, and upload the whole thing. Then, write an <code>app.R</code> that does:</p></li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r">pkgload<span class="op">::</span><span class="kw">load_all</span>()
shiny<span class="op">::</span><span class="kw">shinyApp</span>(<span class="dt">ui =</span> <span class="kw">app_ui</span>(), <span class="dt">server =</span> app_server)</code></pre>
<p>And of course, don’t forget to add this file in the <code>.Rbuildignore</code>!</p>
<p>This is the file you’ll get if your run <code>golem::add_rconnect_file()</code>.</p>
</div>
<div id="docker-containers" class="section level4">
<h4><span class="header-section-number">9.1.3.3</span> Docker containers</h4>
<p>In order to dockerize your app, simply install the package as any other package, and use as a <code>CMD</code> <code>R -e 'options(&quot;shiny.port&quot;=80,shiny.host=&quot;0.0.0.0&quot;);myuberapp::run_app()'</code>. Of course changing the port to the one you need.</p>
<p>You’ll get the Dockerfile you need with <code>golem::add_dockerfile()</code>.</p>
</div>
</div>
<div id="resources" class="section level3">
<h3><span class="header-section-number">9.1.4</span> Resources</h3>
<ul>
<li><p><a href="http://r-pkgs.had.co.nz/">R packages</a></p></li>
<li><p><a href="https://speakerdeck.com/colinfay/building-a-package-that-lasts-erum-2018-workshop">“Building a package that lasts”</a></p></li>
<li><p><a href="https://cran.r-project.org/doc/manuals/r-release/R-exts.html#Creating-R-packages">Writing R Extensions</a></p></li>
<li><p><a href="https://kbroman.org/pkg_primer/">R package primer - a minimal tutorial</a></p></li>
</ul>
</div>
</div>
<div id="understanding-golem-package-structure" class="section level2">
<h2><span class="header-section-number">9.2</span> Understanding <code>{golem}</code> package structure</h2>
<p>// TODO</p>
</div>
<div id="using-shiny-modules" class="section level2">
<h2><span class="header-section-number">9.3</span> Using Shiny Modules</h2>
<p>// TODO</p>
</div>
<div id="splitting-your-app-into-files" class="section level2">
<h2><span class="header-section-number">9.4</span> Splitting your app into files</h2>
<p>// TODO</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="step-deploy.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="golem.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>

<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 16 Optimizing {shiny} Code | Engineering Production-Grade Shiny Apps</title>
  <meta name="description" content="A book about engineering shiny application that will later be sent to production. This book cover project management, structuring your project, building a solid testing suite, and optimizing your codebase. We describe in this book a specific workflow: design, prototype, build, strengthen and deploy." />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 16 Optimizing {shiny} Code | Engineering Production-Grade Shiny Apps" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="https://raw.githubusercontent.com/ThinkR-open/engineering-shiny-book/master/img/engineering-shiny.jpg" />
  <meta property="og:description" content="A book about engineering shiny application that will later be sent to production. This book cover project management, structuring your project, building a solid testing suite, and optimizing your codebase. We describe in this book a specific workflow: design, prototype, build, strengthen and deploy." />
  <meta name="github-repo" content="ThinkR-open/building-shiny-apps-workflow" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 16 Optimizing {shiny} Code | Engineering Production-Grade Shiny Apps" />
  
  <meta name="twitter:description" content="A book about engineering shiny application that will later be sent to production. This book cover project management, structuring your project, building a solid testing suite, and optimizing your codebase. We describe in this book a specific workflow: design, prototype, build, strengthen and deploy." />
  <meta name="twitter:image" content="https://raw.githubusercontent.com/ThinkR-open/engineering-shiny-book/master/img/engineering-shiny.jpg" />

<meta name="author" content="Colin Fay, Sébastien Rochette, Vincent Guyader, Cervan Girard" />


<meta name="date" content="2021-07-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon" />
<link rel="prev" href="common-app-caveats.html"/>
<link rel="next" href="using-javascript.html"/>
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block/empty-anchor.js"></script>
<link href="libs/anchor-sections/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections/anchor-sections.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-149994171-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-149994171-1');
</script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
<link rel="stylesheet" href="css/thinkr.css" type="text/css" />
<link rel="stylesheet" href="css/style_gitbook.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Engineering Production-Grade Shiny Apps</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#motivation"><i class="fa fa-check"></i>Motivation</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#audience-for-this-book"><i class="fa fa-check"></i>Audience for this book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-is-production"><i class="fa fa-check"></i>What is “production”?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#book-structure"><i class="fa fa-check"></i>Book structure</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-the-authors"><i class="fa fa-check"></i>About the authors</a><ul>
<li><a href="index.html#colin-fay"><a href="https://colinfay.me/">Colin Fay</a></a></li>
<li><a href="index.html#sébastien-rochette"><a href="https://statnmap.com/">Sébastien Rochette</a></a></li>
<li><a href="index.html#vincent-guyader"><a href="https://twitter.com/VincentGuyader">Vincent Guyader</a></a></li>
<li><a href="index.html#cervan-girard"><a href="https://twitter.com/CervanGirard">Cervan Girard</a></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#disclaimer"><i class="fa fa-check"></i>Disclaimer</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#software-information-and-conventions"><i class="fa fa-check"></i>Software information and conventions</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#want-to-help"><i class="fa fa-check"></i>Want to help?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#other-resources"><i class="fa fa-check"></i>Other resources</a><ul>
<li><a href="index.html#getting-started-with-shiny">Getting started with <code>{shiny}</code></a></li>
<li><a href="index.html#putting-shiny-into-production">Putting <code>{shiny}</code> into production</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgments"><i class="fa fa-check"></i>Acknowledgments</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#special-thanks"><i class="fa fa-check"></i>Special thanks</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#contributors-to-this-book"><i class="fa fa-check"></i>Contributors to this book</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="foreword.html"><a href="foreword.html"><i class="fa fa-check"></i>Foreword</a></li>
<li class="chapter" data-level="" data-path="application-presentation.html"><a href="application-presentation.html"><i class="fa fa-check"></i>Application presentation</a><ul>
<li><a href="application-presentation.html#hexmake"><code>{hexmake}</code></a></li>
<li><a href="application-presentation.html#tidytuesday201942"><code>{tidytuesday201942}</code></a></li>
<li><a href="application-presentation.html#minifying"><code>{minifying}</code></a></li>
<li class="chapter" data-level="" data-path="application-presentation.html"><a href="application-presentation.html#other-applications"><i class="fa fa-check"></i>Other applications</a></li>
</ul></li>
<li class="part"><span><b>I Building Successful {shiny} Apps</b></span></li>
<li class="chapter" data-level="1" data-path="successful-shiny-app.html"><a href="successful-shiny-app.html"><i class="fa fa-check"></i><b>1</b> About Successful <code>{shiny}</code> Apps</a><ul>
<li class="chapter" data-level="1.1" data-path="successful-shiny-app.html"><a href="successful-shiny-app.html#a-very-short-introduction-to-shiny"><i class="fa fa-check"></i><b>1.1</b> A (very) short introduction to <code>{shiny}</code></a></li>
<li class="chapter" data-level="1.2" data-path="successful-shiny-app.html"><a href="successful-shiny-app.html#complex-shiny"><i class="fa fa-check"></i><b>1.2</b> What is a complex <code>{shiny}</code> application?</a><ul>
<li class="chapter" data-level="1.2.1" data-path="successful-shiny-app.html"><a href="successful-shiny-app.html#reaching-the-cliff-of-complexity"><i class="fa fa-check"></i><b>1.2.1</b> Reaching the cliff of complexity</a></li>
<li class="chapter" data-level="1.2.2" data-path="successful-shiny-app.html"><a href="successful-shiny-app.html#balancing-complexities"><i class="fa fa-check"></i><b>1.2.2</b> Balancing complexities</a></li>
<li class="chapter" data-level="1.2.3" data-path="successful-shiny-app.html"><a href="successful-shiny-app.html#assessing-code-complexity"><i class="fa fa-check"></i><b>1.2.3</b> Assessing code complexity</a></li>
<li class="chapter" data-level="1.2.4" data-path="successful-shiny-app.html"><a href="successful-shiny-app.html#production-grade-software-engineering"><i class="fa fa-check"></i><b>1.2.4</b> Production-grade software engineering</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="successful-shiny-app.html"><a href="successful-shiny-app.html#what-is-a-successful-shiny-app"><i class="fa fa-check"></i><b>1.3</b> What is a successful <code>{shiny}</code> app?</a><ul>
<li class="chapter" data-level="1.3.1" data-path="successful-shiny-app.html"><a href="successful-shiny-app.html#it-exists"><i class="fa fa-check"></i><b>1.3.1</b> It exists</a></li>
<li class="chapter" data-level="1.3.2" data-path="successful-shiny-app.html"><a href="successful-shiny-app.html#it-is-accurate"><i class="fa fa-check"></i><b>1.3.2</b> It is accurate</a></li>
<li class="chapter" data-level="1.3.3" data-path="successful-shiny-app.html"><a href="successful-shiny-app.html#it-is-usable"><i class="fa fa-check"></i><b>1.3.3</b> It is usable</a></li>
<li class="chapter" data-level="1.3.4" data-path="successful-shiny-app.html"><a href="successful-shiny-app.html#it-is-immortal"><i class="fa fa-check"></i><b>1.3.4</b> It is immortal</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="planning-ahead.html"><a href="planning-ahead.html"><i class="fa fa-check"></i><b>2</b> Planning Ahead</a><ul>
<li class="chapter" data-level="2.1" data-path="planning-ahead.html"><a href="planning-ahead.html#working-with-a-long-term-mindset"><i class="fa fa-check"></i><b>2.1</b> Working with a “long-term” mindset</a><ul>
<li class="chapter" data-level="2.1.1" data-path="planning-ahead.html"><a href="planning-ahead.html#prepare-for-success"><i class="fa fa-check"></i><b>2.1.1</b> Prepare for success</a></li>
<li class="chapter" data-level="2.1.2" data-path="planning-ahead.html"><a href="planning-ahead.html#develop-with-the-kiss-principle"><i class="fa fa-check"></i><b>2.1.2</b> Develop with the KISS principle</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="planning-ahead.html"><a href="planning-ahead.html#working-as-a-team-tools-and-structure"><i class="fa fa-check"></i><b>2.2</b> Working as a team: Tools and structure</a><ul>
<li class="chapter" data-level="2.2.1" data-path="planning-ahead.html"><a href="planning-ahead.html#from-the-tools-point-of-view"><i class="fa fa-check"></i><b>2.2.1</b> From the tools point of view</a></li>
<li class="chapter" data-level="2.2.2" data-path="planning-ahead.html"><a href="planning-ahead.html#from-the-team-point-of-view"><i class="fa fa-check"></i><b>2.2.2</b> From the team point of view</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="structuring-project.html"><a href="structuring-project.html"><i class="fa fa-check"></i><b>3</b> Structuring Your Project</a><ul>
<li class="chapter" data-level="3.1" data-path="structuring-project.html"><a href="structuring-project.html#shiny-app-as-a-package"><i class="fa fa-check"></i><b>3.1</b> <code>{shiny}</code> app as a package</a><ul>
<li class="chapter" data-level="3.1.1" data-path="structuring-project.html"><a href="structuring-project.html#what-is-in-a-production-grade-shiny-app"><i class="fa fa-check"></i><b>3.1.1</b> What is in a production-grade <code>{shiny}</code> app?</a></li>
<li class="chapter" data-level="3.1.2" data-path="structuring-project.html"><a href="structuring-project.html#resources"><i class="fa fa-check"></i><b>3.1.2</b> Resources</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="structuring-project.html"><a href="structuring-project.html#using-shiny-modules"><i class="fa fa-check"></i><b>3.2</b> Using <code>{shiny}</code> modules</a><ul>
<li class="chapter" data-level="3.2.1" data-path="structuring-project.html"><a href="structuring-project.html#why-shiny-modules"><i class="fa fa-check"></i><b>3.2.1</b> Why <code>{shiny}</code> modules?</a></li>
<li class="chapter" data-level="3.2.2" data-path="structuring-project.html"><a href="structuring-project.html#when-to-use-shiny-modules"><i class="fa fa-check"></i><b>3.2.2</b> When to use <code>{shiny}</code> modules</a></li>
<li class="chapter" data-level="3.2.3" data-path="structuring-project.html"><a href="structuring-project.html#a-practical-walkthrough"><i class="fa fa-check"></i><b>3.2.3</b> A practical walkthrough</a></li>
<li class="chapter" data-level="3.2.4" data-path="structuring-project.html"><a href="structuring-project.html#communication-between-modules"><i class="fa fa-check"></i><b>3.2.4</b> Communication between modules</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="structuring-project.html"><a href="structuring-project.html#structuring-your-app"><i class="fa fa-check"></i><b>3.3</b> Structuring your app</a><ul>
<li class="chapter" data-level="3.3.1" data-path="structuring-project.html"><a href="structuring-project.html#business-logic-and-application-logic"><i class="fa fa-check"></i><b>3.3.1</b> Business logic and application logic</a></li>
<li class="chapter" data-level="3.3.2" data-path="structuring-project.html"><a href="structuring-project.html#small-is-beautiful-bis-repetita"><i class="fa fa-check"></i><b>3.3.2</b> Small is beautiful (bis repetita)</a></li>
<li class="chapter" data-level="3.3.3" data-path="structuring-project.html"><a href="structuring-project.html#conventions-matter"><i class="fa fa-check"></i><b>3.3.3</b> Conventions matter</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="golem.html"><a href="golem.html"><i class="fa fa-check"></i><b>4</b> Introduction to <code>{golem}</code></a><ul>
<li class="chapter" data-level="4.1" data-path="golem.html"><a href="golem.html#what-is-golem"><i class="fa fa-check"></i><b>4.1</b> What is <code>{golem}</code>?</a></li>
<li class="chapter" data-level="4.2" data-path="golem.html"><a href="golem.html#understanding-golem-app-structure"><i class="fa fa-check"></i><b>4.2</b> Understanding <code>{golem}</code> app structure</a><ul>
<li class="chapter" data-level="4.2.1" data-path="golem.html"><a href="golem.html#description-and-namespace"><i class="fa fa-check"></i><b>4.2.1</b> <code>DESCRIPTION</code> and <code>NAMESPACE</code></a></li>
<li class="chapter" data-level="4.2.2" data-path="golem.html"><a href="golem.html#r"><i class="fa fa-check"></i><b>4.2.2</b> R/</a></li>
<li class="chapter" data-level="4.2.3" data-path="golem.html"><a href="golem.html#golem-config"><i class="fa fa-check"></i><b>4.2.3</b> <code>golem-config</code></a></li>
<li class="chapter" data-level="4.2.4" data-path="golem.html"><a href="golem.html#instappwww"><i class="fa fa-check"></i><b>4.2.4</b> <code>inst/app/www/</code></a></li>
<li class="chapter" data-level="4.2.5" data-path="golem.html"><a href="golem.html#dev"><i class="fa fa-check"></i><b>4.2.5</b> <code>dev/</code></a></li>
<li class="chapter" data-level="4.2.6" data-path="golem.html"><a href="golem.html#man"><i class="fa fa-check"></i><b>4.2.6</b> <code>man/</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="workflow.html"><a href="workflow.html"><i class="fa fa-check"></i><b>5</b> The Workflow</a><ul>
<li class="chapter" data-level="5.1" data-path="workflow.html"><a href="workflow.html#step-1-design"><i class="fa fa-check"></i><b>5.1</b> Step 1: Design</a></li>
<li class="chapter" data-level="5.2" data-path="workflow.html"><a href="workflow.html#step-2-prototype"><i class="fa fa-check"></i><b>5.2</b> Step 2: Prototype</a></li>
<li class="chapter" data-level="5.3" data-path="workflow.html"><a href="workflow.html#step-3-build"><i class="fa fa-check"></i><b>5.3</b> Step 3: Build</a></li>
<li class="chapter" data-level="5.4" data-path="workflow.html"><a href="workflow.html#step-4-strengthen"><i class="fa fa-check"></i><b>5.4</b> Step 4: Strengthen</a></li>
<li class="chapter" data-level="5.5" data-path="workflow.html"><a href="workflow.html#step-5-deploy"><i class="fa fa-check"></i><b>5.5</b> Step 5: Deploy</a></li>
</ul></li>
<li class="part"><span><b>II Step 1: Design</b></span></li>
<li class="chapter" data-level="6" data-path="ux-matters.html"><a href="ux-matters.html"><i class="fa fa-check"></i><b>6</b> UX Matters</a><ul>
<li class="chapter" data-level="6.1" data-path="ux-matters.html"><a href="ux-matters.html#simplicity-is-gold"><i class="fa fa-check"></i><b>6.1</b> Simplicity is gold</a><ul>
<li class="chapter" data-level="6.1.1" data-path="ux-matters.html"><a href="ux-matters.html#how-we-read-the-web-scanning-content"><i class="fa fa-check"></i><b>6.1.1</b> How we read the web: Scanning content</a></li>
<li class="chapter" data-level="6.1.2" data-path="ux-matters.html"><a href="ux-matters.html#building-a-self-evident-app-or-at-least-self-explanatory"><i class="fa fa-check"></i><b>6.1.2</b> Building a self-evident app (or at least self-explanatory)</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="ux-matters.html"><a href="ux-matters.html#the-danger-of-feature-creep"><i class="fa fa-check"></i><b>6.2</b> The danger of feature-creep</a><ul>
<li class="chapter" data-level="6.2.1" data-path="ux-matters.html"><a href="ux-matters.html#what-is-feature-creep"><i class="fa fa-check"></i><b>6.2.1</b> What is feature-creep?</a></li>
<li class="chapter" data-level="6.2.2" data-path="ux-matters.html"><a href="ux-matters.html#too-much-reactivity"><i class="fa fa-check"></i><b>6.2.2</b> Too much reactivity</a></li>
<li class="chapter" data-level="6.2.3" data-path="ux-matters.html"><a href="ux-matters.html#too-much-interactivity"><i class="fa fa-check"></i><b>6.2.3</b> Too much interactivity</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="ux-matters.html"><a href="ux-matters.html#web-accessibility"><i class="fa fa-check"></i><b>6.3</b> Web accessibility</a><ul>
<li class="chapter" data-level="6.3.1" data-path="ux-matters.html"><a href="ux-matters.html#about-accessibility"><i class="fa fa-check"></i><b>6.3.1</b> About accessibility</a></li>
<li class="chapter" data-level="6.3.2" data-path="ux-matters.html"><a href="ux-matters.html#making-your-app-accessible"><i class="fa fa-check"></i><b>6.3.2</b> Making your app accessible</a></li>
<li class="chapter" data-level="6.3.3" data-path="ux-matters.html"><a href="ux-matters.html#evaluating-your-app-accessibility-and-further-reading"><i class="fa fa-check"></i><b>6.3.3</b> Evaluating your app accessibility and further reading</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="dont-rush-into-coding.html"><a href="dont-rush-into-coding.html"><i class="fa fa-check"></i><b>7</b> Don’t Rush into Coding</a><ul>
<li class="chapter" data-level="7.1" data-path="dont-rush-into-coding.html"><a href="dont-rush-into-coding.html#designing-before-coding"><i class="fa fa-check"></i><b>7.1</b> Designing before coding</a><ul>
<li class="chapter" data-level="7.1.1" data-path="dont-rush-into-coding.html"><a href="dont-rush-into-coding.html#the-urge-to-code"><i class="fa fa-check"></i><b>7.1.1</b> The urge to code</a></li>
<li class="chapter" data-level="7.1.2" data-path="dont-rush-into-coding.html"><a href="dont-rush-into-coding.html#knowing-where-to-search"><i class="fa fa-check"></i><b>7.1.2</b> Knowing where to search</a></li>
<li class="chapter" data-level="7.1.3" data-path="dont-rush-into-coding.html"><a href="dont-rush-into-coding.html#about-concept-map"><i class="fa fa-check"></i><b>7.1.3</b> About concept map</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="dont-rush-into-coding.html"><a href="dont-rush-into-coding.html#ask-questions"><i class="fa fa-check"></i><b>7.2</b> Ask questions</a><ul>
<li class="chapter" data-level="7.2.1" data-path="dont-rush-into-coding.html"><a href="dont-rush-into-coding.html#about-the-end-users"><i class="fa fa-check"></i><b>7.2.1</b> About the end users</a></li>
<li class="chapter" data-level="7.2.2" data-path="dont-rush-into-coding.html"><a href="dont-rush-into-coding.html#building-personas"><i class="fa fa-check"></i><b>7.2.2</b> Building personas</a></li>
<li class="chapter" data-level="7.2.3" data-path="dont-rush-into-coding.html"><a href="dont-rush-into-coding.html#pre-existing-code-base"><i class="fa fa-check"></i><b>7.2.3</b> Pre-existing code-base</a></li>
<li class="chapter" data-level="7.2.4" data-path="dont-rush-into-coding.html"><a href="dont-rush-into-coding.html#deployment"><i class="fa fa-check"></i><b>7.2.4</b> Deployment</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Step 2: Prototype</b></span></li>
<li class="chapter" data-level="8" data-path="setting-up-for-success.html"><a href="setting-up-for-success.html"><i class="fa fa-check"></i><b>8</b> Setting up for Success with <code>{golem}</code></a><ul>
<li class="chapter" data-level="8.1" data-path="setting-up-for-success.html"><a href="setting-up-for-success.html#create-a-golem"><i class="fa fa-check"></i><b>8.1</b> Create a <code>{golem}</code></a></li>
<li class="chapter" data-level="8.2" data-path="setting-up-for-success.html"><a href="setting-up-for-success.html#setting-things-up-with-dev01_start.r"><i class="fa fa-check"></i><b>8.2</b> Setting things up with <code>dev/01_start.R</code></a><ul>
<li class="chapter" data-level="8.2.1" data-path="setting-up-for-success.html"><a href="setting-up-for-success.html#fill-the-description-and-set-options"><i class="fa fa-check"></i><b>8.2.1</b> Fill the DESCRIPTION and set options</a></li>
<li class="chapter" data-level="8.2.2" data-path="setting-up-for-success.html"><a href="setting-up-for-success.html#set-common-files"><i class="fa fa-check"></i><b>8.2.2</b> Set common files</a></li>
<li class="chapter" data-level="8.2.3" data-path="setting-up-for-success.html"><a href="setting-up-for-success.html#use-recommended-elements"><i class="fa fa-check"></i><b>8.2.3</b> Use recommended elements</a></li>
<li class="chapter" data-level="8.2.4" data-path="setting-up-for-success.html"><a href="setting-up-for-success.html#add-utility-functions"><i class="fa fa-check"></i><b>8.2.4</b> Add utility functions</a></li>
<li class="chapter" data-level="8.2.5" data-path="setting-up-for-success.html"><a href="setting-up-for-success.html#changing-the-favicon"><i class="fa fa-check"></i><b>8.2.5</b> Changing the favicon</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="setting-up-for-success.html"><a href="setting-up-for-success.html#setting-infrastructure-for-prototyping"><i class="fa fa-check"></i><b>8.3</b> Setting infrastructure for prototyping</a><ul>
<li class="chapter" data-level="8.3.1" data-path="setting-up-for-success.html"><a href="setting-up-for-success.html#add-modules-in-dev02_dev.r"><i class="fa fa-check"></i><b>8.3.1</b> Add modules in <code>dev/02_dev.R</code></a></li>
<li class="chapter" data-level="8.3.2" data-path="setting-up-for-success.html"><a href="setting-up-for-success.html#add-css-and-js-files"><i class="fa fa-check"></i><b>8.3.2</b> Add CSS and JS files</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="building-ispum-app.html"><a href="building-ispum-app.html"><i class="fa fa-check"></i><b>9</b> Building an “ipsum-app”</a><ul>
<li class="chapter" data-level="9.1" data-path="building-ispum-app.html"><a href="building-ispum-app.html#prototyping-is-crucial"><i class="fa fa-check"></i><b>9.1</b> Prototyping is crucial</a><ul>
<li class="chapter" data-level="9.1.1" data-path="building-ispum-app.html"><a href="building-ispum-app.html#prototype-then-polish"><i class="fa fa-check"></i><b>9.1.1</b> Prototype, then polish</a></li>
<li class="chapter" data-level="9.1.2" data-path="building-ispum-app.html"><a href="building-ispum-app.html#the-ui-first-approach"><i class="fa fa-check"></i><b>9.1.2</b> The “UI first” approach</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="building-ispum-app.html"><a href="building-ispum-app.html#prototyping-shiny"><i class="fa fa-check"></i><b>9.2</b> Prototyping <code>{shiny}</code></a><ul>
<li class="chapter" data-level="9.2.1" data-path="building-ispum-app.html"><a href="building-ispum-app.html#fast-ui-prototyping-with-shinipsum"><i class="fa fa-check"></i><b>9.2.1</b> Fast UI prototyping with <code>{shinipsum}</code></a></li>
<li class="chapter" data-level="9.2.2" data-path="building-ispum-app.html"><a href="building-ispum-app.html#using-fakir-for-fake-data-generation"><i class="fa fa-check"></i><b>9.2.2</b> Using <code>{fakir}</code> for fake data generation</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="building-ispum-app.html"><a href="building-ispum-app.html#proto-rmdfirst"><i class="fa fa-check"></i><b>9.3</b> Building with RMarkdown</a><ul>
<li class="chapter" data-level="9.3.1" data-path="building-ispum-app.html"><a href="building-ispum-app.html#define-the-content-of-the-application"><i class="fa fa-check"></i><b>9.3.1</b> Define the content of the application</a></li>
<li class="chapter" data-level="9.3.2" data-path="building-ispum-app.html"><a href="building-ispum-app.html#using-the-rmd-files-as-a-laboratory-notebook"><i class="fa fa-check"></i><b>9.3.2</b> Using the Rmd files as a laboratory notebook</a></li>
<li class="chapter" data-level="9.3.3" data-path="building-ispum-app.html"><a href="building-ispum-app.html#rmd-vignettes-and-documentation-first"><i class="fa fa-check"></i><b>9.3.3</b> Rmd, Vignettes, and documentation first</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Step 3: Build</b></span></li>
<li class="chapter" data-level="10" data-path="build-app-golem.html"><a href="build-app-golem.html"><i class="fa fa-check"></i><b>10</b> Building the App with <code>{golem}</code></a><ul>
<li class="chapter" data-level="10.1" data-path="build-app-golem.html"><a href="build-app-golem.html#add-dependencies"><i class="fa fa-check"></i><b>10.1</b> Add dependencies</a><ul>
<li class="chapter" data-level="10.1.1" data-path="build-app-golem.html"><a href="build-app-golem.html#package-dependencies"><i class="fa fa-check"></i><b>10.1.1</b> Package dependencies</a></li>
<li class="chapter" data-level="10.1.2" data-path="build-app-golem.html"><a href="build-app-golem.html#importing-packages-and-functions"><i class="fa fa-check"></i><b>10.1.2</b> Importing packages and functions</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="build-app-golem.html"><a href="build-app-golem.html#submodules-and-utility-functions"><i class="fa fa-check"></i><b>10.2</b> Submodules and utility functions</a></li>
<li class="chapter" data-level="10.3" data-path="build-app-golem.html"><a href="build-app-golem.html#add-tests"><i class="fa fa-check"></i><b>10.3</b> Add tests</a></li>
<li class="chapter" data-level="10.4" data-path="build-app-golem.html"><a href="build-app-golem.html#documentation-and-code-coverage"><i class="fa fa-check"></i><b>10.4</b> Documentation and code coverage</a><ul>
<li class="chapter" data-level="10.4.1" data-path="build-app-golem.html"><a href="build-app-golem.html#vignette"><i class="fa fa-check"></i><b>10.4.1</b> Vignette</a></li>
<li class="chapter" data-level="10.4.2" data-path="build-app-golem.html"><a href="build-app-golem.html#code-coverage-and-continuous-integration"><i class="fa fa-check"></i><b>10.4.2</b> Code coverage and continuous integration</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="build-app-golem.html"><a href="build-app-golem.html#using-golem-dev-functions"><i class="fa fa-check"></i><b>10.5</b> Using <code>{golem}</code> dev functions</a></li>
</ul></li>
<li class="part"><span><b>V Step 4: Strengthen</b></span></li>
<li class="chapter" data-level="11" data-path="build-yourself-safety-net.html"><a href="build-yourself-safety-net.html"><i class="fa fa-check"></i><b>11</b> Build Yourself a Safety Net</a><ul>
<li class="chapter" data-level="11.1" data-path="build-yourself-safety-net.html"><a href="build-yourself-safety-net.html#testing-your-app"><i class="fa fa-check"></i><b>11.1</b> Testing your app</a><ul>
<li class="chapter" data-level="11.1.1" data-path="build-yourself-safety-net.html"><a href="build-yourself-safety-net.html#testing-the-business-logic"><i class="fa fa-check"></i><b>11.1.1</b> Testing the business logic</a></li>
<li class="chapter" data-level="11.1.2" data-path="build-yourself-safety-net.html"><a href="build-yourself-safety-net.html#shinytestserver"><i class="fa fa-check"></i><b>11.1.2</b> <code>shiny::testServer()</code></a></li>
<li class="chapter" data-level="11.1.3" data-path="build-yourself-safety-net.html"><a href="build-yourself-safety-net.html#testing-the-interactive-logic"><i class="fa fa-check"></i><b>11.1.3</b> Testing the interactive logic</a></li>
<li class="chapter" data-level="11.1.4" data-path="build-yourself-safety-net.html"><a href="build-yourself-safety-net.html#testing-the-app-load"><i class="fa fa-check"></i><b>11.1.4</b> Testing the app load</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="build-yourself-safety-net.html"><a href="build-yourself-safety-net.html#a-reproducible-environment"><i class="fa fa-check"></i><b>11.2</b> A reproducible environment</a><ul>
<li class="chapter" data-level="11.2.1" data-path="build-yourself-safety-net.html"><a href="build-yourself-safety-net.html#renv"><i class="fa fa-check"></i><b>11.2.1</b> <code>{renv}</code></a></li>
<li class="chapter" data-level="11.2.2" data-path="build-yourself-safety-net.html"><a href="build-yourself-safety-net.html#docker"><i class="fa fa-check"></i><b>11.2.2</b> Docker</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="version-control.html"><a href="version-control.html"><i class="fa fa-check"></i><b>12</b> Version Control</a><ul>
<li class="chapter" data-level="12.1" data-path="version-control.html"><a href="version-control.html#version-control-git"><i class="fa fa-check"></i><b>12.1</b> Using version control with <code>Git</code></a><ul>
<li class="chapter" data-level="12.1.1" data-path="version-control.html"><a href="version-control.html#why-version-control"><i class="fa fa-check"></i><b>12.1.1</b> Why version control?</a></li>
<li class="chapter" data-level="12.1.2" data-path="version-control.html"><a href="version-control.html#git-basics-add---commit---push---pull"><i class="fa fa-check"></i><b>12.1.2</b> <code>Git</code> basics: <code>add</code> - <code>commit</code> - <code>push</code> - <code>pull</code></a></li>
<li class="chapter" data-level="12.1.3" data-path="version-control.html"><a href="version-control.html#about-branches"><i class="fa fa-check"></i><b>12.1.3</b> About branches</a></li>
<li class="chapter" data-level="12.1.4" data-path="version-control.html"><a href="version-control.html#issues"><i class="fa fa-check"></i><b>12.1.4</b> Issues</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="version-control.html"><a href="version-control.html#git-integration"><i class="fa fa-check"></i><b>12.2</b> <code>Git</code> integration</a><ul>
<li class="chapter" data-level="12.2.1" data-path="version-control.html"><a href="version-control.html#with-rstudio"><i class="fa fa-check"></i><b>12.2.1</b> With RStudio</a></li>
<li class="chapter" data-level="12.2.2" data-path="version-control.html"><a href="version-control.html#as-part-of-a-larger-world"><i class="fa fa-check"></i><b>12.2.2</b> As part of a larger world</a></li>
<li class="chapter" data-level="12.2.3" data-path="version-control.html"><a href="version-control.html#about-git-flow"><i class="fa fa-check"></i><b>12.2.3</b> About <code>git-flow</code></a></li>
<li class="chapter" data-level="12.2.4" data-path="version-control.html"><a href="version-control.html#further-readings-on-git"><i class="fa fa-check"></i><b>12.2.4</b> Further readings on <code>Git</code></a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="version-control.html"><a href="version-control.html#automated-testing"><i class="fa fa-check"></i><b>12.3</b> Automated testing</a></li>
</ul></li>
<li class="part"><span><b>VI Step 5: Deploy</b></span></li>
<li class="chapter" data-level="13" data-path="deploy.html"><a href="deploy.html"><i class="fa fa-check"></i><b>13</b> Deploy Your Application</a><ul>
<li class="chapter" data-level="13.1" data-path="deploy.html"><a href="deploy.html#before-deployment-checklist"><i class="fa fa-check"></i><b>13.1</b> Before deployment checklist</a></li>
<li class="chapter" data-level="13.2" data-path="deploy.html"><a href="deploy.html#sharing-your-app-as-a-package"><i class="fa fa-check"></i><b>13.2</b> Sharing your app as a package</a><ul>
<li class="chapter" data-level="13.2.1" data-path="deploy.html"><a href="deploy.html#install-on-your-machine"><i class="fa fa-check"></i><b>13.2.1</b> Install on your machine</a></li>
<li class="chapter" data-level="13.2.2" data-path="deploy.html"><a href="deploy.html#share-as-a-built-package"><i class="fa fa-check"></i><b>13.2.2</b> Share as a built package</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="deploy.html"><a href="deploy.html#deploying-apps-with-golem"><i class="fa fa-check"></i><b>13.3</b> Deploying apps with <code>{golem}</code></a><ul>
<li class="chapter" data-level="13.3.1" data-path="deploy.html"><a href="deploy.html#rstudio-environments"><i class="fa fa-check"></i><b>13.3.1</b> RStudio environments</a></li>
<li class="chapter" data-level="13.3.2" data-path="deploy.html"><a href="deploy.html#docker-1"><i class="fa fa-check"></i><b>13.3.2</b> Docker</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>VII Optimizing</b></span></li>
<li class="chapter" data-level="14" data-path="need-for-optimization.html"><a href="need-for-optimization.html"><i class="fa fa-check"></i><b>14</b> The Need for Optimization</a><ul>
<li class="chapter" data-level="14.1" data-path="need-for-optimization.html"><a href="need-for-optimization.html#build-first-then-optimize"><i class="fa fa-check"></i><b>14.1</b> Build first, then optimize</a><ul>
<li class="chapter" data-level="14.1.1" data-path="need-for-optimization.html"><a href="need-for-optimization.html#identifying-bottlenecks"><i class="fa fa-check"></i><b>14.1.1</b> Identifying bottlenecks</a></li>
<li class="chapter" data-level="14.1.2" data-path="need-for-optimization.html"><a href="need-for-optimization.html#do-you-need-faster-functions"><i class="fa fa-check"></i><b>14.1.2</b> Do you need faster functions?</a></li>
<li class="chapter" data-level="14.1.3" data-path="need-for-optimization.html"><a href="need-for-optimization.html#dont-sacrifice-readability"><i class="fa fa-check"></i><b>14.1.3</b> Don’t sacrifice readability</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="need-for-optimization.html"><a href="need-for-optimization.html#tools-for-profiling"><i class="fa fa-check"></i><b>14.2</b> Tools for profiling</a><ul>
<li class="chapter" data-level="14.2.1" data-path="need-for-optimization.html"><a href="need-for-optimization.html#profiling-r-code"><i class="fa fa-check"></i><b>14.2.1</b> Profiling R code</a></li>
<li class="chapter" data-level="14.2.2" data-path="need-for-optimization.html"><a href="need-for-optimization.html#profiling-shiny"><i class="fa fa-check"></i><b>14.2.2</b> Profiling <code>{shiny}</code></a></li>
<li class="chapter" data-level="14.2.3" data-path="need-for-optimization.html"><a href="need-for-optimization.html#more-resources-about-web-page-performance"><i class="fa fa-check"></i><b>14.2.3</b> More resources about web-page performance</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="common-app-caveats.html"><a href="common-app-caveats.html"><i class="fa fa-check"></i><b>15</b> Common Application Caveats</a><ul>
<li class="chapter" data-level="15.1" data-path="common-app-caveats.html"><a href="common-app-caveats.html#reactivity-anti-patterns"><i class="fa fa-check"></i><b>15.1</b> Reactivity anti-patterns</a><ul>
<li class="chapter" data-level="15.1.1" data-path="common-app-caveats.html"><a href="common-app-caveats.html#reactivity-is-awesome-until-it-is-not"><i class="fa fa-check"></i><b>15.1.1</b> Reactivity is awesome… until it is not</a></li>
<li class="chapter" data-level="15.1.2" data-path="common-app-caveats.html"><a href="common-app-caveats.html#observe-vs-observeevent"><i class="fa fa-check"></i><b>15.1.2</b> <code>observe</code> vs <code>observeEvent</code></a></li>
<li class="chapter" data-level="15.1.3" data-path="common-app-caveats.html"><a href="common-app-caveats.html#building-triggers-and-watchers"><i class="fa fa-check"></i><b>15.1.3</b> Building triggers and watchers</a></li>
<li class="chapter" data-level="15.1.4" data-path="common-app-caveats.html"><a href="common-app-caveats.html#using-r6-as-data-storage"><i class="fa fa-check"></i><b>15.1.4</b> Using R6 as data storage</a></li>
<li class="chapter" data-level="15.1.5" data-path="common-app-caveats.html"><a href="common-app-caveats.html#logging-reactivity-with-whereami"><i class="fa fa-check"></i><b>15.1.5</b> Logging reactivity with <code>{whereami}</code></a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="common-app-caveats.html"><a href="common-app-caveats.html#r-does-too-much"><i class="fa fa-check"></i><b>15.2</b> R does too much</a><ul>
<li class="chapter" data-level="15.2.1" data-path="common-app-caveats.html"><a href="common-app-caveats.html#rendering-the-ui-from-the-server-side"><i class="fa fa-check"></i><b>15.2.1</b> Rendering the UI from the server side</a></li>
<li class="chapter" data-level="15.2.2" data-path="common-app-caveats.html"><a href="common-app-caveats.html#too-much-data-in-memory"><i class="fa fa-check"></i><b>15.2.2</b> Too much data in memory</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="common-app-caveats.html"><a href="common-app-caveats.html#reading-data"><i class="fa fa-check"></i><b>15.3</b> Reading data</a><ul>
<li class="chapter" data-level="15.3.1" data-path="common-app-caveats.html"><a href="common-app-caveats.html#including-data-in-your-application"><i class="fa fa-check"></i><b>15.3.1</b> Including data in your application</a></li>
<li class="chapter" data-level="15.3.2" data-path="common-app-caveats.html"><a href="common-app-caveats.html#reading-external-datasets"><i class="fa fa-check"></i><b>15.3.2</b> Reading external datasets</a></li>
<li class="chapter" data-level="15.3.3" data-path="common-app-caveats.html"><a href="common-app-caveats.html#using-external-databases"><i class="fa fa-check"></i><b>15.3.3</b> Using external databases</a></li>
<li class="chapter" data-level="15.3.4" data-path="common-app-caveats.html"><a href="common-app-caveats.html#data-source-checklist"><i class="fa fa-check"></i><b>15.3.4</b> Data-source checklist</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="optimizing-shiny-code.html"><a href="optimizing-shiny-code.html"><i class="fa fa-check"></i><b>16</b> Optimizing <code>{shiny}</code> Code</a><ul>
<li class="chapter" data-level="16.1" data-path="optimizing-shiny-code.html"><a href="optimizing-shiny-code.html#optimizing-r-code"><i class="fa fa-check"></i><b>16.1</b> Optimizing R code</a></li>
<li class="chapter" data-level="16.2" data-path="optimizing-shiny-code.html"><a href="optimizing-shiny-code.html#caching-elements"><i class="fa fa-check"></i><b>16.2</b> Caching elements</a><ul>
<li class="chapter" data-level="16.2.1" data-path="optimizing-shiny-code.html"><a href="optimizing-shiny-code.html#what-is-caching"><i class="fa fa-check"></i><b>16.2.1</b> What is caching?</a></li>
<li class="chapter" data-level="16.2.2" data-path="optimizing-shiny-code.html"><a href="optimizing-shiny-code.html#native-caching-in-r"><i class="fa fa-check"></i><b>16.2.2</b> Native caching in R</a></li>
<li class="chapter" data-level="16.2.3" data-path="optimizing-shiny-code.html"><a href="optimizing-shiny-code.html#caching-in-shiny"><i class="fa fa-check"></i><b>16.2.3</b> Caching in <code>{shiny}</code></a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="optimizing-shiny-code.html"><a href="optimizing-shiny-code.html#asynchronous-in-shiny"><i class="fa fa-check"></i><b>16.3</b> Asynchronous in <code>{shiny}</code></a><ul>
<li class="chapter" data-level="16.3.1" data-path="optimizing-shiny-code.html"><a href="optimizing-shiny-code.html#how-to"><i class="fa fa-check"></i><b>16.3.1</b> How to</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="using-javascript.html"><a href="using-javascript.html"><i class="fa fa-check"></i><b>17</b> Using JavaScript</a><ul>
<li class="chapter" data-level="17.1" data-path="using-javascript.html"><a href="using-javascript.html#introduction-1"><i class="fa fa-check"></i><b>17.1</b> Introduction</a></li>
<li class="chapter" data-level="17.2" data-path="using-javascript.html"><a href="using-javascript.html#a-quick-introduction-to-javascript"><i class="fa fa-check"></i><b>17.2</b> A quick introduction to JavaScript</a><ul>
<li class="chapter" data-level="17.2.1" data-path="using-javascript.html"><a href="using-javascript.html#about-javascript"><i class="fa fa-check"></i><b>17.2.1</b> About JavaScript</a></li>
<li class="chapter" data-level="17.2.2" data-path="using-javascript.html"><a href="using-javascript.html#including-javascript-code-in-your-app"><i class="fa fa-check"></i><b>17.2.2</b> Including JavaScript code in your app</a></li>
<li class="chapter" data-level="17.2.3" data-path="using-javascript.html"><a href="using-javascript.html#understanding-html-class-and-id"><i class="fa fa-check"></i><b>17.2.3</b> Understanding HTML, class, and id</a></li>
<li class="chapter" data-level="17.2.4" data-path="using-javascript.html"><a href="using-javascript.html#querying-in-vanilla-javascript"><i class="fa fa-check"></i><b>17.2.4</b> Querying in Vanilla JavaScript</a></li>
<li class="chapter" data-level="17.2.5" data-path="using-javascript.html"><a href="using-javascript.html#about-dom-events"><i class="fa fa-check"></i><b>17.2.5</b> About DOM events</a></li>
<li class="chapter" data-level="17.2.6" data-path="using-javascript.html"><a href="using-javascript.html#about-jquery-and-jquery-selectors"><i class="fa fa-check"></i><b>17.2.6</b> About <code>jQuery</code> and <code>jQuery</code> selectors</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="using-javascript.html"><a href="using-javascript.html#client-side-javascript"><i class="fa fa-check"></i><b>17.3</b> Client-side JavaScript</a><ul>
<li class="chapter" data-level="17.3.1" data-path="using-javascript.html"><a href="using-javascript.html#common-patterns"><i class="fa fa-check"></i><b>17.3.1</b> Common patterns</a></li>
<li class="chapter" data-level="17.3.2" data-path="using-javascript.html"><a href="using-javascript.html#where-to-put-them-back-to-javascript-events"><i class="fa fa-check"></i><b>17.3.2</b> Where to put them: Back to JavaScript Events</a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="using-javascript.html"><a href="using-javascript.html#javascript---shiny-communication"><i class="fa fa-check"></i><b>17.4</b> JavaScript &lt;-&gt; <code>{shiny}</code> communication</a><ul>
<li class="chapter" data-level="17.4.1" data-path="using-javascript.html"><a href="using-javascript.html#from-r-to-javascript"><i class="fa fa-check"></i><b>17.4.1</b> From R to JavaScript</a></li>
<li class="chapter" data-level="17.4.2" data-path="using-javascript.html"><a href="using-javascript.html#from-javascript-to-r"><i class="fa fa-check"></i><b>17.4.2</b> From JavaScript to R</a></li>
</ul></li>
<li class="chapter" data-level="17.5" data-path="using-javascript.html"><a href="using-javascript.html#about-shinyjs-js-functions"><i class="fa fa-check"></i><b>17.5</b> About <code>{shinyjs}</code> JS functions</a></li>
<li class="chapter" data-level="17.6" data-path="using-javascript.html"><a href="using-javascript.html#one-last-thing-api-calls"><i class="fa fa-check"></i><b>17.6</b> One last thing: API calls</a></li>
<li class="chapter" data-level="17.7" data-path="using-javascript.html"><a href="using-javascript.html#learn-more-about-javascript"><i class="fa fa-check"></i><b>17.7</b> Learn more about JavaScript</a><ul>
<li class="chapter" data-level="17.7.1" data-path="using-javascript.html"><a href="using-javascript.html#shiny-and-javascript"><i class="fa fa-check"></i><b>17.7.1</b> <code>{shiny}</code> and JavaScript</a></li>
<li class="chapter" data-level="17.7.2" data-path="using-javascript.html"><a href="using-javascript.html#javascript-basics"><i class="fa fa-check"></i><b>17.7.2</b> JavaScript basics</a></li>
<li class="chapter" data-level="17.7.3" data-path="using-javascript.html"><a href="using-javascript.html#jquery"><i class="fa fa-check"></i><b>17.7.3</b> jQuery</a></li>
<li class="chapter" data-level="17.7.4" data-path="using-javascript.html"><a href="using-javascript.html#intermediateadvanced-javascript"><i class="fa fa-check"></i><b>17.7.4</b> Intermediate/advanced JavaScript</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18" data-path="css.html"><a href="css.html"><i class="fa fa-check"></i><b>18</b> A Gentle Introduction to CSS</a><ul>
<li class="chapter" data-level="18.1" data-path="css.html"><a href="css.html#what-is-css"><i class="fa fa-check"></i><b>18.1</b> What is CSS?</a><ul>
<li class="chapter" data-level="18.1.1" data-path="css.html"><a href="css.html#about-css"><i class="fa fa-check"></i><b>18.1.1</b> About CSS</a></li>
<li class="chapter" data-level="18.1.2" data-path="css.html"><a href="css.html#shinys-default-fluidpage"><i class="fa fa-check"></i><b>18.1.2</b> <code>{shiny}</code>’s default: <code>fluidPage()</code></a></li>
</ul></li>
<li class="chapter" data-level="18.2" data-path="css.html"><a href="css.html#getting-started-with-css"><i class="fa fa-check"></i><b>18.2</b> Getting started with CSS</a><ul>
<li class="chapter" data-level="18.2.1" data-path="css.html"><a href="css.html#about-css-syntax"><i class="fa fa-check"></i><b>18.2.1</b> About CSS syntax</a></li>
<li class="chapter" data-level="18.2.2" data-path="css.html"><a href="css.html#css-selectors"><i class="fa fa-check"></i><b>18.2.2</b> CSS selectors</a></li>
<li class="chapter" data-level="18.2.3" data-path="css.html"><a href="css.html#css-properties"><i class="fa fa-check"></i><b>18.2.3</b> CSS properties</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="css.html"><a href="css.html#integrate-css-files-in-your-shiny-app"><i class="fa fa-check"></i><b>18.3</b> Integrate CSS files in your <code>{shiny}</code> app</a><ul>
<li class="chapter" data-level="18.3.1" data-path="css.html"><a href="css.html#inline-css"><i class="fa fa-check"></i><b>18.3.1</b> Inline CSS</a></li>
<li class="chapter" data-level="18.3.2" data-path="css.html"><a href="css.html#writing-in-a-tagsstyle"><i class="fa fa-check"></i><b>18.3.2</b> Writing in a <code>tags$style()</code></a></li>
<li class="chapter" data-level="18.3.3" data-path="css.html"><a href="css.html#including-external-files"><i class="fa fa-check"></i><b>18.3.3</b> Including external files</a></li>
<li class="chapter" data-level="18.3.4" data-path="css.html"><a href="css.html#using-r-packages"><i class="fa fa-check"></i><b>18.3.4</b> Using R packages</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="css.html"><a href="css.html#external-resources"><i class="fa fa-check"></i><b>18.4</b> External resources</a></li>
</ul></li>
<li class="part"><span><b>VIII Appendix</b></span></li>
<li class="chapter" data-level="" data-path="appendix-a-use-case-building-an-app-from-start-to-finish.html"><a href="appendix-a-use-case-building-an-app-from-start-to-finish.html"><i class="fa fa-check"></i>Appendix A - Use Case: Building an App from Start to Finish</a><ul>
<li class="chapter" data-level="" data-path="appendix-a-use-case-building-an-app-from-start-to-finish.html"><a href="appendix-a-use-case-building-an-app-from-start-to-finish.html#about-the-application"><i class="fa fa-check"></i>About the application</a></li>
<li class="chapter" data-level="" data-path="appendix-a-use-case-building-an-app-from-start-to-finish.html"><a href="appendix-a-use-case-building-an-app-from-start-to-finish.html#step-1-design-1"><i class="fa fa-check"></i>Step 1: Design</a><ul>
<li class="chapter" data-level="" data-path="appendix-a-use-case-building-an-app-from-start-to-finish.html"><a href="appendix-a-use-case-building-an-app-from-start-to-finish.html#deciphering-the-specifications"><i class="fa fa-check"></i>Deciphering the specifications</a></li>
<li class="chapter" data-level="" data-path="appendix-a-use-case-building-an-app-from-start-to-finish.html"><a href="appendix-a-use-case-building-an-app-from-start-to-finish.html#building-a-concept-map"><i class="fa fa-check"></i>Building a concept map</a></li>
<li class="chapter" data-level="" data-path="appendix-a-use-case-building-an-app-from-start-to-finish.html"><a href="appendix-a-use-case-building-an-app-from-start-to-finish.html#asking-questions"><i class="fa fa-check"></i>Asking questions</a></li>
<li class="chapter" data-level="" data-path="appendix-a-use-case-building-an-app-from-start-to-finish.html"><a href="appendix-a-use-case-building-an-app-from-start-to-finish.html#building-personas-1"><i class="fa fa-check"></i>Building personas</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendix-a-use-case-building-an-app-from-start-to-finish.html"><a href="appendix-a-use-case-building-an-app-from-start-to-finish.html#step-2-prototyping"><i class="fa fa-check"></i>Step 2: Prototyping</a><ul>
<li class="chapter" data-level="" data-path="appendix-a-use-case-building-an-app-from-start-to-finish.html"><a href="appendix-a-use-case-building-an-app-from-start-to-finish.html#back-end-in-rmd"><i class="fa fa-check"></i>Back-end in Rmd</a></li>
<li class="chapter" data-level="" data-path="appendix-a-use-case-building-an-app-from-start-to-finish.html"><a href="appendix-a-use-case-building-an-app-from-start-to-finish.html#ui-prototyping"><i class="fa fa-check"></i>UI prototyping</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendix-a-use-case-building-an-app-from-start-to-finish.html"><a href="appendix-a-use-case-building-an-app-from-start-to-finish.html#step-3-build-1"><i class="fa fa-check"></i>Step 3: Build</a></li>
<li class="chapter" data-level="" data-path="appendix-a-use-case-building-an-app-from-start-to-finish.html"><a href="appendix-a-use-case-building-an-app-from-start-to-finish.html#step-4-strengthen-1"><i class="fa fa-check"></i>Step 4: Strengthen</a></li>
<li class="chapter" data-level="" data-path="appendix-a-use-case-building-an-app-from-start-to-finish.html"><a href="appendix-a-use-case-building-an-app-from-start-to-finish.html#step-5-deploy-1"><i class="fa fa-check"></i>Step 5: Deploy</a><ul>
<li class="chapter" data-level="" data-path="appendix-a-use-case-building-an-app-from-start-to-finish.html"><a href="appendix-a-use-case-building-an-app-from-start-to-finish.html#before-deployment-checklist-1"><i class="fa fa-check"></i>Before deployment checklist</a></li>
<li class="chapter" data-level="" data-path="appendix-a-use-case-building-an-app-from-start-to-finish.html"><a href="appendix-a-use-case-building-an-app-from-start-to-finish.html#deploy-as-a-tar.gz"><i class="fa fa-check"></i>Deploy as a tar.gz</a></li>
<li class="chapter" data-level="" data-path="appendix-a-use-case-building-an-app-from-start-to-finish.html"><a href="appendix-a-use-case-building-an-app-from-start-to-finish.html#deploy-on-rstudio-connect"><i class="fa fa-check"></i>Deploy on RStudio Connect</a></li>
<li class="chapter" data-level="" data-path="appendix-a-use-case-building-an-app-from-start-to-finish.html"><a href="appendix-a-use-case-building-an-app-from-start-to-finish.html#deploy-with-docker"><i class="fa fa-check"></i>Deploy with Docker</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendix-b-session-info.html"><a href="appendix-b-session-info.html"><i class="fa fa-check"></i>Appendix B - Session Info</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://rtask.thinkr.fr">A book by the ThinkR team</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Engineering Production-Grade Shiny Apps</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="optimizing-shiny-code" class="section level1">
<h1><span class="header-section-number">Chapter 16</span> Optimizing <code>{shiny}</code> Code</h1>
<div id="optimizing-r-code" class="section level2">
<h2><span class="header-section-number">16.1</span> Optimizing R code</h2>
<p>In its core, <code>{shiny}</code> runs R code on the server side.
To be efficient, the R code computing your values and returning results also has to be optimized.</p>
<p>Optimizing R code is a very broad topic, and it would be possible to write a full book about it.
In fact, a lot of books and blog posts already cover this topic.
Instead of re-writing these books, we will try to point to some crucial resources you can refer to if you want to get started optimizing your R code.</p>
<ul>
<li><p>Efficient R programming <span class="citation">(Gillespie and Lovelace <a href="#ref-colingillespie2017" role="doc-biblioref">2017</a>)</span>, has a series of methods you can quickly put into practice for more efficient R code.</p></li>
<li><p>Advanced R <span class="citation">(Wickham <a href="#ref-hadleywickham2019" role="doc-biblioref">2019</a><a href="#ref-hadleywickham2019" role="doc-biblioref">b</a>)</span> has a chapter about optimizing R code (number 24).
In the rest of this chapter, we will be focusing on how to optimize <code>{shiny}</code> specifically.</p></li>
</ul>
</div>
<div id="caching-elements" class="section level2">
<h2><span class="header-section-number">16.2</span> Caching elements</h2>
<div id="what-is-caching" class="section level3">
<h3><span class="header-section-number">16.2.1</span> What is caching?</h3>
<p>Caching is the process of storing resources-intensive results so that when they are needed again, your program can reuse the result another time without having to redo the computation again.
This is particularly useful for computation that will always return the same result, and should never be used if you expect the result could vary from one function call to the other.</p>
<p>How does it work?
Let’s make a brief parallel with the human brain, and imagine that you know that you will need to use a phone number many times during the day, and for the purpose of this thought experiment, you are completely unable to remember it.<a href="#fn61" class="footnote-ref" id="fnref61"><sup>61</sup></a>
What are you going to do?
There are two solutions here: either you look in the phone book or in your phone contact list every time you need it, which takes a couple of seconds every time, or you use a post-it that you put on your computer screen with the number on it, so that you have direct access to it when you need it.
It takes a couple of seconds the first time you look for the number, but it is almost instantaneous the next times you need it.</p>
<p>This is what caching does: <strong>it stores the result of an expensive computation, so that the next time you need the very same information again, you can read the result instead of redoing the full computation</strong>.
The downside is that you only have limited space on your screen: when your screen is covered by sticky notes, you cannot store any more notes.<a href="#fn62" class="footnote-ref" id="fnref62"><sup>62</sup></a></p>
<p>In the context of an interactive application built with <code>{shiny}</code>, it makes sense to cache data structures: users tend to repeat what they do, or go back and forth between parameters.
For example, if you have a graph which is taking 2 seconds to render (which is quite common in <code>{shiny}</code>, notably when relying on <code>{ggplot2}</code> <span class="citation">(Wickham, Chang, et al. <a href="#ref-R-ggplot2" role="doc-biblioref">2021</a>)</span>), you do not want these 2 seconds to be repeated over and over again when users switch from one parameter to another.
In that case, it does make sense to cache the result: if you call <code>ploting_function(input$selection)</code> twice with the same value for <code>input$selection</code>, and you are sure that this plot will be the same every time, you can cache it.
In other words, instead of recomputing the graph on each <code>input$selection</code> change, you can cache the plot the first time it is generated, and then the application will read the cache instead of re-doing the computation.</p>
<p>Same goes for queries to a database: if a query is done with the same parameters, and you know that they will return the same result, there is no need to ask the database again and again—ask the cache to retrieve the data.</p>
<p>Keep in mind that this caching mechanism is only to be used when <strong>the data don’t change</strong>.
For example, if you are calling a database which is updated on a regular basis, you might not want to cache the results of a function.
In that specific case, you will want the query to be performed every time the function is called, so that you get fresh data.</p>
</div>
<div id="native-caching-in-r" class="section level3">
<h3><span class="header-section-number">16.2.2</span> Native caching in R</h3>
<p>At least two packages in R implement caching of functions (also called memoization): <code>{R.cache}</code> <span class="citation">(Bengtsson <a href="#ref-R-R.cache" role="doc-biblioref">2019</a>)</span>, and <code>{memoise}</code> <span class="citation">(Wickham, Hester, et al. <a href="#ref-R-memoise" role="doc-biblioref">2020</a>)</span>.
They both more or less work the same way: you will call a memoization function on another function, and cache is created for this function output, based on the arguments value.
Then every time you call this function again with the same parameters, the cache is returned instead of computing the function another time.
For example, if computing your data once takes 5 seconds with the parameter <code>n = 50</code>, the next time you will be calling this function with <code>n = 50</code>, instead of recomputing, R will go and fetch the value stored in cache.</p>
<p>Here is a simple example with <code>{memoise}</code>:</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="optimizing-shiny-code.html#cb297-1"></a><span class="kw">library</span>(memoise)</span>
<span id="cb297-2"><a href="optimizing-shiny-code.html#cb297-2"></a><span class="kw">library</span>(tictoc)</span>
<span id="cb297-3"><a href="optimizing-shiny-code.html#cb297-3"></a><span class="co"># We define a function that sleeps for a given number of seconds, </span></span>
<span id="cb297-4"><a href="optimizing-shiny-code.html#cb297-4"></a><span class="co"># then return the time </span></span>
<span id="cb297-5"><a href="optimizing-shiny-code.html#cb297-5"></a>sleep_and_return_time &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">seconds =</span> <span class="dv">1</span>){</span>
<span id="cb297-6"><a href="optimizing-shiny-code.html#cb297-6"></a>  <span class="kw">Sys.sleep</span>(seconds)</span>
<span id="cb297-7"><a href="optimizing-shiny-code.html#cb297-7"></a>  <span class="kw">return</span>(<span class="kw">Sys.time</span>())</span>
<span id="cb297-8"><a href="optimizing-shiny-code.html#cb297-8"></a>}</span>
<span id="cb297-9"><a href="optimizing-shiny-code.html#cb297-9"></a><span class="co"># &quot;Memoising&quot; this function</span></span>
<span id="cb297-10"><a href="optimizing-shiny-code.html#cb297-10"></a>msleep_and_return_time &lt;-<span class="st"> </span><span class="kw">memoise</span>(sleep_and_return_time)</span>
<span id="cb297-11"><a href="optimizing-shiny-code.html#cb297-11"></a><span class="co"># We use the {tictoc} package to count the time to run the code</span></span>
<span id="cb297-12"><a href="optimizing-shiny-code.html#cb297-12"></a><span class="kw">tic</span>()</span>
<span id="cb297-13"><a href="optimizing-shiny-code.html#cb297-13"></a><span class="co"># This will sleeep for 2 seconds and return the time</span></span>
<span id="cb297-14"><a href="optimizing-shiny-code.html#cb297-14"></a><span class="kw">msleep_and_return_time</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>[1] &quot;2021-07-19 05:45:14 UTC&quot;</code></pre>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="optimizing-shiny-code.html#cb299-1"></a><span class="co"># The code should have taken around 2 seconds to run</span></span>
<span id="cb299-2"><a href="optimizing-shiny-code.html#cb299-2"></a><span class="kw">toc</span>()</span></code></pre></div>
<pre><code>2.006 sec elapsed</code></pre>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="optimizing-shiny-code.html#cb301-1"></a><span class="co"># We launch a new recording</span></span>
<span id="cb301-2"><a href="optimizing-shiny-code.html#cb301-2"></a><span class="kw">tic</span>()</span>
<span id="cb301-3"><a href="optimizing-shiny-code.html#cb301-3"></a><span class="co"># This memoised function will return immediately, </span></span>
<span id="cb301-4"><a href="optimizing-shiny-code.html#cb301-4"></a><span class="co"># without sleeping</span></span>
<span id="cb301-5"><a href="optimizing-shiny-code.html#cb301-5"></a><span class="kw">msleep_and_return_time</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>[1] &quot;2021-07-19 05:45:14 UTC&quot;</code></pre>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="optimizing-shiny-code.html#cb303-1"></a><span class="kw">toc</span>()</span></code></pre></div>
<pre><code>0.024 sec elapsed</code></pre>
<p>Let’s try with another example that might look more like what we can find in a <code>{shiny}</code> app: connecting to a database, using the <code>{DBI}</code> <span class="citation">(R Special Interest Group on Databases (R-SIG-DB), Wickham, and Müller <a href="#ref-R-DBI" role="doc-biblioref">2019</a>)</span> and <code>{RSQLite}</code> <span class="citation">(Müller et al. <a href="#ref-R-RSQLite" role="doc-biblioref">2020</a>)</span> packages:</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="optimizing-shiny-code.html#cb305-1"></a><span class="co"># We create an in-memory database using SQLite</span></span>
<span id="cb305-2"><a href="optimizing-shiny-code.html#cb305-2"></a>con &lt;-<span class="st"> </span>DBI<span class="op">::</span><span class="kw">dbConnect</span>(</span>
<span id="cb305-3"><a href="optimizing-shiny-code.html#cb305-3"></a>  RSQLite<span class="op">::</span><span class="kw">SQLite</span>(), </span>
<span id="cb305-4"><a href="optimizing-shiny-code.html#cb305-4"></a>  <span class="dt">dbname =</span> <span class="st">&quot;:memory:&quot;</span></span>
<span id="cb305-5"><a href="optimizing-shiny-code.html#cb305-5"></a>)</span>
<span id="cb305-6"><a href="optimizing-shiny-code.html#cb305-6"></a></span>
<span id="cb305-7"><a href="optimizing-shiny-code.html#cb305-7"></a><span class="co"># Writing a large dataset to the db</span></span>
<span id="cb305-8"><a href="optimizing-shiny-code.html#cb305-8"></a>DBI<span class="op">::</span><span class="kw">dbWriteTable</span>(</span>
<span id="cb305-9"><a href="optimizing-shiny-code.html#cb305-9"></a>  con, </span>
<span id="cb305-10"><a href="optimizing-shiny-code.html#cb305-10"></a>  <span class="st">&quot;diams&quot;</span>, </span>
<span id="cb305-11"><a href="optimizing-shiny-code.html#cb305-11"></a>  <span class="co"># This table will have 539400 rows</span></span>
<span id="cb305-12"><a href="optimizing-shiny-code.html#cb305-12"></a>  dplyr<span class="op">::</span><span class="kw">bind_rows</span>(</span>
<span id="cb305-13"><a href="optimizing-shiny-code.html#cb305-13"></a>    purrr<span class="op">::</span><span class="kw">rerun</span>(<span class="dv">10</span>, ggplot2<span class="op">::</span>diamonds)</span>
<span id="cb305-14"><a href="optimizing-shiny-code.html#cb305-14"></a>  )</span>
<span id="cb305-15"><a href="optimizing-shiny-code.html#cb305-15"></a>)</span>
<span id="cb305-16"><a href="optimizing-shiny-code.html#cb305-16"></a></span>
<span id="cb305-17"><a href="optimizing-shiny-code.html#cb305-17"></a><span class="co"># We memoise the dbGetQuery,</span></span>
<span id="cb305-18"><a href="optimizing-shiny-code.html#cb305-18"></a><span class="co">#  so that every time this function is called with</span></span>
<span id="cb305-19"><a href="optimizing-shiny-code.html#cb305-19"></a><span class="co"># the same parameters, </span></span>
<span id="cb305-20"><a href="optimizing-shiny-code.html#cb305-20"></a><span class="co"># the SQL query is not actually run,</span></span>
<span id="cb305-21"><a href="optimizing-shiny-code.html#cb305-21"></a><span class="co">#  but the results are fetched from the cache </span></span>
<span id="cb305-22"><a href="optimizing-shiny-code.html#cb305-22"></a>m_get_query &lt;-<span class="st"> </span><span class="kw">memoise</span>(DBI<span class="op">::</span>dbGetQuery)</span>
<span id="cb305-23"><a href="optimizing-shiny-code.html#cb305-23"></a><span class="co"># We call a function the first time, </span></span>
<span id="cb305-24"><a href="optimizing-shiny-code.html#cb305-24"></a><span class="co"># with the connection object and an SQL query</span></span>
<span id="cb305-25"><a href="optimizing-shiny-code.html#cb305-25"></a><span class="kw">tic</span>()</span>
<span id="cb305-26"><a href="optimizing-shiny-code.html#cb305-26"></a>res_a &lt;-<span class="st"> </span><span class="kw">m_get_query</span>(</span>
<span id="cb305-27"><a href="optimizing-shiny-code.html#cb305-27"></a>  con, </span>
<span id="cb305-28"><a href="optimizing-shiny-code.html#cb305-28"></a>  <span class="st">&quot;SELECT * FROM diams WHERE cut = &#39;Ideal&#39;&quot;</span></span>
<span id="cb305-29"><a href="optimizing-shiny-code.html#cb305-29"></a>)</span>
<span id="cb305-30"><a href="optimizing-shiny-code.html#cb305-30"></a><span class="kw">toc</span>()</span></code></pre></div>
<pre><code>1.251 sec elapsed</code></pre>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="optimizing-shiny-code.html#cb307-1"></a><span class="co"># We call this function a second time, </span></span>
<span id="cb307-2"><a href="optimizing-shiny-code.html#cb307-2"></a><span class="co"># with the same parameters</span></span>
<span id="cb307-3"><a href="optimizing-shiny-code.html#cb307-3"></a><span class="kw">tic</span>()</span>
<span id="cb307-4"><a href="optimizing-shiny-code.html#cb307-4"></a>res_b &lt;-<span class="st"> </span><span class="kw">m_get_query</span>(</span>
<span id="cb307-5"><a href="optimizing-shiny-code.html#cb307-5"></a>  con, </span>
<span id="cb307-6"><a href="optimizing-shiny-code.html#cb307-6"></a>  <span class="st">&quot;SELECT * FROM diams WHERE cut = &#39;Ideal&#39;&quot;</span></span>
<span id="cb307-7"><a href="optimizing-shiny-code.html#cb307-7"></a>)</span>
<span id="cb307-8"><a href="optimizing-shiny-code.html#cb307-8"></a><span class="kw">toc</span>()</span></code></pre></div>
<pre><code>0.005 sec elapsed</code></pre>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="optimizing-shiny-code.html#cb309-1"></a><span class="co"># Let&#39;s check that the two are equal</span></span>
<span id="cb309-2"><a href="optimizing-shiny-code.html#cb309-2"></a><span class="kw">setequal</span>(res_a, res_b)</span></code></pre></div>
<pre><code>[1] TRUE</code></pre>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="optimizing-shiny-code.html#cb311-1"></a><span class="co"># We now try with a new SQL code (cut = &#39;Good&#39;)</span></span>
<span id="cb311-2"><a href="optimizing-shiny-code.html#cb311-2"></a><span class="kw">tic</span>()</span>
<span id="cb311-3"><a href="optimizing-shiny-code.html#cb311-3"></a>res_c &lt;-<span class="st"> </span><span class="kw">m_get_query</span>(</span>
<span id="cb311-4"><a href="optimizing-shiny-code.html#cb311-4"></a>  con, </span>
<span id="cb311-5"><a href="optimizing-shiny-code.html#cb311-5"></a>  <span class="st">&quot;SELECT * FROM diams WHERE cut = &#39;Good&#39;&quot;</span></span>
<span id="cb311-6"><a href="optimizing-shiny-code.html#cb311-6"></a>)</span>
<span id="cb311-7"><a href="optimizing-shiny-code.html#cb311-7"></a><span class="kw">toc</span>()</span></code></pre></div>
<pre><code>0.384 sec elapsed</code></pre>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="optimizing-shiny-code.html#cb313-1"></a><span class="co"># The function has effectively returned a different result</span></span>
<span id="cb313-2"><a href="optimizing-shiny-code.html#cb313-2"></a><span class="kw">setequal</span>(res_a, res_c)</span></code></pre></div>
<pre><code>[1] FALSE</code></pre>
<p>Note that you can change where the cache is stored by <code>{memoise}</code>.
Here, we will save it in a random directory (do not do this in production).</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="optimizing-shiny-code.html#cb315-1"></a>random_dir &lt;-<span class="st"> </span>fs<span class="op">::</span><span class="kw">path</span>(</span>
<span id="cb315-2"><a href="optimizing-shiny-code.html#cb315-2"></a>  <span class="kw">paste</span>(</span>
<span id="cb315-3"><a href="optimizing-shiny-code.html#cb315-3"></a>    <span class="kw">sample</span>(</span>
<span id="cb315-4"><a href="optimizing-shiny-code.html#cb315-4"></a>      letters, </span>
<span id="cb315-5"><a href="optimizing-shiny-code.html#cb315-5"></a>      <span class="dv">10</span></span>
<span id="cb315-6"><a href="optimizing-shiny-code.html#cb315-6"></a>    ), </span>
<span id="cb315-7"><a href="optimizing-shiny-code.html#cb315-7"></a>    <span class="dt">collapse =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb315-8"><a href="optimizing-shiny-code.html#cb315-8"></a>  )</span>
<span id="cb315-9"><a href="optimizing-shiny-code.html#cb315-9"></a>)</span>
<span id="cb315-10"><a href="optimizing-shiny-code.html#cb315-10"></a>random_dir</span></code></pre></div>
<pre><code>xawcubtjzp</code></pre>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="optimizing-shiny-code.html#cb317-1"></a><span class="co"># We create a directory in the current working directory</span></span>
<span id="cb317-2"><a href="optimizing-shiny-code.html#cb317-2"></a>fs<span class="op">::</span><span class="kw">dir_create</span>(random_dir)</span>
<span id="cb317-3"><a href="optimizing-shiny-code.html#cb317-3"></a><span class="co"># We use this directory as the cache_filesystem for {memoise}</span></span>
<span id="cb317-4"><a href="optimizing-shiny-code.html#cb317-4"></a>local_cache_folder &lt;-<span class="st"> </span><span class="kw">cache_filesystem</span>(random_dir)</span>
<span id="cb317-5"><a href="optimizing-shiny-code.html#cb317-5"></a><span class="co"># The memoised function will use this directory for cache</span></span>
<span id="cb317-6"><a href="optimizing-shiny-code.html#cb317-6"></a>m_get_query &lt;-<span class="st"> </span><span class="kw">memoise</span>(</span>
<span id="cb317-7"><a href="optimizing-shiny-code.html#cb317-7"></a>  DBI<span class="op">::</span>dbGetQuery, </span>
<span id="cb317-8"><a href="optimizing-shiny-code.html#cb317-8"></a>  <span class="dt">cache =</span> local_cache_folder</span>
<span id="cb317-9"><a href="optimizing-shiny-code.html#cb317-9"></a>)</span>
<span id="cb317-10"><a href="optimizing-shiny-code.html#cb317-10"></a><span class="co"># Run the function twice</span></span>
<span id="cb317-11"><a href="optimizing-shiny-code.html#cb317-11"></a>res_a &lt;-<span class="st"> </span><span class="kw">m_get_query</span>(</span>
<span id="cb317-12"><a href="optimizing-shiny-code.html#cb317-12"></a>  con,</span>
<span id="cb317-13"><a href="optimizing-shiny-code.html#cb317-13"></a>  <span class="st">&quot;SELECT * FROM diams WHERE cut = &#39;Ideal&#39;&quot;</span></span>
<span id="cb317-14"><a href="optimizing-shiny-code.html#cb317-14"></a>)</span>
<span id="cb317-15"><a href="optimizing-shiny-code.html#cb317-15"></a>res_b &lt;-<span class="st"> </span><span class="kw">m_get_query</span>(</span>
<span id="cb317-16"><a href="optimizing-shiny-code.html#cb317-16"></a>  con,</span>
<span id="cb317-17"><a href="optimizing-shiny-code.html#cb317-17"></a>  <span class="st">&quot;SELECT * FROM diams WHERE cut = &#39;Good&#39;&quot;</span></span>
<span id="cb317-18"><a href="optimizing-shiny-code.html#cb317-18"></a>)</span>
<span id="cb317-19"><a href="optimizing-shiny-code.html#cb317-19"></a>res_c &lt;-<span class="st"> </span><span class="kw">m_get_query</span>(</span>
<span id="cb317-20"><a href="optimizing-shiny-code.html#cb317-20"></a>  con, </span>
<span id="cb317-21"><a href="optimizing-shiny-code.html#cb317-21"></a>  <span class="st">&quot;SELECT * FROM diams WHERE cut = &#39;Good&#39;&quot;</span></span>
<span id="cb317-22"><a href="optimizing-shiny-code.html#cb317-22"></a>)</span>
<span id="cb317-23"><a href="optimizing-shiny-code.html#cb317-23"></a><span class="co"># The random directory now contains two objects, </span></span>
<span id="cb317-24"><a href="optimizing-shiny-code.html#cb317-24"></a><span class="co"># one for each memoized call</span></span>
<span id="cb317-25"><a href="optimizing-shiny-code.html#cb317-25"></a>fs<span class="op">::</span><span class="kw">dir_tree</span>(random_dir)</span></code></pre></div>
<pre><code>xawcubtjzp
├── 3764a0a4950cb30b
└── c295e060ea7d77c1</code></pre>
<p>As you can see, we now have two cache objects inside the directory we have specified as a <code>cache_filesystem</code>.</p>
</div>
<div id="caching-in-shiny" class="section level3">
<h3><span class="header-section-number">16.2.3</span> Caching in <code>{shiny}</code></h3>
<p>We can apply what we have just seen with <code>{memoise}</code>, for example, to render a table:</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="optimizing-shiny-code.html#cb319-1"></a><span class="kw">library</span>(memoise)</span>
<span id="cb319-2"><a href="optimizing-shiny-code.html#cb319-2"></a><span class="co"># We create an in-memory database using SQLite</span></span>
<span id="cb319-3"><a href="optimizing-shiny-code.html#cb319-3"></a>con &lt;-<span class="st"> </span>DBI<span class="op">::</span><span class="kw">dbConnect</span>(</span>
<span id="cb319-4"><a href="optimizing-shiny-code.html#cb319-4"></a>  RSQLite<span class="op">::</span><span class="kw">SQLite</span>(), </span>
<span id="cb319-5"><a href="optimizing-shiny-code.html#cb319-5"></a>  <span class="dt">dbname =</span> <span class="st">&quot;:memory:&quot;</span></span>
<span id="cb319-6"><a href="optimizing-shiny-code.html#cb319-6"></a>)</span>
<span id="cb319-7"><a href="optimizing-shiny-code.html#cb319-7"></a></span>
<span id="cb319-8"><a href="optimizing-shiny-code.html#cb319-8"></a><span class="co"># Writing a large dataset to the db</span></span>
<span id="cb319-9"><a href="optimizing-shiny-code.html#cb319-9"></a>DBI<span class="op">::</span><span class="kw">dbWriteTable</span>(</span>
<span id="cb319-10"><a href="optimizing-shiny-code.html#cb319-10"></a>  con, </span>
<span id="cb319-11"><a href="optimizing-shiny-code.html#cb319-11"></a>  <span class="st">&quot;diams&quot;</span>, </span>
<span id="cb319-12"><a href="optimizing-shiny-code.html#cb319-12"></a>  <span class="co"># This table will have 539400 rows</span></span>
<span id="cb319-13"><a href="optimizing-shiny-code.html#cb319-13"></a>  dplyr<span class="op">::</span><span class="kw">bind_rows</span>(</span>
<span id="cb319-14"><a href="optimizing-shiny-code.html#cb319-14"></a>    purrr<span class="op">::</span><span class="kw">rerun</span>(<span class="dv">10</span>, ggplot2<span class="op">::</span>diamonds)</span>
<span id="cb319-15"><a href="optimizing-shiny-code.html#cb319-15"></a>  )</span>
<span id="cb319-16"><a href="optimizing-shiny-code.html#cb319-16"></a>)</span>
<span id="cb319-17"><a href="optimizing-shiny-code.html#cb319-17"></a></span>
<span id="cb319-18"><a href="optimizing-shiny-code.html#cb319-18"></a></span>
<span id="cb319-19"><a href="optimizing-shiny-code.html#cb319-19"></a>fct_sql &lt;-<span class="st"> </span><span class="cf">function</span>(cut, con){</span>
<span id="cb319-20"><a href="optimizing-shiny-code.html#cb319-20"></a>  <span class="co"># NEVER EVER SPRINTF AN SQL CODE LIKE THAT</span></span>
<span id="cb319-21"><a href="optimizing-shiny-code.html#cb319-21"></a>  <span class="co"># IT&#39;S SENSITIVE TO SQL INJECTIONS, WE&#39;RE</span></span>
<span id="cb319-22"><a href="optimizing-shiny-code.html#cb319-22"></a>  <span class="co"># DOING IT FOR THE EXAMPLE</span></span>
<span id="cb319-23"><a href="optimizing-shiny-code.html#cb319-23"></a>  cli<span class="op">::</span><span class="kw">cat_rule</span>(<span class="st">&quot;Calling the SQL db&quot;</span>)</span>
<span id="cb319-24"><a href="optimizing-shiny-code.html#cb319-24"></a>  results &lt;-<span class="st"> </span>DBI<span class="op">::</span><span class="kw">dbGetQuery</span>(</span>
<span id="cb319-25"><a href="optimizing-shiny-code.html#cb319-25"></a>    con, <span class="kw">sprintf</span>(</span>
<span id="cb319-26"><a href="optimizing-shiny-code.html#cb319-26"></a>      <span class="st">&quot;SELECT * FROM diams WHERE cut = &#39;%s&#39;&quot;</span>, </span>
<span id="cb319-27"><a href="optimizing-shiny-code.html#cb319-27"></a>      cut</span>
<span id="cb319-28"><a href="optimizing-shiny-code.html#cb319-28"></a>    )</span>
<span id="cb319-29"><a href="optimizing-shiny-code.html#cb319-29"></a>  ) </span>
<span id="cb319-30"><a href="optimizing-shiny-code.html#cb319-30"></a>  <span class="kw">head</span>(results)</span>
<span id="cb319-31"><a href="optimizing-shiny-code.html#cb319-31"></a>}</span>
<span id="cb319-32"><a href="optimizing-shiny-code.html#cb319-32"></a></span>
<span id="cb319-33"><a href="optimizing-shiny-code.html#cb319-33"></a><span class="co"># Using a local cache</span></span>
<span id="cb319-34"><a href="optimizing-shiny-code.html#cb319-34"></a>cache_dir &lt;-<span class="st"> </span><span class="kw">cache_filesystem</span>(<span class="st">&quot;cache&quot;</span>)</span>
<span id="cb319-35"><a href="optimizing-shiny-code.html#cb319-35"></a>memoised_fct_sql &lt;-<span class="st"> </span><span class="kw">memoise</span>(fct_sql, <span class="dt">cache =</span> cache_dir)</span></code></pre></div>
<p>Then, it can be used in an app:</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="optimizing-shiny-code.html#cb320-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb320-2"><a href="optimizing-shiny-code.html#cb320-2"></a>ui &lt;-<span class="st"> </span><span class="cf">function</span>(){</span>
<span id="cb320-3"><a href="optimizing-shiny-code.html#cb320-3"></a>  <span class="kw">tagList</span>(</span>
<span id="cb320-4"><a href="optimizing-shiny-code.html#cb320-4"></a>    <span class="co"># The user can select one of the cut from ggplot2::diamonds,  </span></span>
<span id="cb320-5"><a href="optimizing-shiny-code.html#cb320-5"></a>    <span class="co"># {shiny} will then query the SQL database to retrieve the </span></span>
<span id="cb320-6"><a href="optimizing-shiny-code.html#cb320-6"></a>    <span class="co"># first rows of the result</span></span>
<span id="cb320-7"><a href="optimizing-shiny-code.html#cb320-7"></a>    <span class="kw">selectInput</span>(<span class="st">&quot;cut&quot;</span>, <span class="st">&quot;cut&quot;</span>, <span class="kw">unique</span>(ggplot2<span class="op">::</span>diamonds<span class="op">$</span>cut)),</span>
<span id="cb320-8"><a href="optimizing-shiny-code.html#cb320-8"></a>    <span class="kw">tableOutput</span>(<span class="st">&quot;tbl&quot;</span>)</span>
<span id="cb320-9"><a href="optimizing-shiny-code.html#cb320-9"></a>  )</span>
<span id="cb320-10"><a href="optimizing-shiny-code.html#cb320-10"></a>}</span>
<span id="cb320-11"><a href="optimizing-shiny-code.html#cb320-11"></a></span>
<span id="cb320-12"><a href="optimizing-shiny-code.html#cb320-12"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(</span>
<span id="cb320-13"><a href="optimizing-shiny-code.html#cb320-13"></a>  input, </span>
<span id="cb320-14"><a href="optimizing-shiny-code.html#cb320-14"></a>  output, </span>
<span id="cb320-15"><a href="optimizing-shiny-code.html#cb320-15"></a>  session</span>
<span id="cb320-16"><a href="optimizing-shiny-code.html#cb320-16"></a>){</span>
<span id="cb320-17"><a href="optimizing-shiny-code.html#cb320-17"></a>  </span>
<span id="cb320-18"><a href="optimizing-shiny-code.html#cb320-18"></a>  <span class="co"># Rendering the table of the SQL call</span></span>
<span id="cb320-19"><a href="optimizing-shiny-code.html#cb320-19"></a>  output<span class="op">$</span>tbl &lt;-<span class="st"> </span><span class="kw">renderTable</span>({</span>
<span id="cb320-20"><a href="optimizing-shiny-code.html#cb320-20"></a>    <span class="co"># Using a memoised function allows to prevent from </span></span>
<span id="cb320-21"><a href="optimizing-shiny-code.html#cb320-21"></a>    <span class="co"># calling the SQL database every time the user inputs</span></span>
<span id="cb320-22"><a href="optimizing-shiny-code.html#cb320-22"></a>    <span class="co"># a change</span></span>
<span id="cb320-23"><a href="optimizing-shiny-code.html#cb320-23"></a>    <span class="kw">memoised_fct_sql</span>(input<span class="op">$</span>cut, con)</span>
<span id="cb320-24"><a href="optimizing-shiny-code.html#cb320-24"></a>  })</span>
<span id="cb320-25"><a href="optimizing-shiny-code.html#cb320-25"></a>  </span>
<span id="cb320-26"><a href="optimizing-shiny-code.html#cb320-26"></a>}</span>
<span id="cb320-27"><a href="optimizing-shiny-code.html#cb320-27"></a></span>
<span id="cb320-28"><a href="optimizing-shiny-code.html#cb320-28"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<p>You will see that the first time you run this piece of code, it will take a couple of seconds to render the table for a new <code>input$cut</code> value.
But if you re-select this input a second time, the output will show instantaneously.</p>
<p>Since version <code>1.6.0</code>, <code>{shiny}</code> <span class="citation">(Chang et al. <a href="#ref-R-shiny" role="doc-biblioref">2020</a>)</span> has two caching functions: <code>renderCachedPlot()</code> and <code>bindCache()</code>
(note that <code>renderCachedPlot()</code> is in <code>{shiny}</code> since version <code>1.2.0</code>).</p>
<p><code>renderCachedPlot()</code> behaves more or less like the <code>renderPlot()</code> function, except that it is tailored for caching.
The extra arguments you will find are <code>cacheKeyExpr</code> and <code>sizePolicy</code>: the former is the list of inputs and values that allow you to cache the plot—every time these values and inputs are the same, they produce the same graph, so <code>{shiny}</code> will be fetching inside the cache instead of computing the value another time.
<code>sizePolicy</code> is a function that returns a <code>width</code> and a <code>height</code>, which are used to round the plot dimension in pixels, so that not every pixel combination is generated in the cache.</p>
<p>The good news is that converting existing <code>renderPlot()</code> functions to <code>renderCachedPlot()</code> is pretty straightforward in most cases: take your current <code>renderPlot()</code>, and add the cache keys.<a href="#fn63" class="footnote-ref" id="fnref63"><sup>63</sup></a></p>
<p>Here is an example:</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="optimizing-shiny-code.html#cb321-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb321-2"><a href="optimizing-shiny-code.html#cb321-2"></a>ui &lt;-<span class="st"> </span><span class="cf">function</span>(){</span>
<span id="cb321-3"><a href="optimizing-shiny-code.html#cb321-3"></a>  <span class="kw">tagList</span>(</span>
<span id="cb321-4"><a href="optimizing-shiny-code.html#cb321-4"></a>    <span class="co"># We select a data.frame to plot</span></span>
<span id="cb321-5"><a href="optimizing-shiny-code.html#cb321-5"></a>    <span class="kw">selectInput</span>(</span>
<span id="cb321-6"><a href="optimizing-shiny-code.html#cb321-6"></a>      <span class="st">&quot;tbl&quot;</span>, </span>
<span id="cb321-7"><a href="optimizing-shiny-code.html#cb321-7"></a>      <span class="st">&quot;Table&quot;</span>, </span>
<span id="cb321-8"><a href="optimizing-shiny-code.html#cb321-8"></a>      <span class="kw">c</span>(<span class="st">&quot;iris&quot;</span>, <span class="st">&quot;mtcars&quot;</span>, <span class="st">&quot;airquality&quot;</span>)</span>
<span id="cb321-9"><a href="optimizing-shiny-code.html#cb321-9"></a>    ),</span>
<span id="cb321-10"><a href="optimizing-shiny-code.html#cb321-10"></a>    <span class="co"># This plotOutput will be cached</span></span>
<span id="cb321-11"><a href="optimizing-shiny-code.html#cb321-11"></a>    <span class="kw">plotOutput</span>(<span class="st">&quot;plot&quot;</span>)</span>
<span id="cb321-12"><a href="optimizing-shiny-code.html#cb321-12"></a>  )</span>
<span id="cb321-13"><a href="optimizing-shiny-code.html#cb321-13"></a>}</span>
<span id="cb321-14"><a href="optimizing-shiny-code.html#cb321-14"></a></span>
<span id="cb321-15"><a href="optimizing-shiny-code.html#cb321-15"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(</span>
<span id="cb321-16"><a href="optimizing-shiny-code.html#cb321-16"></a>  input, </span>
<span id="cb321-17"><a href="optimizing-shiny-code.html#cb321-17"></a>  output, </span>
<span id="cb321-18"><a href="optimizing-shiny-code.html#cb321-18"></a>  session</span>
<span id="cb321-19"><a href="optimizing-shiny-code.html#cb321-19"></a>){</span>
<span id="cb321-20"><a href="optimizing-shiny-code.html#cb321-20"></a>  </span>
<span id="cb321-21"><a href="optimizing-shiny-code.html#cb321-21"></a>  <span class="co"># The cache mechanism is made available by renderCachedPlot</span></span>
<span id="cb321-22"><a href="optimizing-shiny-code.html#cb321-22"></a>  output<span class="op">$</span>plot &lt;-<span class="st"> </span><span class="kw">renderCachedPlot</span>({</span>
<span id="cb321-23"><a href="optimizing-shiny-code.html#cb321-23"></a>    <span class="co"># Plotting the selected data.frame</span></span>
<span id="cb321-24"><a href="optimizing-shiny-code.html#cb321-24"></a>    <span class="kw">plot</span>( <span class="kw">get</span>(input<span class="op">$</span>tbl) )</span>
<span id="cb321-25"><a href="optimizing-shiny-code.html#cb321-25"></a>  }, <span class="dt">cacheKeyExpr =</span> {</span>
<span id="cb321-26"><a href="optimizing-shiny-code.html#cb321-26"></a>    <span class="co"># List here all the reactive expression that will </span></span>
<span id="cb321-27"><a href="optimizing-shiny-code.html#cb321-27"></a>    <span class="co"># be used as cache key when running the app, </span></span>
<span id="cb321-28"><a href="optimizing-shiny-code.html#cb321-28"></a>    <span class="co"># you will see that the first time you plot one </span></span>
<span id="cb321-29"><a href="optimizing-shiny-code.html#cb321-29"></a>    <span class="co"># graph, it takes a couple of seconds, </span></span>
<span id="cb321-30"><a href="optimizing-shiny-code.html#cb321-30"></a>    <span class="co"># but the second time, it&#39;s almost </span></span>
<span id="cb321-31"><a href="optimizing-shiny-code.html#cb321-31"></a>    <span class="co"># instantaneous</span></span>
<span id="cb321-32"><a href="optimizing-shiny-code.html#cb321-32"></a>    input<span class="op">$</span>tbl</span>
<span id="cb321-33"><a href="optimizing-shiny-code.html#cb321-33"></a>  })</span>
<span id="cb321-34"><a href="optimizing-shiny-code.html#cb321-34"></a>  </span>
<span id="cb321-35"><a href="optimizing-shiny-code.html#cb321-35"></a>}</span>
<span id="cb321-36"><a href="optimizing-shiny-code.html#cb321-36"></a></span>
<span id="cb321-37"><a href="optimizing-shiny-code.html#cb321-37"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<p>If you try this app, the first rendering of the three plots will take a little bit of time, but every subsequent rendering of the plot is almost instantaneous.</p>
<p><code>bindCache()</code>, a new function from version <code>1.6.0</code>, offers a more general approach, as it can cache any reactive expression.</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="optimizing-shiny-code.html#cb322-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb322-2"><a href="optimizing-shiny-code.html#cb322-2"></a>ui &lt;-<span class="st"> </span><span class="cf">function</span>(){</span>
<span id="cb322-3"><a href="optimizing-shiny-code.html#cb322-3"></a>  <span class="kw">tagList</span>(</span>
<span id="cb322-4"><a href="optimizing-shiny-code.html#cb322-4"></a>    <span class="co"># Select a number of row to sample from mtcars</span></span>
<span id="cb322-5"><a href="optimizing-shiny-code.html#cb322-5"></a>    <span class="kw">sliderInput</span>(</span>
<span id="cb322-6"><a href="optimizing-shiny-code.html#cb322-6"></a>      <span class="st">&quot;nrows&quot;</span>, </span>
<span id="cb322-7"><a href="optimizing-shiny-code.html#cb322-7"></a>      <span class="st">&quot;Number of rows&quot;</span>, </span>
<span id="cb322-8"><a href="optimizing-shiny-code.html#cb322-8"></a>      <span class="dv">1</span>, </span>
<span id="cb322-9"><a href="optimizing-shiny-code.html#cb322-9"></a>      <span class="kw">nrow</span>(mtcars), </span>
<span id="cb322-10"><a href="optimizing-shiny-code.html#cb322-10"></a>      <span class="dv">10</span></span>
<span id="cb322-11"><a href="optimizing-shiny-code.html#cb322-11"></a>    ),</span>
<span id="cb322-12"><a href="optimizing-shiny-code.html#cb322-12"></a>    <span class="kw">tableOutput</span>(<span class="st">&quot;tbl&quot;</span>)</span>
<span id="cb322-13"><a href="optimizing-shiny-code.html#cb322-13"></a>  )</span>
<span id="cb322-14"><a href="optimizing-shiny-code.html#cb322-14"></a>}</span>
<span id="cb322-15"><a href="optimizing-shiny-code.html#cb322-15"></a></span>
<span id="cb322-16"><a href="optimizing-shiny-code.html#cb322-16"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(</span>
<span id="cb322-17"><a href="optimizing-shiny-code.html#cb322-17"></a>  input, </span>
<span id="cb322-18"><a href="optimizing-shiny-code.html#cb322-18"></a>  output, </span>
<span id="cb322-19"><a href="optimizing-shiny-code.html#cb322-19"></a>  session</span>
<span id="cb322-20"><a href="optimizing-shiny-code.html#cb322-20"></a>){</span>
<span id="cb322-21"><a href="optimizing-shiny-code.html#cb322-21"></a>  </span>
<span id="cb322-22"><a href="optimizing-shiny-code.html#cb322-22"></a>  <span class="co"># The random sample will always be the same</span></span>
<span id="cb322-23"><a href="optimizing-shiny-code.html#cb322-23"></a>  <span class="co"># Whenever input$nrows is the same</span></span>
<span id="cb322-24"><a href="optimizing-shiny-code.html#cb322-24"></a>  output<span class="op">$</span>tbl &lt;-<span class="st"> </span><span class="kw">renderTable</span>({</span>
<span id="cb322-25"><a href="optimizing-shiny-code.html#cb322-25"></a>    dplyr<span class="op">::</span><span class="kw">sample_n</span>(mtcars, input<span class="op">$</span>nrows)</span>
<span id="cb322-26"><a href="optimizing-shiny-code.html#cb322-26"></a>  }) <span class="op">%&gt;%</span></span>
<span id="cb322-27"><a href="optimizing-shiny-code.html#cb322-27"></a><span class="st">    </span><span class="kw">bindCache</span>({</span>
<span id="cb322-28"><a href="optimizing-shiny-code.html#cb322-28"></a>      input<span class="op">$</span>nrows</span>
<span id="cb322-29"><a href="optimizing-shiny-code.html#cb322-29"></a>    })</span>
<span id="cb322-30"><a href="optimizing-shiny-code.html#cb322-30"></a>}</span>
<span id="cb322-31"><a href="optimizing-shiny-code.html#cb322-31"></a></span>
<span id="cb322-32"><a href="optimizing-shiny-code.html#cb322-32"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<p><strong>Caching is a nice way to make your app faster, even more if you expect your output to be stable over time: if the plot created by a series of inputs stays the same throughout your app lifecycle, it is worth thinking about implementing on-disk caching</strong>.
With <code>{memoise}</code>, you can also use remote caching, in the form of Amazon S3 storage or with Google Cloud Storage.
See also the <a href="https://github.com/ThinkR-open/bank">{bank}</a> package for database caching of <code>{shiny}</code> expressions.</p>
<p>If your application needs “fresh” data every time it is used, for example because data in the SQL database are updated every hour, cache will not be of much help here.
On the contrary, the same function inputs will render different output depending on when they are called.</p>
<p>One other thing to remember is that, just like our computer screen from our phone number example from before, you do not have unlimited space when it comes to cache storage: storing a large amount of cache will take space on your disk.</p>
<p>For example, from our stored cache from before:</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="optimizing-shiny-code.html#cb323-1"></a>dir_i &lt;-<span class="st"> </span>fs<span class="op">::</span><span class="kw">dir_info</span>(<span class="st">&quot;cache&quot;</span>)[, <span class="st">&quot;size&quot;</span>, drop  =<span class="st"> </span><span class="ot">FALSE</span>] </span>
<span id="cb323-2"><a href="optimizing-shiny-code.html#cb323-2"></a><span class="kw">head</span>(dir_i)</span></code></pre></div>
<pre><code>  size
1  954
2  440
3  406
4  939
5  407
6  922</code></pre>
<p>Managing cache at a system level is a very vast, fascinating topic that we cannot cover here, but note that the most commonly accepted rule for deleting cache is called <strong>LRU</strong>, for <strong>Least Recently Used</strong>.
The underlying principle of this approach is that users tend to need what they have needed recently: hence the more a piece of data has been used recently, the more likely it is that it will be needed soon.
And this can be retrieved with:</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="optimizing-shiny-code.html#cb325-1"></a>dir_at &lt;-<span class="st"> </span>fs<span class="op">::</span><span class="kw">dir_info</span>(<span class="st">&quot;cache&quot;</span>)[, <span class="st">&quot;access_time&quot;</span>, drop  =<span class="st"> </span><span class="ot">FALSE</span>]</span>
<span id="cb325-2"><a href="optimizing-shiny-code.html#cb325-2"></a><span class="kw">head</span>(dir_at)</span></code></pre></div>
<pre><code>          access_time
1 2021-07-19 05:37:44
2 2021-07-19 05:37:44
3 2021-07-19 05:37:44
4 2021-07-19 05:37:44
5 2021-07-19 05:37:44
6 2021-07-19 05:37:44</code></pre>
<p>Hence, when using cache, it might be interesting to periodically remove the oldest used cache, so that you can regain some space on the server running the application.</p>
</div>
</div>
<div id="asynchronous-in-shiny" class="section level2">
<h2><span class="header-section-number">16.3</span> Asynchronous in <code>{shiny}</code></h2>
<p>One of the drawbacks of <code>{shiny}</code> is that as it is running on top of R, it is single threaded, meaning that each computation is run in sequence, one after the other.
Well, at least natively, as methods have emerged to run pieces of code in parallel.</p>
<div id="how-to" class="section level3">
<h3><span class="header-section-number">16.3.1</span> How to</h3>
<p>To launch code blocks in parallel, we will use a combination of two packages, <code>{future}</code> <span class="citation">(Bengtsson <a href="#ref-R-future" role="doc-biblioref">2020</a>)</span> and <code>{promises}</code> <span class="citation">(Cheng <a href="#ref-R-promises" role="doc-biblioref">2020</a>)</span>, and a <code>reactiveValue()</code>.
<code>{future}</code> is an R package whose main purpose is to allow users to send code to be run elsewhere, i.e. in another session, thread, or even on another machine.
<code>{promises}</code>, on the other hand, is a package providing structure for handling asynchronous programming in R.<a href="#fn64" class="footnote-ref" id="fnref64"><sup>64</sup></a></p>
<div id="a.-asynchronous-for-cross-sessions-availability" class="section level4 unnumbered">
<h4>A. Asynchronous for cross-sessions availability</h4>
<p>The first type of asynchronous programming in <code>{shiny}</code> <strong>allows non-blocking programming in a cross-session context</strong>.
In other words, it is a programming method which is useful in the context of running one <code>{shiny}</code> session that is accessed by multiple users.
Natively, in <code>{shiny}</code>, if <em>user1</em> launches a 15-seconds computation, then <em>user2</em> has to wait for this computation to finish before launching their own 15-seconds computation, and <em>user3</em> has to wait the 15 seconds of <em>user1</em> plus the 15 seconds for user, etc.</p>
<p>With <code>{future}</code> and <code>{promises}</code>, each long computation is sent to be run somewhere else, so when <em>user1</em> launches their 15-seconds computation, they are not blocking the R process for <em>user2</em> and <em>user3</em>.</p>
<p>How does it work?<a href="#fn65" class="footnote-ref" id="fnref65"><sup>65</sup></a>
<code>{promises}</code> comes with two operators which will be useful in our case, <code>%...&gt;%</code> and <code>%...!%</code>: the first being “what happens when the <code>future()</code> is solved?” (i.e. when the computation from the <code>future()</code> is completed), and the second is “what happens if the <code>future()</code> fails?” (i.e. what to do when the <code>future()</code> returns an error).</p>
<p>Here is an example of using this skeleton:</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="optimizing-shiny-code.html#cb327-1"></a><span class="kw">library</span>(future)</span>
<span id="cb327-2"><a href="optimizing-shiny-code.html#cb327-2"></a><span class="kw">library</span>(promises)</span>
<span id="cb327-3"><a href="optimizing-shiny-code.html#cb327-3"></a><span class="co"># We&#39;re opening several R session (future specific)</span></span>
<span id="cb327-4"><a href="optimizing-shiny-code.html#cb327-4"></a><span class="kw">plan</span>(multisession) </span>
<span id="cb327-5"><a href="optimizing-shiny-code.html#cb327-5"></a><span class="co"># We send our code to be run in another session</span></span>
<span id="cb327-6"><a href="optimizing-shiny-code.html#cb327-6"></a><span class="kw">future</span>({</span>
<span id="cb327-7"><a href="optimizing-shiny-code.html#cb327-7"></a>  <span class="kw">Sys.sleep</span>(<span class="dv">3</span>)</span>
<span id="cb327-8"><a href="optimizing-shiny-code.html#cb327-8"></a>  <span class="kw">return</span>(<span class="kw">rnorm</span>(<span class="dv">5</span>))</span>
<span id="cb327-9"><a href="optimizing-shiny-code.html#cb327-9"></a>}) <span class="op">%...&gt;%</span><span class="st"> </span>(</span>
<span id="cb327-10"><a href="optimizing-shiny-code.html#cb327-10"></a>  <span class="co"># When the code is returned, we print the result</span></span>
<span id="cb327-11"><a href="optimizing-shiny-code.html#cb327-11"></a>  <span class="cf">function</span>(result){</span>
<span id="cb327-12"><a href="optimizing-shiny-code.html#cb327-12"></a>    <span class="kw">print</span>(result)</span>
<span id="cb327-13"><a href="optimizing-shiny-code.html#cb327-13"></a>  }</span>
<span id="cb327-14"><a href="optimizing-shiny-code.html#cb327-14"></a>) <span class="op">%...!%</span><span class="st"> </span>(</span>
<span id="cb327-15"><a href="optimizing-shiny-code.html#cb327-15"></a>  <span class="co"># If ever the code from the future() returns an error, </span></span>
<span id="cb327-16"><a href="optimizing-shiny-code.html#cb327-16"></a>  <span class="co"># we throw an error to the console</span></span>
<span id="cb327-17"><a href="optimizing-shiny-code.html#cb327-17"></a>  <span class="cf">function</span>(error){</span>
<span id="cb327-18"><a href="optimizing-shiny-code.html#cb327-18"></a>    <span class="kw">stop</span>(error)</span>
<span id="cb327-19"><a href="optimizing-shiny-code.html#cb327-19"></a>  }</span>
<span id="cb327-20"><a href="optimizing-shiny-code.html#cb327-20"></a>)</span></code></pre></div>
<p>If you run this in your console, you will see that you have access to the R console directly after launching the code.
And a couple of seconds later (a little bit more than 3), the result of the <code>rnorm(5)</code> will be printed to the console.</p>
<p>Note that you can also write a one-line function with <code>.</code> as a parameter, instead of building the full anonymous function (we will use this notation in the rest of the chapter):</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="optimizing-shiny-code.html#cb328-1"></a><span class="kw">library</span>(future)</span>
<span id="cb328-2"><a href="optimizing-shiny-code.html#cb328-2"></a><span class="kw">library</span>(promises)</span>
<span id="cb328-3"><a href="optimizing-shiny-code.html#cb328-3"></a><span class="kw">plan</span>(multisession)</span>
<span id="cb328-4"><a href="optimizing-shiny-code.html#cb328-4"></a><span class="co"># Same code as before, using the anonymous notation</span></span>
<span id="cb328-5"><a href="optimizing-shiny-code.html#cb328-5"></a><span class="kw">future</span>({</span>
<span id="cb328-6"><a href="optimizing-shiny-code.html#cb328-6"></a>  <span class="kw">Sys.sleep</span>(<span class="dv">15</span>)</span>
<span id="cb328-7"><a href="optimizing-shiny-code.html#cb328-7"></a>  <span class="kw">return</span>(<span class="kw">rnorm</span>(<span class="dv">5</span>))</span>
<span id="cb328-8"><a href="optimizing-shiny-code.html#cb328-8"></a>}) <span class="op">%...&gt;%</span><span class="st"> </span></span>
<span id="cb328-9"><a href="optimizing-shiny-code.html#cb328-9"></a><span class="st">  </span><span class="kw">print</span>(.) <span class="op">%...!%</span><span class="st"> </span></span>
<span id="cb328-10"><a href="optimizing-shiny-code.html#cb328-10"></a><span class="st">  </span><span class="kw">stop</span>(.)</span></code></pre></div>
<p>Let’s port this to <code>{shiny}</code>:</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="optimizing-shiny-code.html#cb329-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb329-2"><a href="optimizing-shiny-code.html#cb329-2"></a><span class="kw">library</span>(future)</span>
<span id="cb329-3"><a href="optimizing-shiny-code.html#cb329-3"></a><span class="kw">library</span>(promises)</span>
<span id="cb329-4"><a href="optimizing-shiny-code.html#cb329-4"></a><span class="kw">plan</span>(multisession)</span>
<span id="cb329-5"><a href="optimizing-shiny-code.html#cb329-5"></a>ui &lt;-<span class="st"> </span><span class="cf">function</span>(){</span>
<span id="cb329-6"><a href="optimizing-shiny-code.html#cb329-6"></a>  <span class="kw">tagList</span>(</span>
<span id="cb329-7"><a href="optimizing-shiny-code.html#cb329-7"></a>    <span class="co"># This will receive the output of the future</span></span>
<span id="cb329-8"><a href="optimizing-shiny-code.html#cb329-8"></a>    <span class="kw">verbatimTextOutput</span>(<span class="st">&quot;rnorm&quot;</span>)</span>
<span id="cb329-9"><a href="optimizing-shiny-code.html#cb329-9"></a>  )</span>
<span id="cb329-10"><a href="optimizing-shiny-code.html#cb329-10"></a>}</span>
<span id="cb329-11"><a href="optimizing-shiny-code.html#cb329-11"></a></span>
<span id="cb329-12"><a href="optimizing-shiny-code.html#cb329-12"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(</span>
<span id="cb329-13"><a href="optimizing-shiny-code.html#cb329-13"></a>  input, </span>
<span id="cb329-14"><a href="optimizing-shiny-code.html#cb329-14"></a>  output, </span>
<span id="cb329-15"><a href="optimizing-shiny-code.html#cb329-15"></a>  session</span>
<span id="cb329-16"><a href="optimizing-shiny-code.html#cb329-16"></a>){</span>
<span id="cb329-17"><a href="optimizing-shiny-code.html#cb329-17"></a>  output<span class="op">$</span>rnorm &lt;-<span class="st"> </span><span class="kw">renderPrint</span>({</span>
<span id="cb329-18"><a href="optimizing-shiny-code.html#cb329-18"></a>    <span class="co"># Sending the rnorm to be run in another session</span></span>
<span id="cb329-19"><a href="optimizing-shiny-code.html#cb329-19"></a>    <span class="kw">future</span>({</span>
<span id="cb329-20"><a href="optimizing-shiny-code.html#cb329-20"></a>      <span class="kw">Sys.sleep</span>(<span class="dv">3</span>)</span>
<span id="cb329-21"><a href="optimizing-shiny-code.html#cb329-21"></a>      <span class="kw">return</span>(<span class="kw">rnorm</span>(<span class="dv">5</span>))</span>
<span id="cb329-22"><a href="optimizing-shiny-code.html#cb329-22"></a>    }) <span class="op">%...&gt;%</span><span class="st"> </span></span>
<span id="cb329-23"><a href="optimizing-shiny-code.html#cb329-23"></a><span class="st">      </span><span class="kw">print</span>(.) <span class="op">%...!%</span><span class="st"> </span></span>
<span id="cb329-24"><a href="optimizing-shiny-code.html#cb329-24"></a><span class="st">      </span><span class="kw">stop</span>(.)</span>
<span id="cb329-25"><a href="optimizing-shiny-code.html#cb329-25"></a>  })</span>
<span id="cb329-26"><a href="optimizing-shiny-code.html#cb329-26"></a>}</span>
<span id="cb329-27"><a href="optimizing-shiny-code.html#cb329-27"></a></span>
<span id="cb329-28"><a href="optimizing-shiny-code.html#cb329-28"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<p>If you have run this, it does not seem like a revolution: but trust us, the <code>Sys.sleep()</code> is not blocking as it allows other users to launch the same computation at the same moment.</p>
</div>
<div id="b.-inner-session-asynchronicity" class="section level4 unnumbered">
<h4>B. Inner-session asynchronicity</h4>
<p>In the previous section, we implemented cross-session asynchronicity, meaning that the code is non-blocking, but <strong>when two or more users access the same app: the code is still blocking at an inner-session level</strong>.
In other words, the code in the <code>renderPrint()</code> will still block the rest of the app for a single user.</p>
<p>Let’s have a look at this code:</p>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="optimizing-shiny-code.html#cb330-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb330-2"><a href="optimizing-shiny-code.html#cb330-2"></a>ui &lt;-<span class="st"> </span><span class="cf">function</span>(){</span>
<span id="cb330-3"><a href="optimizing-shiny-code.html#cb330-3"></a>  <span class="kw">tagList</span>(</span>
<span id="cb330-4"><a href="optimizing-shiny-code.html#cb330-4"></a>    <span class="co"># This will receive the output of the future</span></span>
<span id="cb330-5"><a href="optimizing-shiny-code.html#cb330-5"></a>    <span class="kw">verbatimTextOutput</span>(<span class="st">&quot;rnorm&quot;</span>),</span>
<span id="cb330-6"><a href="optimizing-shiny-code.html#cb330-6"></a>    <span class="co"># This plot will only be drawn when the future </span></span>
<span id="cb330-7"><a href="optimizing-shiny-code.html#cb330-7"></a>    <span class="co"># is resolved</span></span>
<span id="cb330-8"><a href="optimizing-shiny-code.html#cb330-8"></a>    <span class="kw">plotOutput</span>(<span class="st">&quot;plot&quot;</span>)</span>
<span id="cb330-9"><a href="optimizing-shiny-code.html#cb330-9"></a>  )</span>
<span id="cb330-10"><a href="optimizing-shiny-code.html#cb330-10"></a>}</span>
<span id="cb330-11"><a href="optimizing-shiny-code.html#cb330-11"></a></span>
<span id="cb330-12"><a href="optimizing-shiny-code.html#cb330-12"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(</span>
<span id="cb330-13"><a href="optimizing-shiny-code.html#cb330-13"></a>  input, </span>
<span id="cb330-14"><a href="optimizing-shiny-code.html#cb330-14"></a>  output, </span>
<span id="cb330-15"><a href="optimizing-shiny-code.html#cb330-15"></a>  session</span>
<span id="cb330-16"><a href="optimizing-shiny-code.html#cb330-16"></a>){</span>
<span id="cb330-17"><a href="optimizing-shiny-code.html#cb330-17"></a>  output<span class="op">$</span>rnorm &lt;-<span class="st"> </span><span class="kw">renderPrint</span>({</span>
<span id="cb330-18"><a href="optimizing-shiny-code.html#cb330-18"></a>    <span class="co"># Sending the rnorm to be run in another session</span></span>
<span id="cb330-19"><a href="optimizing-shiny-code.html#cb330-19"></a>    <span class="co"># At this point, {shiny} is waiting for the future</span></span>
<span id="cb330-20"><a href="optimizing-shiny-code.html#cb330-20"></a>    <span class="co"># to be solved before doing anything else</span></span>
<span id="cb330-21"><a href="optimizing-shiny-code.html#cb330-21"></a>    <span class="kw">future</span>({</span>
<span id="cb330-22"><a href="optimizing-shiny-code.html#cb330-22"></a>      <span class="kw">Sys.sleep</span>(<span class="dv">3</span>)</span>
<span id="cb330-23"><a href="optimizing-shiny-code.html#cb330-23"></a>      <span class="kw">return</span>(<span class="kw">rnorm</span>(<span class="dv">5</span>))</span>
<span id="cb330-24"><a href="optimizing-shiny-code.html#cb330-24"></a>    }) <span class="op">%...&gt;%</span><span class="st"> </span></span>
<span id="cb330-25"><a href="optimizing-shiny-code.html#cb330-25"></a><span class="st">      </span><span class="kw">print</span>(.) <span class="op">%...!%</span><span class="st"> </span></span>
<span id="cb330-26"><a href="optimizing-shiny-code.html#cb330-26"></a><span class="st">      </span><span class="kw">stop</span>(.)</span>
<span id="cb330-27"><a href="optimizing-shiny-code.html#cb330-27"></a>  })</span>
<span id="cb330-28"><a href="optimizing-shiny-code.html#cb330-28"></a>  </span>
<span id="cb330-29"><a href="optimizing-shiny-code.html#cb330-29"></a>  <span class="co"># This plot will only be drawn once the future is resolved</span></span>
<span id="cb330-30"><a href="optimizing-shiny-code.html#cb330-30"></a>  output<span class="op">$</span>plot &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({</span>
<span id="cb330-31"><a href="optimizing-shiny-code.html#cb330-31"></a>    <span class="kw">plot</span>(iris)</span>
<span id="cb330-32"><a href="optimizing-shiny-code.html#cb330-32"></a>  })</span>
<span id="cb330-33"><a href="optimizing-shiny-code.html#cb330-33"></a>}</span>
<span id="cb330-34"><a href="optimizing-shiny-code.html#cb330-34"></a></span>
<span id="cb330-35"><a href="optimizing-shiny-code.html#cb330-35"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<p>Here, you would expect the plot to be available before the <code>rnorm()</code>, but it is not: <code>{promises}</code> is still blocking at an inner-session level, so elements are still rendered sequentially.
To bypass that, we will need to use a <code>reactiveValue()</code> structure.</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="optimizing-shiny-code.html#cb331-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb331-2"><a href="optimizing-shiny-code.html#cb331-2"></a><span class="kw">library</span>(promises)</span>
<span id="cb331-3"><a href="optimizing-shiny-code.html#cb331-3"></a><span class="kw">library</span>(future)</span>
<span id="cb331-4"><a href="optimizing-shiny-code.html#cb331-4"></a><span class="kw">plan</span>(multisession)</span>
<span id="cb331-5"><a href="optimizing-shiny-code.html#cb331-5"></a></span>
<span id="cb331-6"><a href="optimizing-shiny-code.html#cb331-6"></a>ui &lt;-<span class="st"> </span><span class="cf">function</span>(){</span>
<span id="cb331-7"><a href="optimizing-shiny-code.html#cb331-7"></a>  <span class="kw">tagList</span>(</span>
<span id="cb331-8"><a href="optimizing-shiny-code.html#cb331-8"></a>    <span class="co"># This will receive the output of the future</span></span>
<span id="cb331-9"><a href="optimizing-shiny-code.html#cb331-9"></a>    <span class="kw">verbatimTextOutput</span>(<span class="st">&quot;rnorm&quot;</span>),</span>
<span id="cb331-10"><a href="optimizing-shiny-code.html#cb331-10"></a>    <span class="co"># This plot will be drawn before the future is resolved</span></span>
<span id="cb331-11"><a href="optimizing-shiny-code.html#cb331-11"></a>    <span class="kw">plotOutput</span>(<span class="st">&quot;plot&quot;</span>)</span>
<span id="cb331-12"><a href="optimizing-shiny-code.html#cb331-12"></a>  )</span>
<span id="cb331-13"><a href="optimizing-shiny-code.html#cb331-13"></a>}</span>
<span id="cb331-14"><a href="optimizing-shiny-code.html#cb331-14"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(</span>
<span id="cb331-15"><a href="optimizing-shiny-code.html#cb331-15"></a>  input, </span>
<span id="cb331-16"><a href="optimizing-shiny-code.html#cb331-16"></a>  output, </span>
<span id="cb331-17"><a href="optimizing-shiny-code.html#cb331-17"></a>  session</span>
<span id="cb331-18"><a href="optimizing-shiny-code.html#cb331-18"></a>) {</span>
<span id="cb331-19"><a href="optimizing-shiny-code.html#cb331-19"></a>  </span>
<span id="cb331-20"><a href="optimizing-shiny-code.html#cb331-20"></a>  <span class="co"># Initiating a reactiveValues that will receive the </span></span>
<span id="cb331-21"><a href="optimizing-shiny-code.html#cb331-21"></a>  <span class="co"># results from the future</span></span>
<span id="cb331-22"><a href="optimizing-shiny-code.html#cb331-22"></a>  rv &lt;-<span class="st"> </span><span class="kw">reactiveValues</span>(</span>
<span id="cb331-23"><a href="optimizing-shiny-code.html#cb331-23"></a>    <span class="dt">output =</span> <span class="ot">NULL</span></span>
<span id="cb331-24"><a href="optimizing-shiny-code.html#cb331-24"></a>  )</span>
<span id="cb331-25"><a href="optimizing-shiny-code.html#cb331-25"></a>  </span>
<span id="cb331-26"><a href="optimizing-shiny-code.html#cb331-26"></a>  <span class="kw">future</span>({</span>
<span id="cb331-27"><a href="optimizing-shiny-code.html#cb331-27"></a>    <span class="kw">Sys.sleep</span>(<span class="dv">5</span>)</span>
<span id="cb331-28"><a href="optimizing-shiny-code.html#cb331-28"></a>    <span class="kw">rnorm</span>(<span class="dv">5</span>)</span>
<span id="cb331-29"><a href="optimizing-shiny-code.html#cb331-29"></a>  }) <span class="op">%...&gt;%</span></span>
<span id="cb331-30"><a href="optimizing-shiny-code.html#cb331-30"></a><span class="st">    </span><span class="co"># When the future is resolved, we assign the</span></span>
<span id="cb331-31"><a href="optimizing-shiny-code.html#cb331-31"></a><span class="st">    </span><span class="co"># output to rv$output</span></span>
<span id="cb331-32"><a href="optimizing-shiny-code.html#cb331-32"></a><span class="st">    </span>(<span class="cf">function</span>(result){</span>
<span id="cb331-33"><a href="optimizing-shiny-code.html#cb331-33"></a>      rv<span class="op">$</span>output &lt;-<span class="st"> </span>result</span>
<span id="cb331-34"><a href="optimizing-shiny-code.html#cb331-34"></a>    }) <span class="op">%...!%</span></span>
<span id="cb331-35"><a href="optimizing-shiny-code.html#cb331-35"></a><span class="st">    </span><span class="co"># If ever the future outputs an error, we switch</span></span>
<span id="cb331-36"><a href="optimizing-shiny-code.html#cb331-36"></a><span class="st">    </span><span class="co"># back to NULL for rv$output, and throw a warning</span></span>
<span id="cb331-37"><a href="optimizing-shiny-code.html#cb331-37"></a><span class="st">    </span><span class="co"># with the error</span></span>
<span id="cb331-38"><a href="optimizing-shiny-code.html#cb331-38"></a><span class="st">    </span>(<span class="cf">function</span>(error){</span>
<span id="cb331-39"><a href="optimizing-shiny-code.html#cb331-39"></a>      rv<span class="op">$</span>output &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb331-40"><a href="optimizing-shiny-code.html#cb331-40"></a>      <span class="kw">warning</span>(error)</span>
<span id="cb331-41"><a href="optimizing-shiny-code.html#cb331-41"></a>    })</span>
<span id="cb331-42"><a href="optimizing-shiny-code.html#cb331-42"></a>  </span>
<span id="cb331-43"><a href="optimizing-shiny-code.html#cb331-43"></a>  <span class="co"># output$rnorm will be printed whenever rv$output</span></span>
<span id="cb331-44"><a href="optimizing-shiny-code.html#cb331-44"></a>  <span class="co"># is available (i.e. after around 5 seconds)</span></span>
<span id="cb331-45"><a href="optimizing-shiny-code.html#cb331-45"></a>  output<span class="op">$</span>rnorm &lt;-<span class="st"> </span><span class="kw">renderPrint</span>({</span>
<span id="cb331-46"><a href="optimizing-shiny-code.html#cb331-46"></a>    <span class="kw">req</span>(rv<span class="op">$</span>output)</span>
<span id="cb331-47"><a href="optimizing-shiny-code.html#cb331-47"></a>  })</span>
<span id="cb331-48"><a href="optimizing-shiny-code.html#cb331-48"></a>  </span>
<span id="cb331-49"><a href="optimizing-shiny-code.html#cb331-49"></a>  <span class="co"># output$plot will be drawn immediately</span></span>
<span id="cb331-50"><a href="optimizing-shiny-code.html#cb331-50"></a>  output<span class="op">$</span>plot &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({</span>
<span id="cb331-51"><a href="optimizing-shiny-code.html#cb331-51"></a>    <span class="kw">plot</span>(iris)</span>
<span id="cb331-52"><a href="optimizing-shiny-code.html#cb331-52"></a>  })</span>
<span id="cb331-53"><a href="optimizing-shiny-code.html#cb331-53"></a>}</span>
<span id="cb331-54"><a href="optimizing-shiny-code.html#cb331-54"></a></span>
<span id="cb331-55"><a href="optimizing-shiny-code.html#cb331-55"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<p>Let’s detail this code step-by-step:</p>
<ul>
<li><p><code>rv &lt;- reactiveValues</code> creates a <code>reactiveValue()</code> that will contain <code>NULL</code>, and which will serve the content of <code>renderPrint()</code> when the <code>future()</code> is resolved.
It is initiated as <code>NULL</code> so that the <code>renderPrint()</code> is silent at launch.</p></li>
<li><p><code>%...&gt;% rv$output &lt;- result %...!%</code> is the <code>{promises}</code> structure we have seen before.</p></li>
<li><p><code>%...!% (function(error){ rv$output &lt;- NULL ; warning(e) })</code> is what happens when the <code>future({})</code> fails: we are setting the <code>rv$res</code> value back to <code>NULL</code> so that the <code>renderPrint()</code> does not fail and prints an error in case of failure.</p></li>
</ul>
</div>
<div id="c.-potential-pitfalls-of-asynchronous-shiny" class="section level4 unnumbered">
<h4>C. Potential pitfalls of asynchronous <code>{shiny}</code></h4>
<p>There is one thing to be aware of if you plan on using this async methodology: you are not in a sequential context anymore.
Hence, the first <code>future({})</code> you will send is not necessarily the first you will get back.
For example, if you send SQL requests to be run asynchronously and each call takes between 1 and 10 seconds to return, there is a chance that the first request to return will be the last one you sent.
To handle that, we can adopt two different strategies, depending on what we need:</p>
<ul>
<li>We need only the last expression sent. In other words, if we send three expressions to be evaluated somewhere, we only need to get back the last one.
To handle that, the best way is to have an id that is also sent to the future, and when the future comes back, we check that this id is the one we are expecting. If it is, we update the <code>reactiveValues()</code>. If it is not, we ignore it.</li>
</ul>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="optimizing-shiny-code.html#cb332-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb332-2"><a href="optimizing-shiny-code.html#cb332-2"></a><span class="kw">library</span>(promises)</span>
<span id="cb332-3"><a href="optimizing-shiny-code.html#cb332-3"></a><span class="kw">library</span>(future)</span>
<span id="cb332-4"><a href="optimizing-shiny-code.html#cb332-4"></a><span class="kw">plan</span>(multisession)</span>
<span id="cb332-5"><a href="optimizing-shiny-code.html#cb332-5"></a></span>
<span id="cb332-6"><a href="optimizing-shiny-code.html#cb332-6"></a>ui &lt;-<span class="st"> </span><span class="cf">function</span>(){</span>
<span id="cb332-7"><a href="optimizing-shiny-code.html#cb332-7"></a>  <span class="kw">tagList</span>(</span>
<span id="cb332-8"><a href="optimizing-shiny-code.html#cb332-8"></a>    <span class="co"># This button trigger a future, we can click several times</span></span>
<span id="cb332-9"><a href="optimizing-shiny-code.html#cb332-9"></a>    <span class="co"># on it when the app is running</span></span>
<span id="cb332-10"><a href="optimizing-shiny-code.html#cb332-10"></a>    <span class="kw">actionButton</span>(<span class="st">&quot;go&quot;</span>, <span class="st">&quot;go&quot;</span>),</span>
<span id="cb332-11"><a href="optimizing-shiny-code.html#cb332-11"></a>    <span class="co"># This will receive the output of the future</span></span>
<span id="cb332-12"><a href="optimizing-shiny-code.html#cb332-12"></a>    <span class="kw">verbatimTextOutput</span>(<span class="st">&quot;rnorm&quot;</span>),</span>
<span id="cb332-13"><a href="optimizing-shiny-code.html#cb332-13"></a>    <span class="co"># This plot will be drawn before the future is resolved</span></span>
<span id="cb332-14"><a href="optimizing-shiny-code.html#cb332-14"></a>    <span class="kw">plotOutput</span>(<span class="st">&quot;plot&quot;</span>)</span>
<span id="cb332-15"><a href="optimizing-shiny-code.html#cb332-15"></a>  )</span>
<span id="cb332-16"><a href="optimizing-shiny-code.html#cb332-16"></a>}</span>
<span id="cb332-17"><a href="optimizing-shiny-code.html#cb332-17"></a></span>
<span id="cb332-18"><a href="optimizing-shiny-code.html#cb332-18"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(</span>
<span id="cb332-19"><a href="optimizing-shiny-code.html#cb332-19"></a>  input, </span>
<span id="cb332-20"><a href="optimizing-shiny-code.html#cb332-20"></a>  output, </span>
<span id="cb332-21"><a href="optimizing-shiny-code.html#cb332-21"></a>  session</span>
<span id="cb332-22"><a href="optimizing-shiny-code.html#cb332-22"></a>) {</span>
<span id="cb332-23"><a href="optimizing-shiny-code.html#cb332-23"></a>  </span>
<span id="cb332-24"><a href="optimizing-shiny-code.html#cb332-24"></a>  <span class="co"># In our reactiveValues, we also keep track</span></span>
<span id="cb332-25"><a href="optimizing-shiny-code.html#cb332-25"></a>  <span class="co"># of the latest sent id</span></span>
<span id="cb332-26"><a href="optimizing-shiny-code.html#cb332-26"></a>  rv &lt;-<span class="st"> </span><span class="kw">reactiveValues</span>(</span>
<span id="cb332-27"><a href="optimizing-shiny-code.html#cb332-27"></a>    <span class="dt">res =</span> <span class="ot">NULL</span>, </span>
<span id="cb332-28"><a href="optimizing-shiny-code.html#cb332-28"></a>    <span class="dt">last_id =</span> <span class="dv">0</span></span>
<span id="cb332-29"><a href="optimizing-shiny-code.html#cb332-29"></a>  )</span>
<span id="cb332-30"><a href="optimizing-shiny-code.html#cb332-30"></a>  </span>
<span id="cb332-31"><a href="optimizing-shiny-code.html#cb332-31"></a>  </span>
<span id="cb332-32"><a href="optimizing-shiny-code.html#cb332-32"></a>  <span class="kw">observeEvent</span>( input<span class="op">$</span>go , {</span>
<span id="cb332-33"><a href="optimizing-shiny-code.html#cb332-33"></a>    <span class="co"># When the user clicks on the button, the last_id</span></span>
<span id="cb332-34"><a href="optimizing-shiny-code.html#cb332-34"></a>    <span class="co"># is incremented of one</span></span>
<span id="cb332-35"><a href="optimizing-shiny-code.html#cb332-35"></a>    rv<span class="op">$</span>last_id &lt;-<span class="st"> </span>rv<span class="op">$</span>last_id <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb332-36"><a href="optimizing-shiny-code.html#cb332-36"></a>    last_id &lt;-<span class="st"> </span>rv<span class="op">$</span>last_id</span>
<span id="cb332-37"><a href="optimizing-shiny-code.html#cb332-37"></a>    </span>
<span id="cb332-38"><a href="optimizing-shiny-code.html#cb332-38"></a>    <span class="co"># We send the code to be run in the future. One out of </span></span>
<span id="cb332-39"><a href="optimizing-shiny-code.html#cb332-39"></a>    <span class="co"># two calls will sleep for 3 seconds</span></span>
<span id="cb332-40"><a href="optimizing-shiny-code.html#cb332-40"></a>    <span class="kw">future</span>({</span>
<span id="cb332-41"><a href="optimizing-shiny-code.html#cb332-41"></a>      <span class="cf">if</span> (last_id <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>){</span>
<span id="cb332-42"><a href="optimizing-shiny-code.html#cb332-42"></a>        <span class="kw">Sys.sleep</span>(<span class="dv">3</span>)</span>
<span id="cb332-43"><a href="optimizing-shiny-code.html#cb332-43"></a>      }</span>
<span id="cb332-44"><a href="optimizing-shiny-code.html#cb332-44"></a>      <span class="co"># We return from the future the id of the current </span></span>
<span id="cb332-45"><a href="optimizing-shiny-code.html#cb332-45"></a>      <span class="co"># code block</span></span>
<span id="cb332-46"><a href="optimizing-shiny-code.html#cb332-46"></a>      <span class="kw">list</span>(</span>
<span id="cb332-47"><a href="optimizing-shiny-code.html#cb332-47"></a>        <span class="dt">id =</span> last_id,</span>
<span id="cb332-48"><a href="optimizing-shiny-code.html#cb332-48"></a>        <span class="dt">res =</span> <span class="kw">rnorm</span>(<span class="dv">5</span>)</span>
<span id="cb332-49"><a href="optimizing-shiny-code.html#cb332-49"></a>      )</span>
<span id="cb332-50"><a href="optimizing-shiny-code.html#cb332-50"></a>    }) <span class="op">%...&gt;%</span></span>
<span id="cb332-51"><a href="optimizing-shiny-code.html#cb332-51"></a><span class="st">      </span>(<span class="cf">function</span>(result){</span>
<span id="cb332-52"><a href="optimizing-shiny-code.html#cb332-52"></a>        <span class="co"># Printing to the console which future</span></span>
<span id="cb332-53"><a href="optimizing-shiny-code.html#cb332-53"></a>        <span class="co"># we are coming from</span></span>
<span id="cb332-54"><a href="optimizing-shiny-code.html#cb332-54"></a>        cli<span class="op">::</span><span class="kw">cat_rule</span>(</span>
<span id="cb332-55"><a href="optimizing-shiny-code.html#cb332-55"></a>          <span class="kw">sprintf</span>(<span class="st">&quot;Back from %s&quot;</span>, result<span class="op">$</span>id)</span>
<span id="cb332-56"><a href="optimizing-shiny-code.html#cb332-56"></a>        )</span>
<span id="cb332-57"><a href="optimizing-shiny-code.html#cb332-57"></a>        <span class="co"># Change the value of `rv$res` only if </span></span>
<span id="cb332-58"><a href="optimizing-shiny-code.html#cb332-58"></a>        <span class="co"># the current id is the same as the last_id</span></span>
<span id="cb332-59"><a href="optimizing-shiny-code.html#cb332-59"></a>        <span class="cf">if</span> (result<span class="op">$</span>id <span class="op">==</span><span class="st"> </span>rv<span class="op">$</span>last_id){</span>
<span id="cb332-60"><a href="optimizing-shiny-code.html#cb332-60"></a>          rv<span class="op">$</span>res &lt;-<span class="st"> </span>result<span class="op">$</span>res</span>
<span id="cb332-61"><a href="optimizing-shiny-code.html#cb332-61"></a>        }</span>
<span id="cb332-62"><a href="optimizing-shiny-code.html#cb332-62"></a>      }) <span class="op">%...!%</span></span>
<span id="cb332-63"><a href="optimizing-shiny-code.html#cb332-63"></a><span class="st">      </span>(<span class="cf">function</span>(error){</span>
<span id="cb332-64"><a href="optimizing-shiny-code.html#cb332-64"></a>        <span class="kw">warning</span>(error)</span>
<span id="cb332-65"><a href="optimizing-shiny-code.html#cb332-65"></a>      })</span>
<span id="cb332-66"><a href="optimizing-shiny-code.html#cb332-66"></a>    <span class="co"># Note that every render() function should return</span></span>
<span id="cb332-67"><a href="optimizing-shiny-code.html#cb332-67"></a>    <span class="co">#  something: here it will only work if the </span></span>
<span id="cb332-68"><a href="optimizing-shiny-code.html#cb332-68"></a>    <span class="co">#  renderPrint() returns a value, even if </span></span>
<span id="cb332-69"><a href="optimizing-shiny-code.html#cb332-69"></a>    <span class="co"># invisible. We use cat_rule to simulate that.</span></span>
<span id="cb332-70"><a href="optimizing-shiny-code.html#cb332-70"></a>    cli<span class="op">::</span><span class="kw">cat_rule</span>(</span>
<span id="cb332-71"><a href="optimizing-shiny-code.html#cb332-71"></a>      <span class="kw">sprintf</span>(<span class="st">&quot;%s sent&quot;</span>, rv<span class="op">$</span>last_id)</span>
<span id="cb332-72"><a href="optimizing-shiny-code.html#cb332-72"></a>    )</span>
<span id="cb332-73"><a href="optimizing-shiny-code.html#cb332-73"></a>  })</span>
<span id="cb332-74"><a href="optimizing-shiny-code.html#cb332-74"></a>  </span>
<span id="cb332-75"><a href="optimizing-shiny-code.html#cb332-75"></a>  <span class="co"># output$rnorm will be printed whenever rv$output</span></span>
<span id="cb332-76"><a href="optimizing-shiny-code.html#cb332-76"></a>  <span class="co"># is available, i.e. returned from the future</span></span>
<span id="cb332-77"><a href="optimizing-shiny-code.html#cb332-77"></a>  <span class="co">#  and the last one sent.</span></span>
<span id="cb332-78"><a href="optimizing-shiny-code.html#cb332-78"></a>  output<span class="op">$</span>rnorm &lt;-<span class="st"> </span><span class="kw">renderPrint</span>({</span>
<span id="cb332-79"><a href="optimizing-shiny-code.html#cb332-79"></a>    <span class="kw">req</span>(rv<span class="op">$</span>res)</span>
<span id="cb332-80"><a href="optimizing-shiny-code.html#cb332-80"></a>  })</span>
<span id="cb332-81"><a href="optimizing-shiny-code.html#cb332-81"></a>  </span>
<span id="cb332-82"><a href="optimizing-shiny-code.html#cb332-82"></a>  <span class="co"># output$plot will be drawn immediately</span></span>
<span id="cb332-83"><a href="optimizing-shiny-code.html#cb332-83"></a>  output<span class="op">$</span>plot &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({</span>
<span id="cb332-84"><a href="optimizing-shiny-code.html#cb332-84"></a>    <span class="kw">plot</span>(iris)</span>
<span id="cb332-85"><a href="optimizing-shiny-code.html#cb332-85"></a>  })</span>
<span id="cb332-86"><a href="optimizing-shiny-code.html#cb332-86"></a>}</span>
<span id="cb332-87"><a href="optimizing-shiny-code.html#cb332-87"></a></span>
<span id="cb332-88"><a href="optimizing-shiny-code.html#cb332-88"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<ul>
<li>We need to treat the outputs in the order they are received. In that case, instead of waiting for the very last input, you will need to build a structure that will receive the output, check if this output is the “next in line”, store it if it is not, or return it if it is, and see if there is another output in the queue. This type of implementation is a little bit more complex, so we will not detail a full implementation in this chapter, but here is a small example of using <code>{liteq}</code> <span class="citation">(Csárdi <a href="#ref-R-liteq" role="doc-biblioref">2020</a><a href="#ref-R-liteq" role="doc-biblioref">b</a>)</span>.</li>
</ul>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="optimizing-shiny-code.html#cb333-1"></a><span class="kw">library</span>(promises)</span>
<span id="cb333-2"><a href="optimizing-shiny-code.html#cb333-2"></a><span class="kw">library</span>(future)</span>
<span id="cb333-3"><a href="optimizing-shiny-code.html#cb333-3"></a><span class="kw">plan</span>(multisession)</span>
<span id="cb333-4"><a href="optimizing-shiny-code.html#cb333-4"></a></span>
<span id="cb333-5"><a href="optimizing-shiny-code.html#cb333-5"></a><span class="kw">library</span>(liteq)</span>
<span id="cb333-6"><a href="optimizing-shiny-code.html#cb333-6"></a><span class="co"># We create a small db in a tempfile()</span></span>
<span id="cb333-7"><a href="optimizing-shiny-code.html#cb333-7"></a>temp_queue &lt;-<span class="st"> </span><span class="kw">tempfile</span>()</span>
<span id="cb333-8"><a href="optimizing-shiny-code.html#cb333-8"></a>queue &lt;-<span class="st"> </span><span class="kw">ensure_queue</span>(<span class="st">&quot;jobs&quot;</span>, <span class="dt">db =</span> temp_queue)</span>
<span id="cb333-9"><a href="optimizing-shiny-code.html#cb333-9"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>){</span>
<span id="cb333-10"><a href="optimizing-shiny-code.html#cb333-10"></a>  <span class="kw">future</span>({</span>
<span id="cb333-11"><a href="optimizing-shiny-code.html#cb333-11"></a>    <span class="co"># Faking a random computation time</span></span>
<span id="cb333-12"><a href="optimizing-shiny-code.html#cb333-12"></a>    <span class="kw">Sys.sleep</span>( <span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dv">1</span>) )</span>
<span id="cb333-13"><a href="optimizing-shiny-code.html#cb333-13"></a>    <span class="kw">return</span>(</span>
<span id="cb333-14"><a href="optimizing-shiny-code.html#cb333-14"></a>      <span class="kw">list</span>(</span>
<span id="cb333-15"><a href="optimizing-shiny-code.html#cb333-15"></a>        <span class="dt">id =</span> i,</span>
<span id="cb333-16"><a href="optimizing-shiny-code.html#cb333-16"></a>        <span class="dt">res =</span> <span class="kw">rnorm</span>(<span class="dv">5</span>)</span>
<span id="cb333-17"><a href="optimizing-shiny-code.html#cb333-17"></a>      )</span>
<span id="cb333-18"><a href="optimizing-shiny-code.html#cb333-18"></a>    )</span>
<span id="cb333-19"><a href="optimizing-shiny-code.html#cb333-19"></a>  }) <span class="op">%...&gt;%</span><span class="st"> </span></span>
<span id="cb333-20"><a href="optimizing-shiny-code.html#cb333-20"></a><span class="st">    </span><span class="co"># Whenever we receive an output, we add it to </span></span>
<span id="cb333-21"><a href="optimizing-shiny-code.html#cb333-21"></a><span class="st">    </span><span class="co"># the queue database</span></span>
<span id="cb333-22"><a href="optimizing-shiny-code.html#cb333-22"></a><span class="st">    </span>(<span class="cf">function</span>(results){</span>
<span id="cb333-23"><a href="optimizing-shiny-code.html#cb333-23"></a>      <span class="kw">publish</span>(</span>
<span id="cb333-24"><a href="optimizing-shiny-code.html#cb333-24"></a>        queue, </span>
<span id="cb333-25"><a href="optimizing-shiny-code.html#cb333-25"></a>        <span class="dt">title =</span> <span class="kw">as.character</span>(results<span class="op">$</span>i), </span>
<span id="cb333-26"><a href="optimizing-shiny-code.html#cb333-26"></a>        <span class="dt">message =</span> <span class="kw">paste</span>(</span>
<span id="cb333-27"><a href="optimizing-shiny-code.html#cb333-27"></a>          results<span class="op">$</span>res, </span>
<span id="cb333-28"><a href="optimizing-shiny-code.html#cb333-28"></a>          <span class="dt">collapse =</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb333-29"><a href="optimizing-shiny-code.html#cb333-29"></a>        )</span>
<span id="cb333-30"><a href="optimizing-shiny-code.html#cb333-30"></a>      )</span>
<span id="cb333-31"><a href="optimizing-shiny-code.html#cb333-31"></a>    }) <span class="op">%...!%</span><span class="st"> </span></span>
<span id="cb333-32"><a href="optimizing-shiny-code.html#cb333-32"></a><span class="st">    </span><span class="co"># If ever we have an error, we return it as a warning</span></span>
<span id="cb333-33"><a href="optimizing-shiny-code.html#cb333-33"></a><span class="st">    </span><span class="kw">warning</span>(.)</span>
<span id="cb333-34"><a href="optimizing-shiny-code.html#cb333-34"></a>}</span>
<span id="cb333-35"><a href="optimizing-shiny-code.html#cb333-35"></a><span class="kw">Sys.sleep</span>(<span class="dv">10</span>)</span>
<span id="cb333-36"><a href="optimizing-shiny-code.html#cb333-36"></a><span class="co"># List the messages. As you can see, the entries in title</span></span>
<span id="cb333-37"><a href="optimizing-shiny-code.html#cb333-37"></a><span class="co"># are not in numerical order because they didn&#39;t came back</span></span>
<span id="cb333-38"><a href="optimizing-shiny-code.html#cb333-38"></a><span class="co"># in the same order as they were sent</span></span>
<span id="cb333-39"><a href="optimizing-shiny-code.html#cb333-39"></a><span class="kw">list_messages</span>(queue)</span></code></pre></div>
<pre><code>  id title status
1  1     3  READY
2  2     4  READY
3  3     2  READY
4  4     1  READY
5  5     5  READY</code></pre>
<p>For an example of an application built using <code>{promise}</code> and <code>{future}</code>, feel free to browse <a href="https://engineering-shiny.org/shinyfuture/">engineering-shiny.org/shinyfuture/</a>: there you will find an example of blocking and non-blocking processes.</p>

</div>
</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-R-R.cache">
<p>Bengtsson, Henrik. 2019. <em>R.cache: Fast and Light-Weight Caching (Memoization) of Objects and Results to Speed up Computations</em>. <a href="https://github.com/HenrikBengtsson/R.cache">https://github.com/HenrikBengtsson/R.cache</a>.</p>
</div>
<div id="ref-R-future">
<p>Bengtsson, Henrik. 2020. <em>Future: Unified Parallel and Distributed Processing in R for Everyone</em>. <a href="https://github.com/HenrikBengtsson/future">https://github.com/HenrikBengtsson/future</a>.</p>
</div>
<div id="ref-R-shiny">
<p>Chang, Winston, Joe Cheng, JJ Allaire, Yihui Xie, and Jonathan McPherson. 2020. <em>Shiny: Web Application Framework for R</em>. <a href="http://shiny.rstudio.com">http://shiny.rstudio.com</a>.</p>
</div>
<div id="ref-R-promises">
<p>Cheng, Joe. 2020. <em>Promises: Abstractions for Promise-Based Asynchronous Programming</em>.</p>
</div>
<div id="ref-R-liteq">
<p>Csárdi, Gábor. 2020b. <em>Liteq: Lightweight Portable Message Queue Using Sqlite</em>. <a href="https://github.com/r-lib/liteq#readme">https://github.com/r-lib/liteq#readme</a>.</p>
</div>
<div id="ref-colingillespie2017">
<p>Gillespie, Colin, and Robin Lovelace. 2017. <em>Efficient R Programming</em>. O’Reilly Media, Inc, USA.</p>
</div>
<div id="ref-R-RSQLite">
<p>Müller, Kirill, Hadley Wickham, David A. James, and Seth Falcon. 2020. <em>RSQLite: SQLite Interface for R</em>.</p>
</div>
<div id="ref-R-DBI">
<p>R Special Interest Group on Databases (R-SIG-DB), Hadley Wickham, and Kirill Müller. 2019. <em>DBI: R Database Interface</em>.</p>
</div>
<div id="ref-hadleywickham2019">
<p>Wickham, Hadley. 2019b. <em>Advanced R, Second Edition</em>. Chapman; Hall/CRC.</p>
</div>
<div id="ref-R-ggplot2">
<p>Wickham, Hadley, Winston Chang, Lionel Henry, Thomas Lin Pedersen, Kohske Takahashi, Claus Wilke, Kara Woo, Hiroaki Yutani, and Dewey Dunnington. 2021. <em>Ggplot2: Create Elegant Data Visualisations Using the Grammar of Graphics</em>.</p>
</div>
<div id="ref-R-memoise">
<p>Wickham, Hadley, Jim Hester, Kirill Müller, and Daniel Cook. 2020. <em>Memoise: Memoisation of Functions</em>. <a href="https://github.com/r-lib/memoise">https://github.com/r-lib/memoise</a>.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="61">
<li id="fn61"><p>Anyway, now that we all have smartphones, who still remembers phone numbers?<a href="optimizing-shiny-code.html#fnref61" class="footnote-back">↩︎</a></p></li>
<li id="fn63"><p>In some cases you will have to configure the size policy, but in most cases the default values work just well.<a href="optimizing-shiny-code.html#fnref63" class="footnote-back">↩︎</a></p></li>
<li id="fn64"><p>If you are familiar with promises in JavaScript, <code>{promises}</code> is an implementation of this structure into R.<a href="optimizing-shiny-code.html#fnref64" class="footnote-back">↩︎</a></p></li>
<li id="fn65"><p>We’re providing a short introduction with key concepts, but for a more thorough introduction, please refer to the <a href="https://rstudio.github.io/promises/index.html">online documentation</a>.<a href="optimizing-shiny-code.html#fnref65" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
<hr/>
<footer>
<a href="rtask.thinkr.fr"><img src="img/logo400_129.png" alt="ThinkR Website"/></a>
<!--https://yihui.org/en/2018/09/target-blank/-->
<script>
  (function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>
</footer>
            </section>

          </div>
        </div>
      </div>
<a href="common-app-caveats.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="using-javascript.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/ThinkR-open/building-shiny-apps-workflow/edit/master/16-optimizing-shiny-code.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
